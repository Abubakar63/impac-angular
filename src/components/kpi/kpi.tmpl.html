<div class="kpi" ng-class="{ 'static': kpi.static, 'triggered': (kpi.layout.triggered && !isEditing() && !kpi.isLoading), 'editing': isEditing() }">
  <div class="top-line" ng-class="{ 'triggered': kpi.layout.triggered }" ng-hide="kpi.isLoading"></div>
  <div class="kpi-content" ng-class="{ 'editing': isEditing() }" ng-hide="kpi.isLoading">
    <!-- SHOW -->
    <div class="kpi-show row nomargin nopadding" ng-hide="isEditing()">
      <div class="col-xs-3 col-sm-3 kpi-icon" ng-class="{ 'triggered': kpi.layout.triggered }">
        <i class="fa {{kpi.layout.icon.value}} fa-2x"></i>
      </div>
      <div class="col-xs-9 col-sm-9 kpi-text" ng-class="{ 'triggered': kpi.layout.triggered }">
        <span class="caption">{{kpi.layout.text.caption}}</span>
        <span class="emphasis"><strong>{{kpi.layout.text.emphasis}}</strong></span>
      </div>
    </div>
    <!-- EDIT -->
    <div class="kpi-edit" ng-show="isEditing()">
      <div class="kpi-name">
        <h6>{{::kpi.name.toUpperCase()}}</h6>
      </div>

      <alerts-config kpi="kpi" button-html="
          <div class='im-button alert-caption'>
            <span>Alert me when I'm {{getTargetModeLabel()}}</span>
          </div>">
      </alerts-config>

      <!-- TODO: refactor design to handle multiple targets and ranges -->
      <form name="kpi{{kpi.id}}SettingsForm">
        <!-- <div class="im-form-inline"> -->
        <div class="im-form-group" ng-class="this['kpi'+kpi.id+'SettingsForm'].limitValue.$valid ? 'has-success' : 'has-error'">
          <!-- target input -->
          <input name="limitValue" type="text" ng-model="kpi.limit.value" placeholder="{{targetPlaceholder}}" ng-focus="setTargetPlaceholder()" ng-blur="resetTargetPlaceholder()" required>
          <label for="limitValue" class="im-control-label">{{kpi.element_watched}}</label><i class="im-bar"></i>
          <span class="kpi-target-unit" aria-hidden="true">{{getKpiTargetUnit()}}</span>
          <!-- error messages -->
          <div ng-messages="this['kpi'+kpi.id+'SettingsForm'].limitValue.$error" class="im-messages">
            <span ng-message="required">KPI target is required</span>
          </div>
        </div>
          <!-- TODO: second watchable. -->
          <!-- <div class="im-form-group">
            <input name="depr" type="text" required>
            <label for="depr" class="im-control-label">Test</label>
            <i class="im-bar"></i>
          </div>
        </div> -->
        <div class="im-form-group">
          <div ng-repeat="(param, paramValues) in kpi.possibleExtraParams track by $index">
            <!-- extra param selection -->
            <select name="extraParam" ng-model="kpi.extra_params[param]" ng-options="value.id as value.label for value in paramValues">
            </select>
            <label for="extraParam" class="im-control-label">Select {{param | titleize}}</label>
            <i class="im-bar"></i>
          </div>
        </div>
      </form>

      <!-- Remove KPI -->
      <button type="button" class="kpi-remove im-fab im-warn" ng-click="deleteKpi()">
        <i class="fa fa-times" aria-hidden="true"></i>
      </button>

    </div>
  </div>
  <div class="col-xs-2 kpi-data-loader loader" ng-show="kpi.isLoading">
    <i class="fa fa-spinner fa-pulse fa-3x"></i>
  </div>
</div>
