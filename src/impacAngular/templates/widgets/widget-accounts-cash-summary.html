<div class='top-line'>
  <div common-top-buttons parent-widget="widget" />
  <div common-editable-title parent-widget="widget" />
</div>

<div widget-accounts-cash-summary class="content">

  <div ng-show="widget.isLoading" class="loader" align="center">
    Your data is being retrieved...
    <img class="gif" ng-src="{{loaderImage}}"/>
  </div>

  <div ng-hide="widget.isLoading">
    
    <div class="edit" ng-show="widget.isEditMode">
      <h4>Widget settings</h4>
      
      <div setting-organizations parent-widget="widget" class="part" />
      <div setting-time-range parent-widget="widget" class="part" />

      <div align="right">
        <button class="btn btn-default" ng-click="widget.initSettings()">Cancel</button>
        <button class="btn btn-warning" ng-click="widget.updateSettings()">Save</button>
      </div>
    </div>

    <div ng-hide="widget.isEditMode">

      <div ng-show="isDataFound" class="row" >
        <div ng-class="widget.isExpanded() ? 'col-md-6' : 'col-md-12'">
          <div setting-width parent-widget="widget" min="6" max="12" class="settings width" />
        
          <div class='widget-lines-container'>
            <div class='row widget-line header'>
              <div class='col-sm-1' />
              <div class='col-sm-5'></div>
              <div class='col-sm-3 text-right'>{{getLastDate() | date : 'd-MMM'}}</div>
              <div class='col-sm-3 text-right'>Variance</div>
            </div>
            <div class='row widget-line total' ng-repeat="statement in widget.content.summary" >
              <div class="row widget-line" ng-class="isSelected(statement) ? 'selected' : null" >
                <div class='col-sm-1' ng-click="toogleCollapsed(statement)"><i class='fa' ng-class="isCollapsed(statement) ? 'fa-plus-square-o' : 'fa-minus-square-o'" /></div>
                <div class='col-sm-5' ng-click="toogleSelectedElement(statement)"><strong>{{getName(statement) | titleize}}</strong></div>
                <div class='col-sm-3 text-right' ng-click="toogleSelectedElement(statement)"><strong>{{getLastValue(statement) | mnoCurrency : statement.currency}}</strong></div>
                <div class='col-sm-3 text-right' ng-click="toogleSelectedElement(statement)" ng-class="getVarianceClassColor(getLastVariance(statement))"><strong>{{getLastVariance(statement)}}</strong></div>
              </div>
              <div collapse="isCollapsed(statement)">
                <div class="row widget-line" ng-click="toogleSelectedElement(account)" ng-repeat="account in statement.accounts" ng-class="isSelected(account) ? 'selected' : null" >
                  <div class='col-sm-1' />
                  <div class='col-sm-5'>{{account.name}}</div>
                  <div class='col-sm-3 text-right'>{{getLastValue(account) | mnoCurrency : account.currency }}</div>
                  <div class='col-sm-3 text-right' ng-class="getVarianceClassColor(getLastVariance(account))">{{getLastVariance(account)}}</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-6 right-panel text-center" ng-show="widget.isExpanded()">
          <h4>{{getName(selectedElement) | titleize}}</h4>
          <div class="chart-container" ng-if="isDataFound && widget.isExpanded()">
            <div dhb-chart data="widget.chart"></div>
          </div>
          <div class="legend">{{(widget.metadata.hist_parameters.period || 'Monthly') | titleize}} Cash Flow</div>
          <div class='widget-lines-container'>
            <div class='row widget-line'>
              <div class='col-sm-2 text-center' ng-repeat="date in dates" style="padding: 5px 0px;">
                <div class='row widget-line'><div class='col-sm-12' style="padding: 0px;">{{date | date : 'd-MMM'}}</div></div>
                <div class='row widget-line'><div class='col-sm-12' style="padding: 0px;">{{selectedElement.cash_flows[$index] | mnoCurrency : selectedElement.currency }}</div></div>
                <div class='row widget-line'><div class='col-sm-12' style="padding: 0px;" ng-class="getVarianceClassColor(selectedElement.variances[$index])">{{formatVariance(selectedElement.variances[$index])}}</div></div>
              </div>
            </div>
          </div>
        </div>

      </div>

      <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />
    </div>
    
  </div>
</div>