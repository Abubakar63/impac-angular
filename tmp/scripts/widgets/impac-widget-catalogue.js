(function () {
var module;

module = angular.module('maestrano.analytics.impac-widget-catalogue', ['maestrano.assets']);

module.controller('ImpacWidgetCatalogueCtrl', [
  '$scope', 'WidgetTemplateSvc', '$http', 'AssetPath', function($scope, WidgetTemplateSvc, $http, AssetPath) {
    var menu, show;
    $scope.loaderImage = AssetPath['loader-white-bg.gif'];
    $scope.menu = menu = {};
    menu.categories = [];
    menu.loading = true;
    menu.init = function() {
      menu.loading = true;
      return WidgetTemplateSvc.categories().then(function(categories) {
        menu.categories = categories;
        if (!$scope.isAdmin) {
          menu.removeInactiveWidgets();
        }
        menu.prepareCategories();
        return menu.loading = false;
      });
    };
    menu.removeInactiveWidgets = function() {
      return _.each(menu.categories, function(cat) {
        return cat.widgets = _(cat.widgets).filter(function(w) {
          return w.active;
        });
      });
    };
    menu.prepareCategories = function() {
      return menu.categories = _(menu.categories).filter(function(cat) {
        return _.isEmpty(cat.widgets) === false;
      });
    };
    $scope.show = show = {};
    show.widget = false;
    show.loading = false;
    show.get = function(id) {
      show.loading = true;
      return WidgetTemplateSvc.show(id).then(function(widget_template) {
        show.widget = widget_template;
        show.widget.settings = show.widget.settings.splice(0, 6);
        show.widget.compatible_apps = show.widget.compatible_apps.splice(0, 6);
        show.color = widget_template.category_color || "#233845";
        return show.loading = false;
      });
    };
    $scope.init = function() {
      return menu.init();
    };
    return $scope.init();
  }
]);

module.directive('impacWidgetCatalogue', [
  'TemplatePath', function(TemplatePath) {
    return {
      restrict: 'A',
      scope: {
        isAdmin: '='
      },
      templateUrl: TemplatePath['impac/widget_catalogue.html'],
      controller: 'ImpacWidgetCatalogueCtrl'
    };
  }
]);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndpZGdldHMvaW1wYWMtd2lkZ2V0LWNhdGFsb2d1ZS5qcy5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBQTs7QUFBQSxNQUFBLEdBQVMsT0FBTyxDQUFDLE1BQVIsQ0FBZSw0Q0FBZixFQUE0RCxDQUFDLGtCQUFELENBQTVEOztBQUVULE1BQU0sQ0FBQyxVQUFQLENBQWtCLDBCQUFsQixFQUE2QztFQUMzQyxRQUQyQyxFQUNqQyxtQkFEaUMsRUFDWixPQURZLEVBQ0gsV0FERyxFQUNVLFNBQUMsTUFBRCxFQUFTLGlCQUFULEVBQTRCLEtBQTVCLEVBQW1DLFNBQW5DO0FBRW5ELFFBQUE7SUFBQSxNQUFNLENBQUMsV0FBUCxHQUFxQixTQUFVLENBQUEscUJBQUE7SUFHL0IsTUFBTSxDQUFDLElBQVAsR0FBYyxJQUFBLEdBQU87SUFDckIsSUFBSSxDQUFDLFVBQUwsR0FBa0I7SUFDbEIsSUFBSSxDQUFDLE9BQUwsR0FBZTtJQUVmLElBQUksQ0FBQyxJQUFMLEdBQVksU0FBQTtNQUNWLElBQUksQ0FBQyxPQUFMLEdBQWU7YUFDZixpQkFBaUIsQ0FBQyxVQUFsQixDQUFBLENBQThCLENBQUMsSUFBL0IsQ0FDRSxTQUFDLFVBQUQ7UUFDRSxJQUFJLENBQUMsVUFBTCxHQUFrQjtRQUNsQixJQUFBLENBQW9DLE1BQU0sQ0FBQyxPQUEzQztVQUFBLElBQUksQ0FBQyxxQkFBTCxDQUFBLEVBQUE7O1FBQ0EsSUFBSSxDQUFDLGlCQUFMLENBQUE7ZUFDQSxJQUFJLENBQUMsT0FBTCxHQUFlO01BSmpCLENBREY7SUFGVTtJQVVaLElBQUksQ0FBQyxxQkFBTCxHQUE2QixTQUFBO2FBQzNCLENBQUMsQ0FBQyxJQUFGLENBQU8sSUFBSSxDQUFDLFVBQVosRUFBd0IsU0FBQyxHQUFEO2VBQ3RCLEdBQUcsQ0FBQyxPQUFKLEdBQWMsQ0FBQSxDQUFFLEdBQUcsQ0FBQyxPQUFOLENBQWMsQ0FBQyxNQUFmLENBQXVCLFNBQUMsQ0FBRDtpQkFDbkMsQ0FBQyxDQUFDO1FBRGlDLENBQXZCO01BRFEsQ0FBeEI7SUFEMkI7SUFNN0IsSUFBSSxDQUFDLGlCQUFMLEdBQXlCLFNBQUE7YUFDdkIsSUFBSSxDQUFDLFVBQUwsR0FBa0IsQ0FBQSxDQUFFLElBQUksQ0FBQyxVQUFQLENBQWtCLENBQUMsTUFBbkIsQ0FBMkIsU0FBQyxHQUFEO2VBQ3pDLENBQUMsQ0FBQyxPQUFGLENBQVUsR0FBRyxDQUFDLE9BQWQsQ0FBQSxLQUEwQjtNQURlLENBQTNCO0lBREs7SUFNekIsTUFBTSxDQUFDLElBQVAsR0FBYyxJQUFBLEdBQU87SUFDckIsSUFBSSxDQUFDLE1BQUwsR0FBYztJQUNkLElBQUksQ0FBQyxPQUFMLEdBQWU7SUFFZixJQUFJLENBQUMsR0FBTCxHQUFXLFNBQUMsRUFBRDtNQUNULElBQUksQ0FBQyxPQUFMLEdBQWU7YUFDZixpQkFBaUIsQ0FBQyxJQUFsQixDQUF1QixFQUF2QixDQUEwQixDQUFDLElBQTNCLENBQ0UsU0FBQyxlQUFEO1FBQ0UsSUFBSSxDQUFDLE1BQUwsR0FBYztRQUNkLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBWixHQUF1QixJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxNQUFyQixDQUE0QixDQUE1QixFQUErQixDQUEvQjtRQUN2QixJQUFJLENBQUMsTUFBTSxDQUFDLGVBQVosR0FBOEIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsTUFBNUIsQ0FBbUMsQ0FBbkMsRUFBc0MsQ0FBdEM7UUFDOUIsSUFBSSxDQUFDLEtBQUwsR0FBYSxlQUFlLENBQUMsY0FBaEIsSUFBa0M7ZUFDL0MsSUFBSSxDQUFDLE9BQUwsR0FBZTtNQUxqQixDQURGO0lBRlM7SUFhWCxNQUFNLENBQUMsSUFBUCxHQUFjLFNBQUE7YUFDWixJQUFJLENBQUMsSUFBTCxDQUFBO0lBRFk7V0FHZCxNQUFNLENBQUMsSUFBUCxDQUFBO0VBbkRtRCxDQURWO0NBQTdDOztBQXVEQSxNQUFNLENBQUMsU0FBUCxDQUFpQixzQkFBakIsRUFBeUM7RUFBQyxjQUFELEVBQWlCLFNBQUMsWUFBRDtBQUN4RCxXQUFPO01BQ0gsUUFBQSxFQUFVLEdBRFA7TUFFSCxLQUFBLEVBQU87UUFDTCxPQUFBLEVBQVEsR0FESDtPQUZKO01BS0gsV0FBQSxFQUFhLFlBQWEsQ0FBQSw2QkFBQSxDQUx2QjtNQU1ILFVBQUEsRUFBWSwwQkFOVDs7RUFEaUQsQ0FBakI7Q0FBekMiLCJmaWxlIjoid2lkZ2V0cy9pbXBhYy13aWRnZXQtY2F0YWxvZ3VlLmpzLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ21hZXN0cmFuby5hbmFseXRpY3MuaW1wYWMtd2lkZ2V0LWNhdGFsb2d1ZScsWydtYWVzdHJhbm8uYXNzZXRzJ10pXG5cbm1vZHVsZS5jb250cm9sbGVyKCdJbXBhY1dpZGdldENhdGFsb2d1ZUN0cmwnLFtcbiAgJyRzY29wZScsICdXaWRnZXRUZW1wbGF0ZVN2YycsICckaHR0cCcsICdBc3NldFBhdGgnLCAoJHNjb3BlLCBXaWRnZXRUZW1wbGF0ZVN2YywgJGh0dHAsIEFzc2V0UGF0aCkgLT5cblxuICAgICRzY29wZS5sb2FkZXJJbWFnZSA9IEFzc2V0UGF0aFsnbG9hZGVyLXdoaXRlLWJnLmdpZiddXG5cbiAgICAjPT09TUVOVT09PVxuICAgICRzY29wZS5tZW51ID0gbWVudSA9IHt9XG4gICAgbWVudS5jYXRlZ29yaWVzID0gW11cbiAgICBtZW51LmxvYWRpbmcgPSB0cnVlXG5cbiAgICBtZW51LmluaXQgPSAtPlxuICAgICAgbWVudS5sb2FkaW5nID0gdHJ1ZVxuICAgICAgV2lkZ2V0VGVtcGxhdGVTdmMuY2F0ZWdvcmllcygpLnRoZW4oXG4gICAgICAgIChjYXRlZ29yaWVzKSAtPlxuICAgICAgICAgIG1lbnUuY2F0ZWdvcmllcyA9IGNhdGVnb3JpZXNcbiAgICAgICAgICBtZW51LnJlbW92ZUluYWN0aXZlV2lkZ2V0cygpIHVubGVzcyAkc2NvcGUuaXNBZG1pblxuICAgICAgICAgIG1lbnUucHJlcGFyZUNhdGVnb3JpZXMoKVxuICAgICAgICAgIG1lbnUubG9hZGluZyA9IGZhbHNlXG4gICAgICApXG5cbiAgICBtZW51LnJlbW92ZUluYWN0aXZlV2lkZ2V0cyA9IC0+XG4gICAgICBfLmVhY2ggbWVudS5jYXRlZ29yaWVzLCAoY2F0KSAtPlxuICAgICAgICBjYXQud2lkZ2V0cyA9IF8oY2F0LndpZGdldHMpLmZpbHRlciggKHcpIC0+XG4gICAgICAgICAgdy5hY3RpdmVcbiAgICAgICAgKVxuXG4gICAgbWVudS5wcmVwYXJlQ2F0ZWdvcmllcyA9IC0+XG4gICAgICBtZW51LmNhdGVnb3JpZXMgPSBfKG1lbnUuY2F0ZWdvcmllcykuZmlsdGVyKCAoY2F0KSAtPlxuICAgICAgICAgIF8uaXNFbXB0eShjYXQud2lkZ2V0cykgPT0gZmFsc2VcbiAgICAgICAgKVxuXG4gICAgIz09PVNIT1c9PT1cbiAgICAkc2NvcGUuc2hvdyA9IHNob3cgPSB7fVxuICAgIHNob3cud2lkZ2V0ID0gZmFsc2VcbiAgICBzaG93LmxvYWRpbmcgPSBmYWxzZVxuXG4gICAgc2hvdy5nZXQgPSAoaWQpIC0+XG4gICAgICBzaG93LmxvYWRpbmcgPSB0cnVlXG4gICAgICBXaWRnZXRUZW1wbGF0ZVN2Yy5zaG93KGlkKS50aGVuKFxuICAgICAgICAod2lkZ2V0X3RlbXBsYXRlKSAtPlxuICAgICAgICAgIHNob3cud2lkZ2V0ID0gd2lkZ2V0X3RlbXBsYXRlXG4gICAgICAgICAgc2hvdy53aWRnZXQuc2V0dGluZ3MgPSBzaG93LndpZGdldC5zZXR0aW5ncy5zcGxpY2UoMCwgNilcbiAgICAgICAgICBzaG93LndpZGdldC5jb21wYXRpYmxlX2FwcHMgPSBzaG93LndpZGdldC5jb21wYXRpYmxlX2FwcHMuc3BsaWNlKDAsIDYpXG4gICAgICAgICAgc2hvdy5jb2xvciA9IHdpZGdldF90ZW1wbGF0ZS5jYXRlZ29yeV9jb2xvciB8fCBcIiMyMzM4NDVcIlxuICAgICAgICAgIHNob3cubG9hZGluZyA9IGZhbHNlXG4gICAgICApXG5cblxuICAgICM9PT1JTklUPT09XG4gICAgJHNjb3BlLmluaXQgPSAtPlxuICAgICAgbWVudS5pbml0KClcblxuICAgICRzY29wZS5pbml0KClcbl0pXG5cbm1vZHVsZS5kaXJlY3RpdmUoJ2ltcGFjV2lkZ2V0Q2F0YWxvZ3VlJywgWydUZW1wbGF0ZVBhdGgnLCAoVGVtcGxhdGVQYXRoKSAtPlxuICByZXR1cm4ge1xuICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgIHNjb3BlOiB7XG4gICAgICAgIGlzQWRtaW46Jz0nXG4gICAgICB9LFxuICAgICAgdGVtcGxhdGVVcmw6IFRlbXBsYXRlUGF0aFsnaW1wYWMvd2lkZ2V0X2NhdGFsb2d1ZS5odG1sJ10sXG4gICAgICBjb250cm9sbGVyOiAnSW1wYWNXaWRnZXRDYXRhbG9ndWVDdHJsJ1xuICB9XG5dKVxuIl19