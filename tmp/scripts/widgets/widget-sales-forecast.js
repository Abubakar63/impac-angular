(function () {
var module;

module = angular.module('maestrano.analytics.widget-sales-forecast', ['maestrano.assets']);

module.controller('WidgetSalesForecastCtrl', [
  '$scope', 'DhbAnalyticsSvc', 'ChartFormatterSvc', '$filter', function($scope, DhbAnalyticsSvc, ChartFormatterSvc, $filter) {
    var getSettingsCount, w;
    w = $scope.widget;
    w.initContext = function() {
      return $scope.isDataFound = angular.isDefined(w.content) && !_.isEmpty(w.content.dates) && !_.isEmpty(w.content.totals);
    };
    w.format = function() {
      var all_values_are_positive, formattedDates, inputData, options;
      if ($scope.isDataFound) {
        all_values_are_positive = true;
        formattedDates = _.map(w.content.dates, function(aDate) {
          return $filter('date')(aDate, 'MMM-yy');
        });
        inputData = [
          {
            title: 'Sales Performance',
            labels: formattedDates,
            values: w.content.totals
          }
        ];
        angular.forEach(w.content.totals, function(value) {
          return all_values_are_positive && (all_values_are_positive = value >= 0);
        });
        options = {
          scaleBeginAtZero: all_values_are_positive,
          showXLabels: true,
          datasetFill: true,
          pointDot: false
        };
        return w.chart = ChartFormatterSvc.lineChart(inputData, options);
      }
    };
    $scope.getOpportunityAmount = function(anOpp) {
      if ($scope.isDataFound && !_.isEmpty(anOpp)) {
        if (anOpp.amount && anOpp.amount.amount) {
          return anOpp.amount.amount;
        } else {
          return '-';
        }
      }
    };
    $scope.getOpportunityCurrency = function(anOpp) {
      if ($scope.isDataFound && !_.isEmpty(anOpp)) {
        if (anOpp.amount && anOpp.amount.currency) {
          return anOpp.amount.currency;
        } else if (w.content.currency) {
          return w.content.currency;
        } else {
          return 'AUD';
        }
      }
    };
    getSettingsCount = function() {
      if (w.settings != null) {
        return w.settings.length;
      } else {
        return 0;
      }
    };
    $scope.$watch(getSettingsCount, function(total) {
      if (total >= 1) {
        return w.loadContent();
      }
    });
    return w;
  }
]);

module.directive('widgetSalesForecast', function() {
  return {
    restrict: 'A',
    link: function(scope, element) {
      element.addClass("accounts");
      return element.addClass("profit-and-loss");
    },
    controller: 'WidgetSalesForecastCtrl'
  };
});
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndpZGdldHMvd2lkZ2V0LXNhbGVzLWZvcmVjYXN0LmpzLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBOztBQUFBLE1BQUEsR0FBUyxPQUFPLENBQUMsTUFBUixDQUFlLDJDQUFmLEVBQTJELENBQUMsa0JBQUQsQ0FBM0Q7O0FBRVQsTUFBTSxDQUFDLFVBQVAsQ0FBa0IseUJBQWxCLEVBQTRDO0VBQzFDLFFBRDBDLEVBQ2hDLGlCQURnQyxFQUNiLG1CQURhLEVBQ1EsU0FEUixFQUUxQyxTQUFDLE1BQUQsRUFBUyxlQUFULEVBQTBCLGlCQUExQixFQUE2QyxPQUE3QztBQUVFLFFBQUE7SUFBQSxDQUFBLEdBQUksTUFBTSxDQUFDO0lBRVgsQ0FBQyxDQUFDLFdBQUYsR0FBZ0IsU0FBQTthQUNkLE1BQU0sQ0FBQyxXQUFQLEdBQXFCLE9BQU8sQ0FBQyxTQUFSLENBQWtCLENBQUMsQ0FBQyxPQUFwQixDQUFBLElBQWdDLENBQUMsQ0FBQyxDQUFDLE9BQUYsQ0FBVSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQXBCLENBQWpDLElBQStELENBQUMsQ0FBQyxDQUFDLE9BQUYsQ0FBVSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQXBCO0lBRHZFO0lBR2hCLENBQUMsQ0FBQyxNQUFGLEdBQVcsU0FBQTtBQUNULFVBQUE7TUFBQSxJQUFHLE1BQU0sQ0FBQyxXQUFWO1FBQ0UsdUJBQUEsR0FBMEI7UUFFMUIsY0FBQSxHQUFpQixDQUFDLENBQUMsR0FBRixDQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBaEIsRUFBdUIsU0FBQyxLQUFEO2lCQUN0QyxPQUFBLENBQVEsTUFBUixDQUFBLENBQWdCLEtBQWhCLEVBQXVCLFFBQXZCO1FBRHNDLENBQXZCO1FBR2pCLFNBQUEsR0FBWTtVQUFDO1lBQ1gsS0FBQSxFQUFPLG1CQURJO1lBRVgsTUFBQSxFQUFRLGNBRkc7WUFHWCxNQUFBLEVBQVEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUhQO1dBQUQ7O1FBTVosT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUExQixFQUFrQyxTQUFDLEtBQUQ7aUJBQ2hDLDRCQUFBLDBCQUE0QixLQUFBLElBQVM7UUFETCxDQUFsQztRQUlBLE9BQUEsR0FBVTtVQUNSLGdCQUFBLEVBQWtCLHVCQURWO1VBRVIsV0FBQSxFQUFhLElBRkw7VUFHUixXQUFBLEVBQWEsSUFITDtVQUlSLFFBQUEsRUFBVSxLQUpGOztlQU9WLENBQUMsQ0FBQyxLQUFGLEdBQVUsaUJBQWlCLENBQUMsU0FBbEIsQ0FBNEIsU0FBNUIsRUFBc0MsT0FBdEMsRUF2Qlo7O0lBRFM7SUEwQlgsTUFBTSxDQUFDLG9CQUFQLEdBQThCLFNBQUMsS0FBRDtNQUM1QixJQUFHLE1BQU0sQ0FBQyxXQUFQLElBQXNCLENBQUMsQ0FBQyxDQUFDLE9BQUYsQ0FBVSxLQUFWLENBQTFCO1FBQ0UsSUFBRyxLQUFLLENBQUMsTUFBTixJQUFnQixLQUFLLENBQUMsTUFBTSxDQUFDLE1BQWhDO0FBQ0UsaUJBQU8sS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUR0QjtTQUFBLE1BQUE7QUFHRSxpQkFBTyxJQUhUO1NBREY7O0lBRDRCO0lBTzlCLE1BQU0sQ0FBQyxzQkFBUCxHQUFnQyxTQUFDLEtBQUQ7TUFDOUIsSUFBRyxNQUFNLENBQUMsV0FBUCxJQUFzQixDQUFDLENBQUMsQ0FBQyxPQUFGLENBQVUsS0FBVixDQUExQjtRQUNFLElBQUcsS0FBSyxDQUFDLE1BQU4sSUFBZ0IsS0FBSyxDQUFDLE1BQU0sQ0FBQyxRQUFoQztBQUNFLGlCQUFPLEtBQUssQ0FBQyxNQUFNLENBQUMsU0FEdEI7U0FBQSxNQUVLLElBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFiO0FBQ0gsaUJBQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQURkO1NBQUEsTUFBQTtBQUdILGlCQUFPLE1BSEo7U0FIUDs7SUFEOEI7SUFtQmhDLGdCQUFBLEdBQW1CLFNBQUE7TUFDakIsSUFBRyxrQkFBSDtBQUNFLGVBQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxPQURwQjtPQUFBLE1BQUE7QUFHRSxlQUFPLEVBSFQ7O0lBRGlCO0lBT25CLE1BQU0sQ0FBQyxNQUFQLENBQWMsZ0JBQWQsRUFBZ0MsU0FBQyxLQUFEO01BQzlCLElBQW1CLEtBQUEsSUFBUyxDQUE1QjtlQUFBLENBQUMsQ0FBQyxXQUFGLENBQUEsRUFBQTs7SUFEOEIsQ0FBaEM7QUFHQSxXQUFPO0VBckVULENBRjBDO0NBQTVDOztBQTBFQSxNQUFNLENBQUMsU0FBUCxDQUFpQixxQkFBakIsRUFBd0MsU0FBQTtBQUN0QyxTQUFPO0lBQ0wsUUFBQSxFQUFVLEdBREw7SUFFTCxJQUFBLEVBQU0sU0FBQyxLQUFELEVBQVEsT0FBUjtNQUNKLE9BQU8sQ0FBQyxRQUFSLENBQWlCLFVBQWpCO2FBQ0EsT0FBTyxDQUFDLFFBQVIsQ0FBaUIsaUJBQWpCO0lBRkksQ0FGRDtJQUtKLFVBQUEsRUFBWSx5QkFMUjs7QUFEK0IsQ0FBeEMiLCJmaWxlIjoid2lkZ2V0cy93aWRnZXQtc2FsZXMtZm9yZWNhc3QuanMuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnbWFlc3RyYW5vLmFuYWx5dGljcy53aWRnZXQtc2FsZXMtZm9yZWNhc3QnLFsnbWFlc3RyYW5vLmFzc2V0cyddKVxuXG5tb2R1bGUuY29udHJvbGxlcignV2lkZ2V0U2FsZXNGb3JlY2FzdEN0cmwnLFtcbiAgJyRzY29wZScsICdEaGJBbmFseXRpY3NTdmMnLCAnQ2hhcnRGb3JtYXR0ZXJTdmMnLCAnJGZpbHRlcicsXG4gICgkc2NvcGUsIERoYkFuYWx5dGljc1N2YywgQ2hhcnRGb3JtYXR0ZXJTdmMsICRmaWx0ZXIpIC0+XG5cbiAgICB3ID0gJHNjb3BlLndpZGdldFxuXG4gICAgdy5pbml0Q29udGV4dCA9IC0+XG4gICAgICAkc2NvcGUuaXNEYXRhRm91bmQgPSBhbmd1bGFyLmlzRGVmaW5lZCh3LmNvbnRlbnQpICYmICFfLmlzRW1wdHkody5jb250ZW50LmRhdGVzKSAmJiAhXy5pc0VtcHR5KHcuY29udGVudC50b3RhbHMpXG5cbiAgICB3LmZvcm1hdCA9IC0+XG4gICAgICBpZiAkc2NvcGUuaXNEYXRhRm91bmRcbiAgICAgICAgYWxsX3ZhbHVlc19hcmVfcG9zaXRpdmUgPSB0cnVlXG4gICAgICAgIFxuICAgICAgICBmb3JtYXR0ZWREYXRlcyA9IF8ubWFwIHcuY29udGVudC5kYXRlcywgKGFEYXRlKSAtPlxuICAgICAgICAgICRmaWx0ZXIoJ2RhdGUnKShhRGF0ZSwgJ01NTS15eScpXG5cbiAgICAgICAgaW5wdXREYXRhID0gW3tcbiAgICAgICAgICB0aXRsZTogJ1NhbGVzIFBlcmZvcm1hbmNlJyxcbiAgICAgICAgICBsYWJlbHM6IGZvcm1hdHRlZERhdGVzLFxuICAgICAgICAgIHZhbHVlczogdy5jb250ZW50LnRvdGFsc1xuICAgICAgICB9XVxuXG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh3LmNvbnRlbnQudG90YWxzLCAodmFsdWUpIC0+XG4gICAgICAgICAgYWxsX3ZhbHVlc19hcmVfcG9zaXRpdmUgJiY9IHZhbHVlID49IDBcbiAgICAgICAgKVxuXG4gICAgICAgIG9wdGlvbnMgPSB7XG4gICAgICAgICAgc2NhbGVCZWdpbkF0WmVybzogYWxsX3ZhbHVlc19hcmVfcG9zaXRpdmUsXG4gICAgICAgICAgc2hvd1hMYWJlbHM6IHRydWUsXG4gICAgICAgICAgZGF0YXNldEZpbGw6IHRydWUsXG4gICAgICAgICAgcG9pbnREb3Q6IGZhbHNlLFxuICAgICAgICB9XG5cbiAgICAgICAgdy5jaGFydCA9IENoYXJ0Rm9ybWF0dGVyU3ZjLmxpbmVDaGFydChpbnB1dERhdGEsb3B0aW9ucylcblxuICAgICRzY29wZS5nZXRPcHBvcnR1bml0eUFtb3VudCA9IChhbk9wcCkgLT5cbiAgICAgIGlmICRzY29wZS5pc0RhdGFGb3VuZCAmJiAhXy5pc0VtcHR5KGFuT3BwKVxuICAgICAgICBpZiBhbk9wcC5hbW91bnQgJiYgYW5PcHAuYW1vdW50LmFtb3VudFxuICAgICAgICAgIHJldHVybiBhbk9wcC5hbW91bnQuYW1vdW50XG4gICAgICAgIGVsc2VcbiAgICAgICAgICByZXR1cm4gJy0nXG5cbiAgICAkc2NvcGUuZ2V0T3Bwb3J0dW5pdHlDdXJyZW5jeSA9IChhbk9wcCkgLT5cbiAgICAgIGlmICRzY29wZS5pc0RhdGFGb3VuZCAmJiAhXy5pc0VtcHR5KGFuT3BwKVxuICAgICAgICBpZiBhbk9wcC5hbW91bnQgJiYgYW5PcHAuYW1vdW50LmN1cnJlbmN5XG4gICAgICAgICAgcmV0dXJuIGFuT3BwLmFtb3VudC5jdXJyZW5jeVxuICAgICAgICBlbHNlIGlmIHcuY29udGVudC5jdXJyZW5jeVxuICAgICAgICAgIHJldHVybiB3LmNvbnRlbnQuY3VycmVuY3lcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHJldHVybiAnQVVEJ1xuXG5cbiAgICAjIC0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAjIFRPRE86IFJlZmFjdG9yIG9uY2Ugd2UgaGF2ZSB1bmRlcnN0b29kIGV4YWN0bHkgaG93IHRoZSBhbmd1bGFyanMgY29tcGlsYXRpb24gcHJvY2VzcyB3b3JrczpcbiAgICAjIGluIHRoaXMgb3JkZXIsIHdlIHNob3VsZDpcbiAgICAjIDEtIGNvbXBpbGUgaW1wYWMtd2lkZ2V0IGNvbnRyb2xsZXJcbiAgICAjIDItIGNvbXBpbGUgdGhlIHNwZWNpZmljIHdpZGdldCB0ZW1wbGF0ZS9jb250cm9sbGVyXG4gICAgIyAzLSBjb21waWxlIHRoZSBzZXR0aW5ncyB0ZW1wbGF0ZXMvY29udHJvbGxlcnNcbiAgICAjIDQtIGNhbGwgd2lkZ2V0LmxvYWRDb250ZW50KCkgKGlkZWFsbHksIGZyb20gaW1wYWMtd2lkZ2V0LCBvbmNlIGEgY2FsbGJhY2sgXG4gICAgIyAgICAgYXNzZXNzaW5nIHRoYXQgZXZlcnl0aGluZyBpcyBjb21waWxlZCBhbiByZWFkeSBpcyByZWNlaXZlZClcbiAgICBnZXRTZXR0aW5nc0NvdW50ID0gLT5cbiAgICAgIGlmIHcuc2V0dGluZ3M/XG4gICAgICAgIHJldHVybiB3LnNldHRpbmdzLmxlbmd0aFxuICAgICAgZWxzZVxuICAgICAgICByZXR1cm4gMFxuXG4gICAgIyBvcmdhbml6YXRpb25faWRzXG4gICAgJHNjb3BlLiR3YXRjaCBnZXRTZXR0aW5nc0NvdW50LCAodG90YWwpIC0+XG4gICAgICB3LmxvYWRDb250ZW50KCkgaWYgdG90YWwgPj0gMVxuXG4gICAgcmV0dXJuIHdcbl0pXG5cbm1vZHVsZS5kaXJlY3RpdmUoJ3dpZGdldFNhbGVzRm9yZWNhc3QnLCAtPlxuICByZXR1cm4ge1xuICAgIHJlc3RyaWN0OiAnQScsXG4gICAgbGluazogKHNjb3BlLCBlbGVtZW50KSAtPlxuICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImFjY291bnRzXCIpXG4gICAgICBlbGVtZW50LmFkZENsYXNzKFwicHJvZml0LWFuZC1sb3NzXCIpXG4gICAgLGNvbnRyb2xsZXI6ICdXaWRnZXRTYWxlc0ZvcmVjYXN0Q3RybCdcbiAgfVxuKSJdfQ==