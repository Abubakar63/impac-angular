(function () {
var module;

module = angular.module('maestrano.analytics.widget-sales-customer-details', ['maestrano.assets']);

module.controller('WidgetSalesCustomerDetailsCtrl', [
  '$scope', 'DhbAnalyticsSvc', 'Utilities', '$filter', function($scope, DhbAnalyticsSvc, Utilities, $filter) {
    var getSettingsCount, w;
    w = $scope.widget;
    w.initContext = function() {
      if ($scope.isDataFound = !_.isEmpty(w.content.customers)) {
        $scope.customersOptions = _.map(w.content.customers, function(e) {
          return {
            value: e.uid,
            label: e.name
          };
        });
        return $scope.selectedCustomer = {
          value: $scope.getCustomer().uid,
          label: $scope.getCustomer().name
        };
      }
    };
    $scope.getCustomer = function() {
      var customer;
      if (!$scope.isDataFound) {
        return false;
      }
      if (w.metadata && w.metadata.customer_uid) {
        customer = angular.copy(_.find(w.content.customers, function(e) {
          return e.uid === w.metadata.customer_uid;
        }) || w.content.customers[0]);
      } else {
        customer = angular.copy(w.content.customers[0]);
      }
      return customer;
    };
    $scope.formatAddress = function(anAddress) {
      if (angular.isDefined(anAddress)) {
        return anAddress.replace(/, /g, ',\n');
      }
    };
    $scope.getFromDate = function() {
      if ($scope.isDataFound) {
        return w.content.from;
      }
    };
    $scope.getToDate = function() {
      if ($scope.isDataFound) {
        return w.content.to;
      }
    };
    getSettingsCount = function() {
      if (w.settings != null) {
        return w.settings.length;
      } else {
        return 0;
      }
    };
    $scope.$watch(getSettingsCount, function(total) {
      if (total >= 4) {
        return w.loadContent();
      }
    });
    return w;
  }
]);

module.directive('widgetSalesCustomerDetails', function() {
  return {
    restrict: 'A',
    link: function(scope, element) {
      element.addClass("sales");
      return element.addClass("customer-details");
    },
    controller: 'WidgetSalesCustomerDetailsCtrl'
  };
});
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndpZGdldHMvd2lkZ2V0LXNhbGVzLWN1c3RvbWVyLWRldGFpbHMuanMuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUE7O0FBQUEsTUFBQSxHQUFTLE9BQU8sQ0FBQyxNQUFSLENBQWUsbURBQWYsRUFBbUUsQ0FBQyxrQkFBRCxDQUFuRTs7QUFFVCxNQUFNLENBQUMsVUFBUCxDQUFrQixnQ0FBbEIsRUFBbUQ7RUFDakQsUUFEaUQsRUFDdkMsaUJBRHVDLEVBQ3BCLFdBRG9CLEVBQ1AsU0FETyxFQUVqRCxTQUFDLE1BQUQsRUFBUyxlQUFULEVBQTBCLFNBQTFCLEVBQXFDLE9BQXJDO0FBRUUsUUFBQTtJQUFBLENBQUEsR0FBSSxNQUFNLENBQUM7SUFFWCxDQUFDLENBQUMsV0FBRixHQUFnQixTQUFBO01BQ2QsSUFBRyxNQUFNLENBQUMsV0FBUCxHQUFxQixDQUFDLENBQUMsQ0FBQyxPQUFGLENBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFwQixDQUF6QjtRQUVFLE1BQU0sQ0FBQyxnQkFBUCxHQUEwQixDQUFDLENBQUMsR0FBRixDQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBaEIsRUFBMkIsU0FBQyxDQUFEO2lCQUNuRDtZQUNFLEtBQUEsRUFBTyxDQUFDLENBQUMsR0FEWDtZQUVFLEtBQUEsRUFBTyxDQUFDLENBQUMsSUFGWDs7UUFEbUQsQ0FBM0I7ZUFNMUIsTUFBTSxDQUFDLGdCQUFQLEdBQTBCO1VBQ3hCLEtBQUEsRUFBTyxNQUFNLENBQUMsV0FBUCxDQUFBLENBQW9CLENBQUMsR0FESjtVQUV4QixLQUFBLEVBQU8sTUFBTSxDQUFDLFdBQVAsQ0FBQSxDQUFvQixDQUFDLElBRko7VUFSNUI7O0lBRGM7SUFjaEIsTUFBTSxDQUFDLFdBQVAsR0FBcUIsU0FBQTtBQUNuQixVQUFBO01BQUEsSUFBQSxDQUFvQixNQUFNLENBQUMsV0FBM0I7QUFBQSxlQUFPLE1BQVA7O01BRUEsSUFBRyxDQUFDLENBQUMsUUFBRixJQUFjLENBQUMsQ0FBQyxRQUFRLENBQUMsWUFBNUI7UUFDRSxRQUFBLEdBQVcsT0FBTyxDQUFDLElBQVIsQ0FBYSxDQUFDLENBQUMsSUFBRixDQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBakIsRUFBNEIsU0FBQyxDQUFEO2lCQUNsRCxDQUFDLENBQUMsR0FBRixLQUFTLENBQUMsQ0FBQyxRQUFRLENBQUM7UUFEOEIsQ0FBNUIsQ0FBQSxJQUVuQixDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVUsQ0FBQSxDQUFBLENBRmQsRUFEYjtPQUFBLE1BQUE7UUFLRSxRQUFBLEdBQVcsT0FBTyxDQUFDLElBQVIsQ0FBYSxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVUsQ0FBQSxDQUFBLENBQWpDLEVBTGI7O0FBT0EsYUFBTztJQVZZO0lBWXJCLE1BQU0sQ0FBQyxhQUFQLEdBQXVCLFNBQUMsU0FBRDtNQUNyQixJQUF5QyxPQUFPLENBQUMsU0FBUixDQUFrQixTQUFsQixDQUF6QztBQUFBLGVBQU8sU0FBUyxDQUFDLE9BQVYsQ0FBa0IsS0FBbEIsRUFBd0IsS0FBeEIsRUFBUDs7SUFEcUI7SUFHdkIsTUFBTSxDQUFDLFdBQVAsR0FBcUIsU0FBQTtNQUNuQixJQUF5QixNQUFNLENBQUMsV0FBaEM7QUFBQSxlQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBakI7O0lBRG1CO0lBR3JCLE1BQU0sQ0FBQyxTQUFQLEdBQW1CLFNBQUE7TUFDakIsSUFBdUIsTUFBTSxDQUFDLFdBQTlCO0FBQUEsZUFBTyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQWpCOztJQURpQjtJQVduQixnQkFBQSxHQUFtQixTQUFBO01BQ2pCLElBQUcsa0JBQUg7QUFDRSxlQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsT0FEcEI7T0FBQSxNQUFBO0FBR0UsZUFBTyxFQUhUOztJQURpQjtJQU9uQixNQUFNLENBQUMsTUFBUCxDQUFjLGdCQUFkLEVBQWdDLFNBQUMsS0FBRDtNQUM5QixJQUFtQixLQUFBLElBQVMsQ0FBNUI7ZUFBQSxDQUFDLENBQUMsV0FBRixDQUFBLEVBQUE7O0lBRDhCLENBQWhDO0FBR0EsV0FBTztFQXpEVCxDQUZpRDtDQUFuRDs7QUErREEsTUFBTSxDQUFDLFNBQVAsQ0FBaUIsNEJBQWpCLEVBQStDLFNBQUE7QUFDN0MsU0FBTztJQUNMLFFBQUEsRUFBVSxHQURMO0lBRUwsSUFBQSxFQUFNLFNBQUMsS0FBRCxFQUFRLE9BQVI7TUFDSixPQUFPLENBQUMsUUFBUixDQUFpQixPQUFqQjthQUNBLE9BQU8sQ0FBQyxRQUFSLENBQWlCLGtCQUFqQjtJQUZJLENBRkQ7SUFLSixVQUFBLEVBQVksZ0NBTFI7O0FBRHNDLENBQS9DIiwiZmlsZSI6IndpZGdldHMvd2lkZ2V0LXNhbGVzLWN1c3RvbWVyLWRldGFpbHMuanMuanMiLCJzb3VyY2VSb290IjoiL3NvdXJjZS8iLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUgPSBhbmd1bGFyLm1vZHVsZSgnbWFlc3RyYW5vLmFuYWx5dGljcy53aWRnZXQtc2FsZXMtY3VzdG9tZXItZGV0YWlscycsWydtYWVzdHJhbm8uYXNzZXRzJ10pXG5cbm1vZHVsZS5jb250cm9sbGVyKCdXaWRnZXRTYWxlc0N1c3RvbWVyRGV0YWlsc0N0cmwnLFtcbiAgJyRzY29wZScsICdEaGJBbmFseXRpY3NTdmMnLCAnVXRpbGl0aWVzJywgJyRmaWx0ZXInLFxuICAoJHNjb3BlLCBEaGJBbmFseXRpY3NTdmMsIFV0aWxpdGllcywgJGZpbHRlcikgLT5cblxuICAgIHcgPSAkc2NvcGUud2lkZ2V0XG5cbiAgICB3LmluaXRDb250ZXh0ID0gLT5cbiAgICAgIGlmICRzY29wZS5pc0RhdGFGb3VuZCA9ICFfLmlzRW1wdHkody5jb250ZW50LmN1c3RvbWVycylcblxuICAgICAgICAkc2NvcGUuY3VzdG9tZXJzT3B0aW9ucyA9IF8ubWFwKHcuY29udGVudC5jdXN0b21lcnMsIChlKSAtPlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBlLnVpZCxcbiAgICAgICAgICAgIGxhYmVsOiBlLm5hbWUsXG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgICRzY29wZS5zZWxlY3RlZEN1c3RvbWVyID0ge1xuICAgICAgICAgIHZhbHVlOiAkc2NvcGUuZ2V0Q3VzdG9tZXIoKS51aWQsXG4gICAgICAgICAgbGFiZWw6ICRzY29wZS5nZXRDdXN0b21lcigpLm5hbWUsXG4gICAgICAgIH1cblxuICAgICRzY29wZS5nZXRDdXN0b21lciA9IC0+XG4gICAgICByZXR1cm4gZmFsc2UgdW5sZXNzICRzY29wZS5pc0RhdGFGb3VuZFxuXG4gICAgICBpZiB3Lm1ldGFkYXRhICYmIHcubWV0YWRhdGEuY3VzdG9tZXJfdWlkXG4gICAgICAgIGN1c3RvbWVyID0gYW5ndWxhci5jb3B5KF8uZmluZCh3LmNvbnRlbnQuY3VzdG9tZXJzLCAoZSkgLT5cbiAgICAgICAgICBlLnVpZCA9PSB3Lm1ldGFkYXRhLmN1c3RvbWVyX3VpZFxuICAgICAgICApIHx8IHcuY29udGVudC5jdXN0b21lcnNbMF0pXG4gICAgICBlbHNlXG4gICAgICAgIGN1c3RvbWVyID0gYW5ndWxhci5jb3B5KHcuY29udGVudC5jdXN0b21lcnNbMF0pXG5cbiAgICAgIHJldHVybiBjdXN0b21lclxuXG4gICAgJHNjb3BlLmZvcm1hdEFkZHJlc3MgPSAoYW5BZGRyZXNzKSAtPlxuICAgICAgcmV0dXJuIGFuQWRkcmVzcy5yZXBsYWNlKC8sIC9nLCcsXFxuJykgaWYgYW5ndWxhci5pc0RlZmluZWQoYW5BZGRyZXNzKVxuXG4gICAgJHNjb3BlLmdldEZyb21EYXRlID0gLT5cbiAgICAgIHJldHVybiB3LmNvbnRlbnQuZnJvbSBpZiAkc2NvcGUuaXNEYXRhRm91bmRcblxuICAgICRzY29wZS5nZXRUb0RhdGUgPSAtPlxuICAgICAgcmV0dXJuIHcuY29udGVudC50byBpZiAkc2NvcGUuaXNEYXRhRm91bmRcblxuXG4gICAgIyBUT0RPOiBSZWZhY3RvciBvbmNlIHdlIGhhdmUgdW5kZXJzdG9vZCBleGFjdGx5IGhvdyB0aGUgYW5ndWxhcmpzIGNvbXBpbGF0aW9uIHByb2Nlc3Mgd29ya3M6XG4gICAgIyBpbiB0aGlzIG9yZGVyLCB3ZSBzaG91bGQ6XG4gICAgIyAxLSBjb21waWxlIGltcGFjLXdpZGdldCBjb250cm9sbGVyXG4gICAgIyAyLSBjb21waWxlIHRoZSBzcGVjaWZpYyB3aWRnZXQgdGVtcGxhdGUvY29udHJvbGxlclxuICAgICMgMy0gY29tcGlsZSB0aGUgc2V0dGluZ3MgdGVtcGxhdGVzL2NvbnRyb2xsZXJzXG4gICAgIyA0LSBjYWxsIHdpZGdldC5sb2FkQ29udGVudCgpIChpZGVhbGx5LCBmcm9tIGltcGFjLXdpZGdldCwgb25jZSBhIGNhbGxiYWNrIFxuICAgICMgICAgIGFzc2Vzc2luZyB0aGF0IGV2ZXJ5dGhpbmcgaXMgY29tcGlsZWQgYW4gcmVhZHkgaXMgcmVjZWl2ZWQpXG4gICAgZ2V0U2V0dGluZ3NDb3VudCA9IC0+XG4gICAgICBpZiB3LnNldHRpbmdzP1xuICAgICAgICByZXR1cm4gdy5zZXR0aW5ncy5sZW5ndGhcbiAgICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIDBcblxuICAgICMgU2V0dGluZ3M6IG9yZ2FuaXphdGlvbnMgKyB0aW1lIHJhbmdlICsgeDEgcGFyYW0gc2VsZWN0b3IgKyB3aWR0aFxuICAgICRzY29wZS4kd2F0Y2ggZ2V0U2V0dGluZ3NDb3VudCwgKHRvdGFsKSAtPlxuICAgICAgdy5sb2FkQ29udGVudCgpIGlmIHRvdGFsID49IDRcblxuICAgIHJldHVybiB3XG5cbl0pXG5cbm1vZHVsZS5kaXJlY3RpdmUoJ3dpZGdldFNhbGVzQ3VzdG9tZXJEZXRhaWxzJywgLT5cbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0EnLFxuICAgIGxpbms6IChzY29wZSwgZWxlbWVudCkgLT5cbiAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJzYWxlc1wiKVxuICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImN1c3RvbWVyLWRldGFpbHNcIilcbiAgICAsY29udHJvbGxlcjogJ1dpZGdldFNhbGVzQ3VzdG9tZXJEZXRhaWxzQ3RybCdcbiAgfVxuKSJdfQ==