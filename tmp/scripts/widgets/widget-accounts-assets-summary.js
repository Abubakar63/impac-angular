(function () {
var module;

module = angular.module('maestrano.analytics.widget-accounts-assets-summary', ['maestrano.assets']);

module.controller('WidgetAccountsAssetsSummaryCtrl', [
  '$scope', 'DhbAnalyticsSvc', 'ChartFormatterSvc', function($scope, DhbAnalyticsSvc, ChartFormatterSvc) {
    var getSettingsCount, w;
    w = $scope.widget;
    w.initContext = function() {
      return $scope.isDataFound = angular.isDefined(w.content) && !_.isEmpty(w.content.summary);
    };
    w.format = function() {
      var pieData, pieOptions;
      if ($scope.isDataFound) {
        pieData = _.map(w.content.summary, function(account) {
          return {
            label: account.label,
            value: account.total
          };
        });
        pieOptions = {
          percentageInnerCutout: 50,
          tooltipFontSize: 12
        };
        return w.chart = ChartFormatterSvc.pieChart(pieData, pieOptions);
      }
    };
    $scope.getCurrency = function() {
      if ($scope.isDataFound) {
        return w.content.currency;
      }
    };
    $scope.getAccountColor = function(anAccount) {
      if ($scope.isDataFound) {
        return ChartFormatterSvc.getColor(_.indexOf(w.content.summary, anAccount));
      }
    };
    getSettingsCount = function() {
      if (w.settings != null) {
        return w.settings.length;
      } else {
        return 0;
      }
    };
    $scope.$watch(getSettingsCount, function(total) {
      if (total === 1) {
        return w.loadContent();
      }
    });
    return w;
  }
]);

module.directive('widgetAccountsAssetsSummary', function() {
  return {
    restrict: 'A',
    link: function(scope, element) {
      element.addClass("accounts");
      return element.addClass("assets-summary");
    },
    controller: 'WidgetAccountsAssetsSummaryCtrl'
  };
});
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndpZGdldHMvd2lkZ2V0LWFjY291bnRzLWFzc2V0cy1zdW1tYXJ5LmpzLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBOztBQUFBLE1BQUEsR0FBUyxPQUFPLENBQUMsTUFBUixDQUFlLG9EQUFmLEVBQW9FLENBQUMsa0JBQUQsQ0FBcEU7O0FBRVQsTUFBTSxDQUFDLFVBQVAsQ0FBa0IsaUNBQWxCLEVBQW9EO0VBQ2xELFFBRGtELEVBQ3hDLGlCQUR3QyxFQUNyQixtQkFEcUIsRUFFbEQsU0FBQyxNQUFELEVBQVMsZUFBVCxFQUEwQixpQkFBMUI7QUFFRSxRQUFBO0lBQUEsQ0FBQSxHQUFJLE1BQU0sQ0FBQztJQUVYLENBQUMsQ0FBQyxXQUFGLEdBQWdCLFNBQUE7YUFDZCxNQUFNLENBQUMsV0FBUCxHQUFxQixPQUFPLENBQUMsU0FBUixDQUFrQixDQUFDLENBQUMsT0FBcEIsQ0FBQSxJQUFnQyxDQUFDLENBQUMsQ0FBQyxPQUFGLENBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFwQjtJQUR4QztJQUdoQixDQUFDLENBQUMsTUFBRixHQUFXLFNBQUE7QUFDVCxVQUFBO01BQUEsSUFBRyxNQUFNLENBQUMsV0FBVjtRQUNFLE9BQUEsR0FBVSxDQUFDLENBQUMsR0FBRixDQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBaEIsRUFBeUIsU0FBQyxPQUFEO2lCQUNqQztZQUNFLEtBQUEsRUFBTyxPQUFPLENBQUMsS0FEakI7WUFFRSxLQUFBLEVBQU8sT0FBTyxDQUFDLEtBRmpCOztRQURpQyxDQUF6QjtRQU1WLFVBQUEsR0FBYTtVQUNYLHFCQUFBLEVBQXVCLEVBRFo7VUFFWCxlQUFBLEVBQWlCLEVBRk47O2VBS2IsQ0FBQyxDQUFDLEtBQUYsR0FBVSxpQkFBaUIsQ0FBQyxRQUFsQixDQUEyQixPQUEzQixFQUFvQyxVQUFwQyxFQVpaOztJQURTO0lBZVgsTUFBTSxDQUFDLFdBQVAsR0FBcUIsU0FBQTtNQUNuQixJQUFzQixNQUFNLENBQUMsV0FBN0I7ZUFBQSxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVY7O0lBRG1CO0lBR3JCLE1BQU0sQ0FBQyxlQUFQLEdBQXlCLFNBQUMsU0FBRDtNQUN2QixJQUF1RSxNQUFNLENBQUMsV0FBOUU7ZUFBQSxpQkFBaUIsQ0FBQyxRQUFsQixDQUEyQixDQUFDLENBQUMsT0FBRixDQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBcEIsRUFBNkIsU0FBN0IsQ0FBM0IsRUFBQTs7SUFEdUI7SUFXekIsZ0JBQUEsR0FBbUIsU0FBQTtNQUNqQixJQUFHLGtCQUFIO0FBQ0UsZUFBTyxDQUFDLENBQUMsUUFBUSxDQUFDLE9BRHBCO09BQUEsTUFBQTtBQUdFLGVBQU8sRUFIVDs7SUFEaUI7SUFNbkIsTUFBTSxDQUFDLE1BQVAsQ0FBYyxnQkFBZCxFQUFnQyxTQUFDLEtBQUQ7TUFDOUIsSUFBbUIsS0FBQSxLQUFTLENBQTVCO2VBQUEsQ0FBQyxDQUFDLFdBQUYsQ0FBQSxFQUFBOztJQUQ4QixDQUFoQztBQUdBLFdBQU87RUE3Q1QsQ0FGa0Q7Q0FBcEQ7O0FBa0RBLE1BQU0sQ0FBQyxTQUFQLENBQWlCLDZCQUFqQixFQUFnRCxTQUFBO0FBQzlDLFNBQU87SUFDTCxRQUFBLEVBQVUsR0FETDtJQUVMLElBQUEsRUFBTSxTQUFDLEtBQUQsRUFBUSxPQUFSO01BQ0osT0FBTyxDQUFDLFFBQVIsQ0FBaUIsVUFBakI7YUFDQSxPQUFPLENBQUMsUUFBUixDQUFpQixnQkFBakI7SUFGSSxDQUZEO0lBS0osVUFBQSxFQUFZLGlDQUxSOztBQUR1QyxDQUFoRCIsImZpbGUiOiJ3aWRnZXRzL3dpZGdldC1hY2NvdW50cy1hc3NldHMtc3VtbWFyeS5qcy5qcyIsInNvdXJjZVJvb3QiOiIvc291cmNlLyIsInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZSA9IGFuZ3VsYXIubW9kdWxlKCdtYWVzdHJhbm8uYW5hbHl0aWNzLndpZGdldC1hY2NvdW50cy1hc3NldHMtc3VtbWFyeScsWydtYWVzdHJhbm8uYXNzZXRzJ10pXG5cbm1vZHVsZS5jb250cm9sbGVyKCdXaWRnZXRBY2NvdW50c0Fzc2V0c1N1bW1hcnlDdHJsJyxbXG4gICckc2NvcGUnLCAnRGhiQW5hbHl0aWNzU3ZjJywgJ0NoYXJ0Rm9ybWF0dGVyU3ZjJyxcbiAgKCRzY29wZSwgRGhiQW5hbHl0aWNzU3ZjLCBDaGFydEZvcm1hdHRlclN2YykgLT5cblxuICAgIHcgPSAkc2NvcGUud2lkZ2V0XG5cbiAgICB3LmluaXRDb250ZXh0ID0gLT5cbiAgICAgICRzY29wZS5pc0RhdGFGb3VuZCA9IGFuZ3VsYXIuaXNEZWZpbmVkKHcuY29udGVudCkgJiYgIV8uaXNFbXB0eSh3LmNvbnRlbnQuc3VtbWFyeSlcblxuICAgIHcuZm9ybWF0ID0gLT5cbiAgICAgIGlmICRzY29wZS5pc0RhdGFGb3VuZFxuICAgICAgICBwaWVEYXRhID0gXy5tYXAgdy5jb250ZW50LnN1bW1hcnksIChhY2NvdW50KSAtPlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGxhYmVsOiBhY2NvdW50LmxhYmVsLFxuICAgICAgICAgICAgdmFsdWU6IGFjY291bnQudG90YWwsXG4gICAgICAgICAgfVxuICAgICAgICAjIGN1cnJlbmN5ID0gXCIkXCJcbiAgICAgICAgcGllT3B0aW9ucyA9IHtcbiAgICAgICAgICBwZXJjZW50YWdlSW5uZXJDdXRvdXQ6IDUwLFxuICAgICAgICAgIHRvb2x0aXBGb250U2l6ZTogMTIsXG4gICAgICAgICAgIyB0b29sdGlwVGVtcGxhdGU6IFwiPCVpZiAobGFiZWwpeyU+PCU9bGFiZWwgJT46IDwlfSU+PCU9IHZhbHVlICsgJyAje2N1cnJlbmN5fScgJT5cIlxuICAgICAgICB9XG4gICAgICAgIHcuY2hhcnQgPSBDaGFydEZvcm1hdHRlclN2Yy5waWVDaGFydChwaWVEYXRhLCBwaWVPcHRpb25zKVxuXG4gICAgJHNjb3BlLmdldEN1cnJlbmN5ID0gLT5cbiAgICAgIHcuY29udGVudC5jdXJyZW5jeSBpZiAkc2NvcGUuaXNEYXRhRm91bmRcblxuICAgICRzY29wZS5nZXRBY2NvdW50Q29sb3IgPSAoYW5BY2NvdW50KSAtPlxuICAgICAgQ2hhcnRGb3JtYXR0ZXJTdmMuZ2V0Q29sb3IoXy5pbmRleE9mKHcuY29udGVudC5zdW1tYXJ5LCBhbkFjY291bnQpKSBpZiAkc2NvcGUuaXNEYXRhRm91bmRcblxuXG4gICAgIyBUT0RPOiBSZWZhY3RvciBvbmNlIHdlIGhhdmUgdW5kZXJzdG9vZCBleGFjdGx5IGhvdyB0aGUgYW5ndWxhcmpzIGNvbXBpbGF0aW9uIHByb2Nlc3Mgd29ya3M6XG4gICAgIyBpbiB0aGlzIG9yZGVyLCB3ZSBzaG91bGQ6XG4gICAgIyAxLSBjb21waWxlIGltcGFjLXdpZGdldCBjb250cm9sbGVyXG4gICAgIyAyLSBjb21waWxlIHRoZSBzcGVjaWZpYyB3aWRnZXQgdGVtcGxhdGUvY29udHJvbGxlclxuICAgICMgMy0gY29tcGlsZSB0aGUgc2V0dGluZ3MgdGVtcGxhdGVzL2NvbnRyb2xsZXJzXG4gICAgIyA0LSBjYWxsIHdpZGdldC5sb2FkQ29udGVudCgpIChpZGVhbGx5LCBmcm9tIGltcGFjLXdpZGdldCwgb25jZSBhIGNhbGxiYWNrIFxuICAgICMgICAgIGFzc2Vzc2luZyB0aGF0IGV2ZXJ5dGhpbmcgaXMgY29tcGlsZWQgYW4gcmVhZHkgaXMgcmVjZWl2ZWQpXG4gICAgZ2V0U2V0dGluZ3NDb3VudCA9IC0+XG4gICAgICBpZiB3LnNldHRpbmdzP1xuICAgICAgICByZXR1cm4gdy5zZXR0aW5ncy5sZW5ndGhcbiAgICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIDBcblxuICAgICRzY29wZS4kd2F0Y2ggZ2V0U2V0dGluZ3NDb3VudCwgKHRvdGFsKSAtPlxuICAgICAgdy5sb2FkQ29udGVudCgpIGlmIHRvdGFsID09IDFcblxuICAgIHJldHVybiB3XG5dKVxuXG5tb2R1bGUuZGlyZWN0aXZlKCd3aWRnZXRBY2NvdW50c0Fzc2V0c1N1bW1hcnknLCAtPlxuICByZXR1cm4ge1xuICAgIHJlc3RyaWN0OiAnQScsXG4gICAgbGluazogKHNjb3BlLCBlbGVtZW50KSAtPlxuICAgICAgZWxlbWVudC5hZGRDbGFzcyhcImFjY291bnRzXCIpXG4gICAgICBlbGVtZW50LmFkZENsYXNzKFwiYXNzZXRzLXN1bW1hcnlcIilcbiAgICAsY29udHJvbGxlcjogJ1dpZGdldEFjY291bnRzQXNzZXRzU3VtbWFyeUN0cmwnXG4gIH1cbikiXX0=