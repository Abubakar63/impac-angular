(function () {
var module;

module = angular.module('maestrano.analytics.widget-hr-employee-details', ['maestrano.assets']);

module.controller('WidgetHrEmployeeDetailsCtrl', [
  '$scope', 'DhbAnalyticsSvc', 'Utilities', '$filter', function($scope, DhbAnalyticsSvc, Utilities, $filter) {
    var getSettingsCount, w;
    w = $scope.widget;
    w.initContext = function() {
      if ($scope.isDataFound = !_.isEmpty(w.content.employees)) {
        $scope.periodOptions = [
          {
            label: 'Yearly',
            value: 'yearly'
          }, {
            label: 'Monthly',
            value: 'monthly'
          }, {
            label: 'Weekly',
            value: 'weekly'
          }, {
            label: 'Hourly',
            value: 'hourly'
          }
        ];
        if (w.metadata && w.metadata.period) {
          $scope.period = _.find($scope.periodOptions, function(o) {
            return o.value === w.metadata.period.toLowerCase();
          }) || $scope.periodOptions[0];
        } else {
          $scope.period = $scope.periodOptions[0];
        }
        $scope.employeesOptions = _.map(w.content.employees, function(e) {
          return {
            value: e.uid,
            label: e.lastname + " " + e.firstname
          };
        });
        return $scope.selectedEmployee = {
          value: $scope.getEmployee().uid,
          label: ($scope.getEmployee().lastname) + " " + ($scope.getEmployee().firstname)
        };
      }
    };
    $scope.getSingleCompanyName = function() {
      var org, orgUid;
      if (w.content && w.content.organizations) {
        orgUid = w.content.organizations[0];
        org = _.find(w.parentDashboard.data_sources, function(o) {
          return o.uid === orgUid;
        });
        return org.label;
      }
    };
    $scope.getEmployee = function() {
      var employee;
      if (!$scope.isDataFound) {
        return false;
      }
      if (w.metadata && w.metadata.employee_uid) {
        employee = angular.copy(_.find(w.content.employees, function(e) {
          return e.uid === w.metadata.employee_uid;
        }) || w.content.employees[0]);
      } else {
        employee = angular.copy(w.content.employees[0]);
      }
      employee.salary && (employee.salary = $filter('mnoCurrency')(employee.salary.amount, employee.salary.currency));
      return employee;
    };
    $scope.formatAddress = function(anAddress) {
      if (angular.isDefined(anAddress)) {
        return anAddress.replace(/, /g, ',\n');
      }
    };
    getSettingsCount = function() {
      if (w.settings != null) {
        return w.settings.length;
      } else {
        return 0;
      }
    };
    $scope.$watch(getSettingsCount, function(total) {
      if (total >= 4) {
        return w.loadContent();
      }
    });
    return w;
  }
]);

module.directive('widgetHrEmployeeDetails', function() {
  return {
    restrict: 'A',
    link: function(scope, element) {
      element.addClass("hr");
      return element.addClass("employee-details");
    },
    controller: 'WidgetHrEmployeeDetailsCtrl'
  };
});
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndpZGdldHMvd2lkZ2V0LWhyLWVtcGxveWVlLWRldGFpbHMuanMuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUE7O0FBQUEsTUFBQSxHQUFTLE9BQU8sQ0FBQyxNQUFSLENBQWUsZ0RBQWYsRUFBZ0UsQ0FBQyxrQkFBRCxDQUFoRTs7QUFFVCxNQUFNLENBQUMsVUFBUCxDQUFrQiw2QkFBbEIsRUFBZ0Q7RUFDOUMsUUFEOEMsRUFDcEMsaUJBRG9DLEVBQ2pCLFdBRGlCLEVBQ0osU0FESSxFQUU5QyxTQUFDLE1BQUQsRUFBUyxlQUFULEVBQTBCLFNBQTFCLEVBQXFDLE9BQXJDO0FBRUUsUUFBQTtJQUFBLENBQUEsR0FBSSxNQUFNLENBQUM7SUFFWCxDQUFDLENBQUMsV0FBRixHQUFnQixTQUFBO01BQ2QsSUFBRyxNQUFNLENBQUMsV0FBUCxHQUFxQixDQUFDLENBQUMsQ0FBQyxPQUFGLENBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFwQixDQUF6QjtRQUVFLE1BQU0sQ0FBQyxhQUFQLEdBQXVCO1VBQ3JCO1lBQUMsS0FBQSxFQUFPLFFBQVI7WUFBa0IsS0FBQSxFQUFPLFFBQXpCO1dBRHFCLEVBRXJCO1lBQUMsS0FBQSxFQUFPLFNBQVI7WUFBbUIsS0FBQSxFQUFPLFNBQTFCO1dBRnFCLEVBR3JCO1lBQUMsS0FBQSxFQUFPLFFBQVI7WUFBa0IsS0FBQSxFQUFPLFFBQXpCO1dBSHFCLEVBSXJCO1lBQUMsS0FBQSxFQUFPLFFBQVI7WUFBa0IsS0FBQSxFQUFPLFFBQXpCO1dBSnFCOztRQU12QixJQUFHLENBQUMsQ0FBQyxRQUFGLElBQWMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxNQUE1QjtVQUNFLE1BQU0sQ0FBQyxNQUFQLEdBQWdCLENBQUMsQ0FBQyxJQUFGLENBQU8sTUFBTSxDQUFDLGFBQWQsRUFBNkIsU0FBQyxDQUFEO21CQUMzQyxDQUFDLENBQUMsS0FBRixLQUFXLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLFdBQWxC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QUFoQztBQUdBLFdBQU87RUF4RVQsQ0FGOEM7Q0FBaEQ7O0FBOEVBLE1BQU0sQ0FBQyxTQUFQLENBQWlCLHlCQUFqQixFQUE0QyxTQUFBO0FBQzFDLFNBQU87SUFDTCxRQUFBLEVBQVUsR0FETDtJQUVMLElBQUEsRUFBTSxTQUFDLEtBQUQsRUFBUSxPQUFSO01BQ0osT0FBTyxDQUFDLFFBQVIsQ0FBaUIsSUFBakI7YUFDQSxPQUFPLENBQUMsUUFBUixDQUFpQixrQkFBakI7SUFGSSxDQUZEO0lBS0osVUFBQSxFQUFZLDZCQUxSOztBQURtQyxDQUE1QyIsImZpbGUiOiJ3aWRnZXRzL3dpZGdldC1oci1lbXBsb3llZS1kZXRhaWxzLmpzLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ21hZXN0cmFuby5hbmFseXRpY3Mud2lkZ2V0LWhyLWVtcGxveWVlLWRldGFpbHMnLFsnbWFlc3RyYW5vLmFzc2V0cyddKVxuXG5tb2R1bGUuY29udHJvbGxlcignV2lkZ2V0SHJFbXBsb3llZURldGFpbHNDdHJsJyxbXG4gICckc2NvcGUnLCAnRGhiQW5hbHl0aWNzU3ZjJywgJ1V0aWxpdGllcycsICckZmlsdGVyJyxcbiAgKCRzY29wZSwgRGhiQW5hbHl0aWNzU3ZjLCBVdGlsaXRpZXMsICRmaWx0ZXIpIC0+XG5cbiAgICB3ID0gJHNjb3BlLndpZGdldFxuXG4gICAgdy5pbml0Q29udGV4dCA9IC0+XG4gICAgICBpZiAkc2NvcGUuaXNEYXRhRm91bmQgPSAhXy5pc0VtcHR5KHcuY29udGVudC5lbXBsb3llZXMpXG5cbiAgICAgICAgJHNjb3BlLnBlcmlvZE9wdGlvbnMgPSBbXG4gICAgICAgICAge2xhYmVsOiAnWWVhcmx5JywgdmFsdWU6ICd5ZWFybHknfSxcbiAgICAgICAgICB7bGFiZWw6ICdNb250aGx5JywgdmFsdWU6ICdtb250aGx5J30sXG4gICAgICAgICAge2xhYmVsOiAnV2Vla2x5JywgdmFsdWU6ICd3ZWVrbHknfSxcbiAgICAgICAgICB7bGFiZWw6ICdIb3VybHknLCB2YWx1ZTogJ2hvdXJseSd9XG4gICAgICAgIF1cbiAgICAgICAgaWYgdy5tZXRhZGF0YSAmJiB3Lm1ldGFkYXRhLnBlcmlvZFxuICAgICAgICAgICRzY29wZS5wZXJpb2QgPSBfLmZpbmQoJHNjb3BlLnBlcmlvZE9wdGlvbnMsIChvKSAtPlxuICAgICAgICAgICAgby52YWx1ZSA9PSB3Lm1ldGFkYXRhLnBlcmlvZC50b0xvd2VyQ2FzZSgpXG4gICAgICAgICAgKSB8fCAkc2NvcGUucGVyaW9kT3B0aW9uc1swXVxuICAgICAgICBlbHNlXG4gICAgICAgICAgJHNjb3BlLnBlcmlvZCA9ICRzY29wZS5wZXJpb2RPcHRpb25zWzBdXG5cbiAgICAgICAgJHNjb3BlLmVtcGxveWVlc09wdGlvbnMgPSBfLm1hcCh3LmNvbnRlbnQuZW1wbG95ZWVzLCAoZSkgLT5cbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogZS51aWQsXG4gICAgICAgICAgICBsYWJlbDogXCIje2UubGFzdG5hbWV9ICN7ZS5maXJzdG5hbWV9XCIsXG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgICRzY29wZS5zZWxlY3RlZEVtcGxveWVlID0ge1xuICAgICAgICAgIHZhbHVlOiAkc2NvcGUuZ2V0RW1wbG95ZWUoKS51aWQsXG4gICAgICAgICAgbGFiZWw6IFwiI3skc2NvcGUuZ2V0RW1wbG95ZWUoKS5sYXN0bmFtZX0gI3skc2NvcGUuZ2V0RW1wbG95ZWUoKS5maXJzdG5hbWV9XCIsXG4gICAgICAgIH1cblxuICAgICRzY29wZS5nZXRTaW5nbGVDb21wYW55TmFtZSA9IC0+XG4gICAgICBpZiB3LmNvbnRlbnQgJiYgdy5jb250ZW50Lm9yZ2FuaXphdGlvbnNcbiAgICAgICAgb3JnVWlkID0gdy5jb250ZW50Lm9yZ2FuaXphdGlvbnNbMF1cbiAgICAgICAgb3JnID0gXy5maW5kKHcucGFyZW50RGFzaGJvYXJkLmRhdGFfc291cmNlcywgKG8pIC0+XG4gICAgICAgICAgby51aWQgPT0gb3JnVWlkXG4gICAgICAgIClcbiAgICAgICAgcmV0dXJuIG9yZy5sYWJlbFxuXG4gICAgJHNjb3BlLmdldEVtcGxveWVlID0gLT5cbiAgICAgIHJldHVybiBmYWxzZSB1bmxlc3MgJHNjb3BlLmlzRGF0YUZvdW5kXG5cbiAgICAgIGlmIHcubWV0YWRhdGEgJiYgdy5tZXRhZGF0YS5lbXBsb3llZV91aWRcbiAgICAgICAgZW1wbG95ZWUgPSBhbmd1bGFyLmNvcHkoXy5maW5kKHcuY29udGVudC5lbXBsb3llZXMsIChlKSAtPlxuICAgICAgICAgIGUudWlkID09IHcubWV0YWRhdGEuZW1wbG95ZWVfdWlkXG4gICAgICAgICkgfHwgdy5jb250ZW50LmVtcGxveWVlc1swXSlcbiAgICAgIGVsc2VcbiAgICAgICAgZW1wbG95ZWUgPSBhbmd1bGFyLmNvcHkody5jb250ZW50LmVtcGxveWVlc1swXSlcblxuICAgICAgZW1wbG95ZWUuc2FsYXJ5ICYmPSAkZmlsdGVyKCdtbm9DdXJyZW5jeScpKGVtcGxveWVlLnNhbGFyeS5hbW91bnQsZW1wbG95ZWUuc2FsYXJ5LmN1cnJlbmN5KVxuICAgICAgcmV0dXJuIGVtcGxveWVlXG5cbiAgICAkc2NvcGUuZm9ybWF0QWRkcmVzcyA9IChhbkFkZHJlc3MpIC0+XG4gICAgICByZXR1cm4gYW5BZGRyZXNzLnJlcGxhY2UoLywgL2csJyxcXG4nKSBpZiBhbmd1bGFyLmlzRGVmaW5lZChhbkFkZHJlc3MpXG5cbiAgICAjIFRPRE86IFJlZmFjdG9yIG9uY2Ugd2UgaGF2ZSB1bmRlcnN0b29kIGV4YWN0bHkgaG93IHRoZSBhbmd1bGFyanMgY29tcGlsYXRpb24gcHJvY2VzcyB3b3JrczpcbiAgICAjIGluIHRoaXMgb3JkZXIsIHdlIHNob3VsZDpcbiAgICAjIDEtIGNvbXBpbGUgaW1wYWMtd2lkZ2V0IGNvbnRyb2xsZXJcbiAgICAjIDItIGNvbXBpbGUgdGhlIHNwZWNpZmljIHdpZGdldCB0ZW1wbGF0ZS9jb250cm9sbGVyXG4gICAgIyAzLSBjb21waWxlIHRoZSBzZXR0aW5ncyB0ZW1wbGF0ZXMvY29udHJvbGxlcnNcbiAgICAjIDQtIGNhbGwgd2lkZ2V0LmxvYWRDb250ZW50KCkgKGlkZWFsbHksIGZyb20gaW1wYWMtd2lkZ2V0LCBvbmNlIGEgY2FsbGJhY2sgXG4gICAgIyAgICAgYXNzZXNzaW5nIHRoYXQgZXZlcnl0aGluZyBpcyBjb21waWxlZCBhbiByZWFkeSBpcyByZWNlaXZlZClcbiAgICBnZXRTZXR0aW5nc0NvdW50ID0gLT5cbiAgICAgIGlmIHcuc2V0dGluZ3M/XG4gICAgICAgIHJldHVybiB3LnNldHRpbmdzLmxlbmd0aFxuICAgICAgZWxzZVxuICAgICAgICByZXR1cm4gMFxuXG4gICAgIyBTZXR0aW5nczogb3JnYW5pemF0aW9ucyArIHgyIHBhcmFtIHNlbGVjdG9yICsgd2lkdGhcbiAgICAkc2NvcGUuJHdhdGNoIGdldFNldHRpbmdzQ291bnQsICh0b3RhbCkgLT5cbiAgICAgIHcubG9hZENvbnRlbnQoKSBpZiB0b3RhbCA+PSA0XG5cbiAgICByZXR1cm4gd1xuXG5dKVxuXG5tb2R1bGUuZGlyZWN0aXZlKCd3aWRnZXRIckVtcGxveWVlRGV0YWlscycsIC0+XG4gIHJldHVybiB7XG4gICAgcmVzdHJpY3Q6ICdBJyxcbiAgICBsaW5rOiAoc2NvcGUsIGVsZW1lbnQpIC0+XG4gICAgICBlbGVtZW50LmFkZENsYXNzKFwiaHJcIilcbiAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJlbXBsb3llZS1kZXRhaWxzXCIpXG4gICAgLGNvbnRyb2xsZXI6ICdXaWRnZXRIckVtcGxveWVlRGV0YWlsc0N0cmwnXG4gIH1cbikiXX0=