(function () {
var module;

module = angular.module('maestrano.analytics.impac-widget-template-admin', ['maestrano.assets']);

module.controller('ImpacWidgetTemplateAdminCtrl', [
  '$scope', 'WidgetTemplateSvc', '$http', 'AssetPath', function($scope, WidgetTemplateSvc, $http, AssetPath) {
    var addCategory, create, dataURItoBlob, destroy, index, update, updateCategory;
    $scope.activatedCat = false;
    $scope.cat = {};
    $scope.loaderImage = AssetPath['loader-white-bg.gif'];
    $scope.activateCat = function(cat) {
      if (cat === $scope.activatedCat) {
        $scope.activatedCat = false;
        return $scope.cat[cat] = false;
      } else {
        $scope.cat[cat] = true;
        if ($scope.activatedCat) {
          $scope.cat[$scope.activatedCat] = false;
        }
        return $scope.activatedCat = cat;
      }
    };
    $scope.create = create = {};
    create.successMsg = false;
    create.errorMsg = false;
    create.errors = '';
    create.inProgress = false;
    create.generatePdf = true;
    create.screenshot = {};
    create.model = {};
    create.endpoints = [];
    create.resetEndpoints = function() {
      return _.each(create.endpoints, function(ep) {
        return ep.checked = false;
      });
    };
    create.reset = function() {
      create.model = {};
      create.model['active'] = true;
      create.model.screenshot = "";
      create.screenshot = {};
      return create.resetEndpoints();
    };
    create.save = function() {
      create.errors = '';
      create.successMsg = false;
      create.errorMsg = false;
      create.inProgress = true;
      create.model.endpoints = create.endpoints;
      return WidgetTemplateSvc.create(create).then(function(response) {
        if (response.status === 400) {
          create.errorMsg = true;
          create.errors = response.data;
          return create.inProgress = false;
        }
      });
    };
    create.saveCatalogueImg = function() {
      return $scope.renderTemplateImg(false);
    };
    create.afterSave = function() {
      create.successMsg = true;
      create.reset();
      index.get();
      create.inProgress = false;
      if (create.generatePdf) {
        return WidgetTemplateSvc.generatePdf();
      }
    };
    $scope.update = update = {};
    update.selected = false;
    update.inProgress = false;
    update.successMsg = false;
    update.errorMsg = false;
    update.errors = '';
    update.generatePdf = true;
    update.model = {};
    update.endpoints = [];
    update.save = function() {
      update.successMsg = false;
      update.errorMsg = false;
      update.inProgress = true;
      update.model.endpoints = update.endpoints;
      return WidgetTemplateSvc.update(update).then(function(response) {
        if (response.status === 400) {
          update.errorMsg = true;
          update.errors = response.data;
          return update.inProgress = false;
        }
      });
    };
    update.saveCatalogueImg = function() {
      return $scope.renderTemplateImg(true);
    };
    update.afterSave = function() {
      update.successMsg = true;
      update.inProgress = false;
      if (update.generatePdf) {
        return WidgetTemplateSvc.generatePdf();
      }
    };
    update.selectEndpoints = function(wt) {
      return _.each(update.endpoints, function(ep) {
        ep.checked = false;
        return _.each(wt.endpoints, function(wt_ep) {
          if (wt_ep.shared_entity_id === ep.id) {
            return ep.checked = true;
          }
        });
      });
    };
    $scope.$watch('update.selected', function() {
      if (update.selected) {
        _.each(index.model, function(wt) {
          if (wt.id === update.selected.id) {
            update.model = wt;
            update.model.category_id = wt.category_id;
            update.selectEndpoints(wt);
          }
        });
      } else {
        update.model = {};
      }
      return $scope.$apply;
    });
    $scope.destroy = destroy = {};
    destroy.selected = false;
    destroy.inProgress = false;
    destroy.generatePdf = true;
    destroy.destroy = function() {
      destroy.inProgress = true;
      return WidgetTemplateSvc.destroy(destroy.selected.id).then(destroy.inProgress = false, destroy.selected = false, destroy.confirm = "", index.get(), destroy.generatePdf ? WidgetTemplateSvc.generatePdf() : void 0);
    };
    $scope.addCategory = addCategory = {};
    addCategory.model = {};
    addCategory.save = function() {
      return WidgetTemplateSvc.createCategory(addCategory.model).then(addCategory.model = {}, index.getCategories());
    };
    $scope.updateCategory = updateCategory = {};
    updateCategory.selected = false;
    updateCategory.inProgress = false;
    updateCategory.model = {};
    updateCategory.successMsg = false;
    updateCategory.errorMsg = false;
    updateCategory.errors = '';
    updateCategory.save = function() {
      updateCategory.successMsg = false;
      updateCategory.errorMsg = false;
      updateCategory.inProgress = true;
      return WidgetTemplateSvc.updateCategory(updateCategory.model).then(function(success) {
        updateCategory.successMsg = true;
        return index.getCategories();
      }, function(failure) {
        updateCategory.errorMsg = true;
        return updateCategory.errors = failure.data;
      }, updateCategory.inProgress = false);
    };
    $scope.$watch('updateCategory.selected', function() {
      if (updateCategory.selected) {
        _.each(index.categories, function(cat) {
          if (cat.id === updateCategory.selected.id) {
            updateCategory.model = cat;
          }
        });
      } else {
        updateCategory.model = {};
      }
      return $scope.$apply;
    });
    $scope.index = index = {};
    index.inProgress = false;
    index.model = {};
    index.categories = {};
    index.sharedEntities = {};
    index.lastUpdate = "";
    index.initEndpoints = function(array) {
      return _.each(index.sharedEntities, function(se) {
        return array.push({
          id: se.id,
          name: se.name,
          checked: false
        });
      });
    };
    index.get = function() {
      index.inProgress = true;
      return WidgetTemplateSvc.index().then(function(widget_templates) {
        index.model = widget_templates;
        return index.inProgress = false;
      });
    };
    index.getCategories = function() {
      index.inProgress = true;
      return WidgetTemplateSvc.categories().then(function(categories) {
        index.categories = categories;
        return index.inProgress = false;
      });
    };
    index.getSharedEntities = function() {
      index.inProgress = true;
      return $http.get('/js_api/v1/connec_entities').then(function(success) {
        index.sharedEntities = success.data.shared_entities;
        index.initEndpoints(create.endpoints);
        index.initEndpoints(update.endpoints);
        return index.inProgress = false;
      });
    };
    index.getLastUpdate = function() {
      index.inProgress = true;
      return WidgetTemplateSvc.lastUpdate().then(function(last_update) {
        index.lastUpdate = last_update;
        return index.inProgress = false;
      });
    };
    $scope.saveCatalogueImg = function(aCat, catalogueImgFile) {
      return WidgetTemplateSvc.updateImg(aCat, catalogueImgFile, false);
    };
    $scope.getSettings = function(aModel) {
      if ((aModel.settings != null) && _.isArray(aModel.settings)) {
        return aModel.settings.slice(0, 6);
      } else if ((aModel.settings != null) && _.isString(aModel.settings)) {
        if (aModel.settings === "") {
          return [];
        } else {
          return aModel.settings.split(',').slice(0, 6);
        }
      }
    };
    $scope.getCompatibleApps = function(element) {
      if (element.endpoints != null) {
        return WidgetTemplateSvc.previewApps(element);
      }
    };
    dataURItoBlob = function(dataURI) {
      var ab, bb, byteString, i, ia, j, mimeString, ref;
      byteString = atob(dataURI.split(',')[1]);
      mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
      ab = new ArrayBuffer(byteString.length);
      ia = new Uint8Array(ab);
      for (i = j = 0, ref = byteString.length; 0 <= ref ? j <= ref : j >= ref; i = 0 <= ref ? ++j : --j) {
        ia[i] = byteString.charCodeAt(i);
      }
      bb = new Blob([ab]);
      return bb;
    };
    $scope.renderTemplateImg = function(isUpdate) {
      var contentElem;
      if (isUpdate == null) {
        isUpdate = true;
      }
      if (isUpdate) {
        contentElem = angular.element('#preview_update');
      } else {
        contentElem = angular.element('#preview_create');
      }
      return html2canvas(contentElem, {
        onrendered: function(canvas) {
          var blob, imageData;
          imageData = canvas.toDataURL('image/png');
          blob = dataURItoBlob(imageData);
          if (isUpdate) {
            return $scope.saveCatalogueImg(update, blob);
          } else {
            return $scope.saveCatalogueImg(create, blob);
          }
        }
      });
    };
    $scope.init = function() {
      _.each($scope.catList, function(cat) {
        return $scope.cat[cat] = false;
      });
      create.reset();
      index.get();
      index.getCategories();
      index.getSharedEntities();
      return index.getLastUpdate();
    };
    return $scope.init();
  }
]);

module.directive('impacWidgetTemplateAdmin', [
  'TemplatePath', function(TemplatePath) {
    return {
      restrict: 'A',
      scope: {},
      templateUrl: TemplatePath['impac/widget_template_admin.html'],
      controller: 'ImpacWidgetTemplateAdminCtrl'
    };
  }
]);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndpZGdldHMvaW1wYWMtd2lkZ2V0LXRlbXBsYXRlLWFkbWluLmpzLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBOztBQUFBLE1BQUEsR0FBUyxPQUFPLENBQUMsTUFBUixDQUFlLGlEQUFmLEVBQWlFLENBQUMsa0JBQUQsQ0FBakU7O0FBRVQsTUFBTSxDQUFDLFVBQVAsQ0FBa0IsOEJBQWxCLEVBQWlEO0VBQy9DLFFBRCtDLEVBQ3JDLG1CQURxQyxFQUNoQixPQURnQixFQUNQLFdBRE8sRUFDTSxTQUFDLE1BQUQsRUFBUyxpQkFBVCxFQUE0QixLQUE1QixFQUFtQyxTQUFuQztBQUVuRCxRQUFBO0lBQUEsTUFBTSxDQUFDLFlBQVAsR0FBc0I7SUFDdEIsTUFBTSxDQUFDLEdBQVAsR0FBYTtJQUViLE1BQU0sQ0FBQyxXQUFQLEdBQXFCLFNBQVUsQ0FBQSxxQkFBQTtJQUUvQixNQUFNLENBQUMsV0FBUCxHQUFxQixTQUFDLEdBQUQ7TUFDbkIsSUFBSSxHQUFBLEtBQU8sTUFBTSxDQUFDLFlBQWxCO1FBQ0UsTUFBTSxDQUFDLFlBQVAsR0FBc0I7ZUFDdEIsTUFBTSxDQUFDLEdBQUksQ0FBQSxHQUFBLENBQVgsR0FBa0IsTUFGcEI7T0FBQSxNQUFBO1FBSUUsTUFBTSxDQUFDLEdBQUksQ0FBQSxHQUFBLENBQVgsR0FBa0I7UUFDbEIsSUFBMkMsTUFBTSxDQUFDLFlBQWxEO1VBQUEsTUFBTSxDQUFDLEdBQUksQ0FBQSxNQUFNLENBQUMsWUFBUCxDQUFYLEdBQWtDLE1BQWxDOztlQUNBLE1BQU0sQ0FBQyxZQUFQLEdBQXNCLElBTnhCOztJQURtQjtJQVlyQixNQUFNLENBQUMsTUFBUCxHQUFnQixNQUFBLEdBQVM7SUFDekIsTUFBTSxDQUFDLFVBQVAsR0FBb0I7SUFDcEIsTUFBTSxDQUFDLFFBQVAsR0FBa0I7SUFDbEIsTUFBTSxDQUFDLE1BQVAsR0FBZ0I7SUFDaEIsTUFBTSxDQUFDLFVBQVAsR0FBb0I7SUFDcEIsTUFBTSxDQUFDLFdBQVAsR0FBcUI7SUFDckIsTUFBTSxDQUFDLFVBQVAsR0FBb0I7SUFDcEIsTUFBTSxDQUFDLEtBQVAsR0FBZTtJQUNmLE1BQU0sQ0FBQyxTQUFQLEdBQW1CO0lBRW5CLE1BQU0sQ0FBQyxjQUFQLEdBQXdCLFNBQUE7YUFDdEIsQ0FBQyxDQUFDLElBQUYsQ0FBTyxNQUFNLENBQUMsU0FBZCxFQUF5QixTQUFDLEVBQUQ7ZUFDdkIsRUFBRSxDQUFDLE9BQUgsR0FBYTtNQURVLENBQXpCO0lBRHNCO0lBSXhCLE1BQU0sQ0FBQyxLQUFQLEdBQWUsU0FBQTtNQUNiLE1BQU0sQ0FBQyxLQUFQLEdBQWU7TUFDZixNQUFNLENBQUMsS0FBTSxDQUFBLFFBQUEsQ0FBYixHQUF5QjtNQUN6QixNQUFNLENBQUMsS0FBSyxDQUFDLFVBQWIsR0FBMEI7TUFDMUIsTUFBTSxDQUFDLFVBQVAsR0FBb0I7YUFDcEIsTUFBTSxDQUFDLGNBQVAsQ0FBQTtJQUxhO0lBT2YsTUFBTSxDQUFDLElBQVAsR0FBYyxTQUFBO01BQ1osTUFBTSxDQUFDLE1BQVAsR0FBZ0I7TUFDaEIsTUFBTSxDQUFDLFVBQVAsR0FBb0I7TUFDcEIsTUFBTSxDQUFDLFFBQVAsR0FBa0I7TUFDbEIsTUFBTSxDQUFDLFVBQVAsR0FBb0I7TUFDcEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFiLEdBQXlCLE1BQU0sQ0FBQzthQUNoQyxpQkFBaUIsQ0FBQyxNQUFsQixDQUF5QixNQUF6QixDQUFnQyxDQUFDLElBQWpDLENBQ0UsU0FBQyxRQUFEO1FBQ0UsSUFBRyxRQUFRLENBQUMsTUFBVCxLQUFtQixHQUF0QjtVQUNFLE1BQU0sQ0FBQyxRQUFQLEdBQWtCO1VBQ2xCLE1BQU0sQ0FBQyxNQUFQLEdBQWdCLFFBQVEsQ0FBQztpQkFDekIsTUFBTSxDQUFDLFVBQVAsR0FBb0IsTUFIdEI7O01BREYsQ0FERjtJQU5ZO0lBY2QsTUFBTSxDQUFDLGdCQUFQLEdBQTBCLFNBQUE7YUFDeEIsTUFBTSxDQUFDLGlCQUFQLENBQXlCLEtBQXpCO0lBRHdCO0lBRzFCLE1BQU0sQ0FBQyxTQUFQLEdBQW1CLFNBQUE7TUFDakIsTUFBTSxDQUFDLFVBQVAsR0FBb0I7TUFDcEIsTUFBTSxDQUFDLEtBQVAsQ0FBQTtNQUNBLEtBQUssQ0FBQyxHQUFOLENBQUE7TUFDQSxNQUFNLENBQUMsVUFBUCxHQUFvQjtNQUNwQixJQUFHLE1BQU0sQ0FBQyxXQUFWO2VBQ0UsaUJBQWlCLENBQUMsV0FBbEIsQ0FBQSxFQURGOztJQUxpQjtJQVduQixNQUFNLENBQUMsTUFBUCxHQUFnQixNQUFBLEdBQVM7SUFDekIsTUFBTSxDQUFDLFFBQVAsR0FBa0I7SUFDbEIsTUFBTSxDQUFDLFVBQVAsR0FBb0I7SUFDcEIsTUFBTSxDQUFDLFVBQVAsR0FBb0I7SUFDcEIsTUFBTSxDQUFDLFFBQVAsR0FBa0I7SUFDbEIsTUFBTSxDQUFDLE1BQVAsR0FBZ0I7SUFDaEIsTUFBTSxDQUFDLFdBQVAsR0FBcUI7SUFDckIsTUFBTSxDQUFDLEtBQVAsR0FBZTtJQUNmLE1BQU0sQ0FBQyxTQUFQLEdBQW1CO0lBRW5CLE1BQU0sQ0FBQyxJQUFQLEdBQWMsU0FBQTtNQUNaLE1BQU0sQ0FBQyxVQUFQLEdBQW9CO01BQ3BCLE1BQU0sQ0FBQyxRQUFQLEdBQWtCO01BQ2xCLE1BQU0sQ0FBQyxVQUFQLEdBQW9CO01BQ3BCLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBYixHQUF5QixNQUFNLENBQUM7YUFDaEMsaUJBQWlCLENBQUMsTUFBbEIsQ0FBeUIsTUFBekIsQ0FBZ0MsQ0FBQyxJQUFqQyxDQUNFLFNBQUMsUUFBRDtRQUNFLElBQUcsUUFBUSxDQUFDLE1BQVQsS0FBbUIsR0FBdEI7VUFDRSxNQUFNLENBQUMsUUFBUCxHQUFrQjtVQUNsQixNQUFNLENBQUMsTUFBUCxHQUFnQixRQUFRLENBQUM7aUJBQ3pCLE1BQU0sQ0FBQyxVQUFQLEdBQW9CLE1BSHRCOztNQURGLENBREY7SUFMWTtJQWFkLE1BQU0sQ0FBQyxnQkFBUCxHQUEwQixTQUFBO2FBQ3hCLE1BQU0sQ0FBQyxpQkFBUCxDQUF5QixJQUF6QjtJQUR3QjtJQUcxQixNQUFNLENBQUMsU0FBUCxHQUFtQixTQUFBO01BQ2pCLE1BQU0sQ0FBQyxVQUFQLEdBQW9CO01BQ3BCLE1BQU0sQ0FBQyxVQUFQLEdBQW9CO01BQ3BCLElBQUcsTUFBTSxDQUFDLFdBQVY7ZUFDRSxpQkFBaUIsQ0FBQyxXQUFsQixDQUFBLEVBREY7O0lBSGlCO0lBTW5CLE1BQU0sQ0FBQyxlQUFQLEdBQXlCLFNBQUMsRUFBRDthQUN2QixDQUFDLENBQUMsSUFBRixDQUFPLE1BQU0sQ0FBQyxTQUFkLEVBQXlCLFNBQUMsRUFBRDtRQUN2QixFQUFFLENBQUMsT0FBSCxHQUFhO2VBQ2IsQ0FBQyxDQUFDLElBQUYsQ0FBTyxFQUFFLENBQUMsU0FBVixFQUFxQixTQUFDLEtBQUQ7VUFDbkIsSUFBRyxLQUFLLENBQUMsZ0JBQU4sS0FBMEIsRUFBRSxDQUFDLEVBQWhDO0FBQ0UsbUJBQU8sRUFBRSxDQUFDLE9BQUgsR0FBYSxLQUR0Qjs7UUFEbUIsQ0FBckI7TUFGdUIsQ0FBekI7SUFEdUI7SUFPekIsTUFBTSxDQUFDLE1BQVAsQ0FBYyxpQkFBZCxFQUFpQyxTQUFBO01BQy9CLElBQUcsTUFBTSxDQUFDLFFBQVY7UUFDRSxDQUFDLENBQUMsSUFBRixDQUFPLEtBQUssQ0FBQyxLQUFiLEVBQW9CLFNBQUMsRUFBRDtVQUNsQixJQUFHLEVBQUUsQ0FBQyxFQUFILEtBQVMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxFQUE1QjtZQUNFLE1BQU0sQ0FBQyxLQUFQLEdBQWU7WUFDZixNQUFNLENBQUMsS0FBSyxDQUFDLFdBQWIsR0FBMkIsRUFBRSxDQUFDO1lBQzlCLE1BQU0sQ0FBQyxlQUFQLENBQXVCLEVBQXZCLEVBSEY7O1FBRGtCLENBQXBCLEVBREY7T0FBQSxNQUFBO1FBUUUsTUFBTSxDQUFDLEtBQVAsR0FBZSxHQVJqQjs7YUFTQSxNQUFNLENBQUM7SUFWd0IsQ0FBakM7SUFnQkEsTUFBTSxDQUFDLE9BQVAsR0FBaUIsT0FBQSxHQUFVO0lBQzNCLE9BQU8sQ0FBQyxRQUFSLEdBQW1CO0lBQ25CLE9BQU8sQ0FBQyxVQUFSLEdBQXFCO0lBQ3JCLE9BQU8sQ0FBQyxXQUFSLEdBQXNCO0lBRXRCLE9BQU8sQ0FBQyxPQUFSLEdBQWtCLFNBQUE7TUFDaEIsT0FBTyxDQUFDLFVBQVIsR0FBcUI7YUFDckIsaUJBQWlCLENBQUMsT0FBbEIsQ0FBMEIsT0FBTyxDQUFDLFFBQVEsQ0FBQyxFQUEzQyxDQUE4QyxDQUFDLElBQS9DLENBQ0UsT0FBTyxDQUFDLFVBQVIsR0FBcUIsS0FEdkIsRUFFRSxPQUFPLENBQUMsUUFBUixHQUFtQixLQUZyQixFQUdFLE9BQU8sQ0FBQyxPQUFSLEdBQWtCLEVBSHBCLEVBSUUsS0FBSyxDQUFDLEdBQU4sQ0FBQSxDQUpGLEVBS0ssT0FBTyxDQUFDLFdBQVgsR0FDRSxpQkFBaUIsQ0FBQyxXQUFsQixDQUFBLENBREYsR0FBQSxNQUxGO0lBRmdCO0lBY2xCLE1BQU0sQ0FBQyxXQUFQLEdBQXFCLFdBQUEsR0FBYztJQUNuQyxXQUFXLENBQUMsS0FBWixHQUFvQjtJQUVwQixXQUFXLENBQUMsSUFBWixHQUFtQixTQUFBO2FBQ2pCLGlCQUFpQixDQUFDLGNBQWxCLENBQWlDLFdBQVcsQ0FBQyxLQUE3QyxDQUFtRCxDQUFDLElBQXBELENBQ0UsV0FBVyxDQUFDLEtBQVosR0FBb0IsRUFEdEIsRUFFRSxLQUFLLENBQUMsYUFBTixDQUFBLENBRkY7SUFEaUI7SUFTbkIsTUFBTSxDQUFDLGNBQVAsR0FBd0IsY0FBQSxHQUFpQjtJQUN6QyxjQUFjLENBQUMsUUFBZixHQUEwQjtJQUMxQixjQUFjLENBQUMsVUFBZixHQUE0QjtJQUM1QixjQUFjLENBQUMsS0FBZixHQUF1QjtJQUN2QixjQUFjLENBQUMsVUFBZixHQUE0QjtJQUM1QixjQUFjLENBQUMsUUFBZixHQUEwQjtJQUMxQixjQUFjLENBQUMsTUFBZixHQUF3QjtJQUV4QixjQUFjLENBQUMsSUFBZixHQUFzQixTQUFBO01BQ3BCLGNBQWMsQ0FBQyxVQUFmLEdBQTRCO01BQzVCLGNBQWMsQ0FBQyxRQUFmLEdBQTBCO01BQzFCLGNBQWMsQ0FBQyxVQUFmLEdBQTRCO2FBQzVCLGlCQUFpQixDQUFDLGNBQWxCLENBQWlDLGNBQWMsQ0FBQyxLQUFoRCxDQUFzRCxDQUFDLElBQXZELENBQ0UsU0FBQyxPQUFEO1FBQ0UsY0FBYyxDQUFDLFVBQWYsR0FBNEI7ZUFDNUIsS0FBSyxDQUFDLGFBQU4sQ0FBQTtNQUZGLENBREYsRUFJRSxTQUFDLE9BQUQ7UUFDRSxjQUFjLENBQUMsUUFBZixHQUEwQjtlQUMxQixjQUFjLENBQUMsTUFBZixHQUF3QixPQUFPLENBQUM7TUFGbEMsQ0FKRixFQU9FLGNBQWMsQ0FBQyxVQUFmLEdBQTRCLEtBUDlCO0lBSm9CO0lBY3RCLE1BQU0sQ0FBQyxNQUFQLENBQWMseUJBQWQsRUFBeUMsU0FBQTtNQUN2QyxJQUFHLGNBQWMsQ0FBQyxRQUFsQjtRQUNFLENBQUMsQ0FBQyxJQUFGLENBQU8sS0FBSyxDQUFDLFVBQWIsRUFBeUIsU0FBQyxHQUFEO1VBQ3ZCLElBQUcsR0FBRyxDQUFDLEVBQUosS0FBVSxjQUFjLENBQUMsUUFBUSxDQUFDLEVBQXJDO1lBQ0UsY0FBYyxDQUFDLEtBQWYsR0FBdUIsSUFEekI7O1FBRHVCLENBQXpCLEVBREY7T0FBQSxNQUFBO1FBTUUsY0FBYyxDQUFDLEtBQWYsR0FBdUIsR0FOekI7O2FBT0EsTUFBTSxDQUFDO0lBUmdDLENBQXpDO0lBY0EsTUFBTSxDQUFDLEtBQVAsR0FBZSxLQUFBLEdBQVE7SUFDdkIsS0FBSyxDQUFDLFVBQU4sR0FBbUI7SUFDbkIsS0FBSyxDQUFDLEtBQU4sR0FBYztJQUNkLEtBQUssQ0FBQyxVQUFOLEdBQW1CO0lBQ25CLEtBQUssQ0FBQyxjQUFOLEdBQXVCO0lBQ3ZCLEtBQUssQ0FBQyxVQUFOLEdBQW1CO0lBRW5CLEtBQUssQ0FBQyxhQUFOLEdBQXNCLFNBQUMsS0FBRDthQUNwQixDQUFDLENBQUMsSUFBRixDQUFPLEtBQUssQ0FBQyxjQUFiLEVBQTZCLFNBQUMsRUFBRDtlQUMzQixLQUFLLENBQUMsSUFBTixDQUFXO1VBQUMsRUFBQSxFQUFJLEVBQUUsQ0FBQyxFQUFSO1VBQVksSUFBQSxFQUFNLEVBQUUsQ0FBQyxJQUFyQjtVQUEyQixPQUFBLEVBQVMsS0FBcEM7U0FBWDtNQUQyQixDQUE3QjtJQURvQjtJQUl0QixLQUFLLENBQUMsR0FBTixHQUFZLFNBQUE7TUFDVixLQUFLLENBQUMsVUFBTixHQUFtQjthQUNuQixpQkFBaUIsQ0FBQyxLQUFsQixDQUFBLENBQXlCLENBQUMsSUFBMUIsQ0FDRSxTQUFDLGdCQUFEO1FBQ0UsS0FBSyxDQUFDLEtBQU4sR0FBYztlQUNkLEtBQUssQ0FBQyxVQUFOLEdBQW1CO01BRnJCLENBREY7SUFGVTtJQVFaLEtBQUssQ0FBQyxhQUFOLEdBQXNCLFNBQUE7TUFDcEIsS0FBSyxDQUFDLFVBQU4sR0FBbUI7YUFDbkIsaUJBQWlCLENBQUMsVUFBbEIsQ0FBQSxDQUE4QixDQUFDLElBQS9CLENBQ0UsU0FBQyxVQUFEO1FBQ0UsS0FBSyxDQUFDLFVBQU4sR0FBbUI7ZUFDbkIsS0FBSyxDQUFDLFVBQU4sR0FBbUI7TUFGckIsQ0FERjtJQUZvQjtJQVF0QixLQUFLLENBQUMsaUJBQU4sR0FBMEIsU0FBQTtNQUN4QixLQUFLLENBQUMsVUFBTixHQUFtQjthQUNuQixLQUFLLENBQUMsR0FBTixDQUFVLDRCQUFWLENBQXVDLENBQUMsSUFBeEMsQ0FDRSxTQUFDLE9BQUQ7UUFDRSxLQUFLLENBQUMsY0FBTixHQUF1QixPQUFPLENBQUMsSUFBSSxDQUFDO1FBQ3BDLEtBQUssQ0FBQyxhQUFOLENBQW9CLE1BQU0sQ0FBQyxTQUEzQjtRQUNBLEtBQUssQ0FBQyxhQUFOLENBQW9CLE1BQU0sQ0FBQyxTQUEzQjtlQUNBLEtBQUssQ0FBQyxVQUFOLEdBQW1CO01BSnJCLENBREY7SUFGd0I7SUFVMUIsS0FBSyxDQUFDLGFBQU4sR0FBc0IsU0FBQTtNQUNwQixLQUFLLENBQUMsVUFBTixHQUFtQjthQUNuQixpQkFBaUIsQ0FBQyxVQUFsQixDQUFBLENBQThCLENBQUMsSUFBL0IsQ0FDRSxTQUFDLFdBQUQ7UUFDRSxLQUFLLENBQUMsVUFBTixHQUFtQjtlQUNuQixLQUFLLENBQUMsVUFBTixHQUFtQjtNQUZyQixDQURGO0lBRm9CO0lBV3RCLE1BQU0sQ0FBQyxnQkFBUCxHQUEwQixTQUFDLElBQUQsRUFBTyxnQkFBUDthQUN4QixpQkFBaUIsQ0FBQyxTQUFsQixDQUE0QixJQUE1QixFQUFrQyxnQkFBbEMsRUFBb0QsS0FBcEQ7SUFEd0I7SUFHMUIsTUFBTSxDQUFDLFdBQVAsR0FBcUIsU0FBQyxNQUFEO01BQ25CLElBQUcseUJBQUEsSUFBb0IsQ0FBQyxDQUFDLE9BQUYsQ0FBVSxNQUFNLENBQUMsUUFBakIsQ0FBdkI7QUFDRSxlQUFPLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBaEIsQ0FBc0IsQ0FBdEIsRUFBd0IsQ0FBeEIsRUFEVDtPQUFBLE1BRUssSUFBRyx5QkFBQSxJQUFvQixDQUFDLENBQUMsUUFBRixDQUFXLE1BQU0sQ0FBQyxRQUFsQixDQUF2QjtRQUNILElBQUcsTUFBTSxDQUFDLFFBQVAsS0FBbUIsRUFBdEI7QUFDRSxpQkFBTyxHQURUO1NBQUEsTUFBQTtBQUdFLGlCQUFPLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBaEIsQ0FBc0IsR0FBdEIsQ0FBMEIsQ0FBQyxLQUEzQixDQUFpQyxDQUFqQyxFQUFtQyxDQUFuQyxFQUhUO1NBREc7O0lBSGM7SUFTckIsTUFBTSxDQUFDLGlCQUFQLEdBQTJCLFNBQUMsT0FBRDtNQUN6QixJQUEwQyx5QkFBMUM7ZUFBQSxpQkFBaUIsQ0FBQyxXQUFsQixDQUE4QixPQUE5QixFQUFBOztJQUR5QjtJQUczQixhQUFBLEdBQWdCLFNBQUMsT0FBRDtBQUNkLFVBQUE7TUFBQSxVQUFBLEdBQWEsSUFBQSxDQUFLLE9BQU8sQ0FBQyxLQUFSLENBQWMsR0FBZCxDQUFtQixDQUFBLENBQUEsQ0FBeEI7TUFDYixVQUFBLEdBQWEsT0FBTyxDQUFDLEtBQVIsQ0FBYyxHQUFkLENBQW1CLENBQUEsQ0FBQSxDQUFFLENBQUMsS0FBdEIsQ0FBNEIsR0FBNUIsQ0FBaUMsQ0FBQSxDQUFBLENBQUUsQ0FBQyxLQUFwQyxDQUEwQyxHQUExQyxDQUErQyxDQUFBLENBQUE7TUFFNUQsRUFBQSxHQUFTLElBQUEsV0FBQSxDQUFZLFVBQVUsQ0FBQyxNQUF2QjtNQUNULEVBQUEsR0FBUyxJQUFBLFVBQUEsQ0FBVyxFQUFYO0FBQ1QsV0FBUyw0RkFBVDtRQUNFLEVBQUcsQ0FBQSxDQUFBLENBQUgsR0FBUSxVQUFVLENBQUMsVUFBWCxDQUFzQixDQUF0QjtBQURWO01BR0EsRUFBQSxHQUFTLElBQUEsSUFBQSxDQUFLLENBQUMsRUFBRCxDQUFMO0FBQ1QsYUFBTztJQVZPO0lBWWhCLE1BQU0sQ0FBQyxpQkFBUCxHQUEyQixTQUFDLFFBQUQ7QUFDekIsVUFBQTs7UUFEMEIsV0FBUzs7TUFDbkMsSUFBRyxRQUFIO1FBQ0UsV0FBQSxHQUFjLE9BQU8sQ0FBQyxPQUFSLENBQWdCLGlCQUFoQixFQURoQjtPQUFBLE1BQUE7UUFHRSxXQUFBLEdBQWMsT0FBTyxDQUFDLE9BQVIsQ0FBZ0IsaUJBQWhCLEVBSGhCOzthQUtBLFdBQUEsQ0FBWSxXQUFaLEVBQXlCO1FBQ3ZCLFVBQUEsRUFBWSxTQUFDLE1BQUQ7QUFDVixjQUFBO1VBQUEsU0FBQSxHQUFZLE1BQU0sQ0FBQyxTQUFQLENBQWlCLFdBQWpCO1VBQ1osSUFBQSxHQUFPLGFBQUEsQ0FBYyxTQUFkO1VBRVAsSUFBRyxRQUFIO21CQUNFLE1BQU0sQ0FBQyxnQkFBUCxDQUF3QixNQUF4QixFQUFnQyxJQUFoQyxFQURGO1dBQUEsTUFBQTttQkFHRSxNQUFNLENBQUMsZ0JBQVAsQ0FBd0IsTUFBeEIsRUFBZ0MsSUFBaEMsRUFIRjs7UUFKVSxDQURXO09BQXpCO0lBTnlCO0lBcUIzQixNQUFNLENBQUMsSUFBUCxHQUFjLFNBQUE7TUFDWixDQUFDLENBQUMsSUFBRixDQUFPLE1BQU0sQ0FBQyxPQUFkLEVBQXVCLFNBQUMsR0FBRDtlQUNyQixNQUFNLENBQUMsR0FBSSxDQUFBLEdBQUEsQ0FBWCxHQUFrQjtNQURHLENBQXZCO01BRUEsTUFBTSxDQUFDLEtBQVAsQ0FBQTtNQUNBLEtBQUssQ0FBQyxHQUFOLENBQUE7TUFDQSxLQUFLLENBQUMsYUFBTixDQUFBO01BQ0EsS0FBSyxDQUFDLGlCQUFOLENBQUE7YUFDQSxLQUFLLENBQUMsYUFBTixDQUFBO0lBUFk7V0FTZCxNQUFNLENBQUMsSUFBUCxDQUFBO0VBdlNtRCxDQUROO0NBQWpEOztBQTJTQSxNQUFNLENBQUMsU0FBUCxDQUFpQiwwQkFBakIsRUFBNkM7RUFBQyxjQUFELEVBQWlCLFNBQUMsWUFBRDtBQUM1RCxXQUFPO01BQ0gsUUFBQSxFQUFVLEdBRFA7TUFFSCxLQUFBLEVBQU8sRUFGSjtNQUdILFdBQUEsRUFBYSxZQUFhLENBQUEsa0NBQUEsQ0FIdkI7TUFJSCxVQUFBLEVBQVksOEJBSlQ7O0VBRHFELENBQWpCO0NBQTdDIiwiZmlsZSI6IndpZGdldHMvaW1wYWMtd2lkZ2V0LXRlbXBsYXRlLWFkbWluLmpzLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ21hZXN0cmFuby5hbmFseXRpY3MuaW1wYWMtd2lkZ2V0LXRlbXBsYXRlLWFkbWluJyxbJ21hZXN0cmFuby5hc3NldHMnXSlcblxubW9kdWxlLmNvbnRyb2xsZXIoJ0ltcGFjV2lkZ2V0VGVtcGxhdGVBZG1pbkN0cmwnLFtcbiAgJyRzY29wZScsICdXaWRnZXRUZW1wbGF0ZVN2YycsICckaHR0cCcsICdBc3NldFBhdGgnLCAoJHNjb3BlLCBXaWRnZXRUZW1wbGF0ZVN2YywgJGh0dHAsIEFzc2V0UGF0aCkgLT5cblxuICAgICRzY29wZS5hY3RpdmF0ZWRDYXQgPSBmYWxzZVxuICAgICRzY29wZS5jYXQgPSB7fVxuXG4gICAgJHNjb3BlLmxvYWRlckltYWdlID0gQXNzZXRQYXRoWydsb2FkZXItd2hpdGUtYmcuZ2lmJ11cblxuICAgICRzY29wZS5hY3RpdmF0ZUNhdCA9IChjYXQpIC0+XG4gICAgICBpZiAoY2F0ID09ICRzY29wZS5hY3RpdmF0ZWRDYXQpXG4gICAgICAgICRzY29wZS5hY3RpdmF0ZWRDYXQgPSBmYWxzZVxuICAgICAgICAkc2NvcGUuY2F0W2NhdF0gPSBmYWxzZVxuICAgICAgZWxzZVxuICAgICAgICAkc2NvcGUuY2F0W2NhdF0gPSB0cnVlXG4gICAgICAgICRzY29wZS5jYXRbJHNjb3BlLmFjdGl2YXRlZENhdF0gPSBmYWxzZSBpZiAkc2NvcGUuYWN0aXZhdGVkQ2F0XG4gICAgICAgICRzY29wZS5hY3RpdmF0ZWRDYXQgPSBjYXRcblxuICAgICMgPT09PT09PT09PT09PT09PT09PT09PVxuICAgICMgQ1JFQVRFXG4gICAgIyA9PT09PT09PT09PT09PT09PT09PT09XG4gICAgJHNjb3BlLmNyZWF0ZSA9IGNyZWF0ZSA9IHt9XG4gICAgY3JlYXRlLnN1Y2Nlc3NNc2cgPSBmYWxzZVxuICAgIGNyZWF0ZS5lcnJvck1zZyA9IGZhbHNlXG4gICAgY3JlYXRlLmVycm9ycyA9ICcnXG4gICAgY3JlYXRlLmluUHJvZ3Jlc3MgPSBmYWxzZVxuICAgIGNyZWF0ZS5nZW5lcmF0ZVBkZiA9IHRydWVcbiAgICBjcmVhdGUuc2NyZWVuc2hvdCA9IHt9XG4gICAgY3JlYXRlLm1vZGVsID0ge31cbiAgICBjcmVhdGUuZW5kcG9pbnRzID0gW11cblxuICAgIGNyZWF0ZS5yZXNldEVuZHBvaW50cyA9IC0+XG4gICAgICBfLmVhY2ggY3JlYXRlLmVuZHBvaW50cywgKGVwKSAtPlxuICAgICAgICBlcC5jaGVja2VkID0gZmFsc2VcblxuICAgIGNyZWF0ZS5yZXNldCA9IC0+XG4gICAgICBjcmVhdGUubW9kZWwgPSB7fVxuICAgICAgY3JlYXRlLm1vZGVsWydhY3RpdmUnXSA9IHRydWVcbiAgICAgIGNyZWF0ZS5tb2RlbC5zY3JlZW5zaG90ID0gXCJcIlxuICAgICAgY3JlYXRlLnNjcmVlbnNob3QgPSB7fVxuICAgICAgY3JlYXRlLnJlc2V0RW5kcG9pbnRzKClcblxuICAgIGNyZWF0ZS5zYXZlID0gLT5cbiAgICAgIGNyZWF0ZS5lcnJvcnMgPSAnJ1xuICAgICAgY3JlYXRlLnN1Y2Nlc3NNc2cgPSBmYWxzZVxuICAgICAgY3JlYXRlLmVycm9yTXNnID0gZmFsc2VcbiAgICAgIGNyZWF0ZS5pblByb2dyZXNzID0gdHJ1ZVxuICAgICAgY3JlYXRlLm1vZGVsLmVuZHBvaW50cyA9IGNyZWF0ZS5lbmRwb2ludHNcbiAgICAgIFdpZGdldFRlbXBsYXRlU3ZjLmNyZWF0ZShjcmVhdGUpLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgLT5cbiAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXMgPT0gNDAwXG4gICAgICAgICAgICBjcmVhdGUuZXJyb3JNc2cgPSB0cnVlXG4gICAgICAgICAgICBjcmVhdGUuZXJyb3JzID0gcmVzcG9uc2UuZGF0YVxuICAgICAgICAgICAgY3JlYXRlLmluUHJvZ3Jlc3MgPSBmYWxzZVxuICAgICAgKVxuXG4gICAgY3JlYXRlLnNhdmVDYXRhbG9ndWVJbWcgPSAtPlxuICAgICAgJHNjb3BlLnJlbmRlclRlbXBsYXRlSW1nKGZhbHNlKVxuXG4gICAgY3JlYXRlLmFmdGVyU2F2ZSA9IC0+XG4gICAgICBjcmVhdGUuc3VjY2Vzc01zZyA9IHRydWVcbiAgICAgIGNyZWF0ZS5yZXNldCgpXG4gICAgICBpbmRleC5nZXQoKVxuICAgICAgY3JlYXRlLmluUHJvZ3Jlc3MgPSBmYWxzZVxuICAgICAgaWYgY3JlYXRlLmdlbmVyYXRlUGRmXG4gICAgICAgIFdpZGdldFRlbXBsYXRlU3ZjLmdlbmVyYXRlUGRmKClcblxuICAgICMgPT09PT09PT09PT09PT09PT09PT09PVxuICAgICMgVVBEQVRFXG4gICAgIyA9PT09PT09PT09PT09PT09PT09PT09XG4gICAgJHNjb3BlLnVwZGF0ZSA9IHVwZGF0ZSA9IHt9XG4gICAgdXBkYXRlLnNlbGVjdGVkID0gZmFsc2VcbiAgICB1cGRhdGUuaW5Qcm9ncmVzcyA9IGZhbHNlXG4gICAgdXBkYXRlLnN1Y2Nlc3NNc2cgPSBmYWxzZVxuICAgIHVwZGF0ZS5lcnJvck1zZyA9IGZhbHNlXG4gICAgdXBkYXRlLmVycm9ycyA9ICcnXG4gICAgdXBkYXRlLmdlbmVyYXRlUGRmID0gdHJ1ZVxuICAgIHVwZGF0ZS5tb2RlbCA9IHt9XG4gICAgdXBkYXRlLmVuZHBvaW50cyA9IFtdXG5cbiAgICB1cGRhdGUuc2F2ZSA9ICgpIC0+XG4gICAgICB1cGRhdGUuc3VjY2Vzc01zZyA9IGZhbHNlXG4gICAgICB1cGRhdGUuZXJyb3JNc2cgPSBmYWxzZVxuICAgICAgdXBkYXRlLmluUHJvZ3Jlc3MgPSB0cnVlXG4gICAgICB1cGRhdGUubW9kZWwuZW5kcG9pbnRzID0gdXBkYXRlLmVuZHBvaW50c1xuICAgICAgV2lkZ2V0VGVtcGxhdGVTdmMudXBkYXRlKHVwZGF0ZSkudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSAtPlxuICAgICAgICAgIGlmIHJlc3BvbnNlLnN0YXR1cyA9PSA0MDBcbiAgICAgICAgICAgIHVwZGF0ZS5lcnJvck1zZyA9IHRydWVcbiAgICAgICAgICAgIHVwZGF0ZS5lcnJvcnMgPSByZXNwb25zZS5kYXRhXG4gICAgICAgICAgICB1cGRhdGUuaW5Qcm9ncmVzcyA9IGZhbHNlXG4gICAgICApXG5cbiAgICB1cGRhdGUuc2F2ZUNhdGFsb2d1ZUltZyA9IC0+XG4gICAgICAkc2NvcGUucmVuZGVyVGVtcGxhdGVJbWcodHJ1ZSlcblxuICAgIHVwZGF0ZS5hZnRlclNhdmUgPSAtPlxuICAgICAgdXBkYXRlLnN1Y2Nlc3NNc2cgPSB0cnVlXG4gICAgICB1cGRhdGUuaW5Qcm9ncmVzcyA9IGZhbHNlXG4gICAgICBpZiB1cGRhdGUuZ2VuZXJhdGVQZGZcbiAgICAgICAgV2lkZ2V0VGVtcGxhdGVTdmMuZ2VuZXJhdGVQZGYoKVxuXG4gICAgdXBkYXRlLnNlbGVjdEVuZHBvaW50cyA9ICh3dCkgLT5cbiAgICAgIF8uZWFjaCB1cGRhdGUuZW5kcG9pbnRzLCAoZXApIC0+XG4gICAgICAgIGVwLmNoZWNrZWQgPSBmYWxzZVxuICAgICAgICBfLmVhY2ggd3QuZW5kcG9pbnRzLCAod3RfZXApIC0+XG4gICAgICAgICAgaWYgd3RfZXAuc2hhcmVkX2VudGl0eV9pZCA9PSBlcC5pZFxuICAgICAgICAgICAgcmV0dXJuIGVwLmNoZWNrZWQgPSB0cnVlXG5cbiAgICAkc2NvcGUuJHdhdGNoKCd1cGRhdGUuc2VsZWN0ZWQnLCAtPlxuICAgICAgaWYgdXBkYXRlLnNlbGVjdGVkXG4gICAgICAgIF8uZWFjaCBpbmRleC5tb2RlbCwgKHd0KSAtPlxuICAgICAgICAgIGlmIHd0LmlkID09IHVwZGF0ZS5zZWxlY3RlZC5pZFxuICAgICAgICAgICAgdXBkYXRlLm1vZGVsID0gd3RcbiAgICAgICAgICAgIHVwZGF0ZS5tb2RlbC5jYXRlZ29yeV9pZCA9IHd0LmNhdGVnb3J5X2lkXG4gICAgICAgICAgICB1cGRhdGUuc2VsZWN0RW5kcG9pbnRzKHd0KVxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICBlbHNlXG4gICAgICAgIHVwZGF0ZS5tb2RlbCA9IHt9XG4gICAgICAkc2NvcGUuJGFwcGx5XG4gICAgKVxuXG4gICAgIyA9PT09PT09PT09PT09PT09PT09PT09XG4gICAgIyBERVNUUk9ZXG4gICAgIyA9PT09PT09PT09PT09PT09PT09PT09XG4gICAgJHNjb3BlLmRlc3Ryb3kgPSBkZXN0cm95ID0ge31cbiAgICBkZXN0cm95LnNlbGVjdGVkID0gZmFsc2VcbiAgICBkZXN0cm95LmluUHJvZ3Jlc3MgPSBmYWxzZVxuICAgIGRlc3Ryb3kuZ2VuZXJhdGVQZGYgPSB0cnVlXG5cbiAgICBkZXN0cm95LmRlc3Ryb3kgPSAtPlxuICAgICAgZGVzdHJveS5pblByb2dyZXNzID0gdHJ1ZVxuICAgICAgV2lkZ2V0VGVtcGxhdGVTdmMuZGVzdHJveShkZXN0cm95LnNlbGVjdGVkLmlkKS50aGVuKFxuICAgICAgICBkZXN0cm95LmluUHJvZ3Jlc3MgPSBmYWxzZVxuICAgICAgICBkZXN0cm95LnNlbGVjdGVkID0gZmFsc2VcbiAgICAgICAgZGVzdHJveS5jb25maXJtID0gXCJcIlxuICAgICAgICBpbmRleC5nZXQoKVxuICAgICAgICBpZiBkZXN0cm95LmdlbmVyYXRlUGRmXG4gICAgICAgICAgV2lkZ2V0VGVtcGxhdGVTdmMuZ2VuZXJhdGVQZGYoKVxuICAgICAgKVxuXG4gICAgIyA9PT09PT09PT09PT09PT09PT09PT09XG4gICAgIyBBREQgQ0FURUdPUllcbiAgICAjID09PT09PT09PT09PT09PT09PT09PT1cbiAgICAkc2NvcGUuYWRkQ2F0ZWdvcnkgPSBhZGRDYXRlZ29yeSA9IHt9XG4gICAgYWRkQ2F0ZWdvcnkubW9kZWwgPSB7fVxuXG4gICAgYWRkQ2F0ZWdvcnkuc2F2ZSA9IC0+XG4gICAgICBXaWRnZXRUZW1wbGF0ZVN2Yy5jcmVhdGVDYXRlZ29yeShhZGRDYXRlZ29yeS5tb2RlbCkudGhlbihcbiAgICAgICAgYWRkQ2F0ZWdvcnkubW9kZWwgPSB7fVxuICAgICAgICBpbmRleC5nZXRDYXRlZ29yaWVzKClcbiAgICAgIClcblxuICAgICMgPT09PT09PT09PT09PT09PT09PT09PVxuICAgICMgVVBEQVRFIENBVEVHT1JZXG4gICAgIyA9PT09PT09PT09PT09PT09PT09PT09XG4gICAgJHNjb3BlLnVwZGF0ZUNhdGVnb3J5ID0gdXBkYXRlQ2F0ZWdvcnkgPSB7fVxuICAgIHVwZGF0ZUNhdGVnb3J5LnNlbGVjdGVkID0gZmFsc2VcbiAgICB1cGRhdGVDYXRlZ29yeS5pblByb2dyZXNzID0gZmFsc2VcbiAgICB1cGRhdGVDYXRlZ29yeS5tb2RlbCA9IHt9XG4gICAgdXBkYXRlQ2F0ZWdvcnkuc3VjY2Vzc01zZyA9IGZhbHNlXG4gICAgdXBkYXRlQ2F0ZWdvcnkuZXJyb3JNc2cgPSBmYWxzZVxuICAgIHVwZGF0ZUNhdGVnb3J5LmVycm9ycyA9ICcnXG5cbiAgICB1cGRhdGVDYXRlZ29yeS5zYXZlID0gKCkgLT5cbiAgICAgIHVwZGF0ZUNhdGVnb3J5LnN1Y2Nlc3NNc2cgPSBmYWxzZVxuICAgICAgdXBkYXRlQ2F0ZWdvcnkuZXJyb3JNc2cgPSBmYWxzZVxuICAgICAgdXBkYXRlQ2F0ZWdvcnkuaW5Qcm9ncmVzcyA9IHRydWVcbiAgICAgIFdpZGdldFRlbXBsYXRlU3ZjLnVwZGF0ZUNhdGVnb3J5KHVwZGF0ZUNhdGVnb3J5Lm1vZGVsKS50aGVuKFxuICAgICAgICAoc3VjY2VzcykgLT5cbiAgICAgICAgICB1cGRhdGVDYXRlZ29yeS5zdWNjZXNzTXNnID0gdHJ1ZVxuICAgICAgICAgIGluZGV4LmdldENhdGVnb3JpZXMoKVxuICAgICAgICAoZmFpbHVyZSkgLT5cbiAgICAgICAgICB1cGRhdGVDYXRlZ29yeS5lcnJvck1zZyA9IHRydWVcbiAgICAgICAgICB1cGRhdGVDYXRlZ29yeS5lcnJvcnMgPSBmYWlsdXJlLmRhdGFcbiAgICAgICAgdXBkYXRlQ2F0ZWdvcnkuaW5Qcm9ncmVzcyA9IGZhbHNlXG4gICAgICApXG5cbiAgICAkc2NvcGUuJHdhdGNoKCd1cGRhdGVDYXRlZ29yeS5zZWxlY3RlZCcsIC0+XG4gICAgICBpZiB1cGRhdGVDYXRlZ29yeS5zZWxlY3RlZFxuICAgICAgICBfLmVhY2ggaW5kZXguY2F0ZWdvcmllcywgKGNhdCkgLT5cbiAgICAgICAgICBpZiBjYXQuaWQgPT0gdXBkYXRlQ2F0ZWdvcnkuc2VsZWN0ZWQuaWRcbiAgICAgICAgICAgIHVwZGF0ZUNhdGVnb3J5Lm1vZGVsID0gY2F0XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgIGVsc2VcbiAgICAgICAgdXBkYXRlQ2F0ZWdvcnkubW9kZWwgPSB7fVxuICAgICAgJHNjb3BlLiRhcHBseVxuICAgIClcblxuICAgICMgPT09PT09PT09PT09PT09PT09PT09PVxuICAgICMgSU5ERVhcbiAgICAjID09PT09PT09PT09PT09PT09PT09PT1cbiAgICAkc2NvcGUuaW5kZXggPSBpbmRleCA9IHt9XG4gICAgaW5kZXguaW5Qcm9ncmVzcyA9IGZhbHNlXG4gICAgaW5kZXgubW9kZWwgPSB7fVxuICAgIGluZGV4LmNhdGVnb3JpZXMgPSB7fVxuICAgIGluZGV4LnNoYXJlZEVudGl0aWVzID0ge31cbiAgICBpbmRleC5sYXN0VXBkYXRlID0gXCJcIlxuXG4gICAgaW5kZXguaW5pdEVuZHBvaW50cyA9IChhcnJheSkgLT5cbiAgICAgIF8uZWFjaCBpbmRleC5zaGFyZWRFbnRpdGllcywgKHNlKSAtPlxuICAgICAgICBhcnJheS5wdXNoKHtpZDogc2UuaWQsIG5hbWU6IHNlLm5hbWUsIGNoZWNrZWQ6IGZhbHNlfSlcblxuICAgIGluZGV4LmdldCA9IC0+XG4gICAgICBpbmRleC5pblByb2dyZXNzID0gdHJ1ZVxuICAgICAgV2lkZ2V0VGVtcGxhdGVTdmMuaW5kZXgoKS50aGVuKFxuICAgICAgICAod2lkZ2V0X3RlbXBsYXRlcykgLT5cbiAgICAgICAgICBpbmRleC5tb2RlbCA9IHdpZGdldF90ZW1wbGF0ZXNcbiAgICAgICAgICBpbmRleC5pblByb2dyZXNzID0gZmFsc2VcbiAgICAgIClcblxuICAgIGluZGV4LmdldENhdGVnb3JpZXMgPSAtPlxuICAgICAgaW5kZXguaW5Qcm9ncmVzcyA9IHRydWVcbiAgICAgIFdpZGdldFRlbXBsYXRlU3ZjLmNhdGVnb3JpZXMoKS50aGVuKFxuICAgICAgICAoY2F0ZWdvcmllcykgLT5cbiAgICAgICAgICBpbmRleC5jYXRlZ29yaWVzID0gY2F0ZWdvcmllc1xuICAgICAgICAgIGluZGV4LmluUHJvZ3Jlc3MgPSBmYWxzZVxuICAgICAgKVxuXG4gICAgaW5kZXguZ2V0U2hhcmVkRW50aXRpZXMgPSAtPlxuICAgICAgaW5kZXguaW5Qcm9ncmVzcyA9IHRydWVcbiAgICAgICRodHRwLmdldCgnL2pzX2FwaS92MS9jb25uZWNfZW50aXRpZXMnKS50aGVuKFxuICAgICAgICAoc3VjY2VzcykgLT5cbiAgICAgICAgICBpbmRleC5zaGFyZWRFbnRpdGllcyA9IHN1Y2Nlc3MuZGF0YS5zaGFyZWRfZW50aXRpZXNcbiAgICAgICAgICBpbmRleC5pbml0RW5kcG9pbnRzKGNyZWF0ZS5lbmRwb2ludHMpXG4gICAgICAgICAgaW5kZXguaW5pdEVuZHBvaW50cyh1cGRhdGUuZW5kcG9pbnRzKVxuICAgICAgICAgIGluZGV4LmluUHJvZ3Jlc3MgPSBmYWxzZVxuICAgICAgKVxuXG4gICAgaW5kZXguZ2V0TGFzdFVwZGF0ZSA9IC0+XG4gICAgICBpbmRleC5pblByb2dyZXNzID0gdHJ1ZVxuICAgICAgV2lkZ2V0VGVtcGxhdGVTdmMubGFzdFVwZGF0ZSgpLnRoZW4oXG4gICAgICAgIChsYXN0X3VwZGF0ZSkgLT5cbiAgICAgICAgICBpbmRleC5sYXN0VXBkYXRlID0gbGFzdF91cGRhdGVcbiAgICAgICAgICBpbmRleC5pblByb2dyZXNzID0gZmFsc2VcbiAgICAgIClcblxuICAgICMgPT09PT09PT09PT09PT09PT09PT09PVxuICAgICMgR0xPQkFMIEZVTkNUSU9OU1xuICAgICMgPT09PT09PT09PT09PT09PT09PT09PVxuICAgICRzY29wZS5zYXZlQ2F0YWxvZ3VlSW1nID0gKGFDYXQsIGNhdGFsb2d1ZUltZ0ZpbGUpIC0+XG4gICAgICBXaWRnZXRUZW1wbGF0ZVN2Yy51cGRhdGVJbWcoYUNhdCwgY2F0YWxvZ3VlSW1nRmlsZSwgZmFsc2UpXG5cbiAgICAkc2NvcGUuZ2V0U2V0dGluZ3MgPSAoYU1vZGVsKSAtPlxuICAgICAgaWYgYU1vZGVsLnNldHRpbmdzPyAmJiBfLmlzQXJyYXkoYU1vZGVsLnNldHRpbmdzKVxuICAgICAgICByZXR1cm4gYU1vZGVsLnNldHRpbmdzLnNsaWNlKDAsNilcbiAgICAgIGVsc2UgaWYgYU1vZGVsLnNldHRpbmdzPyAmJiBfLmlzU3RyaW5nKGFNb2RlbC5zZXR0aW5ncylcbiAgICAgICAgaWYgYU1vZGVsLnNldHRpbmdzID09IFwiXCJcbiAgICAgICAgICByZXR1cm4gW11cbiAgICAgICAgZWxzZVxuICAgICAgICAgIHJldHVybiBhTW9kZWwuc2V0dGluZ3Muc3BsaXQoJywnKS5zbGljZSgwLDYpXG5cbiAgICAkc2NvcGUuZ2V0Q29tcGF0aWJsZUFwcHMgPSAoZWxlbWVudCkgLT5cbiAgICAgIFdpZGdldFRlbXBsYXRlU3ZjLnByZXZpZXdBcHBzKGVsZW1lbnQpIGlmIGVsZW1lbnQuZW5kcG9pbnRzP1xuXG4gICAgZGF0YVVSSXRvQmxvYiA9IChkYXRhVVJJKSAtPlxuICAgICAgYnl0ZVN0cmluZyA9IGF0b2IoZGF0YVVSSS5zcGxpdCgnLCcpWzFdKVxuICAgICAgbWltZVN0cmluZyA9IGRhdGFVUkkuc3BsaXQoJywnKVswXS5zcGxpdCgnOicpWzFdLnNwbGl0KCc7JylbMF1cblxuICAgICAgYWIgPSBuZXcgQXJyYXlCdWZmZXIoYnl0ZVN0cmluZy5sZW5ndGgpXG4gICAgICBpYSA9IG5ldyBVaW50OEFycmF5KGFiKVxuICAgICAgZm9yIGkgaW4gWzAuLmJ5dGVTdHJpbmcubGVuZ3RoXVxuICAgICAgICBpYVtpXSA9IGJ5dGVTdHJpbmcuY2hhckNvZGVBdChpKVxuXG4gICAgICBiYiA9IG5ldyBCbG9iKFthYl0pXG4gICAgICByZXR1cm4gYmJcblxuICAgICRzY29wZS5yZW5kZXJUZW1wbGF0ZUltZyA9IChpc1VwZGF0ZT10cnVlKSAtPlxuICAgICAgaWYgaXNVcGRhdGVcbiAgICAgICAgY29udGVudEVsZW0gPSBhbmd1bGFyLmVsZW1lbnQoJyNwcmV2aWV3X3VwZGF0ZScpXG4gICAgICBlbHNlXG4gICAgICAgIGNvbnRlbnRFbGVtID0gYW5ndWxhci5lbGVtZW50KCcjcHJldmlld19jcmVhdGUnKVxuXG4gICAgICBodG1sMmNhbnZhcyhjb250ZW50RWxlbSwge1xuICAgICAgICBvbnJlbmRlcmVkOiAoY2FudmFzKSAtPlxuICAgICAgICAgIGltYWdlRGF0YSA9IGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL3BuZycpXG4gICAgICAgICAgYmxvYiA9IGRhdGFVUkl0b0Jsb2IoaW1hZ2VEYXRhKVxuXG4gICAgICAgICAgaWYgaXNVcGRhdGVcbiAgICAgICAgICAgICRzY29wZS5zYXZlQ2F0YWxvZ3VlSW1nKHVwZGF0ZSwgYmxvYilcbiAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAkc2NvcGUuc2F2ZUNhdGFsb2d1ZUltZyhjcmVhdGUsIGJsb2IpXG4gICAgICAgIH1cbiAgICAgIClcblxuICAgICMgPT09PT09PT09PT09PT09PT09PT09PVxuICAgICMgSU5JVFxuICAgICMgPT09PT09PT09PT09PT09PT09PT09PVxuICAgICRzY29wZS5pbml0ID0gLT5cbiAgICAgIF8uZWFjaCAkc2NvcGUuY2F0TGlzdCwgKGNhdCkgLT5cbiAgICAgICAgJHNjb3BlLmNhdFtjYXRdID0gZmFsc2VcbiAgICAgIGNyZWF0ZS5yZXNldCgpXG4gICAgICBpbmRleC5nZXQoKVxuICAgICAgaW5kZXguZ2V0Q2F0ZWdvcmllcygpXG4gICAgICBpbmRleC5nZXRTaGFyZWRFbnRpdGllcygpXG4gICAgICBpbmRleC5nZXRMYXN0VXBkYXRlKClcblxuICAgICRzY29wZS5pbml0KClcbl0pXG5cbm1vZHVsZS5kaXJlY3RpdmUoJ2ltcGFjV2lkZ2V0VGVtcGxhdGVBZG1pbicsIFsnVGVtcGxhdGVQYXRoJywgKFRlbXBsYXRlUGF0aCkgLT5cbiAgcmV0dXJuIHtcbiAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICBzY29wZToge30sXG4gICAgICB0ZW1wbGF0ZVVybDogVGVtcGxhdGVQYXRoWydpbXBhYy93aWRnZXRfdGVtcGxhdGVfYWRtaW4uaHRtbCddLFxuICAgICAgY29udHJvbGxlcjogJ0ltcGFjV2lkZ2V0VGVtcGxhdGVBZG1pbkN0cmwnXG4gIH1cbl0pXG4iXX0=