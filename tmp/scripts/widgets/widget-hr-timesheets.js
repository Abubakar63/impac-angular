(function () {
var module;

module = angular.module('maestrano.analytics.widget-hr-timesheets', ['maestrano.assets']);

module.controller('WidgetHrTimesheetsCtrl', [
  '$scope', 'DhbAnalyticsSvc', 'ChartFormatterSvc', function($scope, DhbAnalyticsSvc, ChartFormatterSvc) {
    var getSettingsCount, unCollapsedSetting, w;
    w = $scope.widget;
    w.initContext = function() {
      if ($scope.isDataFound = angular.isDefined(w.content) && !_.isEmpty(w.content.employees) && !_.isEmpty(w.content.dates)) {
        $scope.employeesOptions = _.map(w.content.employees, function(e) {
          return {
            value: e.id,
            label: e.lastname + " " + e.firstname
          };
        });
        $scope.selectedEmployee = {
          value: $scope.getEmployee().id,
          label: ($scope.getEmployee().lastname) + " " + ($scope.getEmployee().firstname)
        };
        return $scope.unCollapsed = w.metadata.unCollapsed || [];
      }
    };
    $scope.toogleCollapsed = function(categoryName) {
      if (categoryName != null) {
        if (_.find($scope.unCollapsed, (function(name) {
          return categoryName === name;
        }))) {
          $scope.unCollapsed = _.reject($scope.unCollapsed, function(name) {
            return name === categoryName;
          });
        } else {
          $scope.unCollapsed.push(categoryName);
        }
        return w.updateSettings(false);
      }
    };
    $scope.isCollapsed = function(categoryName) {
      if (categoryName != null) {
        if (_.find($scope.unCollapsed, (function(name) {
          return categoryName === name;
        }))) {
          return false;
        } else {
          return true;
        }
      }
    };
    $scope.getEmployee = function() {
      if (!$scope.isDataFound) {
        return false;
      }
      if (w.metadata && w.metadata.employee_id) {
        return _.find(w.content.employees, function(e) {
          return e.id === w.metadata.employee_id;
        }) || w.content.employees[0];
      } else {
        return w.content.employees[0];
      }
    };
    $scope.getEmployeeTimeWorked = function() {
      var employee;
      if (employee = $scope.getEmployee()) {
        return _.find(w.content.employees, function(e) {
          return e.id === employee.id;
        }).total_time_worked;
      }
    };
    $scope.getEmployeeTimeOff = function() {
      var employee;
      if (employee = $scope.getEmployee()) {
        return _.find(w.content.employees, function(e) {
          return e.id === employee.id;
        }).total_time_off;
      }
    };
    unCollapsedSetting = {};
    unCollapsedSetting.initialized = false;
    unCollapsedSetting.initialize = function() {
      return unCollapsedSetting.initialized = true;
    };
    unCollapsedSetting.toMetadata = function() {
      return {
        unCollapsed: $scope.unCollapsed
      };
    };
    w.settings.push(unCollapsedSetting);
    getSettingsCount = function() {
      if (w.settings != null) {
        return w.settings.length;
      } else {
        return 0;
      }
    };
    $scope.$watch(getSettingsCount, function(total) {
      if (total >= 4) {
        return w.loadContent();
      }
    });
    return w;
  }
]);

module.directive('widgetHrTimesheets', function() {
  return {
    restrict: 'A',
    link: function(scope, element) {
      element.addClass("hr");
      return element.addClass("timesheets");
    },
    controller: 'WidgetHrTimesheetsCtrl'
  };
});
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndpZGdldHMvd2lkZ2V0LWhyLXRpbWVzaGVldHMuanMuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQUE7O0FBQUEsTUFBQSxHQUFTLE9BQU8sQ0FBQyxNQUFSLENBQWUsMENBQWYsRUFBMEQsQ0FBQyxrQkFBRCxDQUExRDs7QUFFVCxNQUFNLENBQUMsVUFBUCxDQUFrQix3QkFBbEIsRUFBMkM7RUFDekMsUUFEeUMsRUFDL0IsaUJBRCtCLEVBQ1osbUJBRFksRUFFekMsU0FBQyxNQUFELEVBQVMsZUFBVCxFQUEwQixpQkFBMUI7QUFFRSxRQUFBO0lBQUEsQ0FBQSxHQUFJLE1BQU0sQ0FBQztJQUVYLENBQUMsQ0FBQyxXQUFGLEdBQWdCLFNBQUE7TUFDZCxJQUFHLE1BQU0sQ0FBQyxXQUFQLEdBQXFCLE9BQU8sQ0FBQyxTQUFSLENBQWtCLENBQUMsQ0FBQyxPQUFwQixDQUFBLElBQWdDLENBQUMsQ0FBQyxDQUFDLE9BQUYsQ0FBVSxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQXBCLENBQWpDLElBQW1FLENBQUMsQ0FBQyxDQUFDLE9BQUYsQ0FBVSxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQXBCLENBQTVGO1FBRUUsTUFBTSxDQUFDLGdCQUFQLEdBQTBCLENBQUMsQ0FBQyxHQUFGLENBQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxTQUFoQixFQUEyQixTQUFDLENBQUQ7aUJBQ25EO1lBQ0UsS0FBQSxFQUFPLENBQUMsQ0FBQyxFQURYO1lBRUUsS0FBQSxFQUFVLENBQUMsQ0FBQyxRQUFILEdBQVksR0FBWixHQUFlLENBQUMsQ0FBQyxTQUY1Qjs7UUFEbUQsQ0FBM0I7UUFNMUIsTUFBTSxDQUFDLGdCQUFQLEdBQTBCO1VBQ3hCLEtBQUEsRUFBTyxNQUFNLENBQUMsV0FBUCxDQUFBLENBQW9CLENBQUMsRUFESjtVQUV4QixLQUFBLEVBQVMsQ0FBQyxNQUFNLENBQUMsV0FBUCxDQUFBLENBQW9CLENBQUMsUUFBdEIsQ0FBQSxHQUErQixHQUEvQixH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QUFBLEdBQW1CLFNBQUE7TUFDakIsSUFBRyxrQkFBSDtBQUNFLGVBQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxPQURwQjtPQUFBLE1BQUE7QUFHRSxlQUFPLEVBSFQ7O0lBRGlCO0lBT25CLE1BQU0sQ0FBQyxNQUFQLENBQWMsZ0JBQWQsRUFBZ0MsU0FBQyxLQUFEO01BQzlCLElBQW1CLEtBQUEsSUFBUyxDQUE1QjtlQUFBLENBQUMsQ0FBQyxXQUFGLENBQUEsRUFBQTs7SUFEOEIsQ0FBaEM7QUFHQSxXQUFPO0VBNUZULENBRnlDO0NBQTNDOztBQWlHQSxNQUFNLENBQUMsU0FBUCxDQUFpQixvQkFBakIsRUFBdUMsU0FBQTtBQUNyQyxTQUFPO0lBQ0wsUUFBQSxFQUFVLEdBREw7SUFFTCxJQUFBLEVBQU0sU0FBQyxLQUFELEVBQVEsT0FBUjtNQUNKLE9BQU8sQ0FBQyxRQUFSLENBQWlCLElBQWpCO2FBQ0EsT0FBTyxDQUFDLFFBQVIsQ0FBaUIsWUFBakI7SUFGSSxDQUZEO0lBS0osVUFBQSxFQUFZLHdCQUxSOztBQUQ4QixDQUF2QyIsImZpbGUiOiJ3aWRnZXRzL3dpZGdldC1oci10aW1lc2hlZXRzLmpzLmpzIiwic291cmNlUm9vdCI6Ii9zb3VyY2UvIiwic291cmNlc0NvbnRlbnQiOlsibW9kdWxlID0gYW5ndWxhci5tb2R1bGUoJ21hZXN0cmFuby5hbmFseXRpY3Mud2lkZ2V0LWhyLXRpbWVzaGVldHMnLFsnbWFlc3RyYW5vLmFzc2V0cyddKVxuXG5tb2R1bGUuY29udHJvbGxlcignV2lkZ2V0SHJUaW1lc2hlZXRzQ3RybCcsW1xuICAnJHNjb3BlJywgJ0RoYkFuYWx5dGljc1N2YycsICdDaGFydEZvcm1hdHRlclN2YycsXG4gICgkc2NvcGUsIERoYkFuYWx5dGljc1N2YywgQ2hhcnRGb3JtYXR0ZXJTdmMpIC0+XG5cbiAgICB3ID0gJHNjb3BlLndpZGdldFxuXG4gICAgdy5pbml0Q29udGV4dCA9IC0+XG4gICAgICBpZiAkc2NvcGUuaXNEYXRhRm91bmQgPSBhbmd1bGFyLmlzRGVmaW5lZCh3LmNvbnRlbnQpICYmICFfLmlzRW1wdHkody5jb250ZW50LmVtcGxveWVlcykgJiYgIV8uaXNFbXB0eSh3LmNvbnRlbnQuZGF0ZXMpXG4gICAgICAgIFxuICAgICAgICAkc2NvcGUuZW1wbG95ZWVzT3B0aW9ucyA9IF8ubWFwKHcuY29udGVudC5lbXBsb3llZXMsIChlKSAtPlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHZhbHVlOiBlLmlkLFxuICAgICAgICAgICAgbGFiZWw6IFwiI3tlLmxhc3RuYW1lfSAje2UuZmlyc3RuYW1lfVwiLFxuICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgICAkc2NvcGUuc2VsZWN0ZWRFbXBsb3llZSA9IHtcbiAgICAgICAgICB2YWx1ZTogJHNjb3BlLmdldEVtcGxveWVlKCkuaWQsXG4gICAgICAgICAgbGFiZWw6IFwiI3skc2NvcGUuZ2V0RW1wbG95ZWUoKS5sYXN0bmFtZX0gI3skc2NvcGUuZ2V0RW1wbG95ZWUoKS5maXJzdG5hbWV9XCIsXG4gICAgICAgIH1cblxuICAgICAgICAkc2NvcGUudW5Db2xsYXBzZWQgPSB3Lm1ldGFkYXRhLnVuQ29sbGFwc2VkIHx8IFtdXG5cbiAgICAkc2NvcGUudG9vZ2xlQ29sbGFwc2VkID0gKGNhdGVnb3J5TmFtZSkgLT5cbiAgICAgIGlmIGNhdGVnb3J5TmFtZT8gXG4gICAgICAgIGlmIF8uZmluZCgkc2NvcGUudW5Db2xsYXBzZWQsICgobmFtZSkgLT4gY2F0ZWdvcnlOYW1lID09IG5hbWUpKVxuICAgICAgICAgICRzY29wZS51bkNvbGxhcHNlZCA9IF8ucmVqZWN0KCRzY29wZS51bkNvbGxhcHNlZCwgKG5hbWUpIC0+XG4gICAgICAgICAgICBuYW1lID09IGNhdGVnb3J5TmFtZVxuICAgICAgICAgIClcbiAgICAgICAgZWxzZVxuICAgICAgICAgICRzY29wZS51bkNvbGxhcHNlZC5wdXNoKGNhdGVnb3J5TmFtZSlcbiAgICAgICAgdy51cGRhdGVTZXR0aW5ncyhmYWxzZSlcblxuICAgICRzY29wZS5pc0NvbGxhcHNlZCA9IChjYXRlZ29yeU5hbWUpIC0+XG4gICAgICBpZiBjYXRlZ29yeU5hbWU/ICBcbiAgICAgICAgaWYgXy5maW5kKCRzY29wZS51bkNvbGxhcHNlZCwgKChuYW1lKSAtPiBjYXRlZ29yeU5hbWUgPT0gbmFtZSkpXG4gICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIGVsc2VcbiAgICAgICAgICByZXR1cm4gdHJ1ZVxuXG4gICAgJHNjb3BlLmdldEVtcGxveWVlID0gLT5cbiAgICAgIHJldHVybiBmYWxzZSB1bmxlc3MgJHNjb3BlLmlzRGF0YUZvdW5kXG5cbiAgICAgIGlmIHcubWV0YWRhdGEgJiYgdy5tZXRhZGF0YS5lbXBsb3llZV9pZFxuICAgICAgICByZXR1cm4gXy5maW5kKHcuY29udGVudC5lbXBsb3llZXMsIChlKSAtPlxuICAgICAgICAgIGUuaWQgPT0gdy5tZXRhZGF0YS5lbXBsb3llZV9pZFxuICAgICAgICApIHx8IHcuY29udGVudC5lbXBsb3llZXNbMF1cbiAgICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIHcuY29udGVudC5lbXBsb3llZXNbMF1cblxuICAgICRzY29wZS5nZXRFbXBsb3llZVRpbWVXb3JrZWQgPSAtPlxuICAgICAgaWYgZW1wbG95ZWUgPSAkc2NvcGUuZ2V0RW1wbG95ZWUoKVxuICAgICAgICBfLmZpbmQody5jb250ZW50LmVtcGxveWVlcywgKGUpIC0+XG4gICAgICAgICAgZS5pZCA9PSBlbXBsb3llZS5pZFxuICAgICAgICApLnRvdGFsX3RpbWVfd29ya2VkXG5cbiAgICAkc2NvcGUuZ2V0RW1wbG95ZWVUaW1lT2ZmID0gLT5cbiAgICAgIGlmIGVtcGxveWVlID0gJHNjb3BlLmdldEVtcGxveWVlKClcbiAgICAgICAgXy5maW5kKHcuY29udGVudC5lbXBsb3llZXMsIChlKSAtPlxuICAgICAgICAgIGUuaWQgPT0gZW1wbG95ZWUuaWRcbiAgICAgICAgKS50b3RhbF90aW1lX29mZlxuXG5cbiAgICAjICMjIyBNaW5pLXNldHRpbmdzXG5cbiAgICB1bkNvbGxhcHNlZFNldHRpbmcgPSB7fVxuICAgIHVuQ29sbGFwc2VkU2V0dGluZy5pbml0aWFsaXplZCA9IGZhbHNlXG4gICAgXG4gICAgdW5Db2xsYXBzZWRTZXR0aW5nLmluaXRpYWxpemUgPSAtPlxuICAgICAgdW5Db2xsYXBzZWRTZXR0aW5nLmluaXRpYWxpemVkID0gdHJ1ZVxuXG4gICAgdW5Db2xsYXBzZWRTZXR0aW5nLnRvTWV0YWRhdGEgPSAtPlxuICAgICAge3VuQ29sbGFwc2VkOiAkc2NvcGUudW5Db2xsYXBzZWR9XG5cbiAgICB3LnNldHRpbmdzLnB1c2godW5Db2xsYXBzZWRTZXR0aW5nKVxuXG4gICAgIyAtLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgIyBUT0RPOiBSZWZhY3RvciBvbmNlIHdlIGhhdmUgdW5kZXJzdG9vZCBleGFjdGx5IGhvdyB0aGUgYW5ndWxhcmpzIGNvbXBpbGF0aW9uIHByb2Nlc3Mgd29ya3M6XG4gICAgIyBpbiB0aGlzIG9yZGVyLCB3ZSBzaG91bGQ6XG4gICAgIyAxLSBjb21waWxlIGltcGFjLXdpZGdldCBjb250cm9sbGVyXG4gICAgIyAyLSBjb21waWxlIHRoZSBzcGVjaWZpYyB3aWRnZXQgdGVtcGxhdGUvY29udHJvbGxlclxuICAgICMgMy0gY29tcGlsZSB0aGUgc2V0dGluZ3MgdGVtcGxhdGVzL2NvbnRyb2xsZXJzXG4gICAgIyA0LSBjYWxsIHdpZGdldC5sb2FkQ29udGVudCgpIChpZGVhbGx5LCBmcm9tIGltcGFjLXdpZGdldCwgb25jZSBhIGNhbGxiYWNrIFxuICAgICMgICAgIGFzc2Vzc2luZyB0aGF0IGV2ZXJ5dGhpbmcgaXMgY29tcGlsZWQgYW4gcmVhZHkgaXMgcmVjZWl2ZWQpXG4gICAgZ2V0U2V0dGluZ3NDb3VudCA9IC0+XG4gICAgICBpZiB3LnNldHRpbmdzP1xuICAgICAgICByZXR1cm4gdy5zZXR0aW5ncy5sZW5ndGhcbiAgICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIDBcblxuICAgICMgb3JnYW5pemF0aW9uX2lkcyArIHVuQ29sbGFwc2VkICsgcGFyYW0gc2VsZWN0b3IgKyB0aW1lIHJhZ2VcbiAgICAkc2NvcGUuJHdhdGNoIGdldFNldHRpbmdzQ291bnQsICh0b3RhbCkgLT5cbiAgICAgIHcubG9hZENvbnRlbnQoKSBpZiB0b3RhbCA+PSA0XG5cbiAgICByZXR1cm4gd1xuXSlcblxubW9kdWxlLmRpcmVjdGl2ZSgnd2lkZ2V0SHJUaW1lc2hlZXRzJywgLT5cbiAgcmV0dXJuIHtcbiAgICByZXN0cmljdDogJ0EnLFxuICAgIGxpbms6IChzY29wZSwgZWxlbWVudCkgLT5cbiAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoXCJoclwiKVxuICAgICAgZWxlbWVudC5hZGRDbGFzcyhcInRpbWVzaGVldHNcIilcbiAgICAsY29udHJvbGxlcjogJ1dpZGdldEhyVGltZXNoZWV0c0N0cmwnXG4gIH1cbikiXX0=