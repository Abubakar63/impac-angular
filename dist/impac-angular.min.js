!function(){"use strict";angular.module("maestrano.impac",["impac.config","impac.services","impac.filters","impac.components","ui.sortable","ui.bootstrap"]),angular.module("impac.components",["impac.components.dashboard","impac.components.dashboard-selector","impac.components.chart","impac.components.widget","impac.components.widgets","impac.components.widgets-settings","impac.components.widgets-common","impac.components.templates"]),angular.module("impac.components.widgets",["impac.components.widgets.accounts-accounting-values","impac.components.widgets.accounts-assets-summary","impac.components.widgets.accounts-balance-sheet","impac.components.widgets.accounts-balance","impac.components.widgets.accounts-cash-summary","impac.components.widgets.accounts-comparison","impac.components.widgets.accounts-custom-calculation","impac.components.widgets.accounts-expenses-revenue","impac.components.widgets.accounts-payable-receivable","impac.components.widgets.accounts-profit-and-loss","impac.components.widgets.hr-employee-details","impac.components.widgets.hr-employees-list","impac.components.widgets.hr-leaves-balance","impac.components.widgets.hr-leaves-schedule","impac.components.widgets.hr-payroll-summary","impac.components.widgets.hr-payroll-taxes","impac.components.widgets.hr-salaries-summary","impac.components.widgets.hr-superannuation-accruals","impac.components.widgets.hr-timesheets","impac.components.widgets.hr-workforce-summary","impac.components.widgets.invoices-aged-payables-receivables","impac.components.widgets.invoices-list","impac.components.widgets.invoices-summary","impac.components.widgets.sales-aged","impac.components.widgets.sales-break-even","impac.components.widgets.sales-comparison","impac.components.widgets.sales-customer-details","impac.components.widgets.sales-cycle","impac.components.widgets.sales-forecast","impac.components.widgets.sales-growth","impac.components.widgets.sales-leads-funnel","impac.components.widgets.sales-leads-list","impac.components.widgets.sales-list","impac.components.widgets.sales-margin","impac.components.widgets.sales-number-of-leads","impac.components.widgets.sales-opportunities-funnel","impac.components.widgets.sales-performance","impac.components.widgets.sales-segmented-turnover","impac.components.widgets.sales-summary","impac.components.widgets.sales-top-opportunities"]),angular.module("impac.components.widgets-settings",["impac.components.widgets-settings.account","impac.components.widgets-settings.accounts-list","impac.components.widgets-settings.chart-filters","impac.components.widgets-settings.formula","impac.components.widgets-settings.hist-mode","impac.components.widgets-settings.organizations","impac.components.widgets-settings.param-selector","impac.components.widgets-settings.params-picker","impac.components.widgets-settings.time-range","impac.components.widgets-settings.width"]),angular.module("impac.components.widgets-common",["impac.components.widgets-common.top-buttons","impac.components.widgets-common.data-not-found","impac.components.widgets-common.editable-title"]),angular.module("impac.filters",["impac.filters.titleize","impac.filters.truncate","impac.filters.mno-currency"]),angular.module("impac.services",["impac.services.routes","impac.services.linking","impac.services.theming","impac.services.assets","impac.services.chart-formatter","impac.services.message-bus","impac.services.utilities","impac.services.main","impac.services.dashboards","impac.services.widgets"]),angular.module("impac.config",[]).config(["$httpProvider",function(e){e.defaults.headers.common.Accept="application/json",e.defaults.headers.common["Content-Type"]="application/json"}]),angular.module("impac.components.templates",[]).run(["$templateCache",function(e){e.put("dashboard-selector/bootstrap-tabs.tmpl.html",'<div class="row">\n  <div class="buttons-bar col-md-8">\n    <tabset type="{{selectorType}}">\n      <tab ng-repeat="dhb in dashboardsList" select="selectDashboard(dhb.id)" active="dhb.active">\n        <tab-heading>\n          {{dhb.full_name}}\n          <a href="" class="close-link" ng-if="isDeleteDhbEnabled">\n            <i class="fa fa-times" ng-click="deleteDashboardModal.open()"></i>\n          </a>\n        </tab-heading>\n      </tab>\n      <tab ng-if=\'isAccessibilityEnabled\' ng-click="toggleAccessibilityMode()">\n        <tab-heading>\n          <a href=""><i class="fa fa-wheelchair"></i></a>\n        </tab-heading>\n      </tab>\n      <tab ng-if="isAddDhbEnabled" ng-click="onCreateDashboard()">\n        <tab-heading>\n          <a href="">+</a>\n        </tab-heading>\n      </tab>\n    </tabset>\n  </div>\n  <div class=\'buttons-bar col-md-4\'>\n    <div class=\'actions-panel\'>\n      <button ng-if=\'isAccessibilityEnabled\' ng-click="toggleAccessibilityMode()" class=\'btn btn-info\' ng-disabled="showWidgetSelector"><span class=\'fa fa-wheelchair\'></span></button>\n      <button ng-if="isAddWidgetEnabled && isThereADashboard()" ng-click="onDisplayWidgetSelector({newValue: true})" class=\'btn btn-warning\' ng-disabled="isWidgetSelectorShown"><span class=\'fa fa-plus\'></span> Add Widget</button>\n      <!-- <button id=\'data-upload-wizard\' ng-click=\'openStarWizard()\' class=\'btn btn-success hidden-xs\' ><span class=\'fa fa-upload\'></span> Data Upload</button> -->\n    </div>\n  </div>\n</div>\n'),e.put("dashboard-selector/delete.modal.html",'<div class="modal-header">\n  <div class="close" type="button" ng-click="instance.close()" >×</div>\n  <h3>Delete Dashboard</h3>\n</div>\n\n<div class="modal-body">\n  <div class="row">\n    <div class="col-sm-12">\n      <div class="alert alert-error" ng-show="errors">\n        <button class="close" ng-click="errors=\'\'">×</button>\n        <ul>\n          <li ng-repeat="error in errors">{{error}}</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n\n  <!-- Create a new widget -->\n  <p>Are you sure you want to delete this analytics dashboard?</p>\n\n</div>\n\n<div class="modal-footer">\n  <div class="row">\n    <div class="col-sm-12">\n      <button class="btn btn-shaded" ng-click="instance.dismiss()" ng-hide="isLoading" ng-disabled="isLoading">Cancel</button>\n      <button class="btn btn-danger" ng-click="proceed()" ng-disabled="isLoading">\n        <i class="fa fa-spinner fa-pulse loader" ng-show="isLoading"></i>\n        Delete\n      </button>\n    </div>\n  </div>\n</div>\n'),e.put("dashboard-selector/dropdown.tmpl.html",'<div class="row buttons-bar">\n\n  <div class="col-md-6 dropdown-container" ng-hide="isLoading">\n    <div ng-if="isThereADashboard()">\n      <h4 class=\'dashboard-title\' ng-click="toggleShowDashboardsDropdown()">\n        {{currentDhb.full_name}}\n        <i class="fa fa-chevron-down" style="font-size: 18px;"></i>\n        <i ng-hide="showChangeDashboardNameBox" class="fa fa-pencil" tooltip="Change name" tooltip-animation="false" tooltip-append-to-body="true" ng-click="toggleChangeDashboardNameBox(currentDhb)"></i>\n      </h4>\n\n      <div collapse="!showDashboardsDropdown" class=\'dashboard-select\'>\n        <div ng-hide="dhb.id == currentDhb.id" class=\'option\' ng-repeat="dhb in dashboardsList">\n          <span class="name" ng-click="selectDashboard(dhb.id)">{{dhb.full_name}}</span>\n          <i ng-hide="showChangeDashboardNameBox" class="fa fa-pencil" tooltip="Change name" tooltip-animation="false" tooltip-append-to-body="true" ng-click="toggleChangeDashboardNameBox(dhb)"/>\n        </div>\n\n        <div ng-show="showCreateDashboardButton" class="option create" ng-click="onCreateDashboard()"><i class="fa fa-plus" /> Create Dashboard</div>\n      </div>\n\n      <div ng-show="showChangeDashboardNameBox" class="change-name">\n        <p>Change dashboard name:</p>\n        <input type="text" class="form-control" id="changeDhbNameInput" ng-model="dashboardToChange.name" ng-keyup="checkAndUpdateDashboardName($event)"/>\n        <button class="btn btn-sm btn-default" ng-click="showChangeDashboardNameBox=false">Cancel</button>\n        <button class="btn btn-sm btn-success" style="margin-left: 10px" ng-click="updateDashboardName()">Confirm</button>\n      </div>\n\n      <p class="data-source-label">\n        <small><b>Source:</b> {{organizationsNames()}}</small>\n      </p>\n    </div>\n  </div>\n\n  <div class="col-md-6 loader-container" ng-show="isLoading">\n    <i class="fa fa-spinner fa-pulse fa-4x loading-spinner"/>\n  </div>\n\n  <div class=\'col-md-6 actions-panel\'>\n\n    <button ng-if=\'isAccessibilityEnabled\' ng-click="toggleAccessibilityMode()" class=\'btn btn-info\' ng-disabled="showWidgetSelector"><span class=\'fa fa-wheelchair\'></span></button>\n\n    <button ng-if="isAddWidgetEnabled && isThereADashboard()" ng-click="onDisplayWidgetSelector({newValue: true})" class=\'btn btn-warning\' ng-disabled="isWidgetSelectorShown"><span class=\'fa fa-plus\'></span> Add Widget</button>\n\n    <button ng-if="isAddDhbEnabled" ng-click="onCreateDashboard()" class=\'btn btn-warning\' ng-show="showCreateDashboardButton"><span class=\'fa fa-pencil-square-o\'></span> Create Dashboard</button>\n\n    <!-- <button id=\'data-upload-wizard\' ng-click=\'dhbCtrl.openStarWizard()\' class=\'btn btn-success hidden-xs\' ><span class=\'fa fa-upload\'></span> Data Upload</button> -->\n\n    <button ng-if="isDeleteDhbEnabled" ng-click="deleteDashboardModal.open()" class=\'btn btn-danger hidden-xs\' ng-show="isThereADashboard()" tooltip="Delete Dashboard"><span class=\'fa fa-trash-o\'></span> </button>\n    \n  </div>\n\n</div>\n'),e.put("dashboard/create.modal.html",'<div class="modal-header">\n  <div class="close" type="button" ng-click="instance.close()" >×</div>\n  <h3>Create New Dashboard</h3>\n</div>\n\n<div class="modal-body">\n  <div class="row">\n    <div class="col-sm-12">\n      <div class="alert alert-error" ng-show="errors">\n        <button class="close" ng-click="errors=\'\'">×</button>\n        <ul>\n          <li ng-repeat="error in errors">{{error}}</li>\n        </ul>\n      </div>\n    </div>\n  </div>\n\n  <!-- Create a new dashboard -->\n  <div class="row dashboard-form">\n    <div class="col-sm-10 col-sm-offset-1">\n      <form class="form-horizontal" role="form">\n        <div class="form-group">\n          <label class="col-sm-2 control-label">Name</label>\n          <div class="col-sm-10">\n            <input type=\'text\' class="form-control" ng-model="model.name" placeholder="E.g: Cash Accounts Monitoring" required>\n          </div>\n        </div>\n\n        <div class="form-group" ng-show="isMultiCompanyAvailable()">\n          <label class="col-sm-2 control-label">Type</label>\n          <div class="col-sm-10">\n            <div class="btn-group" role="group">\n              <button type="button" ng-click="selectMode(\'single\')" ng-class="btnBlassFor(\'single\')">Current Company</button>\n              <button type="button" ng-click="selectMode(\'multi\')" ng-class="btnBlassFor(\'multi\')">Multi Company</button>\n            </div>\n          </div>\n        </div>\n\n        <!-- Single Company mode -->\n        <div class="form-group" ng-show="isCurrentOrganizationShown()">\n          <div ng-show="!canAccessAnalyticsForCurrentOrganization()" class="text-center text-purple">\n            <div class="spacer1"></div>\n            <p>\n              Oops! Only Admins and Super Admins can create dashboards for company {{currentOrganization.name}}.\n              <span ng-show="isMultiCompanyAvailable()">Please select a "Multi Company" dashboard to select data from other companies.</span>\n            </p>\n          </div>\n        </div>\n        \n        <!-- Multi Company mode -->\n        <div class="form-group" ng-show="isSelectOrganizationShown()">\n          <label class="col-sm-2 control-label">Companies</label>\n          <div class="col-sm-10">\n            <ul class="list-unstyled">\n              <li ng-repeat="organization in organizations" >\n                <input type="checkbox" ng-model="organization.$selected" ng-disabled="!canAccessAnalyticsData(organization)"> \n                {{organization.name}} \n                <span ng-show="organization.is_customer_account">(customer)</span>\n                <span ng-show="!canAccessAnalyticsData(organization)">\n                  <em><small>\n                    &nbsp;\n                    &nbsp;\n                    <i class="fa fa-exclamation-circle text-danger" tooltip="Only Admins and Super Admins can access analytics data for this company"></i>\n                  </small></em>\n                </span>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </form>\n\n      <!-- End row col -->\n    </div>\n\n    <!-- End Dashboard form -->\n  </div>\n\n\n\n</div>\n\n<div class="modal-footer">\n  <div class="row">\n    <div class="col-sm-12">\n      <button class="btn btn-shaded" ng-click="instance.dismiss()" ng-hide="isLoading" ng-disabled="isLoading">Cancel</button>\n      <button class="btn btn-info" ng-click="proceed()" ng-disabled="isProceedDisabled()">\n        <i class="fa fa-spinner fa-pulse loader" ng-show="isLoading"></i>\n        Add\n      </button>\n    </div>\n  </div>\n</div>\n'),e.put("dashboard/dashboard.tmpl.html",'<!-- DASHBOARD -->\n<div class="analytics" ng-hide="isLoading">\n  <div mno-star-wizard=true modal-open=\'starWizardModal.value\'></div>\n\n  <!-- Title and Dashboard selection -->\n  <div id="head-title">\n    <div class="row" ng-if="showDhbHeading">\n      <div class="col-md-6 col-sm-12" id="dashboard-heading">\n        <img ng-src="{{impacTitleLogo}}" />\n        <h2>\n          {{dhbHeadingText}}\n        </h2>\n      </div>\n    </div>\n    <dashboard-selector id="module__dashboard-selector" on-display-widget-selector="displayWidgetSelector(newValue)" is-widget-selector-shown="showWidgetSelector" on-create-dashboard="createDashboardModal.open()"></dashboard-selector>\n  </div>\n\n  <!-- Widgets selection container -->\n  <div id="widget-selector" collapse="!showWidgetSelector" ng-if="!customWidgetSelector.path">\n    <div class="title">\n      <i class="fa fa-times-circle" ng-if="showCloseWidgetSelectorButton()" ng-click="displayWidgetSelector(false)"/>\n      <span class="badge confirmation">Widget added!</span>\n      Select the widgets you want to add to your dashboard.\n    </div>\n\n    <div class="row top-container">\n      <div class="col-md-3 categories">\n        <div class="row header">\n          All categories\n        </div>\n        <div class="row lines">\n          <div class="col-md-12" style="padding: 3px 12px;">\n            <p ng-click="selectCategory(\'accounts\')" ng-class="isCategorySelected(\'accounts\') ? \'selected\' : none">Accounting</p>\n            <p ng-click="selectCategory(\'invoices\')" ng-class="isCategorySelected(\'invoices\') ? \'selected\' : none">Invoicing</p>\n            <p ng-click="selectCategory(\'hr\')" ng-class="isCategorySelected(\'hr\') ? \'selected\' : none">HR / Payroll</p>\n            <p ng-click="selectCategory(\'sales\')" ng-class="isCategorySelected(\'sales\') ? \'selected\' : none">Sales</p>\n          </div>\n        </div>\n\n        <div class="arrow" ng-style="getSelectedCategoryTop()">\n          <div class="square"></div>\n          <i class="fa fa-caret-right"></i>\n        </div>\n\n      </div>\n\n      <div class="col-md-9 widgets">\n        <div class="row header">\n          {{getSelectedCategoryName() | titleize}}\n        </div>\n        <div class="row lines">\n          <div class="col-md-4" ng-repeat="widgetPattern in getWidgetsForSelectedCategory()" style="padding: 0px 8px;">\n            <p ng-click="addWidget(widgetPattern.path, widgetPattern.metadata)" tooltip="{{widgetPattern.desc}}" tooltip-placement="{{$index < 9 ? \'bottom\' : \'top\'}}" tooltip-animation="false"  tooltip-append-to-body="true" tooltip-class="impac-widget-selector-tooltip"><i class="fa fa-{{widgetPattern.icon}}" /> {{widgetPattern.name}} <i class="fa fa-plus-circle" /></p>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="bottom">\n      <span class="suggestion">\n        Can\'t find the widget you\'re looking for? <a ng-click="widgetSuggestionModal.open()">Give us your suggestions here!</a>\n      </span>\n    </div>\n  </div>\n\n  <!-- custom widget selector template configured from ImpacThemingProvider -->\n  <div id="custom-widget-selector" ng-if="customWidgetSelector.path" ng-include="customWidgetSelector.path"></div>\n\n\n  <!-- Errors -->\n  <div class="alert alert-error" ng-show="errors">\n    <button class="close" ng-click="errors=\'\'">×</button>\n    <ul>\n      <li ng-repeat="error in errors">{{error}}</li>\n    </ul>\n  </div>\n\n  <div class=\'spacer1\'></div>\n\n  <div id="no-widgets-container" class="text-center ng-hide" ng-show=\'(showChooseDhbMsg() || showNoWidgetsMsg())\'>\n\n    <img ng-src="{{impacDashboardBackground}}" class="bg">\n\n    <div class="impac-info-message">\n      <!-- First Time Dashboard Creation -->\n      <div class="ng-hide" ng-show=\'showChooseDhbMsg()\'>\n        <div class=\'hidden-xs\'>\n          <div class=\'spacer4\'></div>\n          <div class="row">\n            <div class="col-md-8 col-md-offset-2">\n              <div class="testimonial promo-dark">\n                <p><b>It\'s time to add a reporting dashboard!</b></p><p>In 2 clicks, you\'ll be able to visualize how your business is performing.</p>\n              </div>\n            </div>\n          </div>\n          <div class=\'spacer2\'></div>\n        </div>\n        <div class="align-center">\n          <button ng-click="createDashboardModal.open()" class=\'btn btn-lg btn-warning\'><span class=\'fa fa-plus\'></span> Create a Dashboard!</button>\n        </div>\n      </div>\n\n      <!-- Empty Dashboard -->\n      <div class="ng-hide" ng-show=\'showNoWidgetsMsg()\'>\n        <div class=\'hidden-xs\'>\n          <div class=\'spacer4\'></div>\n          <div class="row">\n            <div class="col-md-8 col-md-offset-2">\n              <div class="testimonial promo-dark">\n                <p><b>Now it\'s time to select the metrics you want to see!</b></p><p>Add widgets to your dashboard to help make an Impac!™ to your business.</p>\n              </div>\n            </div>\n          </div>\n          <div class="spacer2"></div>\n        </div>\n        <div class="align-center">\n          <button ng-disabled="showWidgetSelector" ng-click="displayWidgetSelector(true)" class=\'btn btn-lg btn-warning\'><span class=\'fa fa-plus\'></span> Add a new Widget</button>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <!-- First Time Dashboard Creation -->\n  <div class="row text-center" ng-show=\'showChooseDhbMsg()\'>\n    <div class="spacer2 hidden-xs"></div>\n    <div class=\'col-md-8 col-md-offset-2\'>\n      <p class="text-muted"><small><em>Note: dashboards you create will only be accessible by you. Dashboard sharing across users will be added soon.</em></small></p>\n    </div>\n  </div>\n\n  <!-- Widgets -->\n  <div class=\'row\'>\n    <div id="widgets-container" ui-sortable="sortableOptions" ng-model="currentDhb.widgets">\n      <div impac-widget widget="widget" is-accessibility="accessibility" parent-dashboard="currentDhb" ng-repeat="widget in currentDhb.widgets" class="widget-item" ng-class="widget.getColClass()" />\n      <!-- Add Widget Tile, enabled & customised in ImpacThemingProvider -->\n      <div ng-if="isAddChartEnabled" class="unsortable" ng-click="addChartTileOnClick()">\n        <div class="col-md-6 widget-item add-chart">\n          <div class="a-content">+ chart</div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'),e.put("dashboard/widget-suggestion.modal.html",'<div class="modal-header">\n  <div class="close" type="button" ng-click="instance.close()" >×</div>\n  <h3>Suggest a widget</h3>\n</div>\n\n<div class="modal-body">\n\n  <div class="row">\n    <div class="col-md-6">\n      <label>What would you name your widget?</label><br />\n      <input type="text" ng-model="widgetDetails.name" ng-disabled="isLoading" />\n    </div>\n    <div class="col-md-6">\n      <label>In which category?</label><br />\n      <input type="text" ng-model="widgetDetails.category" ng-disabled="isLoading" />\n    </div>\n  </div>\n\n  <div class="spacer1" />\n\n  <div class="row">\n    <div class="col-md-12">\n      <label>What kind of information would your widget display?</label><br />\n      <textarea ng-model="widgetDetails.description" ng-disabled="isLoading" />\n    </div>\n  </div>\n\n  <div class="spacer1" ng-show="isLoading" />\n\n  <div class="row" ng-show="isLoading">\n    <div class="col-md-12 text-center">\n      <!-- <h3 class="thanks-message">{{userName | titleize}}, thanks a lot for helping us improve Impac!&trade;</h3> -->\n      <h3 class="thanks-message">Thanks a lot for helping us improve Impac!&trade;</h3>\n    </div>\n  </div>\n\n</div>\n\n<div class="modal-footer">\n  <div class="row">\n    <div class="col-sm-12" ng-class="isLoading ? \'text-center\' : null">\n      <button class="btn btn-shaded" ng-click="instance.dismiss()" ng-hide="isLoading">Cancel</button>\n      <button class="btn btn-info" ng-click="proceed()" ng-hide="isLoading" ng-disabled="!(widgetDetails.name && widgetDetails.category && widgetDetails.description)">\n        <i class="fa fa-spinner fa-pulse loader" ng-show="isLoading"></i>\n        Send your suggestion\n      </button>\n    </div>\n  </div>\n</div>\n'),e.put("widget/widget.tmpl.html",'<div class="top-line">\n  <div common-top-buttons parent-widget="widget" />\n  <div common-editable-title parent-widget="widget" />\n</div>\n\n<div ng-show="isTemplateLoaded()" class="content" ng-class="templateName">\n\n  <div ng-show="widget.isLoading" class="loader" align="center">\n    <div>\n      <i class="fa fa-spinner fa-pulse fa-3x"></i>\n      <p>Your data is being retrieved...</p>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isLoading" ng-include="widgetContentTemplate()" />\n</div>\n\n<div ng-hide="isTemplateLoaded()" class="content">\n  <div class="loader" align="center">\n    <div>\n      <i class="fa fa-spinner fa-pulse fa-4x"></i>\n    </div>\n  </div>\n</div>\n'),e.put("widgets/accounts-accounting-values.tmpl.html",'<div widget-accounts-accounting-values>\n\n  <div ng-show="widget.isEditMode" class="edit">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n    <div ng-show="isDataFound">\n      <div setting-hist-mode parent-widget="widget" deferred="::histModeDeferred" />\n\n      <div ng-hide="widget.isHistoryMode" class="current">\n        <div class="price">\n           {{ getCurrentPrice() | mnoCurrency : getCurrency() : false }}\n        </div>\n        <div class="currency">{{getCurrency()}}</div>\n        <div class="legend">{{getLegend()}}</div>\n      </div>\n\n      <div class="history chart-container" ng-class="{\'invisible\': !widget.isHistoryMode}">\n        <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n        <div class="legend">{{getLegend()}}</div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n  \n</div>'),e.put("widgets/accounts-assets-summary.tmpl.html",'<div widget-accounts-assets-summary>\n      \n  <div ng-show="widget.isEditMode" class="edit">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n    <div ng-show="isDataFound" class="chart-container">\n      <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n      <div class="legend">\n        <span ng-repeat="valuePair in widget.content.summary">\n          <span style="font-weight: bold; color: {{getAccountColor(valuePair)}};">{{valuePair.label}}</span>: {{valuePair.total | mnoCurrency : getCurrency()}}\n          <br />\n        </span>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/accounts-balance.tmpl.html",'<div widget-accounts-balance>\n\n  <div ng-show="widget.isEditMode" class="edit">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-account parent-widget="widget" class="part" deferred="::accountBackDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n    <div ng-show="isDataFound">\n      <!-- Will be hidden once an account is selected -->\n      <div setting-account ng-hide="widget.selectedAccount" parent-widget="widget" label=\'Select an account to monitor\' on-account-selected="displayAccount()" deferred="::accountFrontDeferred" />\n\n      <!-- All the below divs will remain hidden until an account is selected -->\n      <div ng-show="widget.selectedAccount">\n        <div setting-hist-mode parent-widget="widget" deferred="::histModeDeferred" />\n\n        <div ng-hide="widget.isHistoryMode">\n          <h3>{{getName()}}</h3>\n          <div class="price">\n             {{ getCurrentBalance() | mnoCurrency : getCurrency() : false }}\n          </div>\n          <div class="currency">{{getCurrency()}}</div>\n        </div>\n\n        <div class="chart-container" ng-class="{\'invisible\': !widget.isHistoryMode}">\n          <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n          <div class="legend">{{getName()}}</div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/accounts-balance-sheet.tmpl.html",'<div widget-accounts-balance-sheet>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div class="no-data-block" ng-hide="isDataFound">\n      No balance sheet can be generated between this {{period.label.toLowerCase()}} and the previous {{period.label.toLowerCase()}}. <br />\n      Maybe try selecting a longer period? <br />\n      <span setting-param-selector parent-widget="widget" param="period" options="periodOptions" selected="period" deferred="::paramSelectorFrontDeferred" />\n    </div>\n\n    <div ng-show="isDataFound" class="widget-lines-container">\n      <div class="row widget-line header">\n        <div class="col-sm-6 text-left">Compare with previous: <span setting-param-selector parent-widget="widget" param="period" options="periodOptions" selected="period" deferred="::paramSelectorBackDeferred" /></div>\n        <div class="col-sm-3 text-right">{{widget.content.dates[0] | date : "d-MMM"}}</div>\n        <div class="col-sm-3 text-right">{{widget.content.dates[1] | date : "d-MMM"}}</div>\n      </div>\n     \n      <div class="row widget-line total" ng-repeat="category in categories" >\n        <div class="row widget-line" >\n          <div class="col-sm-1" ng-click="toggleCollapsed(category)" style="cursor: pointer;">\n            <i class="fa" ng-class="isCollapsed(category) ? \'fa-plus-square-o\' : \'fa-minus-square-o\'" />\n          </div>\n          <div class="col-sm-5 text-left"><strong>{{category | titleize}}</strong></div>\n          <div class="col-sm-3 text-right"><strong>{{widget.content.summary[category].totals[0] | mnoCurrency : widget.content.summary[category].currency}}</strong></div>\n          <div class="col-sm-3 text-right"><strong>{{widget.content.summary[category].totals[1] | mnoCurrency : widget.content.summary[category].currency}}</strong></div>\n        </div>\n        \n        <div collapse="isCollapsed(category)">\n          <div class="row widget-line" ng-repeat="account in widget.content.summary[category].accounts" >\n            <div class="col-sm-1" />\n            <div class="col-sm-5 text-left">{{account.name | titleize}}</div>\n            <div class="col-sm-3 text-right">{{account.totals[0] | mnoCurrency : account.currency}}</div>\n            <div class="col-sm-3 text-right">{{account.totals[1] | mnoCurrency : account.currency}}</div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n  </div>\n\n</div>'),e.put("widgets/accounts-cash-summary.tmpl.html",'<div widget-accounts-cash-summary>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row" >\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="6" max="12" class="settings width" deferred="::widthDeferred" />\n\n        <div class="widget-lines-container">\n          <div class="row widget-line header">\n            <div class="col-sm-1" />\n            <div class="col-sm-5"></div>\n            <div class="col-sm-3 text-right">{{getLastDate() | date : "d-MMM"}}</div>\n            <div class="col-sm-3 text-right">Variance</div>\n          </div>\n          <div class="row widget-line total" ng-repeat="statement in widget.content.summary" >\n            <div class="row widget-line" ng-class="isSelected(statement) ? \'selected\' : null" >\n              <div class="col-sm-1" ng-click="toggleCollapsed(statement)"><i class="fa" ng-class="isCollapsed(statement) ? \'fa-plus-square-o\' : \'fa-minus-square-o\'" /></div>\n              <div class="col-sm-5" ng-click="toggleSelectedElement(statement)"><strong>{{getName(statement) | titleize}}</strong></div>\n              <div class="col-sm-3 text-right" ng-click="toggleSelectedElement(statement)"><strong>{{getLastValue(statement) | mnoCurrency : statement.currency}}</strong></div>\n              <div class="col-sm-3 text-right" ng-click="toggleSelectedElement(statement)" ng-class="getVarianceClassColor(getLastVariance(statement))"><strong>{{getLastVariance(statement)}}</strong></div>\n            </div>\n            <div collapse="isCollapsed(statement)">\n              <div class="row widget-line" ng-click="toggleSelectedElement(account)" ng-repeat="account in statement.accounts" ng-class="isSelected(account) ? \'selected\' : null" >\n                <div class="col-sm-1" />\n                <div class="col-sm-5">{{account.name}}</div>\n                <div class="col-sm-3 text-right">{{getLastValue(account) | mnoCurrency : account.currency }}</div>\n                <div class="col-sm-3 text-right" ng-class="getVarianceClassColor(getLastVariance(account))">{{getLastVariance(account)}}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="right-panel text-center" ng-class="{\'col-md-6\': widget.isExpanded(), \'col-md-12 invisible\': !widget.isExpanded()}">\n\n        <div ng-show="selectedElement">\n          <h4>{{getName(selectedElement) | titleize}}</h4>\n\n          <div class="chart-container">\n            <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n            <div class="legend">{{(widget.metadata.hist_parameters.period || "Monthly") | titleize}} Cash Flow</div>\n          </div>\n          \n          <div class="widget-lines-container">\n            <div class="row widget-line">\n              <span class="text-center" ng-repeat="date in dates track by $index">\n                <div ng-if="$index % 6 == 0 && $index > 0" class="clearfix dashed hidden-xs"></div>\n\n                <div class="col-sm-2" style="padding: 5px 0px;">\n                  <div class="row widget-line"><div class="col-sm-12" style="padding: 0px;">{{date | date : "d-MMM"}}</div></div>\n                  <div class="row widget-line"><div class="col-sm-12" style="padding: 0px;">{{selectedElement.cash_flows[$index] | mnoCurrency : selectedElement.currency }}</div></div>\n                  <div class="row widget-line"><div class="col-sm-12" style="padding: 0px;" ng-class="getVarianceClassColor(selectedElement.variances[$index])">{{formatVariance(selectedElement.variances[$index])}}</div></div>\n                </div>\n              </span>\n            </div>\n          </div>\n        </div>\n\n        <div ng-hide="selectedElement" class="no-element">\n          Select an account or an account type to display the corresponding cash evolution.\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n    \n</div>'),e.put("widgets/accounts-comparison.tmpl.html",'<div widget-accounts-comparison>\n  <div setting-accounts-list parent-widget="widget" deferred="::accountsListDeferred" />\n\n  <div ng-show="widget.isEditMode" class="edit">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound">\n      <div ng-hide="hasAccountsSelected()" class="row">\n        <h5>Select the accounts you wish to compare.</h5>\n        <div class="col-md-6">\n          <div class="input-group">\n            <select ng-model="movedAccount" ng-options="account.name + \' (\' + formatAmount(account) + \')\' for account in widget.remainingAccounts" class="form-control" ng-show="widget.hasEditAbility" ng-change="addAccount(movedAccount)"></select>\n          </div>\n        </div>\n      </div>\n\n      <div ng-show="hasAccountsSelected()">\n        <div class="row">\n          <div class="col-md-12 chart-container">\n            <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n          </div>\n        </div>\n\n        <div class="row">\n          <div class="col-md-12">\n            <div class="widget-lines-container">\n              <div class="widget-line" ng-repeat="account in widget.selectedAccounts track by $index">\n                <button class="close" ng-click="removeAccount(account)" ng-show="widget.hasDeleteAbility">\n                  x\n                </button>\n                <i style="float: right; margin-right: 10px;">{{formatAmount(account)}}</i>\n                <i class="fa fa-circle" style="margin: 0px 8px; color: {{getAccountColor(account)}}" />\n                {{account.name}}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="row">\n          <div class="add-account">\n            <div class="input-group">\n              <select ng-model="movedAccount" ng-options="account.name + \' (\' + formatAmount(account) + \')\' for account in widget.remainingAccounts track by account.uid" class="form-control" ng-show="widget.hasDeleteAbility" ng-change="addAccount(movedAccount)" ng-disabled="widget.selectedAccounts.length >= 15 || widget.remainingAccounts.length == 0">\n                <option value="" disabled selected>+ ADD ACCOUNT</option>\n              </select>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/accounts-custom-calculation.tmpl.html",'<div widget-accounts-custom-calculation>\n\n  <div setting-organizations parent-widget="widget" ng-hide="true" deferred="::orgDeferred" />\n  <div setting-accounts-list parent-widget="widget" deferred="::accountsListDeferred" />\n  <div setting-formula parent-widget="widget" deferred="::formulaDeferred" />\n\n  <h3 ng-show="widget.hasEditAbility && !widget.isFormulaCorrect">\n    <a href="" ng-click="formulaModal.open()">Create a custom calculation</a>\n  </h3>\n  \n  <div class="price" ng-show="widget.isFormulaCorrect">\n    {{widget.evaluatedFormula}}\n  </div>\n  <div class="legend" ng-show="widget.isFormulaCorrect">\n    {{widget.legend}}\n  </div>\n\n</div>'),e.put("widgets/accounts-custom-calculation/formula.modal.html",'<div class="analytics modal-custom-calculation">\n  <div class="modal-header">\n    <div class="close" type="button" ng-click="cancel()" >×</div>\n    <h3>Custom Calculation</h3>\n  </div>\n\n  <div class="modal-body">\n    <div class="row">\n      <div class="col-sm-12">\n        <div class="alert alert-error" ng-show="errors">\n          <button class="close" ng-click="errors=\'\'">×</button>\n          <ul>\n            <li ng-repeat="error in errors">{{error}}</li>\n          </ul>\n        </div>\n      </div>\n    </div>\n\n    <div class="edit">\n      <div setting-organizations parent-widget="widget" class="part" deferred="::modalOrgDeferred" />\n    </div>\n\n    <p>Make a custom equation with your accounts, and save it as a widget. To create an equation, simply select your accounts in the list, and use the classical operators (example: ({1} + {2}) / {3})</p>\n\n    <div class=\'row\'>\n      <div ng-show="widget.isLoading" class=\'col-md-6 loader\' align="center">\n        <div>\n          <i class="fa fa-spinner fa-pulse fa-3x"></i>\n          <p>Your data is being retrieved...</p>\n        </div>\n      </div>\n\n      <div ng-hide="widget.isLoading" class=\'col-md-6\'>\n        <div class=\'widget-line\' ng-repeat=\'account in widget.selectedAccounts track by $index\'>\n          <div class=\'row\'>\n            <div class=\'col-md-6\'>\n              {{$index+1}} - {{account.name}}\n            </div>\n            <div class=\'col-md-6\'>\n              {{account.current_balance | mnoCurrency : account.currency}}\n              <button class="close" ng-click="removeAccountFromFormula(account)" ng-show="widget.hasEditAbility"><span class=\'fa fa-times-circle\'></span></button>\n            </div>\n          </div>\n        </div>\n\n        <div class=\'input-group\' ng-show="widget.hasEditAbility">\n          <select ng-model="movedAccount" ng-options="account.name + \' (\' + widget.formatAmount(account) + \')\' for account in widget.remainingAccounts" class=\'form-control\' ng-change=\'addAccountToFormula(movedAccount)\'><select>\n        </div>\n      </div>\n      \n      <div ng-hide="widget.isLoading" class=\'col-md-6\'>\n        <p>Type your formula just below:</p>\n        <input class=\'form-control\' ng-model="widget.formula">\n\n        <p>Result: {{widget.evaluatedFormula}}</p>\n        <p>Legend: {{widget.legend}}</p>\n      </div>\n    </div>\n  </div>\n\n  <div class="modal-footer">\n    <div class="row">\n      <div class="col-sm-12">\n        <button class="btn btn-gray" ng-click="cancel()" ng-hide="widget.isLoading" ng-disabled="isLoading">Cancel</button>\n        <button class="btn btn-warning" ng-click="proceed()" ng-hide="widget.isLoading" ng-disabled=\'!widget.isFormulaCorrect || widget.isLoading\'>\n          <i class="fa fa-spinner fa-pulse loader" ng-show="isLoading"></i>\n          Save\n        </button>\n      </div>\n      \n    </div>\n  </div>\n</div>\n'),e.put("widgets/accounts-expenses-revenue.tmpl.html",'<div widget-accounts-expenses-revenue>\n\n  <div ng-show="widget.isEditMode" class="edit">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n    <div ng-show="isDataFound">\n      <div setting-hist-mode parent-widget="widget" deferred="::histModeDeferred" on-toggle="widget.format()" />\n\n      <div class="chart-container">\n        <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n        \n        <div class="legend" ng-if="widget.isHistoryMode">\n          <span class="negative2">Expenses</span> -\n          <span class="positive2">Revenue</span>\n        </div>\n        \n        <div class="legend" ng-if="!widget.isHistoryMode">\n          <span class="negative2">Expenses: {{getCurrentExpenses() | mnoCurrency : getCurrency()}}</span>\n          </br>\n          <span class="positive2">Revenue: {{getCurrentRevenue() | mnoCurrency : getCurrency()}}</span>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/accounts-payable-receivable.tmpl.html",'<div widget-accounts-payable-receivable>\n\n  <div ng-show="widget.isEditMode" class="edit">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n    <div ng-show="isDataFound">\n      <div setting-hist-mode parent-widget="widget" deferred="::histModeDeferred" />\n\n      <div ng-hide="widget.isHistoryMode">\n        <div class="receivable">\n          <h3>Accounts Receivable</h3>\n          <div class="price positive2">\n             {{getCurrentReceivable() | mnoCurrency : getCurrency() : false}}\n          </div>\n          <div class="currency">{{getCurrency()}}</div>\n        </div>\n\n        <div class="payable">\n          <h3>Accounts Payable</h3>\n          <div class="price negative2">\n            {{getCurrentPayable() | mnoCurrency : getCurrency() : false}}\n          </div>\n          <div class="currency">{{getCurrency()}}</div>\n        </div>\n      </div>\n\n      <div class="chart-container" ng-class="{\'invisible\': !widget.isHistoryMode}">\n        <div impac-chart draw-trigger="drawTrigger.promise" deferred="chartDeferred"></div>\n        <div class="legend">\n          <span class="negative2">Payable</span> -\n          <span class="positive2">Receivable</span>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/accounts-profit-and-loss.tmpl.html",'<div widget-accounts-profit-and-loss>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row" >\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="6" max="12" class="settings width" deferred="::widthDeferred" />\n\n        <div class="widget-lines-container">\n          <div class="row widget-line header">\n            <div class="col-sm-8">{{(widget.metadata.hist_parameters.period || "Monthly") | titleize}} Profit and Loss</div>\n            <div class="col-sm-4 text-right">{{getLastDate() | date : "d-MMM"}}</div>\n          </div>\n          <div class="row widget-line total" ng-repeat="statement in widget.content.summary" >\n            <div class="row widget-line" ng-class="isSelected(statement) ? \'selected\' : null" >\n              <div class="col-sm-1" ng-click="toggleCollapsed(statement)"><i ng-show="statement.accounts" class="fa" ng-class="isCollapsed(statement) ? \'fa-plus-square-o\' : \'fa-minus-square-o\'" /></div>\n              <div class="col-sm-7" ng-click="toggleSelectedElement(statement)"><strong>{{getName(statement) | titleize}}</strong></div>\n              <div class="col-sm-4 text-right" ng-class="getClassColor(getLastValue(statement))" ng-click="toggleSelectedElement(statement)"><strong>{{getLastValue(statement) | mnoCurrency : statement.currency}}</strong></div>\n            </div>\n            <div collapse="isCollapsed(statement)">\n              <div class="row widget-line" ng-click="toggleSelectedElement(account)" ng-repeat="account in statement.accounts" ng-class="isSelected(account) ? \'selected\' : null" >\n                <div class="col-sm-1" />\n                <div class="col-sm-7">{{account.name}}</div>\n                <div class="col-sm-4 text-right" ng-class="getClassColor(getLastValue(account))">{{getLastValue(account) | mnoCurrency : account.currency}}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="right-panel text-center" ng-class="{\'col-md-6\': widget.isExpanded(), \'col-md-12 invisible\': !widget.isExpanded()}">\n\n        <div ng-show="hasElements()"\n          <h4>{{(widget.metadata.hist_parameters.period || "Monthly") | titleize}} Profit and Loss</h4>\n          <div ng-show="selectedElements.length < 2" class="legend">{{getName(selectedElements[0]) | titleize}}</div>\n\n          <div class="chart-container">\n            <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n          </div>\n\n          <div ng-show="selectedElements.length < 2" class="widget-lines-container">\n            <div class="row widget-line">\n              <span class="text-center" ng-repeat="date in dates track by $index">\n                <div ng-if="$index % 6 == 0 && $index > 0" class="clearfix dashed hidden-xs"></div>\n\n                <div class="col-sm-2" style="padding: 5px 0px;">\n                  <div class="row widget-line"><div class="col-sm-12" style="padding: 0px;">{{date | date : "d-MMM"}}</div></div>\n                  <div class="row widget-line"><div class="col-sm-12" ng-class="getClassColor(selectedElements[0].totals[$index])" style="padding: 0px;">{{selectedElements[0].totals[$index] | mnoCurrency : selectedElements[0].currency}}</div></div>\n                </div>\n              </span>\n            </div>\n          </div>\n\n          <div ng-hide="selectedElements.length < 2" class="widget-lines-container">\n            <div class="widget-line" ng-repeat="element in selectedElements">\n              <i style="float: right; margin-right: 10px;" ng-class="getClassColor(getLastValue(element))">{{getLastValue(element) | mnoCurrency : element.currency}}</i>\n              <i class="fa fa-circle" style="margin: 0px 8px; color: {{getElementChartColor($index)}}" />\n              {{getName(element) | titleize}}\n            </div>\n          </div>\n        </div>\n\n        <div ng-hide="hasElements()" class="no-element">\n          Select one or several account(s) or account(s) type(s) to display the corresponding PnL.\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/hr-employee-details.tmpl.html",'<div widget-hr-employee-details>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row" >\n\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="3" max="6" class="settings width" deferred="::widthDeferred" />\n        <div setting-param-selector parent-widget="widget" param="employee_uid" options="employeesOptions" selected="selectedEmployee" class="row title" deferred="::paramSelectorDeferred1" />\n\n        <div class="details-container">\n          <div class="row">\n            <div class="col-md-4"><label>Job Title</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().job_title || "-" }}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Company</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().company || getSingleCompanyName()}}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Phone</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().phone || "-" }}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Email</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().email || "-" }}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Date of birth</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().dob || "-" }}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Gender</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().gender || "-" }}</pre></div>\n          </div>\n        </div>\n      </div>\n\n      <div class="col-md-6 right-panel" ng-show="widget.isExpanded()">\n        <div class="legend">Salary calculation period: <span setting-param-selector parent-widget="widget" param="period" options="periodOptions" selected="period" deferred="::paramSelectorDeferred2" /></div>\n        <div class="details-container">\n          <div class="row">\n            <div class="col-md-4"><label>Salary</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().salary || "-" }}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Address</label></div>\n            <div class="col-md-8"><pre>{{formatAddress(getEmployee().address) || "-" }}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Job location</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().location || "-" }}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Supervisor</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().supervisor || "-" }}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Statuts</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().employment_status || "-" }}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Note</label></div>\n            <div class="col-md-8"><pre>{{getEmployee().note || "-" }}</pre></div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/hr-employees-list.tmpl.html",'<div widget-hr-employees-list>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" >\n\n      <div class="legend">\n        <strong>{{widget.content.total.employees}}</strong> employee{{widget.content.total.employees > 1 ? "s" : null}} - Average salary rate (<span setting-param-selector parent-widget="widget" param="period" options="periodOptions" selected="period" deferred="::paramSelectorDeferred"/>): <strong>{{widget.content.total.average_rate | mnoCurrency : widget.content.total.currency}}</strong>\n      </div>\n\n      <div class="widget-lines-container">\n        <div class="row widget-line header">\n          <div class="col-sm-2">Company</div>\n          <div class="col-sm-3">Employee</div>\n          <div class="col-sm-2">Title</div>\n          <div class="col-sm-3">Phone</div>\n          <div class="col-sm-2">Salary</div>\n        </div>\n        <div class="row widget-line" ng-repeat="employee in widget.content.employees" >\n          <div class="col-sm-2">{{employee.company || getSingleCompanyName()}}</div>\n          <div class="col-sm-3">{{employee.lastname}} {{employee.firstname}}</div>\n          <div class="col-sm-2"><i>{{employee.job_title}}</i></div>\n          <div class="col-sm-3">{{employee.phone}}</div>\n          <div class="col-sm-2"><i>{{getEmployeeSalary(employee)}}</i></div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/hr-leaves-balance.tmpl.html",'<div widget-hr-leaves-balance>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred"/>\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" >\n\n      <div setting-param-selector parent-widget="widget" param="employee_id" options="employeesOptions" selected="selectedEmployee" class="selector" deferred="::paramSelectorDeferred" />\n\n      <div class="widget-lines-container">\n        <div class="widget-line">\n          <i style="float: right; margin-right: 10px;">{{getEmployee().total_leaves}} h</i>\n          Accrued\n        </div>\n        <div class="widget-line">\n          <i style="float: right; margin-right: 10px;">{{getEmployee().total_timeoff}} h</i>\n          Used\n        </div>\n      </div>\n\n      <h3>Leave Balance</h3>\n      <div class="balance">{{(getEmployee().total_leaves - getEmployee().total_timeoff)}} hours</div>\n      <div class="legend">\n        <span>(from {{widget.content.dates[0] | date : "MMM-d"}} to {{widget.content.dates[widget.content.dates.length - 1] | date : "MMM-d"}})</span>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/hr-leaves-schedule.tmpl.html",'<div widget-hr-leaves-schedule>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound">\n\n      <div widget-component-calendar ng-model="eventSources"></div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/hr-payroll-summary.tmpl.html",'<div widget-hr-payroll-summary>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row" >\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="6" max="12" class="settings width" deferred="::widthDeferred" />\n\n        <div class="widget-lines-container">\n          <div class="row widget-line header">\n            <div class="col-sm-12">Payroll Summary - {{getPeriod()}}</div>\n          </div>\n          <div class="row widget-line total" ng-repeat="statement in widget.content.summary" >\n            <div class="row widget-line" ng-class="isSelected(statement) ? \'selected\' : null" >\n              <div class="col-sm-1" ng-click="toggleCollapsed(statement)"><i ng-show="statement.employees" class="fa" ng-class="isCollapsed(statement) ? \'fa-plus-square-o\' : \'fa-minus-square-o\'" /></div>\n              <div class="col-sm-7" ng-click="toggleSelectedElement(statement)"><strong>{{getName(statement) | titleize}}</strong></div>\n              <div class="col-sm-4 text-right" ng-click="toggleSelectedElement(statement)">\n                <strong>{{getLastValue(statement) | mnoCurrency : statement.currency}}</strong>\n              </div>\n            </div>\n            <div collapse="isCollapsed(statement)">\n              <div class="row widget-line" ng-click="toggleSelectedElement(employee)" ng-repeat="employee in statement.employees" ng-class="isSelected(employee) ? \'selected\' : null" >\n                <div class="col-sm-1" />\n                <div class="col-sm-7">{{employee.name}}</div>\n                <div class="col-sm-4 text-right">\n                  <span>{{getLastValue(employee) | mnoCurrency : employee.currency}}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="right-panel text-center" ng-class="{\'col-md-6\': widget.isExpanded(), \'col-md-12 invisible\': !widget.isExpanded()}">\n        \n        <div ng-show="hasElements()">\n        \n          <h4>{{(widget.content.hist_parameters.period || "Monthly") | titleize}} Payroll Summary</h4>\n          <div setting-hist-mode parent-widget="widget" deferred="::histModeDeferred" on-toggle="widget.format()"/>\n\n          <div class="chart-container">\n            <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n            <div ng-show="selectedElements.length < 2" class="legend">{{getName(selectedElements[0]) | titleize}}</div>\n          </div>\n\n          <div ng-show="selectedElements.length < 2" class="widget-lines-container">\n            <div ng-show="getTrackedField()" class="legend">{{getTrackedField()}}</div>\n            <div class="row widget-line">\n              <span class="text-center" ng-repeat="date in widget.content.dates track by $index">\n                <div ng-if="$index % 6 == 0 && $index > 0" class="clearfix dashed hidden-xs"></div>\n\n                <div class="col-sm-2" style="padding: 5px 0px;">\n                  <div class="row widget-line"><div class="col-sm-12" style="padding: 0px;">\n                    {{formatDate(date)}}\n                    </div></div>\n                  <div class="row widget-line"><div class="col-sm-12" style="padding: 0px;">\n                    {{selectedElements[0].totals[$index] | mnoCurrency : selectedElements[0].currency }}\n                  </div></div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div ng-hide="selectedElements.length < 2" class="widget-lines-container">\n\n            <div ng-if="widget.isHistoryMode" class="widget-line header">\n              <span ng-show="getTrackedField()">{{getTrackedField()}} - </span>From {{widget.content.dates[0] | date : "MMM-d"}} to {{widget.content.dates[widget.content.dates.length - 1] | date : "MMM-d"}}\n            </div>\n            <div ng-if="!widget.isHistoryMode" class="widget-line header">\n              <span ng-show="getTrackedField()">{{getTrackedField()}} - </span>{{getPeriod()}}\n            </div>\n\n            <div class="widget-line" ng-repeat="element in selectedElements">\n              <i style="float: right; margin-right: 10px;">\n                <span ng-if="widget.isHistoryMode">{{getTotalSum(element) | mnoCurrency : element.currency}}</span>\n                <span ng-if="!widget.isHistoryMode">{{getLastValue(element) | mnoCurrency : element.currency}}</span>\n              </i>\n              <i class="fa fa-circle" style="margin: 0px 8px; color: {{getElementChartColor($index)}}" />\n              {{getName(element) | titleize}}\n            </div>\n\n          </div>\n\n        </div>\n\n        <div ng-hide="hasElements()" class="no-element">\n          Select one or several employee(s) or category(ies) to display the corresponding summary\n        </div>\n      \n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/hr-payroll-taxes.tmpl.html",'<div widget-hr-payroll-taxes>\n\n  <div ng-show="widget.isEditMode" class="edit">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n    <div ng-show="isDataFound">\n      <div setting-hist-mode parent-widget="widget" deferred="::histModeDeferred" />\n\n      <div ng-hide="widget.isHistoryMode" class="current">\n        <div class="price">{{getCurrentPrice() | mnoCurrency : getCurrency() : false}}</div>\n        <div class="currency">{{getCurrency()}}</div>\n        <div class="legend">Taxes upon workforce costs<br />{{getPeriod()}}</div>\n      </div>\n\n      <div class="history chart-container" ng-class="{\'invisible\': !widget.isHistoryMode}">\n        <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n        <div class="legend">Taxes upon workforce costs</div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>\n'),e.put("widgets/hr-salaries-summary.tmpl.html",'<div widget-hr-salaries-summary>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div align="center" ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row">\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="3" max="6" class="settings width" deferred="::widthDeferred" />\n\n        <h3 class="left">Average Salary Rate</h3>\n        <div class="price">\n           {{widget.content.total.average_rate | mnoCurrency : widget.content.total.currency}}\n        </div>\n        <div class="currency" setting-param-selector parent-widget="widget" param="period" options="periodOptions" selected="period" deferred="::paramSelectorDeferred1"/>\n        <div class="legend">\n          <span>({{widget.content.total.employees}} employee{{widget.content.total.employees > 1 ? "s" : null}} with known salary)</span>\n        </div>\n      </div>\n\n      <div class="right-panel" ng-class="{\'col-md-12 invisible\': !widget.isExpanded(), \'col-md-6\': widget.isExpanded()}">\n        <h3 class="right">Filter: <span setting-param-selector parent-widget="widget" param="filter" options="filterOptions" selected="filter" deferred="::paramSelectorDeferred2"/></h3>\n        <div class="chart-container">\n          <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n        </div>\n        <div class="widget-lines-container">\n          <div class="widget-line" ng-repeat="data in widget.content.summary.data">\n            <i style="float: right; margin-right: 10px;"><b>{{data.value | mnoCurrency : widget.content.total.currency}} (av.)</b></i>\n            <i ng-hide="widget.content.summary.filter==\'age_range\'" class="fa fa-circle" style="margin: 0px 8px; color: {{getColorByIndex($index)}}" />\n            {{data.label}}\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/hr-superannuation-accruals.tmpl.html",'<div widget-hr-superannuation-accruals>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row" >\n\n      <div setting-param-selector parent-widget="widget" param="employee_id" options="employeesOptions" selected="selectedEmployee" class="currency" deferred="::paramSelectorDeferred" />\n\n      <h3>Superannuation Balance</h3>\n      <div class="price">{{getEmployee().total_super | mnoCurrency : getEmployee().currency}}</div>\n      <div class="legend">\n        <span>(from {{widget.content.dates[0] | date : \'MMM-d\'}} to {{widget.content.dates[widget.content.dates.length - 1] | date : \'MMM-d\'}})</span>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/hr-timesheets.tmpl.html",'<div widget-hr-timesheets>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound">\n\n      <div setting-param-selector parent-widget="widget" param="employee_id" options="employeesOptions" selected="selectedEmployee" class="currency" deferred="::paramSelectorDeferred" />\n\n      <div class="widget-lines-container">\n        <div class="row widget-line header">\n          <div class="col-sm-12">From {{widget.content.dates[0] | date : \'MMM-d\'}} to {{widget.content.dates[widget.content.dates.length - 1] | date : \'MMM-d\'}}</div>\n        </div>\n        <div class="row widget-line total" >\n          <div class="row widget-line" >\n            <div class="col-sm-1" ng-click="toggleCollapsed(\'total_time_worked\')" style="cursor: pointer;"><i class="fa" ng-class="isCollapsed(\'total_time_worked\') ? \'fa-plus-square-o\' : \'fa-minus-square-o\'" /></div>\n            <div class="col-sm-7"><strong>Total Time Worked</strong></div>\n            <div class="col-sm-4 text-right"><strong>{{getEmployeeTimeWorked()}} h</strong></div>\n          </div>\n          <div collapse="isCollapsed(\'total_time_worked\')">\n            <div class="row widget-line">\n              <div class="col-sm-1" />\n              <div class="col-sm-11"><i>Activities detail not found</i></div>\n            </div>\n          </div>\n        </div>\n\n        <div class="row widget-line total" >\n          <div class="row widget-line" >\n            <div class="col-sm-1" ng-click="toggleCollapsed(\'total_time_of\')" style="cursor: pointer;"><i class="fa" ng-class="isCollapsed(\'total_time_of\') ? \'fa-plus-square-o\' : \'fa-minus-square-o\'" /></div>\n            <div class="col-sm-7"><strong>Total Time Off</strong></div>\n            <div class="col-sm-4 text-right"><strong>{{getEmployeeTimeOff()}} h</strong></div>\n          </div>\n          <div collapse="isCollapsed(\'total_time_of\')">\n            <div class="row widget-line">\n              <div class="col-sm-1" />\n              <div class="col-sm-7">PTO</div>\n              <div class="col-sm-4 text-right">0 h</div>\n            </div>\n            <div class="row widget-line">\n              <div class="col-sm-1" />\n              <div class="col-sm-7">Vacation</div>\n              <div class="col-sm-4 text-right">0 h</div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/hr-workforce-summary.tmpl.html",'<div widget-hr-workforce-summary>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div align="center" ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row">\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="3" max="6" class="settings width" deferred="::widthDeferred" />\n\n        <h3 class="left">Total Workforce</h3>\n        <div class="price">\n           {{getTotalWorkforce() | mnoCurrency : getCurrency()}}\n        </div>\n        <div class="currency" setting-param-selector parent-widget="widget" param="period" options="periodOptions" selected="period" deferred="::paramSelectorDeferred1"/>\n        <div class="legend">\n          <span>({{getNumberOfEmployees()}} employee{{getNumberOfEmployees() > 1 ? \'s\' : null}} with known salary)</span>\n        </div>\n      </div>\n\n      <div class="right-panel" ng-class="{\'col-md-12 invisible\': !widget.isExpanded(), \'col-md-6\': widget.isExpanded()}">\n        <h3 class="right">Filter: <span setting-param-selector parent-widget="widget" param="filter" options="filterOptions" selected="filter" deferred="::paramSelectorDeferred2"/></h3>\n        <div class="chart-container">\n          <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n        </div>\n        <div class="widget-lines-container">\n          <div class="widget-line" ng-repeat="data in widget.content.summary.data">\n            <i style="float: right; margin-right: 10px;"><b>{{((data.value / widget.content.total.amount)*100).toFixed()}}%</b></i>\n            <i class="fa fa-circle" style="margin: 0px 8px; color: {{getColorByIndex($index)}}" />\n            {{widget.content.summary.filter == "salary_range" ? formatSalaryRange(data) : data.label}}\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/invoices-aged-payables-receivables.tmpl.html",'<div widget-invoices-aged-payables-receivables>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row" >\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="6" max="12" class="settings width" deferred="::widthDeferred" />\n\n        <div class="widget-lines-container">\n          <div class="row widget-line header">\n            <div class="col-sm-8">Aged Payables & Receivables</div>\n            <div class="col-sm-4 text-right">{{widget.content.dates[0] | date : \'MMM-d\'}} to {{widget.content.dates[widget.content.dates.length - 1] | date : \'MMM-d\'}}</div>\n          </div>\n\n          <!-- Payables -->\n          <div class="row widget-line total">\n            <div class="row widget-line" ng-class="isSelected(widget.content.payables) ? \'selected\' : null" >\n              <div class="col-sm-1" ng-click="toggleCollapsed(widget.content.payables)">\n                <i ng-show="widget.content.payables.suppliers" class="fa" ng-class="isCollapsed(widget.content.payables) ? \'fa-plus-square-o\' : \'fa-minus-square-o\'" />\n              </div>\n              <div class="col-sm-7" ng-click="toggleSelectedElement(widget.content.payables)">\n                <strong>Aged Payables</strong>\n              </div>\n              <div class="col-sm-4 text-right" ng-click="toggleSelectedElement(widget.content.payables)">\n                <strong>{{getTotalSum(widget.content.payables) | mnoCurrency : widget.content.payables.currency}}</strong>\n              </div>\n            </div>\n            <div ng-hide="isCollapsed(widget.content.payables)">\n              <div class="row widget-line" ng-click="toggleSelectedElement(supplier)" ng-repeat="supplier in widget.content.payables.suppliers" ng-class="isSelected(supplier) ? \'selected\' : null" >\n                <div class="col-sm-1" />\n                <div class="col-sm-7">{{supplier.name}}</div>\n                <div class="col-sm-4 text-right">\n                  <span>{{getTotalSum(supplier) | mnoCurrency : supplier.currency}}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <!-- Receivables -->\n          <div class="row widget-line total">\n            <div class="row widget-line" ng-class="isSelected(widget.content.receivables) ? \'selected\' : null" >\n              <div class="col-sm-1" ng-click="toggleCollapsed(widget.content.receivables)">\n                <i ng-show="widget.content.receivables.customers" class="fa" ng-class="isCollapsed(widget.content.receivables) ? \'fa-plus-square-o\' : \'fa-minus-square-o\'" />\n              </div>\n              <div class="col-sm-7" ng-click="toggleSelectedElement(widget.content.receivables)">\n                <strong>Aged Receivables</strong>\n              </div>\n              <div class="col-sm-4 text-right" ng-click="toggleSelectedElement(widget.content.receivables)">\n                <strong>{{getTotalSum(widget.content.receivables) | mnoCurrency : widget.content.receivables.currency}}</strong>\n              </div>\n            </div>\n            <div ng-hide="isCollapsed(widget.content.receivables)">\n              <div class="row widget-line" ng-click="toggleSelectedElement(customer)" ng-repeat="customer in widget.content.receivables.customers" ng-class="isSelected(customer) ? \'selected\' : null" >\n                <div class="col-sm-1" />\n                <div class="col-sm-7">{{customer.name}}</div>\n                <div class="col-sm-4 text-right">\n                  <span>{{getTotalSum(customer) | mnoCurrency : customer.currency}}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="right-panel text-center" ng-class="{\'col-md-6\': widget.isExpanded(), \'col-md-12 invisible\': !widget.isExpanded()}">\n          \n        <div ng-show="hasElements()">\n\n          <h4>{{(widget.content.hist_parameters.period || "Monthly") | titleize}} Aged Payables and Receivables</h4>\n\n          <div ng-show="selectedElements.length < 2" class="legend">{{getName(selectedElements[0]) | titleize}}</div>\n\n          <div class="chart-container">\n            <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n          </div>\n\n          <div ng-show="selectedElements.length < 2" class="widget-lines-container">\n            <div class="row widget-line">\n              <span class="text-center" ng-repeat="date in widget.content.dates track by $index">\n                <div ng-if="$index % 6 == 0 && $index > 0" class="clearfix dashed hidden-xs"></div>\n\n                <div class="col-sm-2" style="padding: 5px 0px;">\n                  <div class="row widget-line"><div class="col-sm-12" style="padding: 0px;">\n                    {{date | date : \'MMM-d\'}}\n                  </div></div>\n                  <div class="row widget-line"><div class="col-sm-12" style="padding: 0px;">\n                    {{selectedElements[0].totals[$index] | mnoCurrency : selectedElements[0].currency}}\n                  </div></div>\n                </div>\n              </span>\n            </div>\n          </div>\n\n          <div ng-hide="selectedElements.length < 2" class="widget-lines-container">\n\n            <div class="widget-line header">\n              Total from {{widget.content.dates[0] | date : \'MMM-d\'}} to {{widget.content.dates[widget.content.dates.length - 1] | date : \'MMM-d\'}}\n            </div>\n\n            <div class="widget-line" ng-repeat="element in selectedElements">\n              <i style="float: right; margin-right: 10px;">\n                <span>{{getTotalSum(element) | mnoCurrency : element.currency}}</span>\n              </i>\n              <i class="fa fa-circle" style="margin: 0px 8px; color: {{getElementChartColor($index)}}" />\n              {{getName(element) | titleize}}\n            </div>\n\n          </div>\n\n        </div>\n\n        <div ng-hide="hasElements()" class="no-element">\n          Select one or several account(s) or category(ies) to display the payables/receivables evolution(s).\n        </div>\n\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/invoices-list.accessible.tmpl.html",'<div widget-invoices-list>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <table class="table widget-lines-container" ng-hide="widget.isEditMode">\n\n    <!-- Header line -->\n    <tr class="widget-line header">\n      <td>{{entityTypeCap}}</td>\n      <td>Paid</td>\n      <td>Due</td>\n      <td>Invoiced</td>\n    </tr>\n\n    <!-- Data not found line -->\n    <tr class="widget-line" ng-hide="isDataFound">\n      <td>No {{orderBy}}invoice found for your {{entityType}}</td>\n    </tr>\n    \n    <!-- Content lines -->\n    <tr class="widget-line" ng-show="isDataFound" ng-repeat="entity in widget.content.entities">\n      <td>{{entity.name}}</td>\n      <td><i>{{entity.total_paid | mnoCurrency : entity.currency}}</i></td>\n      <td><i>{{entity.total_due | mnoCurrency : entity.currency}}</i></td>\n      <td><i>{{entity.total_invoiced | mnoCurrency : entity.currency}}</i></td>\n    </tr>\n\n  </table>\n\n</div>\n'),e.put("widgets/invoices-list.tmpl.html",'<div widget-invoices-list>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode" class="widget-lines-container">\n\n    <!-- Header line -->\n    <!-- when large widget -->\n    <div class="row widget-line header" ng-show="widget.width > 3">\n      <div class="col-sm-4">{{entityTypeCap}}</div>\n      <div class="col-sm-7">\n        <div class="col-xs-4">Paid</div>\n        <div class="col-xs-4">Due</div>\n        <div class="col-xs-4">Invoiced</div>\n      </div>\n    </div>\n\n    <!-- when small widget -->\n    <div class="row widget-line header" ng-hide="widget.width > 3">\n      <div class="col-xs-7">{{entityTypeCap}}</div>\n      <div class="col-xs-4" ng-show="orderBy == \'paid \'">Paid</div>\n      <div class="col-xs-4" ng-show="orderBy == \'due \'">Due</div>\n      <div class="col-xs-4" ng-hide="orderBy == \'paid \' || orderBy == \'due \'">Invoiced</div>\n    </div>\n\n    <!-- Data not found line -->\n    <div class="row widget-line" ng-hide="isDataFound">\n      <div class="col-xs-11">No {{orderBy}}invoice found for your {{entityType}}</div>\n    </div>\n\n    <!-- Content lines -->\n    <!-- when large widget -->\n    <div ng-if="widget.width > 3" class="row widget-line" ng-show="isDataFound" ng-repeat="entity in widget.content.entities" tooltip-placement="top" tooltip-html-unsafe="{{getInvoices(entity)}}" tooltip-animation="false" tooltip-append-to-body="true" tooltip-class="impac-widgets-tooltip">\n      <div class="col-sm-4">{{entity.name}}</div>\n      <div class="col-sm-7">\n        <div class="col-xs-4"><i>{{entity.total_paid | mnoCurrency : entity.currency}}</i></div>\n        <div class="col-xs-4"><i>{{entity.total_due | mnoCurrency : entity.currency}}</i></div>\n        <div class="col-xs-4"><i>{{entity.total_invoiced | mnoCurrency : entity.currency}}</i></div>\n      </div>\n      <div class="col-sm-1"><i class="fa fa-info-circle" /></div>\n    </div>\n\n    <!-- when small widget -->\n    <div ng-if="widget.width <= 3" class="row widget-line" ng-show="isDataFound" ng-repeat="entity in widget.content.entities" tooltip-placement="top" tooltip-html-unsafe="{{getInvoices(entity)}}" tooltip-animation="false" tooltip-append-to-body="true" tooltip-class="impac-widgets-tooltip">\n      <div class="col-xs-7">{{entity.name}}</div>\n      <div class="col-xs-4" ng-show="orderBy == \'paid \'"><i>{{entity.total_paid | mnoCurrency : entity.currency}}</i></div>\n      <div class="col-xs-4" ng-show="orderBy == \'due \'"><i>{{entity.total_due | mnoCurrency : entity.currency}}</i></div>\n      <div class="col-xs-4" ng-hide="orderBy == \'paid \' || orderBy == \'due \'"><i>{{entity.total_invoiced | mnoCurrency : entity.currency}}</i></div>\n      <div><i class="fa fa-info-circle" /></div>\n    </div>\n\n  </div>\n\n</div>\n'),e.put("widgets/invoices-summary.tmpl.html",'<div widget-invoices-summary>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-chart-filters parent-widget="widget" class="part" deferred="::chartFiltersDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div align="center" ng-hide="widget.isEditMode">\n    <div ng-show="isDataFound" class="chart-container">\n      <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n      <div class="legend">\n        <span>{{widget.content.legend}}</span>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-aged.tmpl.html",'<div widget-sales-aged>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="center">\n\n      <div setting-param-selector parent-widget="widget" param="filter" options="filterOptions" selected="filter" no-reload truncate-no="60" on-select="widget.format()" style="text-align: center;" deferred="::paramSelectorDeferred"/>\n\n      <div class="chart-container">\n        <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n      </div>\n      <div class="legend">From {{widget.content.dates[0]}} to {{getLastDate()}}</div>\n\n      <div class="widget-lines-container">\n        <div class="row widget-line">\n          <span class="text-center" ng-repeat="date in formattedDates track by $index">\n            <div ng-if="$index % 6 == 0 && $index > 0" class="clearfix dashed hidden-xs"></div>\n\n            <div class="col-sm-2" style="padding: 5px 0px;">\n              <div class="row widget-line"><div class="col-sm-12" style="padding: 0px;">{{date}}</div></div>\n            \n              <div class="row widget-line">\n                <div ng-hide="filter.value == \'quantity_sold\'" class="col-sm-12" ng-class="getClassColor(getTotal($index - 1),getTotal($index))" style="padding: 0px;">\n                  {{getTotal($index) | mnoCurrency : widget.content.currency : false}}\n                  <br />\n                  {{widget.content.currency}}\n                </div>\n                <div ng-show="filter.value == \'quantity_sold\'" class="col-sm-12" ng-class="getClassColor(getTotal($index - 1),getTotal($index))" style="padding: 0px;">\n                  {{getTotal($index)}}\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      \n    </div>\n  </div>\n  <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n</div>\n'),e.put("widgets/sales-break-even.tmpl.html",'<div widget-sales-break-even>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="align-center">\n\n      <div class="legend">From {{widget.content.period.from | date : \'d MMM yyyy\'}} to {{widget.content.period.to | date : \'d MMM yyyy\'}}</div>\n\n      <div class="block to-date">\n        <div class="title">Sales to Date</div>\n        <div class="price">{{widget.content.sales.to_date | mnoCurrency : widget.content.currency : false}}</div>\n        Target: <span class="edit-target" style="float: right;" editable-text="threshold" buttons="no" onaftersave="updateSettings()">\n          {{threshold | mnoCurrency : widget.content.currency : false}}\n        </span>\n      </div>\n\n      <div ng-show="widget.content.break_even" class="block to-breakeven">\n        <div class="title">Projection to Break-Even</div>\n        <span ng-show="isTargetMet()">Your sales already exceed your target by:</span>\n        <div class="price">{{getVariance() | mnoCurrency : widget.content.currency : false}}</div>\n        <span ng-hide="isTargetMet()">\n          Projected date: <span style="float: right;">{{getProjectedDate() | date : \'d-MM-yy\'}}</span>\n          <br />\n          Opportunities to close: <span style="float: right;">{{getOpportunitiesToClose()}}</span>\n        </span>\n      </div>\n      <div ng-show="widget.content.break_even" class="legend">{{widget.content.break_even.eligible_opportunities}} eligible opportunities</div>\n\n      <div ng-hide="widget.content.break_even" class="block to-breakeven">\n        <span class="edit-target" editable-text="threshold" buttons="no" onaftersave="updateSettings()">\n          <div class="define-text">Click to define your sales target</div>\n        </span>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-comparison.tmpl.html",'<div widget-sales-comparison>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row" >\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="6" max="12" class="settings width" deferred="::widthDeferred" />\n\n        <div class="row legend center">\n          Compare by: <div setting-param-selector parent-widget="widget" style="display: inline;" param="criteria" options="criteriaOptions" selected="criteria" truncate-no="30" deferred="::paramSelectorDeferred1" />\n           |\n          See: <div setting-param-selector parent-widget="widget" style="display: inline;" param="filter" options="filterOptions" selected="filter" truncate-no="30" on-select="widget.format()" no-reload deferred="::paramSelectorDeferred2" />\n        </div>\n\n        <div class="widget-lines-container" style="max-height: 530px;">\n          <div class="row widget-line header">\n            <div class="col-sm-12">Total sales from {{widget.content.dates[0]}} to {{getLastDate()}}</div>\n          </div>\n          <div class="row widget-line total" ng-repeat="statement in widget.content.sales_comparison" >\n            <div class="row widget-line" ng-class="isSelected(statement) ? \'selected\' : null" >\n              <div class="col-sm-1" ng-click="toggleCollapsed(statement)"><i ng-show="statement.sales" class="fa" ng-class="isCollapsed(statement) ? \'fa-plus-square-o\' : \'fa-minus-square-o\'" /></div>\n              <div class="col-sm-7" ng-click="toggleSelectedElement(statement)"><strong>{{statement.name | titleize}}</strong></div>\n              <div ng-show="filter.value == \'quantity_sold\'" class="col-sm-4 text-right" ng-click="toggleSelectedElement(statement)"><strong>{{getTotalForPeriod(statement)}}</strong></div>\n              <div ng-hide="filter.value == \'quantity_sold\'" class="col-sm-4 text-right" ng-click="toggleSelectedElement(statement)"><strong>{{getTotalForPeriod(statement) | mnoCurrency : statement.currency}}</strong></div>\n            </div>\n            <div collapse="isCollapsed(statement)">\n              <div class="row widget-line" ng-click="toggleSelectedElement(sale)" ng-repeat="sale in statement.sales" ng-class="isSelected(sale) ? \'selected\' : null" >\n                <div class="col-sm-1" />\n                <div class="col-sm-7">{{sale.name}}</div>\n                <div ng-show="filter.value == \'quantity_sold\'" class="col-sm-4 text-right">{{getTotalForPeriod(sale)}}</div>\n                <div ng-hide="filter.value == \'quantity_sold\'" class="col-sm-4 text-right">{{getTotalForPeriod(sale) | mnoCurrency : sale.currency}}</div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="right-panel text-center" ng-class="{\'col-md-6\': widget.isExpanded(), \'col-md-12 invisible\': !widget.isExpanded()}">\n\n        <div ng-show="hasElements()">\n          <div class="chart-container">\n            <div impac-chart draw-trigger="::drawTrigger.promise" deferred="::chartDeferred"></div>\n          </div>\n\n          <div class="widget-lines-container">\n            <div class="row widget-line header">\n              <div class="col-sm-12">Total sales from {{widget.content.dates[0]}} to {{getLastDate()}}</div>\n            </div>\n            <div class="widget-line" ng-repeat="element in selectedElements">\n              <i ng-show="filter.value == \'quantity_sold\'" style="float: right; margin-right: 10px;">{{getTotalForPeriod(element)}}</i>\n              <i ng-hide="filter.value == \'quantity_sold\'" style="float: right; margin-right: 10px;">{{getTotalForPeriod(element) | mnoCurrency : element.currency}}</i>\n              <i class="fa fa-circle" style="margin: 0px 8px; color: {{getElementChartColor($index)}}" />\n              {{element.name | titleize}}\n            </div>\n          </div>\n        </div>\n\n        <div ng-hide="hasElements()" class="no-element">\n          Select one or several sales category(ies) to display the corresponding comparison.\n        </div>\n\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-customer-details.tmpl.html",'<div widget-sales-customer-details>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" deferred="::orgDeferred" />\n    <div setting-time-range parent-widget="widget" class="part" deferred="::timeRangeDeferred" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row" >\n\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="3" max="6" class="settings width" deferred="::widthDeferred" />\n        <div setting-param-selector parent-widget="widget" param="customer_uid" options="customersOptions" selected="selectedCustomer" class="row title" deferred="::paramSelectorDeferred" />\n\n        <div class="details-container">\n          <div class="row">\n            <div class="col-md-4"><label>Email</label></div>\n            <div class="col-md-8"><pre>{{getCustomer().email}}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Phone</label></div>\n            <div class="col-md-8"><pre>{{getCustomer().phone}}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Website</label></div>\n            <div class="col-md-8"><pre>{{getCustomer().website}}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Contact</label></div>\n            <div class="col-md-8"><pre>{{getCustomer().contact}}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>City</label></div>\n            <div class="col-md-8"><pre>{{getCustomer().city}}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-4"><label>Country</label></div>\n            <div class="col-md-8"><pre>{{getCustomer().country}}</pre></div>\n          </div>\n        </div>\n      </div>\n\n      <div class="col-md-6 right-panel" ng-show="widget.isExpanded()">\n        <div class="details-container">\n          <div class="row" style="border-bottom: solid 1px #e6e6e6; margin-bottom: 10px; padding-bottom: 5px;">\n            <div class="col-md-3"><label>Address</label></div>\n            <div class="col-md-9"><pre>{{formatAddress(getCustomer().full_address)}}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-12 center legend">From {{getFromDate() | date : \'d MMM yyyy\'}} to {{getToDate() | date : \'d MMM yyyy\'}}:</div>\n          </div>\n          <div class="row">\n            <div class="col-md-5"><label>Total invoiced</label></div>\n            <div class="col-md-7"><pre>{{getCustomer().total_invoiced | mnoCurrency : getCustomer().currency}}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-5"><label>Total paid</label></div>\n            <div class="col-md-7"><pre>{{getCustomer().total_paid | mnoCurrency : getCustomer().currency}}</pre></div>\n          </div>\n          <div class="row">\n            <div class="col-md-5"><label>Total due</label></div>\n            <div class="col-md-7"><pre>{{getCustomer().total_due | mnoCurrency : getCustomer().currency}}</pre></div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="::widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-cycle.tmpl.html",'<div widget-sales-cycle>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n    <div setting-params-picker options="statusOptions" param="status_selection" parent-widget="widget" class="part" />\n    <div setting-time-range parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div align="center" ng-hide="widget.isEditMode">\n    <div class="chart-container" ng-class="{\'invisible\': !isDataFound}">\n      <div impac-chart draw-trigger="drawTrigger.promise" deferred="chartDeferred"></div>\n      <div class="legend">\n        <span>Your sales cycle represents how much time your leads stay set to each status</span>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-forecast.tmpl.html",'<div widget-sales-forecast>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" >\n\n      <div class="chart-container">\n        <div impac-chart draw-trigger="drawTrigger.promise" deferred="chartDeferred"></div>\n      </div>\n\n      <div class="widget-lines-container" style="max-height: 340px;">\n        <div class="row widget-line header">\n          <div class="col-sm-12">Projection on the next 6 months</div>\n        </div>\n        <div class="row widget-line total" ng-repeat="date in widget.content.dates.slice(6) track by $index" ng-init="collapsed = true" >\n          <div class="row widget-line" >\n            <div class="col-sm-6" ng-click="collapsed = !collapsed">{{date | date : \'MMMM yyyy\'}}</div>\n            <div class="col-sm-6 text-right"><strong>{{widget.content.totals.slice(6)[$index] | mnoCurrency : widget.content.currency}}</strong></div>\n          </div>\n          <div collapse="collapsed">\n            <div class="row widget-line" ng-repeat="opp in widget.content.opportunities.slice(6)[$index]" >\n              <div class="col-sm-6">{{opp.name}}</div>\n              <div class="col-sm-6 text-right">{{getOpportunityAmount(opp) | mnoCurrency : getOpportunityCurrency(opp)}}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-growth.tmpl.html",'<div widget-sales-growth>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n    <div setting-time-range parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound">\n\n      <div class="selector">\n        <div setting-param-selector parent-widget="widget" param="product" options="productOptions" selected="product"/>\n        <div ng-show="product.value != -1" setting-param-selector parent-widget="widget" param="filter" options="filterOptions" selected="filter"/>\n      </div>\n\n      <div class="chart-container" ng-class="{\'invisible\': !isDataFound || product.value==-1}">\n        <div impac-chart draw-trigger="drawTrigger.promise" deferred="chartDeferred"></div>\n      </div>\n\n      <div ng-show="product.value != -1" class="legend text-center">{{getSelectedProduct().name}}</div>\n      <div class="price text-center" ng-hide="isDataQuantity || product.value == -1" tooltip="total for last period">{{getCurrentValue() | mnoCurrency : getSelectedProduct().currency}}</div>\n      <div class="price text-center" ng-show="isDataQuantity && product.value != -1" tooltip="total for last period">{{getCurrentValue()}}</div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-leads-list.tmpl.html",'<div widget-sales-leads-list>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound">\n\n      <div class="widget-lines-container">\n        <div class="row widget-line total" ng-repeat="lead in widget.content.leads" tooltip-trigger="mouseenter" tooltip-placement="top" tooltip-html-unsafe="{{getLeadDescription(lead)}}" tooltip-animation="false" tooltip-append-to-body="true" tooltip-class="impac-widgets-tooltip">\n          <div class="row widget-line" >\n            <div class="col-sm-7">\n              {{lead.first_name | titleize}} {{lead.last_name | titleize}}\n              <span ng-show="lead.organization">({{lead.organization}})</span>\n            </div>\n            <div class="col-sm-5 text-right"><strong>{{lead.lead_status | titleize}}</strong></div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-leads-funnel.tmpl.html",'<div widget-sales-leads-funnel>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n    <div setting-params-picker options="statusOptions" param="status_selection" parent-widget="widget" class="part" />\n    <div setting-time-range parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row" >\n\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="6" max="12" class="settings width" />\n\n        <div class="legend">Your leads sales funnel from {{widget.content.from | date : \'d MMM yyyy\'}} to {{widget.content.to | date : \'d MMM yyyy\'}}</div>\n\n        <div class="funnel-container">\n          <div class="tile" ng-repeat="elem in funnel" ng-click="toggleSelectStatus(elem.status)">\n            <div class="colored-area" ng-style="elem.coloredWidth" ng-class="isSelected(elem.status) ? \'selected\' : \'\'">{{elem.number}}</div>\n            <div class="main-text" ng-style="elem.statusWidth">{{elem.status | titleize}}</div>\n          </div>\n        </div>\n      </div>\n\n      <div class="col-md-6 right-panel text-center" ng-show="widget.isExpanded()">\n\n        <div ng-hide="selectedStatus" class="currency">\n          Select a status to display a list of the corresponding leads\n        </div>\n\n        <div ng-show="selectedStatus" class="widget-lines-container">\n          <div class="row widget-line total" ng-repeat="lead in getSelectedLeads()" tooltip-trigger="mouseenter" tooltip-placement="top" tooltip-html-unsafe="{{getLeadDescription(lead)}}" tooltip-animation="false"  tooltip-append-to-body="true" tooltip-class="impac-widgets-tooltip">\n            <div class="row widget-line" >\n              <div class="col-sm-7">\n                {{lead.first_name | titleize}} {{lead.last_name | titleize}}\n                <span ng-show="lead.organization">({{lead.organization}})</span>\n              </div>\n              <div class="col-sm-5 text-right"><strong>{{lead.lead_status | titleize}}</strong></div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-list.tmpl.html",'<div widget-sales-list>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound">\n\n      <div class="selector">\n        See: <span setting-param-selector parent-widget="widget" param="filter" options="filterOptions" selected="filter"/> for this <span setting-param-selector parent-widget="widget" param="period" options="periodOptions" selected="period"/>\n        ({{widget.content.hist_parameters.from | date : "d MMM"}} to {{widget.content.hist_parameters.to | date : "d MMM"}})\n      </div>\n\n      <div class="widget-lines-container">\n        <div class="row widget-line total" ng-repeat="company in widget.content.summary" >\n          <div class="row widget-line" >\n            <div class="col-sm-1" ng-click="toggleCollapsed(company.name)" style="cursor: pointer;"><i class="fa" ng-class="isCollapsed(company.name) ? \'fa-plus-square-o\' : \'fa-minus-square-o\'" /></div>\n            <div class="col-sm-7"><strong>{{company.name | titleize}}</strong></div>\n            <div class="col-sm-4 text-right" ng-show="{{filter.value.match(\'quantity\')}}"><strong>{{company.total}}</strong></div>\n            <div class="col-sm-4 text-right" ng-hide="{{filter.value.match(\'quantity\')}}"><strong>{{company.total | mnoCurrency : company.currency}}</strong></div>\n          </div>\n          <div collapse="isCollapsed(company.name)">\n            <div class="row widget-line" ng-repeat="product in company.products" >\n              <div class="col-sm-1" />\n              <div class="col-sm-7">{{product.name | titleize}}</div>\n              <div class="col-sm-4 text-right" ng-show="{{filter.value.match(\'quantity\')}}"><strong>{{product.total}}</strong></div>\n              <div class="col-sm-4 text-right" ng-hide="{{filter.value.match(\'quantity\')}}"><strong>{{product.total | mnoCurrency : product.currency}}</strong></div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-margin.tmpl.html",'<div widget-sales-margin>\n\n  <div ng-show="widget.isEditMode" class="edit">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n    <div setting-time-range parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n    <div ng-show="isDataFound">\n      <div setting-hist-mode parent-widget= "widget" />\n\n      <div ng-hide="widget.isHistoryMode" class="current">\n        <div class="price">\n           {{ getTotalMargin() | mnoCurrency : getCurrency()}}\n        </div>\n        <div class="legend">\n          Total sold - Total purchased\n          </br>\n          {{getTimeSpan()}}\n          </br>\n          <div setting-param-selector parent-widget="widget" param="filter" options="filterOptions" selected="filter" no-reload />\n        </div>\n      </div>\n\n      <div class="history chart-container" ng-class="{\'invisible\': !widget.isHistoryMode}">\n        <div impac-chart draw-trigger="drawTrigger.promise" deferred="chartDeferred"></div>\n        <div class="legend">Total sold - Total purchased</div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>\n'),e.put("widgets/sales-number-of-leads.tmpl.html",'<div widget-sales-number-of-leads>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="align-center">\n      <div class="selector">\n        Leads for this <span setting-param-selector parent-widget="widget" param="period" options="periodOptions" selected="period"/>\n      </div>\n\n      <div class="stats">\n        <div class="stat row align-left" ng-repeat="carac in [\'new\', \'converted\', \'lost\']">\n          <div class="col-md-6 title" style="padding: 0px;">{{carac | titleize}}</div>\n          <div class="col-md-6" style="padding: 0px;">\n            <span class="variation" ng-class="formatNumberOfLeads(carac).color">{{formatNumberOfLeads(carac).variation}}</span>\n            <span class="nominal">{{formatNumberOfLeads(carac).nominal}}</span>\n          </div>\n        </div>\n      </div>\n\n      <div class="legend">\n      {{widget.content.number_of_leads.total[1]}} leads in total\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-opportunities-funnel.tmpl.html",'<div widget-sales-opportunities-funnel>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n    <div setting-params-picker options="statusOptions" param="sales_stage_selection" parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row" >\n\n      <div ng-class="widget.isExpanded() ? \'col-md-6\': \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="6" max="12" class="settings width" />\n\n        <div class="legend">Your opportunities, sorted by sales stage</div>\n\n        <div class="funnel-container">\n          <div class="tile" ng-repeat="elem in funnel" ng-click="toggleSelectStatus(elem.status)">\n            <div class="colored-area" ng-style="elem.coloredWidth" ng-class="isSelected(elem.status) ? \'selected\' : \'\'">{{elem.number}}</div>\n            <div class="main-text" ng-style="elem.statusWidth">{{elem.status | titleize}}</div>\n          </div>\n        </div>\n      </div>\n\n      <div class="col-md-6 right-panel text-center" ng-show="widget.isExpanded()">\n\n        <div ng-hide="selectedStatus" class="currency">\n          Select a sales stage to display a list of the corresponding opportunities\n        </div>\n\n        <div ng-show="selectedStatus" class="widget-lines-container">\n          <div class="row widget-line total" ng-repeat="opp in getSelectedOpportunities()">\n            <div class="row widget-line" >\n              <div class="col-sm-6">\n                {{opp.name | titleize}}\n              </div>\n              <div class="col-sm-6 text-right"><strong>{{getOppDetails(opp)}}</strong></div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-performance.tmpl.html",'<div widget-sales-performance>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound">\n\n      <div class="widget-lines-container" style="max-height: 235px;">\n        <div class="row widget-line header">\n          <div class="col-sm-4">Users/Teams</div>\n          <div class="col-sm-4 text-right">Win ratio</div>\n          <div class="col-sm-4 text-right">Total won</div>\n        </div>\n        <div class="row widget-line total" ng-repeat="assignee in widget.content.assignees" ng-init="collapsed=true">\n          <div class="row widget-line" style="cursor: pointer;" ng-click="collapsed=!collapsed">\n            <div class="col-sm-4"><strong>{{assignee.name | titleize}}</strong></div>\n            <div class="col-sm-4 text-right"><strong>{{assignee.win_ratio}} %</strong></div>\n            <div class="col-sm-4 text-right"><strong>{{assignee.total_won | mnoCurrency : \'AUD\'}}</strong></div>\n          </div>\n          <div collapse="collapsed">\n            <div class="row widget-line" ng-repeat="opp in assignee.opportunities">\n              <div class="col-sm-4">{{opp.name}}</div>\n              <div class="col-sm-4 text-right">{{opp.sales_stage}}</div>\n              <div class="col-sm-4 text-right">{{getOpportunityAmount(opp)}}</div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-segmented-turnover.tmpl.html",'<div widget-sales-segmented-turnover>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n    <div setting-time-range parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div align="center" ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="row">\n      <div ng-class="widget.isExpanded() ? \'col-md-6\' : \'col-md-12\'">\n        <div setting-width parent-widget="widget" min="3" max="6" class="settings width"></div>\n\n        <div class="selector">Filter: <span setting-param-selector parent-widget="widget" param="filter" options="filterOptions" selected="filter"/></div>\n        <div class="chart-container">\n          <div impac-chart draw-trigger="drawTrigger.promise" deferred="chartDeferred"></div>\n        </div>\n        <div class="widget-lines-container">\n          <div class="widget-line">\n            Average price range\n          </div>\n          <div class="widget-line" ng-repeat="range in widget.content.ranges">\n            <i style="float: right; margin-right: 10px;">{{range.percentage}}%</i>\n            <i class="fa fa-circle" style="margin: 0px 8px; color: {{getColorByIndex($index)}}" />\n            {{getRangeLabel(range.label)}}\n          </div>\n        </div>\n      </div>\n\n      <div class="col-md-6 right-panel" ng-show="widget.isExpanded()">\n        <i class="fa fa-info-circle" style="float: left;" tooltip="This widget segments your revenue by products average price range and propose an analysis of its composition" />\n        <h3 style="margin: 25px 10px; text-align: center;">{{getMaxRange().percentage.toFixed()}}% of your revenue comes from products sold at an average price between {{getMaxRange().label.split(\'-\')[0] | mnoCurrency : widget.content.currency}} and {{getMaxRange().label.split(\'-\')[1] | mnoCurrency : widget.content.currency}}.</h3>\n        <div class=\'analysis hidden-md\' >{{getAnalysis()}}</div>\n      </div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-summary.tmpl.html",'<div widget-sales-summary>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n    <div setting-chart-filters parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div align="center" ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound" class="selector">\n      See: <span setting-param-selector parent-widget="widget" param="filter" options="filterOptions" selected="filter"/>\n      for this <span setting-param-selector parent-widget="widget" param="period" options="periodOptions" selected="period"/>\n      ({{widget.content.hist_parameters.from | date : \'d MMM\'}} to {{widget.content.hist_parameters.to | date : \'d MMM\'}})\n    </div>\n\n    <div class="chart-container" ng-class="{\'invisible\': !isDataFound || incorrectPeriod}">\n      <div impac-chart draw-trigger="drawTrigger.promise" deferred="chartDeferred"></div>\n    </div>\n\n    <div class="data-not-found" ng-if="incorrectPeriod">\n      <div class="message">No data found for this period<br/> Please select another one</div>\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n\n</div>'),e.put("widgets/sales-top-opportunities.tmpl.html",'<div widget-sales-top-opportunities>\n\n  <div class="edit" ng-show="widget.isEditMode">\n    <h4>Widget settings</h4>\n\n    <div setting-organizations parent-widget="widget" class="part" />\n\n    <div align="right">\n      <button class="btn btn-default" ng-click="initSettings()">Cancel</button>\n      <button class="btn btn-warning" ng-click="updateSettings()">Save</button>\n    </div>\n  </div>\n\n  <div ng-hide="widget.isEditMode">\n\n    <div ng-show="isDataFound">\n\n      <div class="legend">\n        Total potential: <b>{{widget.content.total_potential | mnoCurrency : widget.content.currency || "AUD"}}</b> - <b>{{widget.content.eligible_opportunities}}</b> eligible opportunities\n      </div>\n\n      <div class="opps-container">\n        <div class="tile" ng-repeat="opp in widget.content.opportunities track by $index" ng-class="getOppClass($index)">\n          <div class="colored-area">{{$index +1 }}</div>\n          <div class="main-text">\n            {{opp.name | titleize}}\n            <br />\n            <i style="font-size: 13px;">{{getOppDetails(opp)}}</i>\n          </div>\n        </div>\n      </div>\n\n    </div>\n\n    <div ng-hide="isDataFound" common-data-not-found widget-engine="widget.category" />\n  </div>\n    \n</div>'),e.put("widgets-common/data-not-found.tmpl.html",'<div class="data-not-found">\n	<img ng-src="{{bgImage}}" />\n	<div class="message">\n	  {{content.mainMessage}}\n    <!-- TODO: provider for html hyperlinks? -->\n		<a ng-href="{{content.linkUrl}}" target="{{content.linkTarget}}">\n			{{content.linkMessage}}\n		</a>\n	</div>\n</div>\n'),e.put("widgets-common/editable-title.tmpl.html",'<div class="visible-lg title-wrapper" ng-if="parentWidget.width >= 3 && parentWidget.width < 6">\n  <div ng-show="parentWidget.hasEditAbility" class="title" editable-text="parentWidget.name" buttons="no" onaftersave="updateName()">\n  	{{parentWidget.name | truncate:18:"."}}\n  </div>\n\n  <div ng-hide="parentWidget.hasEditAbility" class="title">\n  	{{parentWidget.name | truncate:18:"."}}\n  </div>\n</div>\n\n<div class="visible-lg title-wrapper" ng-if="parentWidget.width >= 6">\n  <div ng-show="parentWidget.hasEditAbility" class="title" editable-text="parentWidget.name" buttons="no" onaftersave="updateName()">\n  	{{parentWidget.name | truncate:80:"."}}\n  </div>\n\n  <div ng-hide="parentWidget.hasEditAbility" class="title">\n  	{{parentWidget.name | truncate:80:"."}}\n  </div>\n</div>\n\n<div class="visible-md visible-sm title-wrapper" ng-if="parentWidget.width == 3 && parentWidget.width < 6">\n  <div ng-show="parentWidget.hasEditAbility" class="title" editable-text="parentWidget.name" buttons="no" onaftersave="updateName()">\n  	{{parentWidget.name | truncate:13:"."}}\n  </div>\n\n  <div ng-hide="parentWidget.hasEditAbility" class="title">\n  	{{parentWidget.name | truncate:13:"."}}\n  </div>\n</div>\n\n<div class="visible-md visible-sm title-wrapper" ng-if="parentWidget.width >= 6">\n  <div ng-show="parentWidget.hasEditAbility" class="title" editable-text="parentWidget.name" buttons="no" onaftersave="updateName()">\n  	{{parentWidget.name | truncate:60:"."}}\n  </div>\n\n  <div ng-hide="parentWidget.hasEditAbility" class="title">\n  	{{parentWidget.name | truncate:60:"."}}\n  </div>\n</div>\n\n<div class="visible-xs title-wrapper">\n  <!-- Title edition no designed for mobile -->\n  <div class="title">\n  	{{parentWidget.name | truncate:25:"."}}\n  </div>\n</div>'),e.put("widgets-common/top-buttons.tmpl.html",'<div id="module__top-buttons">\n  <div ng-mouseenter="showCloseActive=true" ng-mouseleave="showCloseActive=false" ng-show="parentWidget.hasDeleteAbility">\n    <button class="btn btn-close top-button" ng-click="showConfirmDelete = !showConfirmDelete">\n      <i class="fa fa-times-circle-o fa-lg"></i>\n      <span class="text-hide">Delete widget</span>\n    </button>\n  </div>\n\n  <div ng-show="parentWidget.hasEditAbility">\n    <button class="btn top-button btn-edit" ng-click="toggleEditMode()" ng-class="{\'edit-mode\': parentWidget.isEditMode}">\n      <i class="fa fa-cog fa-lg"></i>\n      <span class="text-hide">Edit widget</span>\n    </button>\n  </div>\n\n  <div class="refresh-widget">\n    <button class="btn top-button btn-refresh" ng-click="refreshWidget()">\n      <i class="fa fa-refresh"></i>\n      <span class="text-hide">Refresh widget</span>\n    </button>\n  </div>\n\n  <div class="confirm-delete-popover" ng-show="showConfirmDelete">\n    <h4>Are you sure you want to delete this widget ?</h4>\n    <p>(it will not erase your data)</p>\n    <div ng-hide="isDeletePopoverLoading">\n      <button ng-click="showConfirmDelete = false" class="btn btn-sm btn-default">Cancel</button>\n      <button ng-click="deleteWidget()" class="btn btn-sm btn-danger" style="margin-left: 10px;">Delete</button>\n    </div>\n    <div ng-show="isDeletePopoverLoading" class="loader" align="center">\n      <div>\n        <i class="fa fa-spinner fa-pulse fa-4x"></i>\n      </div>\n    </div>\n  </div>\n</div>\n\n'),e.put("widgets-settings/account.tmpl.html",'<h5>{{label}}</h5>\n<div class="input-group settings select-account">\n	<select ng-model="parentWidget.selectedAccount" ng-change="onAccountSelected()" ng-options="account.name + \' (\' + formatAmount(account) + \')\' for account in parentWidget.content.account_list track by account.uid" class="form-control" />\n</div>'),e.put("widgets-settings/chart-filters.tmpl.html",'<div class="settings chart-filters">\n  <h5>Chart filters</h5>\n  <div class="row">\n    <div class="col-md-6">\n      <input type="radio" ng-model="filterCriteria" value="number">\n      <label for="number" ng-click="filterCriteria = \'number\'">Top {{filterValueNumber}} {{entityType}}</label>\n    </div>\n    <div class="col-md-6">\n      <input type="range" ng-model="filterValueNumber" ng-change="filterCriteria = \'number\'" min="3" max="{{maxEntities}}" step="1">\n    </div>\n  </div>\n  <div class="row">\n    <div class="col-md-6">\n      <input type="radio" ng-model="filterCriteria" value="percentage">\n      <label for="percentage" ng-click="filterCriteria = \'percentage\'">Top {{filterValuePercentage}}% {{filterLabel}}</label>\n    </div>\n    <div class="col-md-6">\n      <input type="range" ng-model="filterValuePercentage" ng-change="filterCriteria = \'percentage\'" min="20" max="100" step="5">\n    </div>\n  </div>\n</div>\n'),e.put("widgets-settings/hist-mode.tmpl.html",'<div class="settings hist-mode-choser">\n  <div align="center" class="options">\n    <a ng-click="toggleHistMode(\'current\')" ng-class="!parentWidget.isHistoryMode ? \'active\' : \'inactive\'">current</a> |\n    <a ng-click="toggleHistMode(\'history\')" ng-class="parentWidget.isHistoryMode ? \'active\' : \'inactive\'">history</a>\n  </div>\n  <div class="{{parentWidget.isHistoryMode ? \'arrow-container right\' : \'arrow-container left\'}}">\n    <div class="arrow" />\n    <div class="arrow-border" />\n  </div>\n</div>'),e.put("widgets-settings/organizations.tmpl.html",'<div class="settings organizations">\n  <h5>Select Companies</h5>\n\n  <div class="widget-lines-container">\n    <div class="widget-line" ng-repeat="org in dashboardOrganizations">\n      {{org.label}}\n      <i ng-class="isOrganizationSelected(org.uid) ? \'fa fa-toggle-on\' : \'fa fa-toggle-off\'" ng-click="toggleSelectOrganization(org.uid)" tooltip="{{isOrganizationSelected(org.uid) ? \'disable\' : \'enable\'}}" tooltip-append-to-body="true" />\n    </div>\n  </div>\n</div>'),e.put("widgets-settings/param-selector.tmpl.html",'<span class="settings param-selector">\n	<a ng-click="toggleShowOptions()">{{selected.label | titleize | truncate : getTruncateValue() : "..." : false}} <i class="fa fa-chevron-down" /></a>\n	<div class="options-container" collapse="!showOptions">\n		<div ng-repeat="option in options" ng-click="selectOption(option)">\n			{{option.label | titleize}}\n		</div>\n	</div>\n</span>'),e.put("widgets-settings/params-picker.tmpl.html",'<h5>{{formattedParam | titleize}}</h5>\n<div class="settings params-picker">\n  <div style="margin-bottom: 8px;">\n    The selected criteria will be displayed in this order (drag/drop to modify):\n  </div>\n  <div ui:sortable="sortableOptions" ng-model="options" class="input-group">\n    <span ng-repeat="parameter in options track by $index" class="parameter" ng-class="!parameter.selected ? \'unchecked\' : \'\'">\n      <span class="badge">{{$index + 1}}</span>\n      {{parameter.label | titleize}}\n      <input type="checkbox" ng-model="parameter.selected" />\n    </span>\n  </div>\n</div>'),e.put("widgets-settings/time-range.tmpl.html",'<h5>Time range</h5>\n<div class="settings time-range">\n	<div class="row">\n	  <div class="col-md-12">\n	    Show last {{numberOfPeriods}} {{periodToUnit()}}\n	  </div>\n	</div>\n	<div class="row input-group" align="center" style="margin: 0; margin-top: 3px;">\n	  <div class="col-xs-6" style="padding: 0; padding-right: 5px;">\n	    <select ng-model="selectedPeriod" ng-options="period.toLowerCase() for period in PERIODS track by period" class="form-control" style="height: 22px; margin-top: 0; padding: 0; padding-left: 1px; padding-bottom: 1px;"></select>\n	  </div>\n	  <div class="col-xs-6" style="padding: 0;">\n	    <input type="range" ng-model="numberOfPeriods" min="1" max="12" step="1">\n	  </div>\n	</div>\n</div>'),e.put("widgets-settings/width.tmpl.html",'<i class="fa fa-angle-double-left reduce" ng-show="expanded" ng-click="parentWidget.toggleExpanded()" tooltip="reduce"/>\n<i class="fa fa-angle-double-right expand" ng-hide="expanded" ng-click="parentWidget.toggleExpanded()" tooltip="expand"/>')
}])}(),function(){"use strict";angular.module("impac.filters.mno-currency",[]).filter("mnoCurrency",["$filter",function(e){return function(t,n,i){var a;return null==i&&(i=!0),null!=t?(a=e("currency")(t),a=a.replace("(","-"),a=a.replace(")",""),"EUR"===n?(a=a.replace("$",""),a=a.replace(","," "),a=a.replace(".",","),a+" €"):("AUD"!==n&&"USD"!==n&&(a=a.replace("$","")),i&&n?a+" "+n:a)):""}}])}.call(this),function(){"use strict";angular.module("impac.filters.titleize",[]).filter("titleize",function(){return function(e){return e=void 0===e||null===e?"":e,e.toString().toLowerCase().replace(/\b([a-z])/g,function(e){return e.toUpperCase()})}})}.call(this),function(){"use strict";angular.module("impac.filters.truncate",[]).filter("truncate",function(){return function(e,t,n,i){var a;return e?(t=parseInt(t,10))?e.length<=t?e:(e=e.substr(0,t),i&&(a=e.lastIndexOf(" "),-1!==a&&(e=e.substr(0,a))),e+(n||"…")):e:""}})}.call(this),function(){"use strict";angular.module("impac.services.assets",[]).provider("ImpacAssets",function(){var e,t,n;return n=this,t={dataNotFound:null,impacTitleLogo:null,impacDashboardBackground:null,noWarning:!1},n.configure=function(e){return angular.extend(t,e)},e=function(e){var n;return n=this,n.get=function(n){var i,a;return a="",i="impac-angular warning: There are missing assets ("+n+"), please refer to the including assets section in the docs.",null!=t[n]?a=t[n]:t.noWarning||e.warn(i),a},n},e.$inject=["$log"],n.$get=e,n})}.call(this),function(){"use strict";angular.module("impac.components.chart",[]).directive("impacChart",["$timeout","$log",function(e,t){return{restrict:"A",scope:{drawTrigger:"=",deferred:"="},template:"<canvas></canvas>",link:function(n,i){var a;return a={bezierCurve:!0,pointDotRadius:3,responsive:!0,scaleShowLabels:!0,scaleShowLabelBackdrop:!0,scaleBeginAtZero:!0,scaleShowGridLines:!0},n.draw=function(t){return e(function(){var e,n;switch(_.isEmpty(t.options)||angular.extend(a,t.options),i.children().get(0).remove(),i.append("<canvas></canvas>"),e=i.children().get(0),n=e.getContext("2d"),t.chartType){case"Bar":return new Chart(n).Bar(t.data,a);case"Line":return new Chart(n).Line(t.data,a);case"Pie":return angular.extend(a,{tooltipFixed:!0}),new Chart(n).Pie(t.data,a)}})},n.drawTrigger.then(function(){return t.warn("chart promise has been resolved: use notify instead")},function(e){return t.error(e)},function(e){return n.draw(e)}),n.deferred.resolve("chart ready")}}}])}.call(this),function(){"use strict";angular.module("impac.services.chart-formatter",[]).service("ChartFormatterSvc",["ImpacTheming",function(e){var t,n,i,a,s,r,o,l;n=this,t=e.get().chartColors,this.getPositiveColor=function(){return t.positive},this.getNegativeColor=function(){return t.negative},this.getOthersColor=function(){return t.others},this.getColor=function(e){return t.array[e%t.array.length]},i=function(e){return e.replace(/#/,"")},r=function(e){return parseInt(i(e).substring(0,2),16)},s=function(e){return parseInt(i(e).substring(2,4),16)},a=function(e){return parseInt(i(e).substring(4,6),16)},o=function(e){return[r(e),s(e),a(e)].join(",")},l=function(e,t){return"rgba("+o(e)+","+t+")"},this.lineChart=function(e,t,i){var a;return null==t&&(t={}),null==i&&(i=!1),a=0,{chartType:"Line",options:t,data:{labels:e[0].labels,datasets:_.map(e,function(e){var t;return t=i?0===a?n.getNegativeColor():n.getPositiveColor():n.getColor(a),a++,{label:e.title,data:e.values,fillColor:l(t,.3),strokeColor:t,pointColor:t,pointStrokeColor:t,pointHighlightFill:t,pointHighlightStroke:l(t,.3)}})}}},this.barChart=function(e,t,i){var a;return null==t&&(t={}),null==i&&(i=!0),a=0,{chartType:"Bar",options:t,data:{labels:[""],datasets:_.map(e.values,function(t){var s;return s=n.getColor(a),a++,null==t&&(t=0,s="rgba(0,0,0,0)"),i&&0>t&&(t=-t),{label:e.labels[a]||"",data:[t],fillColor:s,strokeColor:s,highlightFill:s,highlightStroke:s}})}}},this.pieChart=function(e,t,i){var a;return null==t&&(t={}),null==i&&(i=!1),a=0,{chartType:"Pie",options:t,data:_.map(e,function(e){var t;return t=i?0===a?n.getNegativeColor():n.getPositiveColor():n.getColor(a),a++,{value:e.value,label:e.label,color:t,highlight:l(t,.7)}})}}}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.dashboard",[]),e.controller("ImpacDashboardCtrl",["$scope","$http","$q","$filter","$modal","$log","$timeout","$templateCache","MsgBus","Utilities","ImpacAssets","ImpacTheming","ImpacMainSvc","ImpacDashboardsSvc","ImpacWidgetsSvc",function(e,t,n,i,a,s,r,o,l,d,c,u,g,h,p){var m,v;return e.isLoading=!0,e.currentDhb=h.getCurrentDashboard(),e.widgetsList=h.getWidgetsTemplates(),e.impacTitleLogo=c.get("impacTitleLogo"),e.impacDashboardBackground=c.get("impacDashboardBackground"),e.showDhbHeading=u.get().dhbConfig.showDhbHeading,e.dhbHeadingText=u.get().dhbConfig.dhbHeadingText,e.showChooseDhbMsg=function(){return!h.isThereADashboard()},e.showNoWidgetsMsg=function(){return h.isCurrentDashboardEmpty()&&u.get().showNoWidgetMsg},e.starWizardModal={value:!1},l.publish("starWizardModal",e.starWizardModal),e.openStarWizard=function(){return e.starWizardModal.value=!0},h.load(!0).then(function(){return e.displayWidgetSelector(h.isCurrentDashboardEmpty()),e.isLoading=!1}),e.customWidgetSelector=u.get().widgetSelectorConfig,e.showWidgetSelector=!1,e.showCloseWidgetSelectorButton=function(){return!h.isCurrentDashboardEmpty()},e.displayWidgetSelector=function(t){return null==t||e.customWidgetSelector.path?void 0:e.showWidgetSelector=!!t},e.isAddChartEnabled=u.get().addChartTile.show,e.addChartTileOnClick=function(){var t;return t=u.get().addChartTile.onClickOptions.triggers,_.forEach(t,function(t){switch(t.type){case"objectProperty":return e[t.target][t.property]=t.value}})},e.selectedCategory="accounts",e.isCategorySelected=function(t){return null!=e.selectedCategory&&null!=t?e.selectedCategory===t:!1},e.selectCategory=function(t){return e.selectedCategory=t},e.getSelectedCategoryName=function(){if(null==e.selectedCategory)return!1;switch(e.selectedCategory){case"accounts":return"Accounting";case"invoices":return"Invoicing";case"hr":return"HR / Payroll";case"sales":return"Sales";default:return!1}},e.getSelectedCategoryTop=function(){if(null==e.selectedCategory)return!1;switch(e.selectedCategory){case"accounts":return{top:"33px"};case"invoices":return{top:"64px"};case"hr":return{top:"95px"};case"sales":return{top:"126px"};default:return{top:"9999999px"}}},e.getWidgetsForSelectedCategory=function(){return null!=e.selectedCategory&&null!=e.widgetsList?_.select(e.widgetsList,function(t){return t.path.split("/")[0]===e.selectedCategory}):[]},e.addWidget=function(t,n){var i;return null==n&&(n=null),i={widget_category:t},null!=n&&angular.extend(i,{metadata:n}),angular.element("#widget-selector").css("cursor","progress"),angular.element("#widget-selector .top-container .row.lines p").css("cursor","progress"),p.create(i).then(function(){return e.errors="",angular.element("#widget-selector").css("cursor","auto"),angular.element("#widget-selector .top-container .row.lines p").css("cursor","pointer"),angular.element("#widget-selector .badge.confirmation").fadeTo(250,1),r(function(){return angular.element("#widget-selector .badge.confirmation").fadeTo(700,0)},4e3)},function(t){return e.errors=d.processRailsError(t),angular.element("#widget-selector").css("cursor","auto"),angular.element("#widget-selector .top-container .row.lines p").css("cursor","pointer")})},e.createDashboardModal=e.$new(),e.createDashboardModal.config={backdrop:"static",template:o.get("dashboard/create.modal.html"),size:"md",windowClass:"inverse",scope:e.createDashboardModal},e.createDashboardModal.open=function(){var t;return t=e.createDashboardModal,t.locked?void 0:(t.model={name:""},t.errors="",t.isLoading=!0,t.instance=a.open(t.config),t.instance.rendered.then(function(){return t.locked=!0}),t.instance.result.then(function(){return t.locked=!1},function(){return t.locked=!1}),g.loadOrganizations().then(function(e){return t.organizations=e.organizations,t.currentOrganization=e.currentOrganization,t.selectMode("single"),t.isLoading=!1}))},e.createDashboardModal.proceed=function(){var t,n,i;return i=e.createDashboardModal,i.isLoading=!0,t={name:i.model.name},n=[],n="multi"===i.mode?_.select(i.organizations,function(e){return e.$selected}):[{id:g.config.currentOrganization.id}],n.length>0&&(t.organization_ids=_.pluck(n,"id")),h.create(t).then(function(){return i.errors="",i.isLoading=!1,i.instance.close(),e.displayWidgetSelector(h.isCurrentDashboardEmpty())},function(e){return i.isLoading=!1,i.errors=d.processRailsError(e)})},e.createDashboardModal.isProceedDisabled=function(){var t,n,i;return i=e.createDashboardModal,n=_.select(i.organizations,function(e){return e.$selected}),t=_.isEmpty(i.model.name),t||(t=0===n.length),t||(t=0===_.select(n,function(e){return i.canAccessAnalyticsData(e)}).length),i.isLoading||t},e.createDashboardModal.btnBlassFor=function(t){var n;return n=e.createDashboardModal,t===n.mode?"btn btn-sm btn-warning active":"btn btn-sm btn-default"},e.createDashboardModal.selectMode=function(t){var n;return n=e.createDashboardModal,_.each(n.organizations,function(e){return e.$selected=!1}),n.currentOrganization.$selected="single"===t,n.mode=t},e.createDashboardModal.isSelectOrganizationShown=function(){return"multi"===e.createDashboardModal.mode},e.createDashboardModal.isCurrentOrganizationShown=function(){return"single"===e.createDashboardModal.mode},e.createDashboardModal.canAccessAnalyticsForCurrentOrganization=function(){var t;return t=e.createDashboardModal,t.canAccessAnalyticsData(t.currentOrganization)},e.createDashboardModal.isMultiCompanyAvailable=function(){return e.createDashboardModal.organizations.length>1&&e.createDashboardModal.multiOrganizationReporting},e.createDashboardModal.canAccessAnalyticsData=function(e){return e.current_user_role&&("Super Admin"===e.current_user_role||"Admin"===e.current_user_role)},e.widgetSuggestionModal=e.$new(),e.widgetSuggestionModal.widgetDetails={},e.widgetSuggestionModal.config={backdrop:"static",template:o.get("dashboard/widget-suggestion.modal.html"),size:"md",windowClass:"inverse impac-widget-suggestion",scope:e.widgetSuggestionModal},e.widgetSuggestionModal.open=function(){var t;return t=e.widgetSuggestionModal,t.locked?void 0:(t.instance=a.open(t.config),t.instance.rendered.then(function(){return t.locked=!0}),t.instance.result.then(function(){return t.locked=!1},function(){return t.locked=!1}),t.isLoading=!1)},e.widgetSuggestionModal.proceed=function(){var n,i;return i=e.widgetSuggestionModal,i.isLoading=!0,n={widget_name:i.widgetDetails.name,widget_category:i.widgetDetails.category,widget_description:i.widgetDetails.description},t.post("/js_api/v1/mailers",{template:"widget_suggestion",opts:n}),r(function(){return i.instance.close(),i.widgetDetails={},i.isLoading=!1},3e3)},e.sortableOptions={stop:m=function(){var t;return t={widgets_order:_.pluck(e.currentDhb.widgets,"id")},h.update(e.currentDhb.id,t)},start:v=function(e,t){return t.placeholder.css("width",t.item.width()-1),t.placeholder.css("height",t.item.height())},cursorAt:{left:100,top:20},opacity:.5,delay:150,tolerance:"pointer",placeholder:"placeHolderBox",cursor:"move",revert:250,cancel:".unsortable",handle:".top-line"}}]),e.directive("impacDashboard",["$templateCache",function(e){return{restrict:"EA",scope:{dashboards:"="},template:e.get("dashboard/dashboard.tmpl.html"),controller:"ImpacDashboardCtrl"}}])}.call(this),function(){"use strict";angular.module("impac.components.dashboard-selector",[]).directive("dashboardSelector",["$log","$compile","$templateCache","$http","$timeout","$modal","ImpacTheming","ImpacDashboardsSvc","ImpacMainSvc",function(e,t,n,i,a,s,r,o){return{restrict:"E",scope:{onDisplayWidgetSelector:"&",onCreateDashboard:"&",isWidgetSelectorShown:"="},controller:["$scope",function(e){return e.organizationsNames=function(){return _.pluck(e.currentDhb.data_sources,"label").join(", ")},e.toggleShowDashboardsDropdown=function(){return e.showChangeDashboardNameBox?void 0:e.showDashboardsDropdown=o.areThereSeveralDashboards()||e.showCreateDashboardButton?!e.showDashboardsDropdown:!1},e.selectDashboard=function(t){return e.showDashboardsDropdown=!1,e.isLoading=!0,a(function(){return e.isLoading=!1},300),a(function(){return o.setCurrentDashboard(t),e.onDisplayWidgetSelector({newValue:o.isCurrentDashboardEmpty()})},50)},e.toggleChangeDashboardNameBox=function(t){var n;return n=angular.copy(t),e.dashboardToChange={},e.dashboardToChange.id=n.id,e.dashboardToChange.name=n.full_name,e.showChangeDashboardNameBox=!e.showChangeDashboardNameBox,a(function(){var e;return e=$("#changeDhbNameInput"),e.select(),e.focus()},100)},e.checkAndUpdateDashboardName=function(t){return 13===t.keyCode&&e.updateDashboardName(),27===t.keyCode?e.showChangeDashboardNameBox=!1:void 0},e.updateDashboardName=function(){return null==e.dashboardToChange||_.isEmpty(e.dashboardToChange.name)?void 0:o.update(e.dashboardToChange.id,{name:e.dashboardToChange.name}).then(function(){return e.showChangeDashboardNameBox=!1})},e.toggleAccessibilityMode=function(){return e.accessibilityMode=!e.accessibilityMode,angular.forEach(e.currentDhb.widgets,function(e){return e.loadContent()})},e.deleteDashboardModal=e.$new(),e.deleteDashboardModal.config={backdrop:"static",template:n.get("dashboard-selector/delete.modal.html"),size:"md",windowClass:"inverse",scope:e.deleteDashboardModal},e.deleteDashboardModal.open=function(){var t;return t=e.deleteDashboardModal,t.locked?void 0:(t.errors="",t.instance=s.open(t.config),t.instance.rendered.then(function(){return t.locked=!0}),t.instance.result.then(function(){return t.locked=!1},function(){return t.locked=!1}))},e.deleteDashboardModal.proceed=function(){var t;return t=e.deleteDashboardModal,t.isLoading=!0,o["delete"](e.currentDhb.id).then(function(){return t.errors="",t.isLoading=!1,t.instance.close(),e.onDisplayWidgetSelector({newValue:o.isCurrentDashboardEmpty()})},function(e){return t.errors=Utilities.processRailsError(e),t.isLoading=!1})},e}],link:function(a,s){var l,d,c,u,g,h,p;switch(a.currentDhb=o.getCurrentDashboard(),a.dashboardsList=o.getDashboards(),a.isThereADashboard=function(){return o.isThereADashboard()},g=r.get().dhbSelectorConfig,a.isAccessibilityEnabled=g.accessibilityEnabled,a.isAddWidgetEnabled=g.addWidgetEnabled,a.isAddDhbEnabled=g.addDhbEnabled,a.isDeleteDhbEnabled=g.deleteDhbEnabled,a.showCreateDashboardButton=!0,a.showDashboardsDropdown=!1,a.showChangeDashboardNameBox=!1,a.accessibilityMode=!1,g.customTmplPath?d=g.customTmplPath:a.selectorType=g.selectorType,h=null,p=function(e){return h=e},a.selectorType){case"dropdown":p("dashboard-selector/dropdown.tmpl.html");break;case"tabs":p("dashboard-selector/bootstrap-tabs.tmpl.html");break;case"pills":p("dashboard-selector/bootstrap-tabs.tmpl.html");break;default:p(d)}return c=function(){return i.get(h,{cache:n}).then(function(t){return t&&t.data&&t.data.length||e.warn("dashboardSelector custom template: no content found"),l(t.data)},function(t){return e.error("Error retrieving custom template: ",t)})},u=function(){return l(n.get(h))},l=function(e){return s.html(e).show(),t(s.contents())(a)},d?c():u()}}}])}.call(this),function(){"use strict";angular.module("impac.services.dashboards",[]).service("ImpacDashboardsSvc",["$q","$http","$log","ImpacMainSvc","ImpacRoutes",function(e,t,n,i,a){var s,r,o,l;return s=this,this.config={},this.config.dashboards=[],this.getDashboards=function(){return s.config.dashboards},this.config.currentDashboard={},this.getCurrentDashboard=function(){return s.config.currentDashboard},this.config.widgetsTemplates=[],this.getWidgetsTemplates=function(){return s.config.widgetsTemplates},o=function(){return _.isEmpty(s.config.dashboards)||_.isEmpty(s.config.currentDashboard)},this.isThereADashboard=function(){return!_.isEmpty(s.config.currentDashboard)},this.areThereSeveralDashboards=function(){return s.config.dashboards.length>1},this.isCurrentDashboardEmpty=function(){return s.isThereADashboard()&&_.isEmpty(s.config.currentDashboard.widgets)},this.load=function(r){var l;return null==r&&(r=!1),l=e.defer(),o()||r?i.loadOrganizations(r).then(function(e){var i;return i=e.currentOrganization.id,t.get(a.baseDhbPath(i)).then(function(e){return s.setDashboards(e.data).then(function(){return s.setCurrentDashboard(),l.resolve(s.config)}),function(e){return deferre.reject(e)}},function(e){return n.error("Impac - DashboardSvc: cannot retrieve dashboards list for org: "+i),l.reject(e)})},function(e){return n.error("Impac - DashboardSvc: cannot retrieve current organization"),l.reject(e)}):l.resolve(s.config),l.promise},l=function(){return null!=s.config.dashboards&&s.config.dashboards.length>0?(n.info("Impac - DashboardSvc: first dashboard set as current by default"),i.override(s.config.currentDashboard,s.config.dashboards[0]),s.setWidgetsTemplates(s.config.currentDashboard.widgets_templates),s.initializeActiveTabs(),!0):(n.warn("Impac - DashboardSvc: cannot set default current dashboard"),i.override(s.config.currentDashboard,{}),!1)},this.setCurrentDashboard=function(e){var t;return null==e&&(e=null),null!=e?(t=_.find(s.config.dashboards,function(t){return e===t.id}),_.isEmpty(t)?(n.error("Impac - DashboardSvc: dashboard: "+e+" not found in dashboards list"),l()):(i.override(s.config.currentDashboard,t),s.setWidgetsTemplates(t.widgets_templates),s.initializeActiveTabs(),!0)):l()},r=function(e,t){return _.includes(_.pluck(e.data_sources,"id"),t.id)},this.setDashboards=function(e){return i.loadOrganizations().then(function(t){var n,i,a,o,l;for(n=t.currentOrganization,_.remove(s.config.dashboards,function(){return!0}),l=[],a=0,o=e.length;o>a;a++)i=e[a],r(i,n)?l.push(s.config.dashboards.push(i)):l.push(void 0);return l})},this.setWidgetsTemplates=function(e){var t,n,i;if(_.isEmpty(e)||!_.isEmpty(s.config.widgetsTemplates))return!1;for(_.drop(s.config.widgetsTemplates,s.config.widgetsTemplates.length),t=0,n=e.length;n>t;t++)i=e[t],s.config.widgetsTemplates.push(i);return!0},this.initializeActiveTabs=function(){var e,t,n,i,a;for(i=s.config.dashboards,a=[],t=0,n=i.length;n>t;t++)e=i[t],a.push(_.merge(e,{active:s.config.currentDashboard.id===e.id}));return a},this.create=function(i){var r,o;return o=e.defer(),r={dashboard:i},t.post(a.createDhbPath(),r).then(function(e){return s.config.dashboards.push(e.data),s.setCurrentDashboard(e.data.id),o.resolve(e.data)},function(e){return n.error("Impac - DashboardSvc: cannot create dashboard with parameters: "+i),o.reject(e)}),o.promise},this["delete"]=function(i){var r;return r=e.defer(),t["delete"](a.deleteDhbPath(i)).then(function(e){return _.remove(s.config.dashboards,function(e){return i===e.id}),s.setCurrentDashboard(),r.resolve(e)},function(e){return n.error("Impac - DashboardSvc: cannot delete dashboard: "+i),r.reject(e)}),r.promise},this.update=function(i,r){var o,l;return l=e.defer(),o={dashboard:r},t.put(a.updateDhbPath(i),o).then(function(e){return angular.merge(_.find(s.config.dashboards,function(e){return i===e.id}),e.data),i===s.config.currentDashboard.id&&angular.merge(s.config.currentDashboard,e.data),l.resolve(e.data)},function(e){return n.error("Impac - DashboardSvc: cannot update dashboard: "+i+" with parameters: "+r),l.reject(e)}),l.promise},s}])}.call(this),function(){"use strict";angular.module("impac.services.linking",[]).provider("ImpacLinking",function(){var e,t,n;return n=this,t={ssoSession:null,organizations:null},n.linkData=function(e){_.forIn(t,function(n,i){var a;if(a=e[i],null==a)throw"Missing core data ("+i+") to run impac-angular, please refer to impac.services.linking module or impac-angular README.md on required provider configurations.";return t[i]=a})},e=function(e){var n;return n=this,n.getSsoSession=function(){var n;return n=e.defer(),t.ssoSession().then(function(e){return n.resolve(e)},function(e){return n.reject(e)}),n.promise},n.getOrganizations=function(){var n;return n=e.defer(),t.organizations().then(function(e){return n.resolve(e)},function(e){return n.reject(e)}),n.promise},n},e.$inject=["$q"],n.$get=e,n})}.call(this),function(){"use strict";angular.module("impac.services.main",[]).service("ImpacMainSvc",["$q","$log","ImpacLinking","ImpacRoutes",function(e,t,n){var i,a,s;return i=this,this.config={},this.config.organizations=[],this.config.currentOrganization={},this.config.userData={},a=function(){return!(_.isEmpty(i.config.organizations)||_.isEmpty(i.config.currentOrganization))},this.load=function(n){var s;return null==n&&(n=!1),s=e.defer(),!a()||n?e.all([i.loadOrganizations(n),i.loadUserData(n)]).then(function(){return s.resolve(i.config)},function(e){return t.error("ImpacMainSvc: failed to load configuration"),s.reject(e)}):s.resolve(i.config),s.promise},this.loadOrganizations=function(a){var s;return null==a&&(a=!1),s=e.defer(),_.isEmpty(i.config.organizations)||_.isEmpty(i.config.currentOrganization)||a?n.getOrganizations().then(function(e){return null!=e.organizations&&e.organizations.length>0?(i.config.organizations=e.organizations,i.setCurrentOrganization(e.currentOrgId)):(i.config.organizations=[],i.config.currentOrganization={},t.info("ImpacMainSvc: retrieved empty organizations list")),s.resolve(i.config)},function(e){return t.error("ImpacMainSvc: cannot set organization: "+id+" as currentOrganization"),s.reject(e)}):s.resolve(i.config),s.promise},s=function(){return null!=i.config.organizations&&i.config.organizations.length>0?(i.config.currentOrganization=i.config.organizations[0],t.info("ImpacMainSvc: first organization set as current by default"),!0):(i.config.currentOrganization={},t.error("ImpacMainSvc: cannot set default current organization"),{error:{code:400,message:"cannot set default current organization"}})},this.setCurrentOrganization=function(e){var n;return null==e&&(e=null),null!=e?(n=_.find(i.config.organizations,function(t){return e===t.id}),_.isEmpty(n)?(t.error("ImpacMainSvc: organization: "+e+" not found in organizations list"),s()):(i.config.currentOrganization=n,!0)):s()},this.loadUserData=function(a){var s;return null==a&&(a=!1),s=e.defer(),n.getSsoSession().then(function(e){return i.config.userData.ssoSession=e,s.resolve(i.config)},function(e){return t.error("ImpacMainSvc: cannot retrieve user data"),s.reject(e)}),s.promise},this.override=function(e,t){var n,i;for(n in e)i=e[n],delete e[n];for(n in t)i=t[n],e[n]=i;return e},i}])}.call(this),function(){"use strict";angular.module("impac.services.message-bus",[]).service("MsgBus",function(){var e;e={dashboardGrid:{},controlBarFilter:{},controlBarQuickFilter:{},orgaSharingModal:{},appConnectModal:{},page:{},pane:{},errors:[],autostopQueue:[],notificationQueue:[],params:{}},this.publish=function(t,n){return e[t]=n},this.subscribe=function(t){return function(){return e[t]}}})}.call(this),function(){"use strict";angular.module("impac.services.routes",[]).provider("ImpacRoutes",function(){var e,t,n;return n=this,t={dhbBasePath:"/mnoe/jpi/v1/impac/dashboards",widgetBasePath:"/mnoe/jpi/v1/impac/widgets",showWidgetPath:"http://localhost:4000/api/v1/get_widget"},n.configureRoutes=function(e){return angular.extend(t,e)},e=function(){var e;return e=this,e.baseDhbPath=function(e){return null!=e?t.dhbBasePath+"?org_id="+e:t.dhbBasePath},e.showDhbPath=function(e){return t.dhbBasePath+"/"+e},e.createDhbPath=function(){return t.dhbBasePath},e.updateDhbPath=function(t){return e.showDhbPath(t)},e.deleteDhbPath=function(t){return e.showDhbPath(t)},e.showWidgetPath=function(){return t.showWidgetPath},e.widgetBasePath=function(e){return t.widgetBasePath+"/"+e},e.createWidgetPath=function(t){return e.showDhbPath(t)+"/widgets"},e.updateWidgetPath=function(t){return e.widgetBasePath(t)},e.deleteWidgetPath=function(t){return e.widgetBasePath(t)},e},e.$inject=[],n.$get=e,n})}.call(this),function(){"use strict";angular.module("impac.services.theming",[]).provider("ImpacTheming",function(){var e,t,n;return n=this,t={chartColors:{positive:"#3FC4FF",negative:"#1DE9B6",array:["#1de9b6","#7c4dff","#ffc928","#3fc4ff","#ff8e01","#c6ff00","#d500fa","#ff6e41","#ffeb3c","#ff1844"]},dhbConfig:{showDhbHeading:!1,dhbHeadingText:"Impac!"},dhbSelectorConfig:{selectorType:"dropdown",customTmplPath:null,accessibilityEnabled:!1,addWidgetEnabled:!0,addDhbEnabled:!0,deleteDhbEnabled:!0},dataNotFoundConfig:{mainMessage:"Data not found",linkMessage:"Are you missing an app?",linkUrl:"",linkTarget:"_blank"},widgetSelectorConfig:{path:null},addChartTile:{show:!1,onClickOptions:{triggers:[]}},showNoWidgetMsg:{show:!0}},n.configure=function(e){return angular.merge(t,e)},e=function(){var e;return e=this,e.get=function(){return t},e},e.$inject=[],n.$get=e,n})}.call(this),function(){"use strict";angular.module("impac.services.utilities",[]).service("Utilities",function(){this.processRailsError=function(e){var t;return t=[],e.status&&401===e.status?t.push("Sorry! You are not authorized to perform this action"):e.data&&" "!==e.data?angular.isArray(e.data)?_.each(e.data,function(e){var n;return n=e.charAt(0).toUpperCase()+e.slice(1),t.push(""+n)}):angular.isObject(e.data)?_.each(e.data,function(e,n){var i;return i=n.charAt(0).toUpperCase()+n.slice(1),angular.isArray(e)?_.each(e,function(e){return i.match(/base/i)?t.push(e):t.push(i+" "+e)}):i.match(/base/i)?t.push(e):t.push(i+" "+e)}):angular.isString(e.data)?t.push(e.data):t.push("Potentially a system or communication error. Please retry later."):t.push("Potentially a system or communication error. Please retry later."),t}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widget",[]),e.controller("ImpacWidgetCtrl",["$scope","$log","$q","ImpacWidgetsSvc","Utilities",function(e,t,n,i){var a;return a=e.widget||{},e.widgetDeferred=n.defer(),e.widgetDeferred.promise.then(function(s){return n.all(s).then(function(){return i.show(a).then(function(){return e.isAccessibility?(a.initialWidth=a.width,a.width=12):a.initialWidth?a.width=a.initialWidth:void 0},function(n){return e.isDataFound=!1,t.error(n.data.error)})["finally"](a.isLoading=!1)},function(e){return a.isLoading=!1,t.error("widget "+a.id+" failed to render"),t.error(e)})}),e.initSettings=function(){return a.isEditMode=!1,i.initWidgetSettings(a)},e.updateSettings=function(e){return null==e&&(e=!0),a.isEditMode=!1,i.updateWidgetSettings(a,e)},a.getColClass=function(){return"col-md-"+a.width}}]),e.directive("impacWidget",["$templateCache",function(e){return{restrict:"A",scope:{parentDashboard:"=",widget:"=",isAccessibility:"="},controller:"ImpacWidgetCtrl",link:function(t){return t.widget.isLoading=!0,t.widget.settings=[],t.widget.hasEditAbility=!0,t.widget.hasDeleteAbility=!0,t.widgetContentTemplate=function(){var n,i;return n=angular.copy(t.widget.category).split("/"),n.splice(2),t.templateName=n.join("-").replace(/_/g,"-"),i="widgets/"+t.templateName+".tmpl.html",t.isAccessibility&&(e.get("widgets/"+t.templateName+".accessible.tmpl.html")&&(i="widgets/"+t.templateName+".accessible.tmpl.html"),t.templateName=t.templateName+" accessible"),i},t.isTemplateLoaded=function(){return!!e.get(t.widgetContentTemplate())}},template:e.get("widget/widget.tmpl.html")}}])}.call(this),function(){"use strict";angular.module("impac.services.widgets",[]).service("ImpacWidgetsSvc",["$q","$http","$log","ImpacRoutes","ImpacMainSvc","ImpacDashboardsSvc",function(e,t,n,i,a,s){var r,o;return r=this,this.config={},this.config.ssoSessionId="",this.load=function(t){var n;return null==t&&(t=!1),n=e.defer(),_.isEmpty(r.config.ssoSessionId)||t?e.all([a.loadUserData(t),s.load(t)]).then(function(e){return r.config.ssoSessionId=e[0].userData.ssoSession,n.resolve(r.config)},function(e){return n.reject(e)}):n.resolve(r.config),n.promise},this.create=function(a){var o;return o=e.defer(),r.load().then(function(){var e,r;return e=s.getCurrentDashboard(),r={widget:a},t.post(i.createWidgetPath(e.id),r).then(function(t){var n;return n=t.data,e.widgets.push(n),o.resolve(n)},function(t){return n.error("ImpacWidgetsSvc: cannot create widget on dashboard "+e.id),o.reject(t)})},function(e){return n.error("ImpacWidgetsSvc: error while trying to load the service"),o.reject(e)}),o.promise},o=function(e){var t;return t=s.getCurrentDashboard(),_.isEmpty(t)||_.isEmpty(t.widgets)?!1:_.contains(_.pluck(t.widgets,"id"),e)},this.initWidgetSettings=function(e){var t,n,i,a;if(!_.isEmpty(e.settings)){for(i=e.settings,t=0,n=i.length;n>t;t++)a=i[t],a.initialize();return!0}},this.updateWidgetSettings=function(t,n){var i,a,s,o,l,d;if(null==n&&(n=!0),i=e.defer(),_.isEmpty(t.settings))i.reject("no setting to update");else{for(n&&(t.isLoading=!0),o={},l=t.settings,a=0,s=l.length;s>a;a++)d=l[a],angular.merge(o,d.toMetadata());r.update(t,{metadata:o}).then(function(e){return n?r.show(e).then(function(e){return e.isLoading=!1,i.resolve(e)},function(t){return e.isLoading=!1,i.reject(t)}):i.resolve(e)},function(e){return i.reject(e)})}return i.promise},this.show=function(a,s){var l;return null==s&&(s=!1),l=e.defer(),r.load().then(function(){var e;return o(a.id)?(e={owner:a.owner,sso_session:r.config.ssoSessionId,metadata:a.metadata,engine:a.category},s&&angular.extend(e,{refresh_cache:!0}),t.post(i.showWidgetPath(a.id),e).then(function(e){var t,n,i,s,r;for(t=e.data.content||{},{name:e.data.name},angular.extend(a,{content:t,originalName:name}),angular.isDefined(a.initContext)&&a.initContext(),s=a.settings,n=0,i=s.length;i>n;n++)r=s[n],angular.isDefined(r.initialize)&&r.initialize();return angular.isDefined(a.format)&&a.format(),l.resolve(a)},function(e){return n.error("ImpacWidgetsSvc: cannot retrieve widget ("+a.id+") content from API"),l.reject(e)})):(n.info("ImpacWidgetsSvc: trying to load a widget (id: "+a.id+") that is not in currentDashboard"),l.reject("trying to load a widget (id: "+a.id+") that is not in currentDashboard"))},function(){return n.error("ImpacWidgetsSvc: error while trying to load the service"),l.reject(error)}),l.promise},this.update=function(a,s){var l,d;return d=e.defer(),r.load().then(function(){},o(a.id)?(l={widget:s},t.put(i.updateWidgetPath(a.id),l).then(function(e){var t;return t=e.data,angular.extend(a,t),d.resolve(a)},function(e){return n.error("ImpacWidgetsSvc: cannot update widget: "+a.id),d.reject(e)})):(n.info("ImpacWidgetsSvc: trying to update a widget (id: "+a.id+") that is not in currentDashboard"),d.reject("trying to update a widget (id: "+a.id+") that is not in currentDashboard")),function(e){return n.error("ImpacWidgetsSvc: error while trying to load the service"),d.reject(e)}),d.promise},this["delete"]=function(a){var o;return o=e.defer(),r.load().then(function(){var e;return e=s.getCurrentDashboard(),t["delete"](i.deleteWidgetPath(a.id)).then(function(t){return _.remove(e.widgets,function(e){return e.id===a.id}),o.resolve(t)},function(e){return n.error("ImpacWidgetsSvc: error while trying to delete widget: "+a.id),o.reject(e)})},function(e){return n.error("ImpacWidgetsSvc: error while trying to load the service"),o.reject(e)}),o.promise},r}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-common.data-not-found",[]),e.directive("commonDataNotFound",["$templateCache","ImpacAssets","ImpacTheming",function(e,t,n){return{restrict:"A",scope:{widgetEngine:"="},controller:["$scope",function(e){var i,a;return e.bgImage="",e.content=n.get().dataNotFoundConfig,i=t.get("dataNotFound"),e.widgetEngine&&i.length>0?(a=i.split(""),a="/"!==a[a.length-1]?a.concat("/").join(""):a.join(""),e.bgImage=a+e.widgetEngine+".png"):void 0}],template:e.get("widgets-common/data-not-found.tmpl.html")}}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-common.editable-title",[]),e.controller("CommonEditableTitleCtrl",["$scope","ImpacWidgetsSvc",function(e,t){var n;return n=e.parentWidget,e.updateName=function(){var e;return 0===n.name.length?(n.name=n.originalName,"Incorrect name"):(e={name:n.name},t.update(n,e).then(function(){return!0},function(){return n.name=n.originalName}))}}]),e.directive("commonEditableTitle",["$templateCache",function(e){return{restrict:"A",scope:{parentWidget:"="},template:e.get("widgets-common/editable-title.tmpl.html"),controller:"CommonEditableTitleCtrl"}
}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-common.top-buttons",[]),e.controller("CommonTopButtonsCtrl",["$scope","$rootScope","$log","ImpacWidgetsSvc","ImpacAssets",function(e,t,n,i){var a;return a=e.parentWidget,e.showCloseActive=!1,e.showConfirmDelete=!1,e.isDeletePopoverLoading=!1,a.isEditMode=!1,e.deleteWidget=function(){return e.isDeletePopoverLoading=!0,i["delete"](a).then(function(){return!0},function(e){return a.errors=Utilities.processRailsError(e)})["finally"](function(){return e.isDeletePopoverLoading=!1})},e.refreshWidget=function(){return a.isLoading=!0,i.show(a)["finally"](function(){return a.isLoading=!1})},e.toggleEditMode=function(){return a.isLoading?void 0:a.isEditMode?(a.isEditMode=!1,i.initWidgetSettings(a)):a.isEditMode=!0}}]),e.directive("commonTopButtons",["$templateCache",function(e){return{restrict:"A",scope:{parentWidget:"="},template:e.get("widgets-common/top-buttons.tmpl.html"),controller:"CommonTopButtonsCtrl"}}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-settings.account",[]),e.controller("SettingAccountCtrl",["$scope","$filter",function(e,t){var n,i;return i=e.parentWidget,n={},n.key="account",n.isInitialized=!1,n.initialize=function(){return i.selectedAccount=null,null!=i.content&&null!=i.content.account_list&&null!=i.metadata&&null!=i.metadata.account_uid?(i.selectedAccount=_.find(i.content.account_list,function(e){return e.uid===i.metadata.account_uid}),n.isInitialized=!0):void 0},n.toMetadata=function(){return null!=i.selectedAccount?{account_uid:i.selectedAccount.uid}:void 0},e.formatAmount=function(e){return t("mnoCurrency")(e.current_balance,e.currency)},i.settings.push(n),e.deferred.resolve(e.parentWidget)}]),e.directive("settingAccount",["$templateCache",function(e){return{restrict:"A",scope:{parentWidget:"=",deferred:"=",label:"@",onAccountSelected:"&"},link:function(e){return e.label?void 0:e.label="Account to monitor"},template:e.get("widgets-settings/account.tmpl.html"),controller:"SettingAccountCtrl"}}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-settings.accounts-list",[]),e.controller("SettingAccountsListCtrl",["$scope","ImpacWidgetsSvc",function(e,t){var n,i;return i=e.parentWidget,i.moveAccountToAnotherList=function(e,n,a,s){return null==s&&(s=!0),_.isEmpty(n)||_.isEmpty(e)?void 0:(a||(a=[]),_.remove(n,function(t){return e.uid===t.uid}),a.push(e),s?t.updateWidgetSettings(i,!1):void 0)},n={},n.key="accounts-list",n.initialize=function(){return n.isInitialized=!1,i.remainingAccounts=[],i.selectedAccounts=[],null==i.content||_.isEmpty(i.content.complete_list)?void 0:(i.remainingAccounts=angular.copy(i.content.complete_list),_.isEmpty(i.metadata.accounts_list)||angular.forEach(i.metadata.accounts_list,function(e){var t;return t=_.find(i.content.complete_list,function(t){return t.uid===e}),i.moveAccountToAnotherList(t,i.remainingAccounts,i.selectedAccounts,!1)}),n.isInitialized=!0)},n.toMetadata=function(){return n.isInitialized?{accounts_list:_.map(i.selectedAccounts,function(e){return e.uid})}:void 0},i.settings.push(n),e.deferred.resolve(e.parentWidget)}]),e.directive("settingAccountsList",function(){return{restrict:"A",scope:{parentWidget:"=",deferred:"="},controller:"SettingAccountsListCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-settings.chart-filters",[]),e.controller("SettingChartFiltersCtrl",["$scope",function(e){var t,n;return n=e.parentWidget,t={},t.key="chart-filters",t.isInitialized=!1,t.initialize=function(){return null!=n.content.chart_filter&&(e.filterCriteria=n.content.chart_filter.criteria)?(e.maxEntities=n.content.chart_filter.max,e.entityType=n.content.chart_filter.entity_type,e.filterLabel=n.content.chart_filter.filter_label.replace(/_/g," "),"number"===e.filterCriteria?(e.filterValuePercentage=80,e.filterValueNumber=n.content.chart_filter.value):(e.filterValuePercentage=n.content.chart_filter.value,e.filterValueNumber=Math.round(e.maxEntities/2)),t.isInitialized=!0):void 0},t.toMetadata=function(){var t;return null!=n.content.chart_filter?(t="percentage"===e.filterCriteria?e.filterValuePercentage:e.filterValueNumber,{chart_filter:{criteria:e.filterCriteria,value:t}}):{}},n.settings.push(t),e.deferred.resolve(e.parentWidget)}]),e.directive("settingChartFilters",["$templateCache",function(e){return{restrict:"A",scope:{parentWidget:"=",deferred:"="},template:e.get("widgets-settings/chart-filters.tmpl.html"),controller:"SettingChartFiltersCtrl"}}])}.call(this),function(){"use strict";var module;module=angular.module("impac.components.widgets-settings.formula",[]),module.controller("SettingFormulaCtrl",["$scope","$filter",function($scope,$filter){var authorized_regex,evaluateFormula,formatFormula,getFormula,setting,w;return w=$scope.parentWidget,w.formula="",authorized_regex=new RegExp("^(\\{|\\d|\\}|\\/|\\+|-|\\*|\\(|\\)|\\s|\\.)*$"),setting={},setting.key="formula",setting.isInitialized=!1,setting.initialize=function(){return null!=w.metadata&&null!=w.metadata.formula?(w.formula=w.metadata.formula,setting.isInitialized=!0):w.formula=""},setting.toMetadata=function(){return evaluateFormula(),w.isFormulaCorrect?{formula:w.formula}:{formula:""}},getFormula=function(){return w.formula},w.formatAmount=function(e){return $filter("mnoCurrency")(e.current_balance,e.currency)},$scope.$watch(getFormula,function(){return evaluateFormula()}),evaluateFormula=function(){var e,error,i,legend,str;str=angular.copy(w.formula),legend=angular.copy(w.formula),i=1,angular.forEach(w.selectedAccounts,function(e){var t;return t="\\{"+i+"\\}",str=str.replace(new RegExp(t,"g"),e.current_balance_no_format),legend=legend.replace(new RegExp(t,"g"),e.name),i++}),str.match(authorized_regex)||(w.isFormulaCorrect=!1,w.evaluatedFormula="invalid expression");try{w.evaluatedFormula=eval(str).toFixed(2)}catch(error){e=error,w.evaluatedFormula="invalid expression"}return null==w.evaluatedFormula||"invalid expression"===w.evaluatedFormula||"Infinity"===w.evaluatedFormula||"-Infinity"===w.evaluatedFormula?w.isFormulaCorrect=!1:(formatFormula(),w.legend=legend,w.isFormulaCorrect=!0)},formatFormula=function(){var e,t;return!w.formula.match(/\//g)&&null!=w.selectedAccounts&&(t=w.selectedAccounts[0])&&(e=t.currency)?w.evaluatedFormula=$filter("mnoCurrency")(w.evaluatedFormula,e):void 0},w.settings.push(setting),$scope.deferred.resolve($scope.parentWidget)}]),module.directive("settingFormula",function(){return{restrict:"A",scope:{parentWidget:"=",deferred:"="},controller:"SettingFormulaCtrl"}})}.call(this),function(){"use strict";var e,t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};e=angular.module("impac.components.widgets-settings.hist-mode",[]),e.controller("SettingHistModeCtrl",["$scope","ImpacWidgetsSvc",function(e,n){var i,a;return a=e.parentWidget,a.isHistoryMode=!1,e.toggleHistMode=function(i){var s;if(!(a.isHistoryMode&&"history"===i||!a.isHistoryMode&&"current"===i))return a.isHistoryMode=!a.isHistoryMode,n.updateWidgetSettings(a,!1),s=e.onToggle(),t.call(angular.isDefined(e.onToggle),s)>=0},i={},i.key="hist-mode",i.isInitialized=!1,i.initialize=function(){var e;return null!=a.content&&null!=a.content.hist_parameters&&(e=a.content.hist_parameters.mode)?(a.isHistoryMode="history"===e?!0:!1,i.isInitialized=!0):void 0},i.toMetadata=function(){var e;return e=a.isHistoryMode?"history":"current",{hist_parameters:{mode:e}}},a.settings.push(i),e.deferred.resolve(e.parentWidget)}]),e.directive("settingHistMode",["$templateCache",function(e){return{restrict:"A",scope:{parentWidget:"=",deferred:"=",onToggle:"&"},template:e.get("widgets-settings/hist-mode.tmpl.html"),controller:"SettingHistModeCtrl"}}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-settings.organizations",[]),e.controller("SettingOrganizationsCtrl",["$scope","$log","ImpacDashboardsSvc",function(e,t,n){var i,a;return a=e.parentWidget,a.selectedOrganizations={},n.load().then(function(t){return e.dashboardOrganizations=t.currentDashboard.data_sources}),e.isOrganizationSelected=function(e){return!!a.selectedOrganizations[e]},e.toggleSelectOrganization=function(e){return a.selectedOrganizations[e]=!a.selectedOrganizations[e]},i={},i.key="organizations",i.isInitialized=!1,i.initialize=function(){return null!=a.metadata&&null!=a.metadata.organization_ids?(angular.forEach(a.metadata.organization_ids,function(e){return a.selectedOrganizations[e]=!0}),i.isInitialized=!0):void 0},i.toMetadata=function(){var e;return e=_.compact(_.map(a.selectedOrganizations,function(e,t){return e?t:void 0})),{organization_ids:e}},a.settings.push(i),e.deferred.resolve(e.parentWidget)}]),e.directive("settingOrganizations",["$templateCache",function(e){return{restrict:"A",scope:{parentWidget:"=",deferred:"="},template:e.get("widgets-settings/organizations.tmpl.html"),controller:"SettingOrganizationsCtrl"}}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-settings.param-selector",[]),e.controller("SettingParamSelectorCtrl",["$scope","ImpacWidgetsSvc",function(e,t){var n,i;return e.showOptions=!1,e.toggleShowOptions=function(){return e.showOptions=!e.showOptions},e.selectOption=function(n){return n.value!==e.selected.value&&(angular.extend(e.selected,n),e.noReload||(e.parentWidget.isLoading=!0),t.updateWidgetSettings(e.parentWidget,!e.noReload),angular.isDefined(e.onSelect)&&e.onSelect()),e.toggleShowOptions()},e.getTruncateValue=function(){return parseInt(e.truncateNo)||20},i=e.parentWidget,n={},n.key="param-selector",n.isInitialized=!1,n.initialize=function(){return null!=i.content?n.isInitialized=!0:void 0},n.toMetadata=function(){var t;return t={},_.isEmpty(e.selected)||(t[e.param]=e.selected.value),t},i.settings.push(n),e.deferred.resolve(e.parentWidget)}]),e.directive("settingParamSelector",["$templateCache",function(e){return{restrict:"A",scope:{parentWidget:"=",deferred:"=",param:"@",options:"=",selected:"=",truncateNo:"@",onSelect:"&"},link:function(e,t,n){return e.noReload="undefined"!=typeof n.noReload,e.truncateNo=n.truncateNo||20},template:e.get("widgets-settings/param-selector.tmpl.html"),controller:"SettingParamSelectorCtrl"}}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-settings.params-picker",[]),e.controller("SettingParamsPickerCtrl",["$scope",function(e){var t,n;return n=e.parentWidget,t={},t.key="params-picker",t.isInitialized=!1,t.initialize=function(){return e.sortableOptions={"ui-floating":!0,tolerance:"pointer"},_.isEmpty(e.options)?t.isInitialized=!0:void 0},t.toMetadata=function(){var t;return t={},t[""+e.param]=_.compact(_.map(e.options,function(e){return e.selected?e.label:void 0})),t},n.settings.push(t),e.deferred.resolve(e.parentWidget)}]),e.directive("settingParamsPicker",["$templateCache",function(e){return{restrict:"A",scope:{parentWidget:"=",deferred:"=",param:"@",options:"="},link:function(e){return e.formattedParam=e.param.replace("_"," ")},template:e.get("widgets-settings/params-picker.tmpl.html"),controller:"SettingParamsPickerCtrl"}}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-settings.time-range",[]),e.controller("SettingTimeRangeCtrl",["$scope","$log",function(e){var t,n;return n=e.parentWidget,e.numberOfPeriods=(new Date).getMonth()+1,e.selectedPeriod="MONTHLY",e.PERIODS=["DAILY","WEEKLY","MONTHLY","QUARTERLY","YEARLY"],e.periodToUnit=function(){var t,n,i;return t=e.numberOfPeriods,n=e.selectedPeriod,i="DAILY"!==n?n.substring(0,n.length-2).toLowerCase():"day",t>1&&(i=i.concat("s")),i},t={},t.key="time-range",t.isInitialized=!1,t.initialize=function(){var i;return null!=n.metadata&&(i=n.metadata.hist_parameters)?(null!=i.period&&(e.selectedPeriod=i.period),null!=i.number_of_periods&&(e.numberOfPeriods=i.number_of_periods),t.isInitialized=!0):void 0},t.toMetadata=function(){return{hist_parameters:{period:e.selectedPeriod,number_of_periods:e.numberOfPeriods}}},n.settings||(n.settings=[]),n.settings.push(t),e.deferred.resolve(e.parentWidget)}]),e.directive("settingTimeRange",["$templateCache",function(e){return{restrict:"A",scope:{parentWidget:"=",deferred:"="},template:e.get("widgets-settings/time-range.tmpl.html"),controller:"SettingTimeRangeCtrl"}}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets-settings.width",[]),e.controller("SettingWidthCtrl",["$scope","$log","ImpacWidgetsSvc",function(e,t,n){var i,a;return a=e.parentWidget,a.toggleExpanded=function(){return e.expanded=!e.expanded,n.updateWidgetSettings(a,!1),a.width=e.expanded?parseInt(e.max):parseInt(e.min)},i={},i.key="width",i.isInitialized=!1,a.isExpanded=function(){return e.expanded},i.initialize=function(){return null!=a.width?(e.expanded=a.width===parseInt(e.max),i.isInitialized=!0):void 0},i.toMetadata=function(){var t;return t=e.expanded?e.max:e.min,{width:parseInt(t)}},a.settings.push(i),e.deferred.resolve(e.parentWidget)}]),e.directive("settingWidth",["$templateCache",function(e){return{restrict:"A",scope:{parentWidget:"=",deferred:"=",min:"@",max:"@"},template:e.get("widgets-settings/width.tmpl.html"),controller:"SettingWidthCtrl"}}])}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.accounts-accounting-values",[]),e.controller("WidgetAccountsAccountingValuesCtrl",["$scope","$q","ChartFormatterSvc",function(e,t,n){var i,a;return a=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.histModeDeferred=t.defer(),e.chartDeferred=t.defer(),i=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.histModeDeferred.promise,e.chartDeferred.promise],a.initContext=function(){return e.isDataFound=null!=a.content&&null!=a.content.accounting},e.getCurrentPrice=function(){return e.isDataFound?_.last(a.content.accounting.values):void 0},e.getCurrency=function(){return e.isDataFound?a.content.accounting.currency:void 0},e.getLegend=function(){return e.isDataFound?a.content.accounting.legend:void 0},e.drawTrigger=t.defer(),a.format=function(){var t,i,s,r,o;return e.isDataFound?(s=angular.copy(a.content.accounting),r={title:s.type,labels:s.dates,values:s.values},t=!0,angular.forEach(s.values,function(e){return t&&(t=e>=0)}),o={scaleBeginAtZero:t,showXLabels:!1},i=n.lineChart([r],o),e.drawTrigger.notify(i)):void 0},e.widgetDeferred.resolve(i)}]),e.directive("widgetAccountsAccountingValues",function(){return{restrict:"A",controller:"WidgetAccountsAccountingValuesCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.accounts-assets-summary",[]),e.controller("WidgetAccountsAssetsSummaryCtrl",["$scope","$q","ChartFormatterSvc",function(e,t,n){var i,a;return a=e.widget,e.orgDeferred=t.defer(),e.chartDeferred=t.defer(),i=[e.orgDeferred.promise,e.chartDeferred.promise],a.initContext=function(){return e.isDataFound=angular.isDefined(a.content)&&!_.isEmpty(a.content.summary)},e.getCurrency=function(){return e.isDataFound?a.content.currency:void 0},e.getAccountColor=function(t){return e.isDataFound?n.getColor(_.indexOf(a.content.summary,t)):void 0},e.drawTrigger=t.defer(),a.format=function(){var t,i,s;return e.isDataFound?(i=_.map(a.content.summary,function(e){return{label:e.label,value:e.total}}),s={percentageInnerCutout:50,tooltipFontSize:12},t=n.pieChart(i,s),e.drawTrigger.notify(t)):void 0},e.widgetDeferred.resolve(i)}]),e.directive("widgetAccountsAssetsSummary",function(){return{restrict:"A",controller:"WidgetAccountsAssetsSummaryCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.accounts-balance",[]),e.controller("WidgetAccountsBalanceCtrl",["$scope","$q","ChartFormatterSvc",function(e,t,n){var i,a;return a=e.widget,e.orgDeferred=t.defer(),e.accountBackDeferred=t.defer(),e.accountFrontDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.histModeDeferred=t.defer(),e.chartDeferred=t.defer(),i=[e.orgDeferred.promise,e.accountBackDeferred,e.accountFrontDeferred,e.timeRangeDeferred.promise,e.histModeDeferred.promise,e.chartDeferred.promise],a.initContext=function(){return e.isDataFound=null!=a.content&&!_.isEmpty(a.content.account_list)},e.getName=function(){return null!=a.selectedAccount?a.selectedAccount.name:void 0},e.getCurrentBalance=function(){return null!=a.selectedAccount?a.selectedAccount.current_balance:void 0},e.getCurrency=function(){return null!=a.selectedAccount?a.selectedAccount.currency:void 0},e.displayAccount=function(){return e.updateSettings(!1),a.format()},e.drawTrigger=t.defer(),a.format=function(){var t,i,s,r,o;return e.isDataFound&&null!=a.selectedAccount?(s=angular.copy(a.selectedAccount),r={title:s.name,labels:a.content.dates,values:s.balances},t=!0,angular.forEach(s.balances,function(e){return t&&(t=e>=0)}),o={scaleBeginAtZero:t,showXLabels:!1},i=n.lineChart([r],o),e.drawTrigger.notify(i)):void 0},e.widgetDeferred.resolve(i)}]),e.directive("widgetAccountsBalance",function(){return{restrict:"A",controller:"WidgetAccountsBalanceCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.accounts-balance-sheet",[]),e.controller("WidgetAccountsBalanceSheetCtrl",["$scope","$q","ChartFormatterSvc","ImpacWidgetsSvc",function(e,t,n,i){var a,s,r;return r=e.widget,e.orgDeferred=t.defer(),e.paramSelectorFrontDeferred=t.defer(),e.paramSelectorBackDeferred=t.defer(),a=[e.orgDeferred.promise,e.paramSelectorFrontDeferred.promise,e.paramSelectorBackDeferred.promise],e.periodOptions=[{label:"Year",value:"YEARLY"},{label:"Quarter",value:"QUARTERLY"},{label:"Month",value:"MONTHLY"},{label:"Week",value:"WEEKLY"},{label:"Day",value:"DAILY"}],e.period=angular.copy(e.periodOptions[2]),r.initContext=function(){return null!=r.content&&null!=r.content.period&&_.contains(_.pluck(e.periodOptions,"value"),r.content.period)&&(e.period=angular.copy(_.find(e.periodOptions,function(e){return e.value===r.content.period}))),(e.isDataFound=angular.isDefined(r.content)&&!_.isEmpty(r.content.summary)&&!_.isEmpty(r.content.dates))?(e.dates=r.content.dates,e.unCollapsed=r.metadata.unCollapsed||[],e.categories=Object.keys(r.content.summary)):void 0},e.toggleCollapsed=function(t){return null!=t?(_.find(e.unCollapsed,function(e){return t===e})?e.unCollapsed=_.reject(e.unCollapsed,function(e){return e===t}):e.unCollapsed.push(t),i.updateWidgetSettings(r,!1)):void 0},e.isCollapsed=function(t){return null!=t?_.find(e.unCollapsed,function(e){return t===e})?!1:!0:void 0},s={},s.initialized=!1,s.initialize=function(){return s.initialized=!0},s.toMetadata=function(){return{unCollapsed:e.unCollapsed}},r.settings.push(s),e.widgetDeferred.resolve(a)}]),e.directive("widgetAccountsBalanceSheet",function(){return{restrict:"A",controller:"WidgetAccountsBalanceSheetCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.accounts-cash-summary",[]),e.controller("WidgetAccountsCashSummaryCtrl",["$scope","$q","ChartFormatterSvc","$filter","ImpacWidgetsSvc",function(e,t,n,i,a){var s,r,o,l;return l=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.widthDeferred=t.defer(),e.chartDeferred=t.defer(),r=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.widthDeferred.promise,e.chartDeferred.promise],l.initContext=function(){return(e.isDataFound=angular.isDefined(l.content)&&!_.isEmpty(l.content.summary)&&!_.isEmpty(l.content.dates))&&(e.dates=l.content.dates,e.unCollapsed=l.metadata.unCollapsed||[],l.metadata.selectedElement&&(e.selectedElement=_.find(l.content.summary,function(e){return e.name===l.metadata.selectedElement.name}),!e.selectedElement))?angular.forEach(l.content.summary,function(t){return null!=t.accounts?e.selectedElement||(e.selectedElement=_.find(t.accounts,function(e){return e.id===l.metadata.selectedElement.id})):void 0}):void 0},e.getLastDate=function(){return null!=e.dates?_.last(e.dates):void 0},e.getLastValue=function(e){return null!=e.cash_flows?_.last(e.cash_flows):void 0},e.formatVariance=function(e){return null!=e?e>0?"+"+e+" %":e+" %":"n/a"},e.getLastVariance=function(t){return null!=t.variances&&null!=_.last(t.variances)?e.formatVariance(_.last(t.variances)):"n/a"},e.getVarianceClassColor=function(e){return parseInt(e)>0?"positive":parseInt(e)<0?"negative":null},e.getName=function(e){return null!=e&&null!=e.name?e.name.replace("_"," "):void 0},e.toggleSelectedElement=function(t){return e.isSelected(t)?(e.selectedElement=null,l.isExpanded()?l.toggleExpanded():a.updateWidgetSettings(l,!1)):(e.selectedElement=angular.copy(t),l.format(),l.isExpanded()?a.updateWidgetSettings(l,!1):l.toggleExpanded())},e.isSelected=function(t){return null!=t&&null!=e.selectedElement?null!=t.id&&e.selectedElement.id&&t.id===e.selectedElement.id||t.name===e.selectedElement.name?!0:!1:!1},e.toggleCollapsed=function(t){return null!=t&&null!=t.name?(_.find(e.unCollapsed,function(e){return t.name===e})?e.unCollapsed=_.reject(e.unCollapsed,function(e){return e===t.name}):e.unCollapsed.push(t.name),a.updateWidgetSettings(l,!1)):void 0},e.isCollapsed=function(t){return null!=t&&null!=t.name?_.find(e.unCollapsed,function(e){return t.name===e})?!1:!0:void 0},e.drawTrigger=t.defer(),l.format=function(){var t,a,s,r,o,d;return e.isDataFound&&null!=e.selectedElement?(s=angular.copy(e.selectedElement),o=_.map(l.content.dates,function(e){return null!=l.metadata.hist_parameters&&"YEARLY"===l.metadata.hist_parameters.period?i("date")(e,"yyyy"):null!=l.metadata.hist_parameters&&"QUARTERLY"===l.metadata.hist_parameters.period?i("date")(e,"MMM-yy"):null==l.metadata.hist_parameters||"WEEKLY"!==l.metadata.hist_parameters.period&&"DAILY"!==l.metadata.hist_parameters.period?i("date")(e,"MMM"):i("date")(e,"dd-MMM")}),r={title:s.name,labels:o,values:s.cash_flows},t=!0,angular.forEach(s.cash_flows,function(e){return t&&(t=e>=0)}),d={scaleBeginAtZero:t,showXLabels:!0},a=n.lineChart([r],d),e.drawTrigger.notify(a)):void 0},o={},o.initialized=!1,o.initialize=function(){return o.initialized=!0},o.toMetadata=function(){return{unCollapsed:e.unCollapsed}},l.settings.push(o),s={},s.initialized=!1,s.initialize=function(){return s.initialized=!0},s.toMetadata=function(){return{selectedElement:e.selectedElement}},l.settings.push(s),e.widgetDeferred.resolve(r)}]),e.directive("widgetAccountsCashSummary",function(){return{restrict:"A",controller:"WidgetAccountsCashSummaryCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.accounts-comparison",[]),e.controller("WidgetAccountsComparisonCtrl",["$scope","$q","ChartFormatterSvc","$filter",function(e,t,n,i){var a,s;return s=e.widget,e.orgDeferred=t.defer(),e.accountsListDeferred=t.defer(),e.chartDeferred=t.defer(),a=[e.orgDeferred.promise,e.accountsListDeferred.promise,e.chartDeferred.promise],s.initContext=function(){return e.isDataFound=null!=s.content&&!_.isEmpty(s.content.complete_list),e.movedAccount={}},e.hasAccountsSelected=function(){return s.selectedAccounts&&s.selectedAccounts.length>0},e.getAccountColor=function(e){return n.getColor(_.indexOf(s.selectedAccounts,e))},e.addAccount=function(e){return s.moveAccountToAnotherList(e,s.remainingAccounts,s.selectedAccounts),s.format()},e.removeAccount=function(e){return s.moveAccountToAnotherList(e,s.selectedAccounts,s.remainingAccounts),s.format()},e.formatAmount=function(e){return i("mnoCurrency")(e.current_balance,e.currency)},e.drawTrigger=t.defer(),s.format=function(){var t,i,a;for(i={labels:[],values:[]},_.map(s.selectedAccounts,function(e){return i.labels.push(e.name),i.values.push(e.current_balance)});i.values.length<15;)i.labels.push(""),i.values.push(null);return a={showTooltips:!1,showXLabels:!1,barDatasetSpacing:9},t=n.barChart(i,a),e.drawTrigger.notify(t)},e.widgetDeferred.resolve(a)}]),e.directive("widgetAccountsComparison",function(){return{restrict:"A",controller:"WidgetAccountsComparisonCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.accounts-custom-calculation",[]),e.controller("WidgetAccountsCustomCalculationCtrl",["$scope","$timeout","$modal","$q","$templateCache","ImpacWidgetsSvc",function(e,t,n,i,a,s){var r,o;return o=e.widget,e.orgDeferred=i.defer(),e.accountsListDeferred=i.defer(),e.formulaDeferred=i.defer(),r=[e.orgDeferred.promise,e.accountsListDeferred.promise,e.formulaDeferred.promise],o.initContext=function(){return e.movedAccount={},e.isDataFound=null!=o.content&&!_.isEmpty(o.content.complete_list)},e.addAccountToFormula=function(e){return null!=e?(o.selectedAccounts.length>0?o.formula+=" + {"+(o.selectedAccounts.length+1)+"}":o.formula="{1}",o.moveAccountToAnotherList(e,o.remainingAccounts,o.selectedAccounts,!1)):void 0},e.removeAccountFromFormula=function(e){var t,n,i,a,s,r,l,d;for(l=_.map(o.selectedAccounts,function(e){return e.uid}),r=_.reject(l,function(t){return t===e.uid}),n=_.first(_.difference(l,r)),t=_.indexOf(l,n)+1,d=1===t?"{"+t+"\\}\\s*(-|\\*|\\/|\\+)*\\s*":"\\s*(-|\\*|\\/|\\+)*\\s*\\{"+t+"\\}",s=angular.copy(o.formula).replace(new RegExp(d,"g"),""),i=t+1;i<=l.length;)a="\\{"+i+"\\}",s=s.replace(new RegExp(a,"g"),"{"+(i-1)+"}"),i++;return o.formula=angular.copy(s),o.moveAccountToAnotherList(e,o.selectedAccounts,o.remainingAccounts,!1)},e.formulaModal=e.$new(),e.formulaModal.config={backdrop:"static",template:a.get("widgets/accounts-custom-calculation/formula.modal.html"),size:"lg",scope:e.formulaModal,keyboard:!1},e.formulaModal.open=function(){var t;return t=e.formulaModal,t.modalOrgDeferred=i.defer(),_.remove(o.settings,function(e){return"organizations"===e.key}),t.instance=n.open(t.config),t.modalOrgDeferred.promise.then(function(){return e.initSettings()})},e.$watch(function(){return o.selectedOrganizations},function(e){return _.isEmpty(e)?void 0:s.updateWidgetSettings(o)},!0),e.formulaModal.cancel=function(){return e.initSettings(),e.formulaModal.close()},e.formulaModal.proceed=function(){return s.updateWidgetSettings(o,!1),e.formulaModal.close()},e.formulaModal.close=function(){return e.formulaModal.instance.close()},e.$watch(function(){return o.isEditMode},function(t,n){return t&&!n?e.formulaModal.open():void 0}),e.widgetDeferred.resolve(r)}]),e.directive("widgetAccountsCustomCalculation",function(){return{restrict:"A",controller:"WidgetAccountsCustomCalculationCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.accounts-expenses-revenue",[]),e.controller("WidgetAccountsExpensesRevenueCtrl",["$scope","$q","ChartFormatterSvc",function(e,t,n){var i,a;return a=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.histModeDeferred=t.defer(),e.chartDeferred=t.defer(),i=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.histModeDeferred.promise,e.chartDeferred.promise],a.initContext=function(){return e.isDataFound=null!=a.content&&null!=a.content.values},e.getCurrentRevenue=function(){return e.isDataFound?_.last(a.content.values.revenue):void 0},e.getCurrentExpenses=function(){return e.isDataFound?_.last(a.content.values.expenses):void 0},e.getCurrency=function(){return e.isDataFound?a.content.currency:void 0},e.drawTrigger=t.defer(),a.format=function(){var t,i,s,r,o,l;return e.isDataFound?(a.isHistoryMode?(s=[{title:"Expenses ("+e.getCurrency()+")",labels:a.content.dates,values:a.content.values.expenses},{title:"Revenue ("+e.getCurrency()+")",labels:a.content.dates,values:a.content.values.revenue}],t=!0,angular.forEach(a.content.values.expenses,function(e){return t&&(t=e>=0)}),angular.forEach(a.content.values.revenue,function(e){return t&&(t=e>=0)}),r={scaleBeginAtZero:t,showXLabels:!1},i=n.lineChart(s,r,!0)):(o=[{label:"Expenses ("+e.getCurrency()+")",value:e.getCurrentExpenses()},{label:"Revenue ("+e.getCurrency()+")",value:e.getCurrentRevenue()}],l={tooltipFontSize:12,percentageInnerCutout:0},i=n.pieChart(o,l,!0)),e.drawTrigger.notify(i)):void 0},e.widgetDeferred.resolve(i)}]),e.directive("widgetAccountsExpensesRevenue",function(){return{restrict:"A",controller:"WidgetAccountsExpensesRevenueCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.accounts-payable-receivable",[]),e.controller("WidgetAccountsPayableReceivableCtrl",["$scope","$q","ChartFormatterSvc",function(e,t,n){var i,a;return a=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.histModeDeferred=t.defer(),e.chartDeferred=t.defer(),i=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.histModeDeferred.promise,e.chartDeferred.promise],a.initContext=function(){return e.isDataFound=null!=a.content&&null!=a.content.values},e.getCurrentPayable=function(){return e.isDataFound?_.last(a.content.values.payables):void 0},e.getCurrentReceivable=function(){return e.isDataFound?_.last(a.content.values.receivables):void 0},e.getCurrency=function(){return e.isDataFound?a.content.currency:void 0},e.drawTrigger=t.defer(),a.format=function(){var t,i,s,r,o,l,d,c,u,g,h;if(e.isDataFound){for(d=[{title:"Payable",labels:a.content.dates,values:a.content.values.payables},{title:"Receivable",labels:a.content.dates,values:a.content.values.receivables}],t=!0,u=a.content.values.payables,s=0,o=u.length;o>s;s++)h=u[s],t&&(t=h>=0);for(g=a.content.values.receivables,r=0,l=g.length;l>r;r++)h=g[r],t&&(t=h>=0);return c={scaleBeginAtZero:t,showXLabels:!1},i=n.lineChart(d,c,!0),e.drawTrigger.notify(i)}},e.widgetDeferred.resolve(i)}]),e.directive("widgetAccountsPayableReceivable",function(){return{restrict:"A",controller:"WidgetAccountsPayableReceivableCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.accounts-profit-and-loss",[]),e.controller("WidgetAccountsProfitAndLossCtrl",["$scope","$q","ChartFormatterSvc","$filter","ImpacWidgetsSvc",function(e,t,n,i,a){var s,r,o,l;return l=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.widthDeferred=t.defer(),e.chartDeferred=t.defer(),r=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.widthDeferred.promise,e.chartDeferred.promise],l.initContext=function(){return!(e.isDataFound=angular.isDefined(l.content)&&!_.isEmpty(l.content.summary)&&!_.isEmpty(l.content.dates))||(e.dates=l.content.dates,e.unCollapsed=l.metadata.unCollapsed||[],l.metadata.selectedElements&&(e.selectedElements=[],angular.forEach(l.metadata.selectedElements,function(t){var n;return n=_.find(l.content.summary,function(e){return e.name===t.name}),n||angular.forEach(l.content.summary,function(e){return null!=e.accounts?n||(n=_.find(e.accounts,function(e){return t.id===e.id})):void 0}),n?e.selectedElements.push(n):void 0})),null!=e.selectedElements&&e.selectedElements.length>0)?void 0:l.width=6},e.getElementChartColor=function(e){return n.getColor(e)},e.getLastDate=function(){return null!=e.dates?_.last(e.dates):void 0},e.getLastValue=function(e){return null!=e.totals?_.last(e.totals):void 0},e.getClassColor=function(e){return parseInt(e)>0?"positive":parseInt(e)<0?"negative":null},e.getName=function(e){return null!=e&&null!=e.name?e.name.replace(/_/g," "):void 0},e.toggleSelectedElement=function(t){return e.isSelected(t)?(e.selectedElements=_.reject(e.selectedElements,function(e){return t.id?e.id===t.id:e.name===t.name}),l.format(),l.isExpanded()&&0===e.selectedElements.length?l.toggleExpanded():a.updateWidgetSettings(l,!1)):(e.selectedElements||(e.selectedElements=[]),e.selectedElements.push(t),l.format(),l.isExpanded()?a.updateWidgetSettings(l,!1):l.toggleExpanded())},e.isSelected=function(t){return null!=t&&null!=e.selectedElements?_.find(e.selectedElements,function(e){return t.id?e.id===t.id:e.name===t.name})?!0:!1:!1},e.toggleCollapsed=function(t){return null!=t&&null!=t.name?(_.find(e.unCollapsed,function(e){return t.name===e})?e.unCollapsed=_.reject(e.unCollapsed,function(e){return e===t.name}):e.unCollapsed.push(t.name),a.updateWidgetSettings(l,!1)):void 0},e.isCollapsed=function(t){return null!=t&&null!=t.name?_.find(e.unCollapsed,function(e){return t.name===e})?!1:!0:void 0},e.hasElements=function(){return null!=e.selectedElements&&e.selectedElements.length>0
},e.drawTrigger=t.defer(),l.format=function(){var t,a,s,r;return e.isDataFound&&null!=e.selectedElements&&e.selectedElements.length>0?(t=!0,s=[],angular.forEach(e.selectedElements,function(e){var n,a;return n=angular.copy(e),a=_.map(l.content.dates,function(e){return l.metadata.hist_parameters&&"YEARLY"===l.metadata.hist_parameters.period?i("date")(e,"yyyy"):l.metadata.hist_parameters&&"QUARTERLY"===l.metadata.hist_parameters.period?i("date")(e,"MMM-yy"):!l.metadata.hist_parameters||"WEEKLY"!==l.metadata.hist_parameters.period&&"DAILY"!==l.metadata.hist_parameters.period?i("date")(e,"MMM"):i("date")(e,"dd-MMM")}),s.push({title:n.name,labels:a,values:n.totals}),angular.forEach(n.totals,function(e){return t&&(t=e>=0)})}),r={scaleBeginAtZero:t,showXLabels:!0,datasetFill:1===e.selectedElements.length,pointDot:1===e.selectedElements.length},a=n.lineChart(s,r),e.drawTrigger.notify(a)):void 0},o={},o.initialized=!1,o.initialize=function(){return o.initialized=!0},o.toMetadata=function(){return{unCollapsed:e.unCollapsed}},l.settings.push(o),s={},s.initialized=!1,s.initialize=function(){return s.initialized=!0},s.toMetadata=function(){return{selectedElements:e.selectedElements}},l.settings.push(s),e.widgetDeferred.resolve(r)}]),e.directive("widgetAccountsProfitAndLoss",function(){return{restrict:"A",controller:"WidgetAccountsProfitAndLossCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.hr-employee-details",[]),e.controller("WidgetHrEmployeeDetailsCtrl",["$scope","$q","Utilities","$filter",function(e,t,n,i){var a,s;return s=e.widget,e.orgDeferred=t.defer(),e.widthDeferred=t.defer(),e.paramSelectorDeferred1=t.defer(),e.paramSelectorDeferred2=t.defer(),a=[e.orgDeferred.promise,e.widthDeferred.promise,e.paramSelectorDeferred1.promise,e.paramSelectorDeferred2.promise],s.initContext=function(){return(e.isDataFound=!_.isEmpty(s.content.employees))?(e.periodOptions=[{label:"Yearly",value:"yearly"},{label:"Monthly",value:"monthly"},{label:"Weekly",value:"weekly"},{label:"Hourly",value:"hourly"}],e.period=s.metadata&&s.metadata.period?_.find(e.periodOptions,function(e){return e.value===s.metadata.period.toLowerCase()})||e.periodOptions[0]:e.periodOptions[0],e.employeesOptions=_.map(s.content.employees,function(e){return{value:e.uid,label:e.lastname+" "+e.firstname}}),e.selectedEmployee={value:e.getEmployee().uid,label:e.getEmployee().lastname+" "+e.getEmployee().firstname}):void 0},e.getSingleCompanyName=function(){var t,n;return s.content&&s.content.organizations&&(n=s.content.organizations[0],t=_.find(e.parentDashboard.data_sources,function(e){return e.uid===n}),null!=t)?t.label:void 0},e.getEmployee=function(){var t;return e.isDataFound?(t=s.metadata&&s.metadata.employee_uid?angular.copy(_.find(s.content.employees,function(e){return e.uid===s.metadata.employee_uid})||s.content.employees[0]):angular.copy(s.content.employees[0]),t.salary&&(t.salary=i("mnoCurrency")(t.salary.amount,t.salary.currency)),t):!1},e.formatAddress=function(e){return angular.isDefined(e)?e.replace(/, /g,",\n"):void 0},e.widgetDeferred.resolve(a)}]),e.directive("widgetHrEmployeeDetails",function(){return{restrict:"A",controller:"WidgetHrEmployeeDetailsCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.hr-employees-list",[]),e.controller("WidgetHrEmployeesListCtrl",["$scope","$q","Utilities","$filter",function(e,t,n,i){var a,s;return s=e.widget,e.orgDeferred=t.defer(),e.paramSelectorDeferred=t.defer(),a=[e.orgDeferred.promise,e.paramSelectorDeferred.promise],s.initContext=function(){return(e.isDataFound=!_.isEmpty(s.content.total)&&!_.isEmpty(s.content.employees))?(e.periodOptions=[{label:"Yearly",value:"yearly"},{label:"Monthly",value:"monthly"},{label:"Weekly",value:"weekly"},{label:"Hourly",value:"hourly"}],e.period=_.find(e.periodOptions,function(e){return e.value===s.content.total.period.toLowerCase()})||e.periodOptions[0]):void 0},e.getSingleCompanyName=function(){var t,n;return s.content&&s.content.organizations?(n=s.content.organizations[0],t=_.find(e.parentDashboard.data_sources,function(e){return e.uid===n}),t.label):void 0},e.getEmployeeSalary=function(e){return null!=e.salary?i("mnoCurrency")(e.salary.amount,s.content.total.currency):"-"},e.widgetDeferred.resolve(a)}]),e.directive("widgetHrEmployeesList",function(){return{restrict:"A",controller:"WidgetHrEmployeesListCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.hr-leaves-balance",[]),e.controller("WidgetHrLeavesBalanceCtrl",["$scope","$q","Utilities",function(e,t){var n,i;return i=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.paramSelectorDeferred=t.defer(),n=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.paramSelectorDeferred.promise],i.initContext=function(){return(e.isDataFound=!_.isEmpty(i.content.employees)&&!_.isEmpty(i.content.dates))?(e.employeesOptions=_.map(i.content.employees,function(e){return{value:e.id,label:e.lastname+" "+e.firstname}}),e.selectedEmployee={value:e.getEmployee().id,label:e.getEmployee().lastname+" "+e.getEmployee().firstname}):void 0},e.getEmployee=function(){return e.isDataFound?i.metadata&&i.metadata.employee_id?_.find(i.content.employees,function(e){return e.id===i.metadata.employee_id})||i.content.employees[0]:i.content.employees[0]:!1},e.widgetDeferred.resolve(n)}]),e.directive("widgetHrLeavesBalance",function(){return{restrict:"A",controller:"WidgetHrLeavesBalanceCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.hr-leaves-schedule",[]),e.controller("WidgetHrLeavesScheduleCtrl",["$scope","$q","ChartFormatterSvc",function(e,t){var n,i;return i=e.widget,e.orgDeferred=t.defer(),n=[e.orgDeferred.promise],i.initContext=function(){var t;return(e.isDataFound=angular.isDefined(i.content)&&!_.isEmpty(i.content.summary))?(t=[],angular.forEach(i.content.summary,function(e){return t.push({title:e.employee_name+" - "+e.title,start:e.start_date,end:e.end_date})}),e.eventSources=angular.copy(t)):void 0},e.widgetDeferred.resolve(n)}]),e.directive("widgetHrLeavesSchedule",function(){return{restrict:"A",controller:"WidgetHrLeavesScheduleCtrl"}}),e.directive("widgetComponentCalendar",function(){return{scope:{events:"=ngModel"},restrict:"A",link:function(e,t){var n,i;return e.eventSources=[],n={header:{left:"prev",center:"title",right:"next"},contentHeight:204},i=function(){return e.events},e.$watch(i,function(i){return i.length>0?(t.fullCalendar("destroy"),angular.extend(n,{events:e.events}),t.fullCalendar(n)):void 0},!0)}}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.hr-payroll-summary",[]),e.controller("WidgetHrPayrollSummaryCtrl",["$scope","$q","ChartFormatterSvc","$filter","ImpacWidgetsSvc",function(e,t,n,i,a){var s,r,o,l;return l=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.widthDeferred=t.defer(),e.histModeDeferred=t.defer(),e.chartDeferred=t.defer(),r=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.widthDeferred.promise,e.histModeDeferred.promise,e.chartDeferred.promise],l.initContext=function(){return!(e.isDataFound=angular.isDefined(l.content)&&!_.isEmpty(l.content.summary)&&!_.isEmpty(l.content.dates))||(e.unCollapsed=l.metadata.unCollapsed||[],l.metadata.selectedElements&&(e.selectedElements=[],angular.forEach(l.metadata.selectedElements,function(t){var n;return n=_.find(l.content.summary,function(e){return e.name===t.name}),n||angular.forEach(l.content.summary,function(e){return null!=e.employees?n||(n=_.find(e.employees,function(e){return t.id===e.id})):void 0}),n?e.selectedElements.push(n):void 0})),null!=e.selectedElements&&e.selectedElements.length>0)?void 0:l.width=6},e.getElementChartColor=function(e){return n.getColor(e)},e.getLastValue=function(e){return null!=e.totals?e.totals[e.totals.length-2]:void 0},e.getTotalSum=function(e){return null!=e.totals?_.reduce(e.totals,function(e,t){return e+t},0):void 0},e.getName=function(e){return null!=e&&null!=e.name?"total_leaves"===e.name?"Total Leaves Accruals":"total_super"===e.name?"Total Superannuation Accruals":"total_reimbursement"===e.name?"Total Reimbursements":"total_tax"===e.name?"Total Taxes":"total_timeoff"===e.name?"Total Time Off":e.name.replace(/_/g," "):void 0},e.getTrackedField=function(){var t,n;return null==e.selectedElements||_.isEmpty(e.selectedElements)||null==e.selectedElements[0].id?void 0:(n=e.selectedElements[0].id.split("-")[0],t=!0,angular.forEach(e.selectedElements,function(e){return t&&(t=e.id&&n===e.id.split("-")[0])}),t?e.getName({name:n}):null)},e.formatDate=function(e){if(null==l.content.hist_parameters)return i("date")(e,"MMM");switch(l.content.hist_parameters.period){case"DAILY":return i("date")(e,"dd-MMM");case"WEEKLY":return i("date")(e,"dd-MMM");case"MONTHLY":return i("date")(e,"MMM");case"QUARTERLY":return i("date")(e,"MMM-yy");case"YEARLY":return i("date")(e,"yyyy");default:return i("date")(e,"MMM")}},e.toggleSelectedElement=function(t){return e.isSelected(t)?(e.selectedElements=_.reject(e.selectedElements,function(e){return t.id?e.id===t.id:e.name===t.name}),l.format(),l.isExpanded()&&0===e.selectedElements.length?l.toggleExpanded():a.updateWidgetSettings(l,!1)):(e.selectedElements||(e.selectedElements=[]),e.selectedElements.push(t),l.format(),l.isExpanded()?a.updateWidgetSettings(l,!1):l.toggleExpanded())},e.isSelected=function(t){return null!=t&&null!=e.selectedElements?_.find(e.selectedElements,function(e){return t.id?e.id===t.id:e.name===t.name})?!0:!1:!1},e.toggleCollapsed=function(t){return null!=t&&null!=t.name?(_.find(e.unCollapsed,function(e){return t.name===e})?e.unCollapsed=_.reject(e.unCollapsed,function(e){return e===t.name}):e.unCollapsed.push(t.name),a.updateWidgetSettings(l,!1)):void 0},e.getPeriod=function(){var t,n;return e.isDataFound&&l.content.hist_parameters?(n=l.content.hist_parameters.period||"MONTHLY",t="day","DAILY"!==n&&(t=n.substr(0,n.length-2).toLowerCase()),"last "+t):"last MONTH"},e.isCollapsed=function(t){return null!=t&&null!=t.name?_.find(e.unCollapsed,function(e){return t.name===e})?!1:!0:void 0},e.hasElements=function(){return null!=e.selectedElements&&e.selectedElements.length>0},e.drawTrigger=t.defer(),l.format=function(){var t,a,s,r,o,d,c;return e.isDataFound&&e.hasElements()?(l.isHistoryMode?(t=!0,s=[],r=_.map(l.content.dates,function(e){return l.metadata.hist_parameters&&"YEARLY"===l.metadata.hist_parameters.period?i("date")(e,"yyyy"):l.metadata.hist_parameters&&"QUARTERLY"===l.metadata.hist_parameters.period?i("date")(e,"MMM-yy"):!l.metadata.hist_parameters||"WEEKLY"!==l.metadata.hist_parameters.period&&"DAILY"!==l.metadata.hist_parameters.period?i("date")(e,"MMM"):i("date")(e,"dd-MMM")}),angular.forEach(e.selectedElements,function(e){var n;return n=angular.copy(e),s.push({title:n.name,labels:r,values:n.totals}),angular.forEach(n.totals,function(e){return t&&(t=e>=0)})}),o={scaleBeginAtZero:t,showXLabels:!0,datasetFill:1===e.selectedElements.length,pointDot:1===e.selectedElements.length},a=n.lineChart(s,o)):(d=_.map(e.selectedElements,function(t){return{label:i("titleize")(e.getName({name:t.name})),value:e.getLastValue(t)}}),c={showTooltips:!0,percentageInnerCutout:50,tooltipFontSize:12},a=n.pieChart(d,c)),e.drawTrigger.notify(a)):void 0},o={},o.initialized=!1,o.initialize=function(){return o.initialized=!0},o.toMetadata=function(){return{unCollapsed:e.unCollapsed}},l.settings.push(o),s={},s.initialized=!1,s.initialize=function(){return s.initialized=!0},s.toMetadata=function(){return{selectedElements:e.selectedElements}},l.settings.push(s),e.widgetDeferred.resolve(r)}]),e.directive("widgetHrPayrollSummary",function(){return{restrict:"A",controller:"WidgetHrPayrollSummaryCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.hr-payroll-taxes",[]),e.controller("WidgetHrPayrollTaxesCtrl",["$scope","$q","ChartFormatterSvc",function(e,t,n){var i,a;return a=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.histModeDeferred=t.defer(),e.chartDeferred=t.defer(),i=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.histModeDeferred.promise,e.chartDeferred.promise],a.initContext=function(){return e.isDataFound=null!=a.content&&a.content.total_tax&&a.content.dates},e.getCurrentPrice=function(){return e.isDataFound?_.last(a.content.total_tax):void 0},e.getCurrency=function(){return e.isDataFound?a.content.currency||"USD":void 0},e.getPeriod=function(){var t,n;return e.isDataFound&&a.content.hist_parameters?(n=a.content.hist_parameters.period||"MONTHLY",t="day","DAILY"!==n&&(t=n.substr(0,n.length-2).toLowerCase()),"(current "+t+")"):void 0},e.drawTrigger=t.defer(),a.format=function(){var t,i,s,r;return e.isDataFound?(s={title:"Payroll Taxes",labels:a.content.dates,values:a.content.total_tax},t=!0,angular.forEach(a.content.total_tax,function(e){return t&&(t=e>=0)}),r={scaleBeginAtZero:t,showXLabels:!1},i=n.lineChart([s],r),e.drawTrigger.notify(i)):void 0},e.widgetDeferred.resolve(i)}]),e.directive("widgetHrPayrollTaxes",function(){return{restrict:"A",controller:"WidgetHrPayrollTaxesCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.hr-salaries-summary",[]),e.controller("WidgetHrSalariesSummaryCtrl",["$scope","$q","ChartFormatterSvc",function(e,t,n){var i,a;return a=e.widget,e.orgDeferred=t.defer(),e.widthDeferred=t.defer(),e.paramSelectorDeferred1=t.defer(),e.paramSelectorDeferred2=t.defer(),e.chartDeferred=t.defer(),i=[e.orgDeferred.promise,e.widthDeferred.promise,e.paramSelectorDeferred1.promise,e.paramSelectorDeferred2.promise,e.chartDeferred.promise],a.initContext=function(){return(e.isDataFound=null!=a.content.summary&&!_.isEmpty(a.content.summary.data))?(e.periodOptions=[{label:"Yearly",value:"yearly"},{label:"Monthly",value:"monthly"},{label:"Weekly",value:"weekly"},{label:"Hourly",value:"hourly"}],e.period=_.find(e.periodOptions,function(e){return e.value===a.content.total.period.toLowerCase()})||e.periodOptions[0],e.filterOptions=[{label:"Gender",value:"gender"},{label:"Age Range",value:"age_range"},{label:"Job Title",value:"job_title"}],e.filter=_.find(e.filterOptions,function(e){return e.value===a.content.summary.filter})||e.filterOptions[0]):void 0},e.getColorByIndex=function(e){return n.getColor(e)},e.drawTrigger=t.defer(),a.format=function(){var t,i,s,r,o;if(e.isDataFound){if(t={labels:_.map(a.content.summary.data,function(e){return e.label}),values:_.map(a.content.summary.data,function(e){return e.value})},"gender"===e.filter.value)i={showTooltips:!1},s=n.barChart(t,i);else if("job_title"===e.filter.value)i={showTooltips:!1,showXLabels:!1,barDatasetSpacing:15},s=n.barChart(t,i);else{if("age_range"!==e.filter.value)return{error:{message:"wrong filter",code:400}};"unknown"===_.last(t.labels)&&(t.labels.pop(),t.values.pop()),r=[{title:"Average salary",labels:t.labels,values:t.values}],o={scaleBeginAtZero:!0,showXLabels:!1},s=n.lineChart(r,o)}return e.drawTrigger.notify(s)}},e.widgetDeferred.resolve(i)}]),e.directive("widgetHrSalariesSummary",function(){return{restrict:"A",controller:"WidgetHrSalariesSummaryCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.hr-superannuation-accruals",[]),e.controller("WidgetHrSuperannuationAccrualsCtrl",["$scope","$q","Utilities",function(e,t){var n,i;return i=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.paramSelectorDeferred=t.defer(),n=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.paramSelectorDeferred.promise],i.initContext=function(){return(e.isDataFound=!_.isEmpty(i.content.employees)&&!_.isEmpty(i.content.dates))?(e.employeesOptions=_.map(i.content.employees,function(e){return{value:e.id,label:e.lastname+" "+e.firstname}}),e.selectedEmployee={value:e.getEmployee().id,label:e.getEmployee().lastname+" "+e.getEmployee().firstname}):void 0},e.getEmployee=function(){return e.isDataFound?i.metadata&&i.metadata.employee_id?_.find(i.content.employees,function(e){return e.id===i.metadata.employee_id})||i.content.employees[0]:i.content.employees[0]:!1},e.widgetDeferred.resolve(n)}]),e.directive("widgetHrSuperannuationAccruals",function(){return{restrict:"A",controller:"WidgetHrSuperannuationAccrualsCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.hr-timesheets",[]),e.controller("WidgetHrTimesheetsCtrl",["$scope","$q","ChartFormatterSvc","ImpacWidgetsSvc",function(e,t,n,i){var a,s,r;return r=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.paramSelectorDeferred=t.defer(),a=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.paramSelectorDeferred.promise],r.initContext=function(){return(e.isDataFound=angular.isDefined(r.content)&&!_.isEmpty(r.content.employees)&&!_.isEmpty(r.content.dates))?(e.employeesOptions=_.map(r.content.employees,function(e){return{value:e.id,label:e.lastname+" "+e.firstname}}),e.selectedEmployee={value:e.getEmployee().id,label:e.getEmployee().lastname+" "+e.getEmployee().firstname},e.unCollapsed=r.metadata.unCollapsed||[]):void 0},e.toggleCollapsed=function(t){return null!=t?(_.find(e.unCollapsed,function(e){return t===e})?e.unCollapsed=_.reject(e.unCollapsed,function(e){return e===t}):e.unCollapsed.push(t),i.updateWidgetSettings(r,!1)):void 0},e.isCollapsed=function(t){return null!=t?_.find(e.unCollapsed,function(e){return t===e})?!1:!0:void 0},e.getEmployee=function(){return e.isDataFound?r.metadata&&r.metadata.employee_id?_.find(r.content.employees,function(e){return e.id===r.metadata.employee_id})||r.content.employees[0]:r.content.employees[0]:!1},e.getEmployeeTimeWorked=function(){var t;return(t=e.getEmployee())?_.find(r.content.employees,function(e){return e.id===t.id}).total_time_worked:void 0},e.getEmployeeTimeOff=function(){var t;return(t=e.getEmployee())?_.find(r.content.employees,function(e){return e.id===t.id}).total_time_off:void 0},s={},s.initialized=!1,s.initialize=function(){return s.initialized=!0},s.toMetadata=function(){return{unCollapsed:e.unCollapsed}},r.settings.push(s),e.widgetDeferred.resolve(a)}]),e.directive("widgetHrTimesheets",function(){return{restrict:"A",controller:"WidgetHrTimesheetsCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.hr-workforce-summary",[]),e.controller("WidgetHrWorkforceSummaryCtrl",["$scope","$q","ChartFormatterSvc","$filter",function(e,t,n,i){var a,s;return s=e.widget,e.orgDeferred=t.defer(),e.widthDeferred=t.defer(),e.paramSelectorDeferred1=t.defer(),e.paramSelectorDeferred2=t.defer(),e.chartDeferred=t.defer(),a=[e.orgDeferred.promise,e.widthDeferred.promise,e.paramSelectorDeferred1.promise,e.paramSelectorDeferred2.promise,e.chartDeferred.promise],s.initContext=function(){return(e.isDataFound=null!=s.content.summary&&!_.isEmpty(s.content.summary.data))?(e.periodOptions=[{label:"Yearly",value:"yearly"},{label:"Monthly",value:"monthly"},{label:"Weekly",value:"weekly"},{label:"Hourly",value:"hourly"}],e.period=_.find(e.periodOptions,function(e){return e.value===s.content.total.period.toLowerCase()})||e.periodOptions[0],e.filterOptions=[{label:"Gender",value:"gender"},{label:"Age Range",value:"age_range"},{label:"Salary Range",value:"salary_range"},{label:"Job Title",value:"job_title"}],e.filter=_.find(e.filterOptions,function(e){return e.value===s.content.summary.filter})||e.filterOptions[0]):void 0},e.getTotalWorkforce=function(){return e.isDataFound?s.content.total.amount:void 0},e.getNumberOfEmployees=function(){return e.isDataFound?s.content.total.employees:void 0},e.getCurrency=function(){return e.isDataFound?s.content.total.currency:void 0},e.formatSalaryRange=function(e){var t,n;return t=i("mnoCurrency")(e.label.split("-")[0],e.currency,!1),n=i("mnoCurrency")(e.label.split("-")[1],e.currency,!1),[t,n].join(" - ")},e.getColorByIndex=function(e){return n.getColor(e)},e.drawTrigger=t.defer(),s.format=function(){var t,i,a,r,o;return e.isDataFound?("salary_range"===e.filter.value?(t={labels:_.map(s.content.summary.data,function(t){return e.formatSalaryRange(t)}),values:_.map(s.content.summary.data,function(e){return e.value})},i={showTooltips:!1,showXLabels:!1,barDatasetSpacing:15},a=n.barChart(t,i)):(r=_.map(s.content.summary.data,function(e){return{label:e.label,value:e.value}}),o={showTooltips:!0,percentageInnerCutout:50,tooltipFontSize:12},a=n.pieChart(r,o)),e.drawTrigger.notify(a)):void 0},e.widgetDeferred.resolve(a)}]),e.directive("widgetHrWorkforceSummary",function(){return{restrict:"A",controller:"WidgetHrWorkforceSummaryCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.invoices-aged-payables-receivables",[]),e.controller("WidgetInvoicesAgedPayablesReceivablesCtrl",["$scope","$q","$log","$filter","ChartFormatterSvc","ImpacWidgetsSvc",function(e,t,n,i,a,s){var r,o,l,d;return d=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.widthDeferred=t.defer(),e.chartDeferred=t.defer(),o=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.widthDeferred.promise,e.chartDeferred.promise],d.initContext=function(){return!(e.isDataFound=!(!angular.isDefined(d.content)||_.isEmpty(d.content.payables)&&_.isEmpty(d.content.receivables)||_.isEmpty(d.content.dates)))||(e.unCollapsed=d.metadata.unCollapsed||[],d.metadata.selectedElements&&(e.selectedElements=[],angular.forEach(d.metadata.selectedElements,function(t){var n;return"aged_payables"===t.name&&(n=d.content.payables),"aged_receivables"!==t.name||n||(n=d.content.receivables),n||(n=_.find(d.content.payables.suppliers,function(e){return e.id===t.id})),n||(n=_.find(d.content.receivables.customers,function(e){return e.id===t.id})),n?e.selectedElements.push(n):void 0})),null!=e.selectedElements&&e.selectedElements.length>0)?void 0:d.width=6},e.getElementChartColor=function(e){return null!=e?a.getColor(e):void 0},e.getLastValue=function(e){return null!=e&&null!=e.totals?_.last(e.totals):void 0},e.getTotalSum=function(e){return null!=e&&null!=e.totals?_.reduce(e.totals,function(e,t){return e+t},0):void 0},e.getName=function(e){return null!=e&&null!=e.name?e.name.replace(/_/g," "):void 0},e.getPeriod=function(){var t,n;return e.isDataFound&&d.content.hist_parameters?(n=d.content.hist_parameters.period||"MONTHLY",t="day","DAILY"!==n&&(t=n.substr(0,n.length-2).toLowerCase()),"current "+t):"current month"},e.toggleSelectedElement=function(t){return e.isSelected(t)?(e.selectedElements=_.reject(e.selectedElements,function(e){return t.id?e.id===t.id:e.name===t.name}),d.format(),d.isExpanded()&&0===e.selectedElements.length?d.toggleExpanded():s.updateWidgetSettings(d,!1)):(e.selectedElements||(e.selectedElements=[]),e.selectedElements.push(t),d.format(),d.isExpanded()?s.updateWidgetSettings(d,!1):d.toggleExpanded())},e.isSelected=function(t){return null!=t&&null!=e.selectedElements?_.find(e.selectedElements,function(e){return t.id?e.id===t.id:e.name===t.name})?!0:!1:!1},e.toggleCollapsed=function(t){return null!=t&&null!=t.name?(_.find(e.unCollapsed,function(e){return t.name===e})?e.unCollapsed=_.reject(e.unCollapsed,function(e){return e===t.name}):e.unCollapsed.push(t.name),s.updateWidgetSettings(d,!1)):void 0},e.isCollapsed=function(t){return null!=t&&null!=t.name?_.find(e.unCollapsed,function(e){return t.name===e})?!1:!0:void 0},e.hasElements=function(){return null!=e.selectedElements&&e.selectedElements.length>0},e.drawTrigger=t.defer(),d.format=function(){var t,n,s,r,o;return e.isDataFound&&null!=e.selectedElements&&e.selectedElements.length>0?(t=!0,s=[],r=_.map(d.content.dates,function(e){return d.metadata.hist_parameters&&"YEARLY"===d.metadata.hist_parameters.period?i("date")(e,"yyyy"):d.metadata.hist_parameters&&"QUARTERLY"===d.metadata.hist_parameters.period?i("date")(e,"MMM-yy"):!d.metadata.hist_parameters||"WEEKLY"!==d.metadata.hist_parameters.period&&"DAILY"!==d.metadata.hist_parameters.period?i("date")(e,"MMM"):i("date")(e,"dd-MMM")}),angular.forEach(e.selectedElements,function(e){var n;return n=angular.copy(e),s.push({title:n.name,labels:r,values:n.totals}),angular.forEach(n.totals,function(e){return t&&(t=e>=0)})}),o={scaleBeginAtZero:t,showXLabels:!0,datasetFill:1===e.selectedElements.length,pointDot:1===e.selectedElements.length},n=a.lineChart(s,o),e.drawTrigger.notify(n)):void 0},l={},l.initialized=!1,l.initialize=function(){return l.initialized=!0},l.toMetadata=function(){return{unCollapsed:e.unCollapsed}},d.settings.push(l),r={},r.initialized=!1,r.initialize=function(){return r.initialized=!0},r.toMetadata=function(){return{selectedElements:e.selectedElements}},d.settings.push(r),e.widgetDeferred.resolve(o)}]),e.directive("widgetInvoicesAgedPayablesReceivables",function(){return{restrict:"A",controller:"WidgetInvoicesAgedPayablesReceivablesCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.invoices-list",[]),e.controller("WidgetInvoicesListCtrl",["$scope","$q","Utilities","$filter",function(e,t,n,i){var a,s;return s=e.widget,e.orgDeferred=t.defer(),a=[e.orgDeferred.promise],s.initContext=function(){return e.isDataFound=!_.isEmpty(s.content.entities)},e.entityType=s.metadata.entity,e.entityTypeCap=_.capitalize(s.metadata.entity),e.orderBy="name"===s.metadata.order_by||"total_invoiced"===s.metadata.order_by?"":_.last(s.metadata.order_by.split("_")).concat(" "),e.getInvoices=function(e){var t,n;return n=["<strong>"+e.name+"</strong>"],t=1,angular.forEach(e.invoices,function(e){var a,s;return s=""!==e.transaction_no?" ("+e.transaction_no+")":"",a="partially paid"===e.tooltip_status?" ("+i("mnoCurrency")(e.paid,e.currency,!1)+" over "+i("mnoCurrency")(e.invoiced,e.currency,!1)+")":" ("+i("mnoCurrency")(e.invoiced,e.currency,!1)+")",n.push("#"+t+s+" - "+e.tooltip_status+a),t++}),n.join("<br />")},e.widgetDeferred.resolve(a)}]),e.directive("widgetInvoicesList",function(){return{restrict:"A",controller:"WidgetInvoicesListCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.invoices-summary",[]),e.controller("WidgetInvoicesSummaryCtrl",["$scope","$q","Utilities","ChartFormatterSvc",function(e,t,n,i){var a,s;return s=e.widget,e.orgDeferred=t.defer(),e.chartFiltersDeferred=t.defer(),e.chartDeferred=t.defer(),a=[e.orgDeferred.promise,e.chartFiltersDeferred.promise,e.chartDeferred.promise],s.initContext=function(){return e.isDataFound=!_.isEmpty(s.content.summary)},e.drawTrigger=t.defer(),s.format=function(){var t,n,a;return e.isDataFound?(n=_.map(s.content.summary,function(e){return{label:e.name,value:e.total}}),a={percentageInnerCutout:50,tooltipFontSize:12},t=i.pieChart(n,a),e.drawTrigger.notify(t)):void 0},e.widgetDeferred.resolve(a)}]),e.directive("widgetInvoicesSummary",function(){return{restrict:"A",controller:"WidgetInvoicesSummaryCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-aged",[]),e.controller("WidgetSalesAgedCtrl",["$scope","$q","ChartFormatterSvc","$filter",function(e,t,n,i){var a,s;return s=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.paramSelectorDeferred=t.defer(),e.chartDeferred=t.defer(),a=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.paramSelectorDeferred.promise,e.chartDeferred.promise],s.initContext=function(){return(e.isDataFound=angular.isDefined(s.content)&&!_.isEmpty(s.content.aged_sales)&&!_.isEmpty(s.content.dates))?(e.filterOptions=[{label:"value sold (incl. taxes)",value:"gross_value_sold"},{label:"value sold (excl. taxes)",value:"net_value_sold"},{label:"quantity sold",value:"quantity_sold"}],e.filter=angular.copy(_.find(e.filterOptions,function(e){return s.metadata&&s.metadata.filter===e.value})||e.filterOptions[0])):void 0},e.getTotal=function(t){return e.isDataFound&&t>=0&&t<s.content.aged_sales[e.filter.value].length?s.content.aged_sales[e.filter.value][t]:void 0},e.getLastDate=function(){return e.isDataFound?_.last(s.content.dates):void 0},e.getClassColor=function(e,t){return e>t?"negative":t>e?"positive":null},e.drawTrigger=t.defer(),s.format=function(){var t,a,r,o,l;return e.isDataFound?(t=!0,r=[],l=s.content.aged_sales[e.filter.value],e.formattedDates=_.map(s.content.dates,function(e){return s.metadata&&s.metadata.hist_parameters&&"YEARLY"===s.metadata.hist_parameters.period?i("date")(e,"yyyy"):s.metadata&&s.metadata.hist_parameters&&"QUARTERLY"===s.metadata.hist_parameters.period?i("date")(e,"MMM-yy"):s.metadata&&s.metadata.hist_parameters&&("WEEKLY"===s.metadata.hist_parameters.period||"DAILY"===s.metadata.hist_parameters.period)?i("date")(e,"dd-MMM"):i("date")(e,"MMM")}),r.push({title:e.filter.label,labels:e.formattedDates,values:l}),angular.forEach(l,function(e){return t&&(t=e>=0)}),o={scaleBeginAtZero:t,showXLabels:!0,datasetFill:!0,pointDot:!0},a=n.lineChart(r,o),e.drawTrigger.notify(a)):void 0},e.widgetDeferred.resolve(a)}]),e.directive("widgetSalesAged",function(){return{restrict:"A",controller:"WidgetSalesAgedCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-break-even",[]),e.controller("WidgetSalesBreakEvenCtrl",["$scope","$q","ChartFormatterSvc","$filter",function(e,t,n,i){var a,s,r;return r=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),a=[e.orgDeferred.promise,e.timeRangeDeferred.promise],r.initContext=function(){return e.isDataFound=angular.isDefined(r.content)&&!_.isEmpty(r.content.sales),e.threshold=r.metadata.threshold},e.getProjectedDate=function(){var t;return e.isDataFound&&r.content.break_even?(""+r.content.break_even.projected_date).match("After")?(t=angular.copy(r.content.break_even.projected_date).replace("After ",""),"> "+i("date")(t,"d-MM-yy")):r.content.break_even.projected_date:void 0},e.getOpportunitiesToClose=function(){var t;return e.isDataFound&&r.content.break_even?(""+r.content.break_even.opportunities_to_close).match(">")?(t=angular.copy(r.content.break_even.opportunities_to_close).replace(">",""),"> "+t):r.content.break_even.opportunities_to_close:void 0},e.isTargetMet=function(){return e.isDataFound&&r.content.break_even?r.content.break_even.variance<0:void 0},e.getVariance=function(){return e.isDataFound&&r.content.break_even?Math.abs(r.content.break_even.variance):void 0},s={},s.initialized=!1,s.initialize=function(){return s.initialized=!0},s.toMetadata=function(){return{threshold:e.threshold}},r.settings.push(s),e.widgetDeferred.resolve(a)}]),e.directive("widgetSalesBreakEven",function(){return{restrict:"A",controller:"WidgetSalesBreakEvenCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-comparison",[]),e.controller("WidgetSalesComparisonCtrl",["$scope","$q","$filter","ChartFormatterSvc","ImpacWidgetsSvc",function(e,t,n,i,a){var s,r,o,l;return l=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.widthDeferred=t.defer(),e.paramSelectorDeferred1=t.defer(),e.paramSelectorDeferred2=t.defer(),e.chartDeferred=t.defer(),r=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.widthDeferred.promise,e.paramSelectorDeferred1,e.paramSelectorDeferred2,e.chartDeferred.promise],l.initContext=function(){return(e.isDataFound=angular.isDefined(l.content)&&!_.isEmpty(l.content.sales_comparison)&&!_.isEmpty(l.content.dates))&&(e.unCollapsed=l.metadata.unCollapsed||[],e.filterOptions=[{label:"value sold (incl. taxes)",value:"gross_value_sold"},{label:"value sold (excl. taxes)",value:"net_value_sold"},{label:"quantity sold",value:"quantity_sold"}],e.filter=angular.copy(_.find(e.filterOptions,function(e){return l.metadata&&l.metadata.filter===e.value})||e.filterOptions[0]),e.criteriaOptions=[{label:"products",value:"default"},{label:"locations",value:"location"},{label:"industries",value:"industry"},{label:"customers",value:"customer"}],e.criteria=angular.copy(_.find(e.criteriaOptions,function(e){return l.metadata&&l.metadata.criteria===e.value})||e.criteriaOptions[0]),l.metadata.selectedElements)?(e.selectedElements=[],angular.forEach(l.metadata.selectedElements,function(t){var n;return n=_.find(l.content.sales_comparison,function(e){return e.name===t.name
}),n||angular.forEach(l.content.sales_comparison,function(e){return null!=e.sales?n||(n=_.find(e.sales,function(e){return t.id===e.id})):void 0}),n?e.selectedElements.push(n):void 0})):void 0},e.getLastDate=function(){return e.isDataFound?_.last(l.content.dates):void 0},e.getTotalForPeriod=function(t){return null!=t.totals&&e.filter?_.reduce(t.totals[e.filter.value],function(e,t){return e+t},0):void 0},e.getElementChartColor=function(e){return i.getColor(e)},e.toggleSelectedElement=function(t){return e.isSelected(t)?(e.selectedElements=_.reject(e.selectedElements,function(e){return t.id?e.id===t.id:e.name===t.name}),l.format(),l.isExpanded()&&0===e.selectedElements.length?l.toggleExpanded():a.updateWidgetSettings(l,!1)):(e.selectedElements||(e.selectedElements=[]),e.selectedElements.push(t),l.format(),l.isExpanded()?a.updateWidgetSettings(l,!1):l.toggleExpanded())},e.isSelected=function(t){return null!=t&&null!=e.selectedElements?_.find(e.selectedElements,function(e){return t.id?e.id===t.id:e.name===t.name})?!0:!1:!1},e.toggleCollapsed=function(t){return null!=t&&null!=t.name?(_.find(e.unCollapsed,function(e){return t.name===e})?e.unCollapsed=_.reject(e.unCollapsed,function(e){return e===t.name}):e.unCollapsed.push(t.name),a.updateWidgetSettings(l,!1)):void 0},e.isCollapsed=function(t){return null!=t&&null!=t.name?_.find(e.unCollapsed,function(e){return t.name===e})?!1:!0:void 0},e.hasElements=function(){return null!=e.selectedElements&&e.selectedElements.length>0},e.drawTrigger=t.defer(),l.format=function(){var t,a,s,r;return e.isDataFound&&null!=e.selectedElements&&e.selectedElements.length>0?(t=!0,s=[],angular.forEach(e.selectedElements,function(i){var a,r;return a=angular.copy(i),r=_.map(l.content.dates,function(e){return l.metadata.hist_parameters&&"YEARLY"===l.metadata.hist_parameters.period?n("date")(e,"yyyy"):l.metadata.hist_parameters&&"QUARTERLY"===l.metadata.hist_parameters.period?n("date")(e,"MMM-yy"):!l.metadata.hist_parameters||"WEEKLY"!==l.metadata.hist_parameters.period&&"DAILY"!==l.metadata.hist_parameters.period?n("date")(e,"MMM"):n("date")(e,"dd-MMM")}),s.push({title:a.name,labels:r,values:a.totals[e.filter.value]}),angular.forEach(a.totals,function(e){return t&&(t=e>=0)})}),r={scaleBeginAtZero:t,showXLabels:!0,datasetFill:!1,pointDot:!1},a=i.lineChart(s,r),e.drawTrigger.notify(a)):void 0},o={},o.initialized=!1,o.initialize=function(){return o.initialized=!0},o.toMetadata=function(){return{unCollapsed:e.unCollapsed}},l.settings.push(o),s={},s.initialized=!1,s.initialize=function(){return s.initialized=!0},s.toMetadata=function(){return{selectedElements:e.selectedElements}},l.settings.push(s),e.widgetDeferred.resolve(r)}]),e.directive("widgetSalesComparison",function(){return{restrict:"A",controller:"WidgetSalesComparisonCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-customer-details",[]),e.controller("WidgetSalesCustomerDetailsCtrl",["$scope","$q",function(e,t){var n,i;return i=e.widget,e.orgDeferred=t.defer(),e.timeRangeDeferred=t.defer(),e.widthDeferred=t.defer(),e.paramSelectorDeferred=t.defer(),n=[e.orgDeferred.promise,e.timeRangeDeferred.promise,e.widthDeferred.promise,e.paramSelectorDeferred.promise],i.initContext=function(){return(e.isDataFound=!_.isEmpty(i.content.customers))?(e.customersOptions=_.map(i.content.customers,function(e){return{value:e.uid,label:e.name}}),e.selectedCustomer={value:e.getCustomer().uid,label:e.getCustomer().name}):void 0},e.getCustomer=function(){var t;return e.isDataFound?t=i.metadata&&i.metadata.customer_uid?angular.copy(_.find(i.content.customers,function(e){return e.uid===i.metadata.customer_uid})||i.content.customers[0]):angular.copy(i.content.customers[0]):!1},e.formatAddress=function(e){return angular.isDefined(e)?e.replace(/, /g,",\n"):void 0},e.getFromDate=function(){return e.isDataFound?i.content.from:void 0},e.getToDate=function(){return e.isDataFound?i.content.to:void 0},e.widgetDeferred.resolve(n)}]),e.directive("widgetSalesCustomerDetails",function(){return{restrict:"A",controller:"WidgetSalesCustomerDetailsCtrl"}})}.call(this),function(){"use strict";var e,t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};e=angular.module("impac.components.widgets.sales-cycle",[]),e.controller("WidgetSalesCycleCtrl",["$scope","Utilities","ChartFormatterSvc","$filter",function(e,n,i,a){var s,r;return r=e.widget,r.initContext=function(){return(e.isDataFound=angular.isDefined(r.content)&&!_.isEmpty(r.content.status_average_durations))?(e.unit=(r.metadata.unit||r.content.unit||"days").toLowerCase(),e.statusOptions=_.compact(_.map(r.metadata.status_selection,function(e){return angular.isDefined(r.content.status_average_durations[e])?{label:e,selected:!0}:void 0})),angular.forEach(r.content.status_average_durations,function(n,i){return!r.metadata.status_selection||t.call(r.metadata.status_selection,i)>=0?_.isEmpty(r.metadata.status_selection)?e.statusOptions.push({label:i,selected:!0}):void 0:e.statusOptions.push({label:i,selected:!1})})):void 0},r.format=function(){var t,n;return e.isDataFound?(t=_.compact(_.map(e.statusOptions,function(t){var n;return n=r.content.status_average_durations[t.label],t.selected&&angular.isDefined(n)?{label:a("titleize")(t.label)+": "+n+" "+e.unit,value:n}:void 0})),n={percentageInnerCutout:50,tooltipFontSize:12},r.chart=i.pieChart(t,n)):void 0},s=function(){return null!=r.settings?r.settings.length:0},e.$watch(s,function(e){return e>=3?r.loadContent():void 0}),r}]),e.directive("widgetSalesCycle",function(){return{restrict:"A",controller:"WidgetSalesCycleCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-forecast",[]),e.controller("WidgetSalesForecastCtrl",["$scope","ChartFormatterSvc","$filter",function(e,t,n){var i,a;return a=e.widget,a.initContext=function(){return e.isDataFound=angular.isDefined(a.content)&&!_.isEmpty(a.content.dates)&&!_.isEmpty(a.content.totals)},a.format=function(){var i,s,r,o;return e.isDataFound?(i=!0,s=_.map(a.content.dates,function(e){return n("date")(e,"MMM-yy")}),r=[{title:"Sales Performance",labels:s,values:a.content.totals}],angular.forEach(a.content.totals,function(e){return i&&(i=e>=0)}),o={scaleBeginAtZero:i,showXLabels:!0,datasetFill:!0,pointDot:!1},a.chart=t.lineChart(r,o)):void 0},e.getOpportunityAmount=function(t){return e.isDataFound&&!_.isEmpty(t)?t.amount&&t.amount.amount?t.amount.amount:"-":void 0},e.getOpportunityCurrency=function(t){return e.isDataFound&&!_.isEmpty(t)?t.amount&&t.amount.currency?t.amount.currency:a.content.currency?a.content.currency:"AUD":void 0},i=function(){return null!=a.settings?a.settings.length:0},e.$watch(i,function(e){return e>=1?a.loadContent():void 0}),a}]),e.directive("widgetSalesForecast",function(){return{restrict:"A",controller:"WidgetSalesForecastCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-growth",[]),e.controller("WidgetSalesGrowthCtrl",["$scope","ChartFormatterSvc",function(e,t){var n,i;return i=e.widget,e.isDataQuantity=!0,e.getSelectedProduct=function(){return e.isDataFound?_.find(i.content.summary,function(t){return t.id===e.product.value}):void 0},e.getCurrentValue=function(){return null!=e.getSelectedProduct()?_.last(e.getSelectedProduct().totals):void 0},e.getCurrentDate=function(){return e.isDataFound?_.last(i.content.dates):void 0},i.initContext=function(){return(e.isDataFound=angular.isDefined(i.content)&&!_.isEmpty(i.content.summary)&&!_.isEmpty(i.content.dates))?(e.productOptions=_.flatten(_.map(i.content.summary,function(e){return{label:e.code,value:e.id}})),e.product=_.find(e.productOptions,function(e){return e.value===i.content.product})||{label:"SELECT PRODUCT",value:-1},e.filterOptions=[{label:"value sold (incl. taxes)",value:"gross_value_sold"},{label:"value sold (excl. taxes)",value:"net_value_sold"},{label:"quantity sold",value:"quantity_sold"},{label:"value purchased (incl. taxes)",value:"gross_value_purchased"},{label:"value purchased (excl. taxes)",value:"net_value_purchased"},{label:"quantity purchased",value:"quantity_purchased"}],e.filter=_.find(e.filterOptions,function(e){return e.value===i.content.filter})||e.filterOptions[0],e.isDataQuantity=e.filter.value.match("quantity")):void 0},i.format=function(){var n,a,s,r;return e.isDataFound&&e.product&&(a=e.getSelectedProduct())?(s={title:a.name,labels:i.content.dates,values:a.totals},n=!0,angular.forEach(a.totals,function(e){return n&&(n=e>=0)}),r={scaleBeginAtZero:n,showXLabels:!1},i.chart=t.lineChart([s],r)):void 0},n=function(){return null!=i.settings?i.settings.length:0},e.$watch(n,function(e){return e>=4?i.loadContent():void 0}),i}]),e.directive("widgetSalesGrowth",function(){return{restrict:"A",controller:"WidgetSalesGrowthCtrl"}})}.call(this),function(){"use strict";var e,t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};e=angular.module("impac.components.widgets.sales-leads-funnel",[]),e.controller("WidgetSalesLeadsFunnelCtrl",["$scope","Utilities","ChartFormatterSvc","$filter","ImpacWidgetsSvc",function(e,n,i,a,s){var r,o,l;return l=e.widget,l.initContext=function(){return(e.isDataFound=angular.isDefined(l.content)&&!_.isEmpty(l.content.leads_per_status))?(e.statusOptions=_.compact(_.map(l.metadata.status_selection,function(e){return angular.isDefined(l.content.leads_per_status[e])?{label:e,selected:!0}:void 0})),angular.forEach(l.content.leads_per_status,function(n,i){return!l.metadata.status_selection||t.call(l.metadata.status_selection,i)>=0?_.isEmpty(l.metadata.status_selection)?e.statusOptions.push({label:i,selected:!0}):void 0:e.statusOptions.push({label:i,selected:!1})})):void 0},l.format=function(){var t;return e.isDataFound&&(t=0,angular.forEach(e.statusOptions,function(e){var n;return n=l.content.leads_per_status[e.label].total,e.selected&&angular.isDefined(n)&&n>t?t=n:void 0}),t>0)?e.funnel=_.compact(_.map(e.statusOptions,function(e){var n,i,a;return a=l.content.leads_per_status[e.label].total,n=(100*(a/t)-10).toFixed(),i=8>n?92:100-n,e.selected&&angular.isDefined(a)?{status:e.label,number:a,coloredWidth:{width:n+"%"},statusWidth:{width:i+"%"}}:void 0})):void 0},e.getImpacColor=function(e){return i.getColor(e)},e.toggleSelectStatus=function(t){return e.selectedStatus=e.selectedStatus&&e.selectedStatus===t?null:t,!l.isExpanded()&&e.selectedStatus?l.toggleExpanded():s.updateWidgetSettings(l,!1)},e.isSelected=function(t){return e.selectedStatus&&t===e.selectedStatus},e.getSelectedLeads=function(){return e.isDataFound&&e.selectedStatus?l.content.leads_per_status[e.selectedStatus].leads:void 0},e.getLeadDescription=function(e){var t,n;return n=[],t=["<strong>"],e.first_name&&t.push(a("titleize")(e.first_name)),e.last_name&&t.push(a("titleize")(e.last_name)),t.push("</strong>"),n.push(t.join(" ")),n.push("Status: "+a("titleize")(e.lead_status)),e.organization&&n.push("Organization: "+a("titleize")(e.organization)),e.opportunities&&(n.push("<strong>Opportunities:</strong>"),angular.forEach(e.opportunities,function(e){var t;return t=[],e.code&&t.push("#"+e.code),e.name&&t.push(""+e.name),e.amount&&t.push(a("mnoCurrency")(e.amount.total_amount,"USD",!1)),e.probability&&t.push(e.probability+"%"),e.sales_stage&&t.push(""+e.sales_stage),n.push(t.join(" - "))})),n.join("<br />")},o={},o.initialized=!1,o.initialize=function(){return angular.isDefined(l.content.leads_per_status[l.metadata.selected_status])&&(e.selectedStatus=l.metadata.selected_status),o.initialized=!0},o.toMetadata=function(){return{selected_status:e.selectedStatus}},l.settings.push(o),r=function(){return null!=l.settings?l.settings.length:0},e.$watch(r,function(e){return e>=5?l.loadContent():void 0}),l}]),e.directive("widgetSalesLeadsFunnel",function(){return{restrict:"A",controller:"WidgetSalesLeadsFunnelCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-leads-list",[]),e.controller("WidgetSalesLeadsListCtrl",["$scope","ChartFormatterSvc","$filter",function(e,t,n){var i,a;return a=e.widget,a.initContext=function(){return e.isDataFound=angular.isDefined(a.content)&&!_.isEmpty(a.content.leads)},e.getLeadDescription=function(e){var t,i;return i=[],t=["<strong>"],e.first_name&&t.push(n("titleize")(e.first_name)),e.last_name&&t.push(n("titleize")(e.last_name)),t.push("</strong>"),i.push(t.join(" ")),i.push("Status: "+n("titleize")(e.lead_status)),e.organization&&i.push("Organization: "+n("titleize")(e.organization)),e.opportunities&&(i.push("<strong>Opportunities:</strong>"),angular.forEach(e.opportunities,function(e){var t;return t=[],e.code&&t.push("#"+e.code),e.name&&t.push(""+e.name),e.amount&&t.push(n("mnoCurrency")(e.amount.total_amount,"USD",!1)),e.probability&&t.push(e.probability+"%"),e.sales_stage&&t.push(""+e.sales_stage),i.push(t.join(" - "))})),i.join("<br />")},i=function(){return null!=a.settings?a.settings.length:0},e.$watch(i,function(e){return e>=1?a.loadContent():void 0}),a}]),e.directive("widgetSalesLeadsList",function(){return{restrict:"A",controller:"WidgetSalesLeadsListCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-list",[]),e.controller("WidgetSalesListCtrl",["$scope","ChartFormatterSvc","ImpacWidgetsSvc",function(e,t,n){var i,a,s;return s=e.widget,s.initContext=function(){return(e.isDataFound=angular.isDefined(s.content)&&!_.isEmpty(s.content.summary))?(e.periodOptions=[{label:"year",value:"YEARLY"},{label:"quarter",value:"QUARTERLY"},{label:"month",value:"MONTHLY"},{label:"week",value:"WEEKLY"},{label:"day",value:"DAILY"}],e.period=_.find(e.periodOptions,function(e){return e.value===s.content.hist_parameters.period})||e.periodOptions[0],e.filterOptions=[{label:"value sold (incl. taxes)",value:"gross_value_sold"},{label:"value sold (excl. taxes)",value:"net_value_sold"},{label:"quantity sold",value:"quantity_sold"},{label:"value purchased (incl. taxes)",value:"gross_value_purchased"},{label:"value purchased (excl. taxes)",value:"net_value_purchased"},{label:"quantity purchased",value:"quantity_purchased"}],e.filter=_.find(e.filterOptions,function(e){return e.value===s.content.filter})||e.filterOptions[0],e.unCollapsed=s.metadata.unCollapsed||[]):void 0},e.toggleCollapsed=function(t){return null!=t?(_.find(e.unCollapsed,function(e){return t===e})?e.unCollapsed=_.reject(e.unCollapsed,function(e){return e===t}):e.unCollapsed.push(t),n.updateWidgetSettings(s,!1)):void 0},e.isCollapsed=function(t){return null!=t?_.find(e.unCollapsed,function(e){return t===e})?!1:!0:void 0},a={},a.initialized=!1,a.initialize=function(){return a.initialized=!0},a.toMetadata=function(){return{unCollapsed:e.unCollapsed}},s.settings.push(a),i=function(){return null!=s.settings?s.settings.length:0},e.$watch(i,function(e){return e>=3?s.loadContent():void 0}),s}]),e.directive("widgetSalesList",function(){return{restrict:"A",controller:"WidgetSalesListCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-margin",[]),e.controller("WidgetSalesMarginCtrl",["$scope","ChartFormatterSvc","$filter",function(e,t,n){var i,a;return a=e.widget,a.initContext=function(){return e.isDataFound=null!=a.content&&null!=a.content.margins&&null!=a.content.dates,e.filterOptions=[{label:"Including taxes",value:"gross_margin"},{label:"Excluding taxes",value:"net_margin"}],e.filter=null!=a.metadata&&"net_margin"===a.metadata.filter?e.filterOptions[1]:e.filterOptions[0]},a.format=function(){var n,i,s,r;return e.isDataFound?(r=null!=a.metadata&&"net_margin"===a.metadata.filter?a.content.margins.net:a.content.margins.gross,i={title:"Gross margin",labels:a.content.dates,values:r},n=!0,angular.forEach(r,function(e){return n&&(n=e>=0)}),s={scaleBeginAtZero:n,showXLabels:!1},a.chart=t.lineChart([i],s)):void 0},e.getTotalMargin=function(){return e.isDataFound?null!=a.metadata&&"net_margin"===a.metadata.filter?_.reduce(a.content.margins.net,function(e,t){return e+t},0):_.reduce(a.content.margins.gross,function(e,t){return e+t},0):void 0},e.getCurrency=function(){return e.isDataFound?a.content.currency||"USD":void 0},e.getTimeSpan=function(){return e.isDataFound?"From "+n("date")(_.first(a.content.dates),"d MMM yy")+" to "+n("date")(_.last(a.content.dates),"d MMM yy"):void 0},i=function(){return null!=a.settings?a.settings.length:0},e.$watch(i,function(e){return e>=4?a.loadContent():void 0}),a}]),e.directive("widgetSalesMargin",function(){return{restrict:"A",controller:"WidgetSalesMarginCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-number-of-leads",[]),e.controller("WidgetSalesNumberOfLeadsCtrl",["$scope","ChartFormatterSvc","$filter",function(e){var t,n,i;return i=e.widget,i.initContext=function(){return(e.isDataFound=angular.isDefined(i.content)&&!_.isEmpty(i.content.number_of_leads))?(e.periodOptions=[{label:"year",value:"YEARLY"},{label:"quarter",value:"QUARTERLY"},{label:"month",value:"MONTHLY"},{label:"week",value:"WEEKLY"},{label:"day",value:"DAILY"}],e.period=_.find(e.periodOptions,function(e){return e.value===i.metadata.period})||e.periodOptions[3]):void 0},e.formatNumberOfLeads=function(t){var a,s,r,o,l,d;if(s=0,r="- %",!e.isDataFound)return{nominal:s,variation:r,color:""};if(o=angular.copy(i.content.number_of_leads),l=0,a="","new"===t&&o.total&&2===o.total.length)l=o.total[1]-o.total[0],d=n(o.total),d>0?a="green":0>d&&(a="red");else if("converted"===t&&o.converted&&2===o.converted.length)l=o.converted[1],d=n(o.converted),d>0?a="green":0>d&&(a="red");else{if("lost"!==t||!o.lost||2!==o.lost.length)return{nominal:s,variation:r,color:a};l=o.lost[1],d=n(o.lost),0>d?a="green":d>0&&(a="red")}return l>0?s="+"+l:0>l&&(s=l),d&&d>0?r="+"+d.toFixed(0)+"%":d&&0>d&&(r=d.toFixed(0)+"%"),{nominal:s,variation:r,color:a}},n=function(e){var t;return t=0!==e[0]?100*(e[1]/e[0]-1):"- "},t=function(){return null!=i.settings?i.settings.length:0},e.$watch(t,function(e){return e>=2?i.loadContent():void 0}),i}]),e.directive("widgetSalesNumberOfLeads",function(){return{restrict:"A",controller:"WidgetSalesNumberOfLeadsCtrl"}})}.call(this),function(){"use strict";var e,t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};e=angular.module("impac.components.widgets.sales-opportunities-funnel",[]),e.controller("WidgetSalesOpportunitiesFunnelCtrl",["$scope","Utilities","ChartFormatterSvc","$filter","ImpacWidgetsSvc",function(e,n,i,a,s){var r,o,l;return l=e.widget,l.initContext=function(){return(e.isDataFound=angular.isDefined(l.content)&&!_.isEmpty(l.content.opps_per_sales_stage))?(e.statusOptions=_.compact(_.map(l.metadata.sales_stage_selection,function(e){return angular.isDefined(l.content.opps_per_sales_stage[e])?{label:e,selected:!0}:void 0})),angular.forEach(l.content.opps_per_sales_stage,function(n,i){return!l.metadata.sales_stage_selection||t.call(l.metadata.sales_stage_selection,i)>=0?_.isEmpty(l.metadata.sales_stage_selection)?e.statusOptions.push({label:i,selected:!0}):void 0:e.statusOptions.push({label:i,selected:!1})})):void 0},l.format=function(){var t;return e.isDataFound&&(t=0,angular.forEach(e.statusOptions,function(e){var n;return n=l.content.opps_per_sales_stage[e.label].total,e.selected&&angular.isDefined(n)&&n>t?t=n:void 0}),t>0)?e.funnel=_.compact(_.map(e.statusOptions,function(e){var n,i,a;return a=l.content.opps_per_sales_stage[e.label].total,n=(100*(a/t)-10).toFixed(),i=8>n?92:100-n,e.selected&&angular.isDefined(a)?{status:e.label,number:a,coloredWidth:{width:n+"%"},statusWidth:{width:i+"%"}}:void 0})):void 0},e.getImpacColor=function(e){return i.getColor(e)},e.toggleSelectStatus=function(t){return e.selectedStatus=e.selectedStatus&&e.selectedStatus===t?null:t,!l.isExpanded()&&e.selectedStatus?l.toggleExpanded():s.updateWidgetSettings(l,!1)},e.isSelected=function(t){return e.selectedStatus&&t===e.selectedStatus},e.getSelectedOpportunities=function(){return e.isDataFound&&e.selectedStatus?l.content.opps_per_sales_stage[e.selectedStatus].opps:void 0},e.getOppDetails=function(e){var t;return t=[],e.amount&&t.push(a("mnoCurrency")(e.amount.amount,e.amount.currency||"AUD")),e.probability&&t.push("prob. "+e.probability+"%"),t.join(" / ")},o={},o.initialized=!1,o.initialize=function(){return angular.isDefined(l.content.opps_per_sales_stage[l.metadata.selected_status])&&(e.selectedStatus=l.metadata.selected_status),o.initialized=!0},o.toMetadata=function(){return{selected_status:e.selectedStatus}},l.settings.push(o),r=function(){return null!=l.settings?l.settings.length:0},e.$watch(r,function(e){return e>=4?l.loadContent():void 0}),l}]),e.directive("widgetSalesOpportunitiesFunnel",function(){return{restrict:"A",controller:"WidgetSalesOpportunitiesFunnelCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-performance",[]),e.controller("WidgetSalesPerformanceCtrl",["$scope","ChartFormatterSvc","$filter",function(e,t,n){var i,a;return a=e.widget,a.initContext=function(){return e.isDataFound=angular.isDefined(a.content)&&!_.isEmpty(a.content.assignees)},e.getOpportunityAmount=function(t){var i;return e.isDataFound&&!_.isEmpty(t)?t.amount&&t.amount.amount?(i=t.amount.amount,n("mnoCurrency")(i,t.amount.currency||"AUD")):"-":void 0},i=function(){return null!=a.settings?a.settings.length:0},e.$watch(i,function(e){return e>=1?a.loadContent():void 0}),a}]),e.directive("widgetSalesPerformance",function(){return{restrict:"A",controller:"WidgetSalesPerformanceCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-segmented-turnover",[]),e.controller("WidgetSalesSegmentedTurnoverCtrl",["$scope","$filter","ChartFormatterSvc",function(e,t,n){var i,a;return a=e.widget,a.initContext=function(){return(e.isDataFound=!_.isEmpty(a.content.dates)&&!_.isEmpty(a.content.ranges))?(e.filterOptions=[{label:"Gross revenue (incl. taxes)",value:"gross"},{label:"Net revenue (excl. taxes)",value:"net"}],e.filter=_.find(e.filterOptions,function(e){return e.value===a.content.filter})||e.filterOptions[0]):void 0},a.format=function(){var t,i;return e.isDataFound?(t={labels:_.map(a.content.ranges,function(e){return e.label}),values:_.map(a.content.ranges,function(e){return e.value})},i={showTooltips:!1,showXLabels:!1,barDatasetSpacing:15},a.chart=n.barChart(t,i)):void 0},e.getAnalysis=function(){return e.isDataFound?a.content.ranges[0].percentage+a.content.ranges[1].percentage>50?"Your less expensive products bring you most of your revenue.":a.content.ranges[3].percentage+a.content.ranges[4].percentage>50?"Your most expensive products bring you most of your revenue.":"Your revenue is balanced between your different products segments.":void 0},e.getColorByIndex=function(e){return n.getColor(e)},e.getRangeLabel=function(e){var n;return n=e.split("-"),_.map(n,function(e){return t("mnoCurrency")(e,a.content.currency,!1)}).join(" - ")},e.getMaxRange=function(){var t,n;return e.isDataFound?(t=0,n=a.content.ranges[0],angular.forEach(a.content.ranges,function(e){return e.percentage>t&&(n=angular.copy(e)),t=Math.max(t,e.percentage)}),n):void 0},i=function(){return null!=a.settings?a.settings.length:0},e.$watch(i,function(e){return e>=4?a.loadContent():void 0}),a}]),e.directive("widgetSalesSegmentedTurnover",function(){return{restrict:"A",controller:"WidgetSalesSegmentedTurnoverCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-summary",[]),e.controller("WidgetSalesSummaryCtrl",["$scope","Utilities","ChartFormatterSvc",function(e,t,n){var i,a;return a=e.widget,a.initContext=function(){return(e.isDataFound=!_.isEmpty(a.content.hist_parameters))?(e.incorrectPeriod=_.isEmpty(a.content.summary),e.periodOptions=[{label:"year",value:"YEARLY"},{label:"quarter",value:"QUARTERLY"},{label:"month",value:"MONTHLY"},{label:"week",value:"WEEKLY"},{label:"day",value:"DAILY"}],e.period=_.find(e.periodOptions,function(e){return e.value===a.content.hist_parameters.period})||e.periodOptions[0],e.filterOptions=[{label:"value sold (incl. taxes)",value:"gross_value_sold"},{label:"value sold (excl. taxes)",value:"net_value_sold"},{label:"quantity sold",value:"quantity_sold"},{label:"value purchased (incl. taxes)",value:"gross_value_purchased"},{label:"value purchased (excl. taxes)",value:"net_value_purchased"},{label:"quantity purchased",value:"quantity_purchased"}],"customer"===a.metadata.criteria&&(e.filterOptions=[e.filterOptions[0],e.filterOptions[1],e.filterOptions[2]]),e.filter=_.find(e.filterOptions,function(e){return e.value===a.content.filter})||e.filterOptions[0]):void 0},a.format=function(){var t,i;return e.isDataFound?(t=_.map(a.content.summary,function(e){var t;return t=e.company?(e.code||e.location||e.industry||e.customer)+" ("+e.company+")":e.code||e.location||e.industry||e.customer,{label:t,value:e.total}}),i={percentageInnerCutout:50,tooltipFontSize:12},a.chart=n.pieChart(t,i)):void 0},i=function(){return null!=a.settings?a.settings.length:0},e.$watch(i,function(e){return e>=4?a.loadContent():void 0}),a}]),e.directive("widgetSalesSummary",function(){return{restrict:"A",controller:"WidgetSalesSummaryCtrl"}})}.call(this),function(){"use strict";var e;e=angular.module("impac.components.widgets.sales-top-opportunities",[]),e.controller("WidgetSalesTopOpportunitiesCtrl",["$scope","Utilities","ChartFormatterSvc","$filter",function(e,t,n,i){var a,s;return s=e.widget,s.initContext=function(){return e.isDataFound=angular.isDefined(s.content)&&!_.isEmpty(s.content.opportunities)},e.getOppDetails=function(e){var t;return t=[],e.amount&&t.push(i("mnoCurrency")(e.amount.amount,e.amount.currency||"AUD")),e.probability&&t.push("proba "+e.probability+"%"),e.sales_stage&&t.push(e.sales_stage),t.join(" / ")},e.getOppClass=function(e){switch(e){case 0:return"first";case 1:return"second";case 2:return"second";default:return""}},a=function(){return null!=s.settings?s.settings.length:0},e.$watch(a,function(e){return e>=1?s.loadContent():void 0}),s}]),e.directive("widgetSalesTopOpportunities",function(){return{restrict:"A",controller:"WidgetSalesTopOpportunitiesCtrl"}})}.call(this),function(){"use strict";var e=this,t=e.Chart,n=function(e){this.canvas=e.canvas,this.ctx=e;var t=function(e,t){return e["offset"+t]?e["offset"+t]:document.defaultView.getComputedStyle(e).getPropertyValue(t)},n=this.width=t(e.canvas,"Width")||e.canvas.width,a=this.height=t(e.canvas,"Height")||e.canvas.height;return e.canvas.width=n,e.canvas.height=a,n=this.width=e.canvas.width,a=this.height=e.canvas.height,this.aspectRatio=this.width/this.height,i.retinaScale(this),this};n.defaults={global:{animation:!0,animationSteps:60,animationEasing:"easeOutQuart",showScale:!0,scaleOverride:!1,scaleSteps:null,scaleStepWidth:null,scaleStartValue:null,scaleLineColor:"rgba(0,0,0,.1)",scaleLineWidth:1,scaleShowLabels:!0,scaleLabel:"<%=value%>",scaleIntegersOnly:!0,scaleBeginAtZero:!1,scaleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",scaleFontSize:12,scaleFontStyle:"normal",scaleFontColor:"#666",responsive:!1,maintainAspectRatio:!0,showTooltips:!0,customTooltips:!1,tooltipEvents:["mousemove","touchstart","touchmove","mouseout"],tooltipFillColor:"rgba(0,0,0,0.8)",tooltipFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipFontSize:14,tooltipFontStyle:"normal",tooltipFontColor:"#fff",tooltipTitleFontFamily:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",tooltipTitleFontSize:14,tooltipTitleFontStyle:"bold",tooltipTitleFontColor:"#fff",tooltipTitleTemplate:"<%= label%>",tooltipYPadding:6,tooltipXPadding:6,tooltipCaretSize:8,tooltipCornerRadius:6,tooltipXOffset:10,tooltipTemplate:"<%if (label){%><%=label%>: <%}%><%= value %>",tooltipFixed:!1,multiTooltipTemplate:"<%= value %>",multiTooltipKeyBackground:"#fff",onAnimationProgress:function(){},onAnimationComplete:function(){}}},n.types={};var i=n.helpers={},a=i.each=function(e,t,n){var i=Array.prototype.slice.call(arguments,3);if(e)if(e.length===+e.length){var a;for(a=0;a<e.length;a++)t.apply(n,[e[a],a].concat(i))}else for(var s in e)t.apply(n,[e[s],s].concat(i))},s=i.clone=function(e){var t={};return a(e,function(n,i){e.hasOwnProperty(i)&&(t[i]=n)}),t},r=i.extend=function(e){return a(Array.prototype.slice.call(arguments,1),function(t){a(t,function(n,i){t.hasOwnProperty(i)&&(e[i]=n)})}),e},o=i.merge=function(){var e=Array.prototype.slice.call(arguments,0);return e.unshift({}),r.apply(null,e)},l=i.indexOf=function(e,t){if(Array.prototype.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},d=(i.where=function(e,t){var n=[];return i.each(e,function(e){t(e)&&n.push(e)}),n},i.findNextWhere=function(e,t,n){n||(n=-1);for(var i=n+1;i<e.length;i++){var a=e[i];if(t(a))return a}},i.findPreviousWhere=function(e,t,n){n||(n=e.length);for(var i=n-1;i>=0;i--){var a=e[i];if(t(a))return a}},i.inherits=function(e){var t=this,n=e&&e.hasOwnProperty("constructor")?e.constructor:function(){return t.apply(this,arguments)},i=function(){this.constructor=n};return i.prototype=t.prototype,n.prototype=new i,n.extend=d,e&&r(n.prototype,e),n.__super__=t.prototype,n}),c=i.noop=function(){},u=i.uid=function(){var e=0;return function(){return"chart-"+e++}}(),g=i.warn=function(e){window.console&&"function"==typeof window.console.warn&&console.warn(e)},h=i.amd="function"==typeof define&&define.amd,p=i.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},m=i.max=function(e){return Math.max.apply(Math,e)},v=i.min=function(e){return Math.min.apply(Math,e)},f=(i.cap=function(e,t,n){if(p(t)){if(e>t)return t}else if(p(n)&&n>e)return n;return e},i.getDecimalPlaces=function(e){if(e%1!==0&&p(e)){var t=e.toString();if(t.indexOf("e-")<0)return t.split(".")[1].length;if(t.indexOf(".")<0)return parseInt(t.split("e-")[1]);var n=t.split(".")[1].split("e-");return n[0].length+parseInt(n[1])}return 0}),w=i.radians=function(e){return e*(Math.PI/180)},b=(i.getAngleFromPoint=function(e,t){var n=t.x-e.x,i=t.y-e.y,a=Math.sqrt(n*n+i*i),s=2*Math.PI+Math.atan2(i,n);return 0>n&&0>i&&(s+=2*Math.PI),{angle:s,distance:a}},i.aliasPixel=function(e){return e%2===0?0:.5}),y=(i.splineCurve=function(e,t,n,i){var a=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),s=Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2)),r=i*a/(a+s),o=i*s/(a+s);return{inner:{x:t.x-r*(n.x-e.x),y:t.y-r*(n.y-e.y)},outer:{x:t.x+o*(n.x-e.x),y:t.y+o*(n.y-e.y)}}},i.calculateOrderOfMagnitude=function(e){return Math.floor(Math.log(e)/Math.LN10)}),C=(i.calculateScaleRange=function(e,t,n,i,a){var s=2,r=Math.floor(t/(1.5*n)),o=s>=r,l=m(e),d=v(e);l===d&&(l+=.5,d>=.5&&!i?d-=.5:l+=.5);for(var c=Math.abs(l-d),u=y(c),g=Math.ceil(l/(1*Math.pow(10,u)))*Math.pow(10,u),h=i?0:Math.floor(d/(1*Math.pow(10,u)))*Math.pow(10,u),p=g-h,f=Math.pow(10,u),w=Math.round(p/f);(w>r||r>2*w)&&!o;)if(w>r)f*=2,w=Math.round(p/f),w%1!==0&&(o=!0);else if(a&&u>=0){if(f/2%1!==0)break;f/=2,w=Math.round(p/f)}else f/=2,w=Math.round(p/f);return o&&(w=s,f=p/w),{steps:w,stepValue:f,min:h,max:h+w*f}},i.template=function(e,t){function n(e,t){var n=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):i[e]=i[e];return t?n(t):n}if(e instanceof Function)return e(t);var i={};return n(e,t)}),S=(i.generateLabels=function(e,t,n,i){var s=new Array(t);return e&&a(s,function(t,a){s[a]=C(e,{value:n+i*(a+1)})}),s},i.easingEffects={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return-1*e*(e-2)},easeInOutQuad:function(e){return(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1)},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return 1*((e=e/1-1)*e*e+1)},easeInOutCubic:function(e){return(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2)
},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return-1*((e=e/1-1)*e*e*e-1)},easeInOutQuart:function(e){return(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},easeInQuint:function(e){return 1*(e/=1)*e*e*e*e},easeOutQuint:function(e){return 1*((e=e/1-1)*e*e*e*e+1)},easeInOutQuint:function(e){return(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},easeInSine:function(e){return-1*Math.cos(e/1*(Math.PI/2))+1},easeOutSine:function(e){return 1*Math.sin(e/1*(Math.PI/2))},easeInOutSine:function(e){return-.5*(Math.cos(Math.PI*e/1)-1)},easeInExpo:function(e){return 0===e?1:1*Math.pow(2,10*(e/1-1))},easeOutExpo:function(e){return 1===e?1:1*(-Math.pow(2,-10*e/1)+1)},easeInOutExpo:function(e){return 0===e?0:1===e?1:(e/=.5)<1?.5*Math.pow(2,10*(e-1)):.5*(-Math.pow(2,-10*--e)+2)},easeInCirc:function(e){return e>=1?e:-1*(Math.sqrt(1-(e/=1)*e)-1)},easeOutCirc:function(e){return 1*Math.sqrt(1-(e=e/1-1)*e)},easeInOutCirc:function(e){return(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},easeInElastic:function(e){var t=1.70158,n=0,i=1;return 0===e?0:1==(e/=1)?1:(n||(n=.3),i<Math.abs(1)?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),-(i*Math.pow(2,10*(e-=1))*Math.sin(2*(1*e-t)*Math.PI/n)))},easeOutElastic:function(e){var t=1.70158,n=0,i=1;return 0===e?0:1==(e/=1)?1:(n||(n=.3),i<Math.abs(1)?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),i*Math.pow(2,-10*e)*Math.sin(2*(1*e-t)*Math.PI/n)+1)},easeInOutElastic:function(e){var t=1.70158,n=0,i=1;return 0===e?0:2==(e/=.5)?1:(n||(n=.3*1.5),i<Math.abs(1)?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),1>e?-.5*i*Math.pow(2,10*(e-=1))*Math.sin(2*(1*e-t)*Math.PI/n):i*Math.pow(2,-10*(e-=1))*Math.sin(2*(1*e-t)*Math.PI/n)*.5+1)},easeInBack:function(e){var t=1.70158;return 1*(e/=1)*e*((t+1)*e-t)},easeOutBack:function(e){var t=1.70158;return 1*((e=e/1-1)*e*((t+1)*e+t)+1)},easeInOutBack:function(e){var t=1.70158;return(e/=.5)<1?.5*e*e*(((t*=1.525)+1)*e-t):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce:function(e){return 1-S.easeOutBounce(1-e)},easeOutBounce:function(e){return(e/=1)<1/2.75?7.5625*e*e:2/2.75>e?1*(7.5625*(e-=1.5/2.75)*e+.75):2.5/2.75>e?1*(7.5625*(e-=2.25/2.75)*e+.9375):1*(7.5625*(e-=2.625/2.75)*e+.984375)},easeInOutBounce:function(e){return.5>e?.5*S.easeInBounce(2*e):.5*S.easeOutBounce(2*e-1)+.5}}),D=i.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)}}(),x=(i.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(e){return window.clearTimeout(e,1e3/60)}}(),i.animationLoop=function(e,t,n,i,a,s){var r=0,o=S[n]||S.linear,l=function(){r++;var n=r/t,d=o(n);e.call(s,d,n,r),i.call(s,d,n),t>r?s.animationFrame=D(l):a.apply(s)};D(l)},i.getRelativePosition=function(e){var t,n,i=e.originalEvent||e,a=e.currentTarget||e.srcElement,s=a.getBoundingClientRect();return i.touches?(t=i.touches[0].clientX-s.left,n=i.touches[0].clientY-s.top):(t=i.clientX-s.left,n=i.clientY-s.top),{x:t,y:n}},i.addEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n}),E=i.removeEvent=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=c},_=(i.bindEvents=function(e,t,n){e.events||(e.events={}),a(t,function(t){e.events[t]=function(){n.apply(e,arguments)},x(e.chart.canvas,t,e.events[t])})},i.unbindEvents=function(e,t){a(t,function(t,n){E(e.chart.canvas,n,t)})}),M=i.getMaximumWidth=function(e){var t=e.parentNode,n=parseInt(A(t,"padding-left"))+parseInt(A(t,"padding-right"));return t.clientWidth-n},k=i.getMaximumHeight=function(e){var t=e.parentNode,n=parseInt(A(t,"padding-bottom"))+parseInt(A(t,"padding-top"));return t.clientHeight-n},A=i.getStyle=function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,null).getPropertyValue(t)},F=(i.getMaximumSize=i.getMaximumWidth,i.retinaScale=function(e){var t=e.ctx,n=e.canvas.width,i=e.canvas.height;window.devicePixelRatio&&(t.canvas.style.width=n+"px",t.canvas.style.height=i+"px",t.canvas.height=i*window.devicePixelRatio,t.canvas.width=n*window.devicePixelRatio,t.scale(window.devicePixelRatio,window.devicePixelRatio))}),W=i.clear=function(e){e.ctx.clearRect(0,0,e.width,e.height)},L=i.fontString=function(e,t,n){return t+" "+e+"px "+n},T=i.longestText=function(e,t,n){e.font=t;var i=0;return a(n,function(t){var n=e.measureText(t).width;i=n>i?n:i}),i},z=i.drawRoundedRectangle=function(e,t,n,i,a,s){e.beginPath(),e.moveTo(t+s,n),e.lineTo(t+i-s,n),e.quadraticCurveTo(t+i,n,t+i,n+s),e.lineTo(t+i,n+a-s),e.quadraticCurveTo(t+i,n+a,t+i-s,n+a),e.lineTo(t+s,n+a),e.quadraticCurveTo(t,n+a,t,n+a-s),e.lineTo(t,n+s),e.quadraticCurveTo(t,n,t+s,n),e.closePath()};n.instances={},n.Type=function(e,t,i){this.options=t,this.chart=i,this.id=u(),n.instances[this.id]=this,t.responsive&&this.resize(),this.initialize.call(this,e)},r(n.Type.prototype,{initialize:function(){return this},clear:function(){return W(this.chart),this},stop:function(){return n.animationService.cancelAnimation(this),this},resize:function(e){this.stop();var t=this.chart.canvas,n=M(this.chart.canvas),i=this.options.maintainAspectRatio?n/this.chart.aspectRatio:k(this.chart.canvas);return t.width=this.chart.width=n,t.height=this.chart.height=i,F(this.chart),"function"==typeof e&&e.apply(this,Array.prototype.slice.call(arguments,1)),this},reflow:c,render:function(e){if(e&&this.reflow(),this.options.animation&&!e){var t=new n.Animation;t.numSteps=this.options.animationSteps,t.easing=this.options.animationEasing,t.render=function(e,t){var n=i.easingEffects[t.easing],a=t.currentStep/t.numSteps,s=n(a);e.draw(s,a,t.currentStep)},t.onAnimationProgress=this.options.onAnimationProgress,t.onAnimationComplete=this.options.onAnimationComplete,n.animationService.addAnimation(this,t)}else this.draw(),this.options.onAnimationComplete.call(this);return this},generateLegend:function(){return C(this.options.legendTemplate,this)},destroy:function(){this.clear(),_(this,this.events);var e=this.chart.canvas;e.width=this.chart.width,e.height=this.chart.height,e.style.removeProperty?(e.style.removeProperty("width"),e.style.removeProperty("height")):(e.style.removeAttribute("width"),e.style.removeAttribute("height")),delete n.instances[this.id]},showTooltip:function(e,t){"undefined"==typeof this.activeElements&&(this.activeElements=[]);var s=function(e){var t=!1;return e.length!==this.activeElements.length?t=!0:(a(e,function(e,n){e!==this.activeElements[n]&&(t=!0)},this),t)}.call(this,e);if(s||t){if(this.activeElements=e,this.draw(),this.options.customTooltips&&this.options.customTooltips(!1),e.length>0)if(this.datasets&&this.datasets.length>1){for(var r,o,d=this.datasets.length-1;d>=0&&(r=this.datasets[d].points||this.datasets[d].bars||this.datasets[d].segments,o=l(r,e[0]),-1===o);d--);var c=[],u=[],g=function(){var e,t,n,a,s,r=[],l=[],d=[];return i.each(this.datasets,function(t){e=t.points||t.bars||t.segments,e[o]&&e[o].hasValue()&&r.push(e[o])}),i.each(r,function(e){l.push(e.x),d.push(e.y),c.push(i.template(this.options.multiTooltipTemplate,e)),u.push({fill:e._saved.fillColor||e.fillColor,stroke:e._saved.strokeColor||e.strokeColor})},this),s=v(d),n=m(d),a=v(l),t=m(l),{x:a>this.chart.width/2?a:t,y:(s+n)/2}}.call(this,o);new n.MultiTooltip({x:g.x,y:g.y,xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,xOffset:this.options.tooltipXOffset,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,titleTextColor:this.options.tooltipTitleFontColor,titleFontFamily:this.options.tooltipTitleFontFamily,titleFontStyle:this.options.tooltipTitleFontStyle,titleFontSize:this.options.tooltipTitleFontSize,cornerRadius:this.options.tooltipCornerRadius,labels:c,legendColors:u,legendColorBackground:this.options.multiTooltipKeyBackground,title:C(this.options.tooltipTitleTemplate,e[0]),chart:this.chart,ctx:this.chart.ctx,custom:this.options.customTooltips}).draw()}else a(e,function(e){var t=e.tooltipPosition();new n.Tooltip({x:Math.round(t.x),y:Math.round(t.y),xPadding:this.options.tooltipXPadding,yPadding:this.options.tooltipYPadding,fillColor:this.options.tooltipFillColor,textColor:this.options.tooltipFontColor,fontFamily:this.options.tooltipFontFamily,fontStyle:this.options.tooltipFontStyle,fontSize:this.options.tooltipFontSize,caretHeight:this.options.tooltipCaretSize,cornerRadius:this.options.tooltipCornerRadius,text:C(this.options.tooltipTemplate,e),chart:this.chart,custom:this.options.customTooltips,tooltipFixed:this.options.tooltipFixed}).draw()},this);return this}},toBase64Image:function(){return this.chart.canvas.toDataURL.apply(this.chart.canvas,arguments)}}),n.Type.extend=function(e){var t=this,i=function(){return t.apply(this,arguments)};if(i.prototype=s(t.prototype),r(i.prototype,e),i.extend=n.Type.extend,e.name||t.prototype.name){var a=e.name||t.prototype.name,l=n.defaults[t.prototype.name]?s(n.defaults[t.prototype.name]):{};n.defaults[a]=r(l,e.defaults),n.types[a]=i,n.prototype[a]=function(e,t){var s=o(n.defaults.global,n.defaults[a],t||{});return new i(e,s,this)}}else g("Name not provided for this chart, so it hasn't been registered");return t},n.Element=function(e){r(this,e),this.initialize.apply(this,arguments),this.save()},r(n.Element.prototype,{initialize:function(){},restore:function(e){return e?a(e,function(e){this[e]=this._saved[e]},this):r(this,this._saved),this},save:function(){return this._saved=s(this),delete this._saved._saved,this},update:function(e){return a(e,function(e,t){this._saved[t]=this[t],this[t]=e},this),this},transition:function(e,t){return a(e,function(e,n){this[n]=(e-this._saved[n])*t+this._saved[n]},this),this},tooltipPosition:function(){return{x:this.x,y:this.y}},hasValue:function(){return p(this.value)}}),n.Element.extend=d,n.Point=n.Element.extend({display:!0,inRange:function(e,t){var n=this.hitDetectionRadius+this.radius;return Math.pow(e-this.x,2)+Math.pow(t-this.y,2)<Math.pow(n,2)},draw:function(){if(this.display){var e=this.ctx;e.beginPath(),e.arc(this.x,this.y,this.radius,0,2*Math.PI),e.closePath(),e.strokeStyle=this.strokeColor,e.lineWidth=this.strokeWidth,e.fillStyle=this.fillColor,e.fill(),e.stroke()}}}),n.Arc=n.Element.extend({inRange:function(e,t){var n=i.getAngleFromPoint(this,{x:e,y:t}),a=n.angle>=this.startAngle&&n.angle<=this.endAngle,s=n.distance>=this.innerRadius&&n.distance<=this.outerRadius;return a&&s},tooltipPosition:function(){var e=this.startAngle+(this.endAngle-this.startAngle)/2,t=(this.outerRadius-this.innerRadius)/2+this.innerRadius;return{x:this.x+Math.cos(e)*t,y:this.y+Math.sin(e)*t}},draw:function(){var e=this.ctx;e.beginPath(),e.arc(this.x,this.y,this.outerRadius,this.startAngle,this.endAngle),e.arc(this.x,this.y,this.innerRadius,this.endAngle,this.startAngle,!0),e.closePath(),e.strokeStyle=this.strokeColor,e.lineWidth=this.strokeWidth,e.fillStyle=this.fillColor,e.fill(),e.lineJoin="bevel",this.showStroke&&e.stroke()}}),n.Rectangle=n.Element.extend({draw:function(){var e=this.ctx,t=this.width/2,n=this.x-t,i=this.x+t,a=this.base-(this.base-this.y),s=this.strokeWidth/2;this.showStroke&&(n+=s,i-=s,a+=s),e.beginPath(),e.fillStyle=this.fillColor,e.strokeStyle=this.strokeColor,e.lineWidth=this.strokeWidth,e.moveTo(n,this.base),e.lineTo(n,a),e.lineTo(i,a),e.lineTo(i,this.base),e.fill(),this.showStroke&&e.stroke()},height:function(){return this.base-this.y},inRange:function(e,t){return e>=this.x-this.width/2&&e<=this.x+this.width/2&&t>=this.y&&t<=this.base}}),n.Animation=n.Element.extend({currentStep:null,numSteps:60,easing:"",render:null,onAnimationProgress:null,onAnimationComplete:null}),n.Tooltip=n.Element.extend({draw:function(){var e=this.chart.ctx;e.font=L(this.fontSize,this.fontStyle,this.fontFamily),this.xAlign="center",this.yAlign="above";var t=this.caretPadding=2,n=e.measureText(this.text).width+2*this.xPadding,i=this.fontSize+2*this.yPadding,a=i+this.caretHeight+t;this.tooltipFixed&&(n=this.chart.width,i=2*this.fontSize+4*this.yPadding),this.x+n/2>this.chart.width?this.xAlign="left":this.x-n/2<0&&(this.xAlign="right"),this.y-a<0&&(this.yAlign="below");var s=this.x-n/2,r=this.y-a;if(e.fillStyle=this.fillColor,this.custom)this.custom(this);else{if(this.tooltipFixed)switch(s=0,this.yAlign){case"above":r=0;break;case"below":r=this.chart.height/2-i/2}else{switch(this.yAlign){case"above":e.beginPath(),e.moveTo(this.x,this.y-t),e.lineTo(this.x+this.caretHeight,this.y-(t+this.caretHeight)),e.lineTo(this.x-this.caretHeight,this.y-(t+this.caretHeight)),e.closePath(),e.fill();break;case"below":r=this.y+t+this.caretHeight,e.beginPath(),e.moveTo(this.x,this.y+t),e.lineTo(this.x+this.caretHeight,this.y+t+this.caretHeight),e.lineTo(this.x-this.caretHeight,this.y+t+this.caretHeight),e.closePath(),e.fill()}switch(this.xAlign){case"left":s=this.x-n+(this.cornerRadius+this.caretHeight);break;case"right":s=this.x-(this.cornerRadius+this.caretHeight)}}z(e,s,r,n,i,this.cornerRadius),e.fill(),e.fillStyle=this.textColor,e.textAlign="center",e.textBaseline="middle",this.tooltipFixed&&this.text.split(":").length>=2?(e.fillText(this.text.split(":")[0],s+n/2,r+this.yPadding+this.fontSize),e.fillText(this.text.split(":")[1],s+n/2,r+2*(this.yPadding+this.fontSize))):e.fillText(this.text,s+n/2,r+i/2)}}}),n.MultiTooltip=n.Element.extend({initialize:function(){this.font=L(this.fontSize,this.fontStyle,this.fontFamily),this.titleFont=L(this.titleFontSize,this.titleFontStyle,this.titleFontFamily),this.height=this.labels.length*this.fontSize+(this.labels.length-1)*(this.fontSize/2)+2*this.yPadding+1.5*this.titleFontSize,this.ctx.font=this.titleFont;var e=this.ctx.measureText(this.title).width,t=T(this.ctx,this.font,this.labels)+this.fontSize+3,n=m([t,e]);this.width=n+2*this.xPadding;var i=this.height/2;this.y-i<0?this.y=i:this.y+i>this.chart.height&&(this.y=this.chart.height-i),this.x>this.chart.width/2?this.x-=this.xOffset+this.width:this.x+=this.xOffset},getLineHeight:function(e){var t=this.y-this.height/2+this.yPadding,n=e-1;return 0===e?t+this.titleFontSize/2:t+(1.5*this.fontSize*n+this.fontSize/2)+1.5*this.titleFontSize},draw:function(){if(this.custom)this.custom(this);else{z(this.ctx,this.x,this.y-this.height/2,this.width,this.height,this.cornerRadius);var e=this.ctx;e.fillStyle=this.fillColor,e.fill(),e.closePath(),e.textAlign="left",e.textBaseline="middle",e.fillStyle=this.titleTextColor,e.font=this.titleFont,e.fillText(this.title,this.x+this.xPadding,this.getLineHeight(0)),e.font=this.font,i.each(this.labels,function(t,n){e.fillStyle=this.textColor,e.fillText(t,this.x+this.xPadding+this.fontSize+3,this.getLineHeight(n+1)),e.fillStyle=this.legendColorBackground,e.fillRect(this.x+this.xPadding,this.getLineHeight(n+1)-this.fontSize/2,this.fontSize,this.fontSize),e.fillStyle=this.legendColors[n].fill,e.fillRect(this.x+this.xPadding,this.getLineHeight(n+1)-this.fontSize/2,this.fontSize,this.fontSize)},this)}}}),n.Scale=n.Element.extend({initialize:function(){this.fit()},buildYLabels:function(){this.yLabels=[];for(var e=f(this.stepValue),t=0;t<=this.steps;t++)this.yLabels.push(C(this.templateString,{value:(this.min+t*this.stepValue).toFixed(e)}));this.yLabelWidth=this.display&&this.showLabels?T(this.ctx,this.font,this.yLabels)+10:0},addXLabel:function(e){this.xLabels.push(e),this.valuesCount++,this.fit()},removeXLabel:function(){this.xLabels.shift(),this.valuesCount--,this.fit()},fit:function(){this.startPoint=this.display?this.fontSize:0,this.endPoint=this.display?this.height-1.5*this.fontSize-5:this.height,this.startPoint+=this.padding,this.endPoint-=this.padding;var e,t=this.endPoint,n=this.endPoint-this.startPoint;for(this.calculateYRange(n),this.buildYLabels(),this.calculateXLabelRotation();n>this.endPoint-this.startPoint;)n=this.endPoint-this.startPoint,e=this.yLabelWidth,this.calculateYRange(n),this.buildYLabels(),e<this.yLabelWidth&&(this.endPoint=t,this.calculateXLabelRotation())},calculateXLabelRotation:function(){this.ctx.font=this.font;var e,t,n=this.ctx.measureText(this.xLabels[0]).width,i=this.ctx.measureText(this.xLabels[this.xLabels.length-1]).width;if(this.xScalePaddingRight=i/2+3,this.xScalePaddingLeft=n/2>this.yLabelWidth?n/2:this.yLabelWidth,this.xLabelRotation=0,this.display){var a,s=T(this.ctx,this.font,this.xLabels);this.xLabelWidth=s;for(var r=Math.floor(this.calculateX(1)-this.calculateX(0))-6;this.xLabelWidth>r&&0===this.xLabelRotation||this.xLabelWidth>r&&this.xLabelRotation<=90&&this.xLabelRotation>0;)a=Math.cos(w(this.xLabelRotation)),e=a*n,t=a*i,e+this.fontSize/2>this.yLabelWidth&&(this.xScalePaddingLeft=e+this.fontSize/2),this.xScalePaddingRight=this.fontSize/2,this.xLabelRotation++,this.xLabelWidth=a*s;this.xLabelRotation>0&&(this.endPoint-=Math.sin(w(this.xLabelRotation))*s+3)}else this.xLabelWidth=0,this.xScalePaddingRight=this.padding,this.xScalePaddingLeft=this.padding},calculateYRange:c,drawingArea:function(){return this.startPoint-this.endPoint},calculateY:function(e){var t=this.drawingArea()/(this.min-this.max);return this.endPoint-t*(e-this.min)},calculateX:function(e){var t=(this.xLabelRotation>0,this.width-(this.xScalePaddingLeft+this.xScalePaddingRight)),n=t/Math.max(this.valuesCount-(this.offsetGridLines?0:1),1),i=n*e+this.xScalePaddingLeft;return this.offsetGridLines&&(i+=n/2),Math.round(i)},update:function(e){i.extend(this,e),this.fit()},draw:function(){var e=this.ctx,t=(this.endPoint-this.startPoint)/this.steps,n=Math.round(this.xScalePaddingLeft);this.display&&(e.fillStyle=this.textColor,e.font=this.font,a(this.yLabels,function(a,s){var r=this.endPoint-t*s,o=Math.round(r),l=this.showHorizontalLines;e.textAlign="right",e.textBaseline="middle",this.showLabels&&e.fillText(a,n-10,r),0!==s||l||(l=!0),l&&e.beginPath(),s>0?(e.lineWidth=this.gridLineWidth,e.strokeStyle=this.gridLineColor):(e.lineWidth=this.lineWidth,e.strokeStyle=this.lineColor),o+=i.aliasPixel(e.lineWidth),l&&(e.moveTo(n,o),e.lineTo(this.width,o),e.stroke(),e.closePath()),e.lineWidth=this.lineWidth,e.strokeStyle=this.lineColor,e.beginPath(),e.moveTo(n-5,o),e.lineTo(n,o),e.stroke(),e.closePath()},this),a(this.xLabels,function(t,n){var i=this.calculateX(n)+b(this.lineWidth),a=this.calculateX(n-(this.offsetGridLines?.5:0))+b(this.lineWidth),s=this.xLabelRotation>0,r=this.showVerticalLines;0!==n||r||(r=!0),r&&e.beginPath(),n>0?(e.lineWidth=this.gridLineWidth,e.strokeStyle=this.gridLineColor):(e.lineWidth=this.lineWidth,e.strokeStyle=this.lineColor),r&&(e.moveTo(a,this.endPoint),e.lineTo(a,this.startPoint-3),e.stroke(),e.closePath()),e.lineWidth=this.lineWidth,e.strokeStyle=this.lineColor,e.beginPath(),e.moveTo(a,this.endPoint),e.lineTo(a,this.endPoint+5),e.stroke(),e.closePath(),e.save(),e.translate(i,s?this.endPoint+12:this.endPoint+8),e.rotate(-1*w(this.xLabelRotation)),e.font=this.font,e.textAlign=s?"right":"center",e.textBaseline=s?"middle":"top",e.fillText(t,0,0),e.restore()},this))}}),n.RadialScale=n.Element.extend({initialize:function(){this.size=v([this.height,this.width]),this.drawingArea=this.display?this.size/2-(this.fontSize/2+this.backdropPaddingY):this.size/2},calculateCenterOffset:function(e){var t=this.drawingArea/(this.max-this.min);return(e-this.min)*t},update:function(){this.lineArc?this.drawingArea=this.display?this.size/2-(this.fontSize/2+this.backdropPaddingY):this.size/2:this.setScaleSize(),this.buildYLabels()},buildYLabels:function(){this.yLabels=[];for(var e=f(this.stepValue),t=0;t<=this.steps;t++)this.yLabels.push(C(this.templateString,{value:(this.min+t*this.stepValue).toFixed(e)}))},getCircumference:function(){return 2*Math.PI/this.valuesCount},setScaleSize:function(){var e,t,n,i,a,s,r,o,l,d,c,u,g=v([this.height/2-this.pointLabelFontSize-5,this.width/2]),h=this.width,m=0;for(this.ctx.font=L(this.pointLabelFontSize,this.pointLabelFontStyle,this.pointLabelFontFamily),t=0;t<this.valuesCount;t++)e=this.getPointPosition(t,g),n=this.ctx.measureText(C(this.templateString,{value:this.labels[t]})).width+5,0===t||t===this.valuesCount/2?(i=n/2,e.x+i>h&&(h=e.x+i,a=t),e.x-i<m&&(m=e.x-i,r=t)):t<this.valuesCount/2?e.x+n>h&&(h=e.x+n,a=t):t>this.valuesCount/2&&e.x-n<m&&(m=e.x-n,r=t);l=m,d=Math.ceil(h-this.width),s=this.getIndexAngle(a),o=this.getIndexAngle(r),c=d/Math.sin(s+Math.PI/2),u=l/Math.sin(o+Math.PI/2),c=p(c)?c:0,u=p(u)?u:0,this.drawingArea=g-(u+c)/2,this.setCenterPoint(u,c)},setCenterPoint:function(e,t){var n=this.width-t-this.drawingArea,i=e+this.drawingArea;this.xCenter=(i+n)/2,this.yCenter=this.height/2},getIndexAngle:function(e){var t=2*Math.PI/this.valuesCount;return e*t-Math.PI/2},getPointPosition:function(e,t){var n=this.getIndexAngle(e);return{x:Math.cos(n)*t+this.xCenter,y:Math.sin(n)*t+this.yCenter}},draw:function(){if(this.display){var e=this.ctx;if(a(this.yLabels,function(t,n){if(n>0){var i,a=n*(this.drawingArea/this.steps),s=this.yCenter-a;if(this.lineWidth>0)if(e.strokeStyle=this.lineColor,e.lineWidth=this.lineWidth,this.lineArc)e.beginPath(),e.arc(this.xCenter,this.yCenter,a,0,2*Math.PI),e.closePath(),e.stroke();else{e.beginPath();for(var r=0;r<this.valuesCount;r++)i=this.getPointPosition(r,this.calculateCenterOffset(this.min+n*this.stepValue)),0===r?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y);e.closePath(),e.stroke()}if(this.showLabels){if(e.font=L(this.fontSize,this.fontStyle,this.fontFamily),this.showLabelBackdrop){var o=e.measureText(t).width;e.fillStyle=this.backdropColor,e.fillRect(this.xCenter-o/2-this.backdropPaddingX,s-this.fontSize/2-this.backdropPaddingY,o+2*this.backdropPaddingX,this.fontSize+2*this.backdropPaddingY)}e.textAlign="center",e.textBaseline="middle",e.fillStyle=this.fontColor,e.fillText(t,this.xCenter,s)}}},this),!this.lineArc){e.lineWidth=this.angleLineWidth,e.strokeStyle=this.angleLineColor;for(var t=this.valuesCount-1;t>=0;t--){var n=null,i=null;if(this.angleLineWidth>0&&(n=this.calculateCenterOffset(this.max),i=this.getPointPosition(t,n),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(i.x,i.y),e.stroke(),e.closePath()),this.backgroundColors&&this.backgroundColors.length==this.valuesCount){null==n&&(n=this.calculateCenterOffset(this.max)),null==i&&(i=this.getPointPosition(t,n));var s=this.getPointPosition(0===t?this.valuesCount-1:t-1,n),r=this.getPointPosition(t===this.valuesCount-1?0:t+1,n),o={x:(s.x+i.x)/2,y:(s.y+i.y)/2},l={x:(i.x+r.x)/2,y:(i.y+r.y)/2};e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(o.x,o.y),e.lineTo(i.x,i.y),e.lineTo(l.x,l.y),e.fillStyle=this.backgroundColors[t],e.fill(),e.closePath()}var d=this.getPointPosition(t,this.calculateCenterOffset(this.max)+5);e.font=L(this.pointLabelFontSize,this.pointLabelFontStyle,this.pointLabelFontFamily),e.fillStyle=this.pointLabelFontColor;var c=this.labels.length,u=this.labels.length/2,g=u/2,h=g>t||t>c-g,p=t===g||t===c-g;e.textAlign=0===t?"center":t===u?"center":u>t?"left":"right",e.textBaseline=p?"middle":h?"bottom":"top",e.fillText(this.labels[t],d.x,d.y)}}}}}),n.animationService={frameDuration:17,animations:[],dropFrames:0,addAnimation:function(e,t){for(var n=0;n<this.animations.length;++n)if(this.animations[n].chartInstance===e)return void(this.animations[n].animationObject=t);this.animations.push({chartInstance:e,animationObject:t}),1==this.animations.length&&i.requestAnimFrame.call(window,this.digestWrapper)},cancelAnimation:function(e){var t=i.findNextWhere(this.animations,function(t){return t.chartInstance===e});t&&this.animations.splice(t,1)},digestWrapper:function(){n.animationService.startDigest.call(n.animationService)},startDigest:function(){var e=Date.now(),t=0;this.dropFrames>1&&(t=Math.floor(this.dropFrames),this.dropFrames-=t);for(var n=0;n<this.animations.length;n++)null===this.animations[n].animationObject.currentStep&&(this.animations[n].animationObject.currentStep=0),this.animations[n].animationObject.currentStep+=1+t,this.animations[n].animationObject.currentStep>this.animations[n].animationObject.numSteps&&(this.animations[n].animationObject.currentStep=this.animations[n].animationObject.numSteps),this.animations[n].animationObject.render(this.animations[n].chartInstance,this.animations[n].animationObject),this.animations[n].animationObject.currentStep==this.animations[n].animationObject.numSteps&&(this.animations.splice(n,1),n--);var a=Date.now(),s=a-e-this.frameDuration,r=s/this.frameDuration;r>1&&(this.dropFrames+=r),this.animations.length>0&&i.requestAnimFrame.call(window,this.digestWrapper)}},i.addEvent(window,"resize",function(){var e;return function(){clearTimeout(e),e=setTimeout(function(){a(n.instances,function(e){e.options.responsive&&e.resize(e.render,!0)})},50)}}()),h?define(function(){return n}):"object"==typeof module&&module.exports&&(module.exports=n),e.Chart=n,n.noConflict=function(){return e.Chart=t,n}}.call(this),function(){"use strict";var e=this,t=e.Chart,n=t.helpers,i={scaleBeginAtZero:!0,scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,barShowStroke:!0,barStrokeWidth:2,barValueSpacing:5,barDatasetSpacing:1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].fillColor%>"><%if(datasets[i].label){%><%=datasets[i].label%><%}%></span></li><%}%></ul>',showXLabels:!0};t.Type.extend({name:"Bar",defaults:i,initialize:function(e){var i=this.options;this.ScaleClass=t.Scale.extend({offsetGridLines:!0,calculateBarX:function(e,t,n){var a=this.calculateBaseWidth(),s=this.calculateX(n)-a/2,r=this.calculateBarWidth(e);return s+r*t+t*i.barDatasetSpacing+r/2},calculateBaseWidth:function(){return this.calculateX(1)-this.calculateX(0)-2*i.barValueSpacing},calculateBarWidth:function(e){var t=this.calculateBaseWidth()-(e-1)*i.barDatasetSpacing;return t/e}}),this.datasets=[],this.options.showTooltips&&n.bindEvents(this,this.options.tooltipEvents,function(e){var t="mouseout"!==e.type?this.getBarsAtEvent(e):[];this.eachBars(function(e){e.restore(["fillColor","strokeColor"])}),n.each(t,function(e){e.fillColor=e.highlightFill,e.strokeColor=e.highlightStroke}),this.showTooltip(t)}),this.BarClass=t.Rectangle.extend({strokeWidth:this.options.barStrokeWidth,showStroke:this.options.barShowStroke,ctx:this.chart.ctx}),n.each(e.datasets,function(t){var i={label:t.label||null,fillColor:t.fillColor,strokeColor:t.strokeColor,bars:[]};this.datasets.push(i),n.each(t.data,function(n,a){i.bars.push(new this.BarClass({value:n,label:e.labels[a],datasetLabel:t.label,strokeColor:t.strokeColor,fillColor:t.fillColor,highlightFill:t.highlightFill||t.fillColor,highlightStroke:t.highlightStroke||t.strokeColor}))},this)},this),this.buildScale(e.labels),this.BarClass.prototype.base=this.scale.endPoint,this.eachBars(function(e,t,i){n.extend(e,{width:this.scale.calculateBarWidth(this.datasets.length),x:this.scale.calculateBarX(this.datasets.length,i,t),y:this.scale.endPoint}),e.save()},this),this.render()},update:function(){this.scale.update(),n.each(this.activeElements,function(e){e.restore(["fillColor","strokeColor"])}),this.eachBars(function(e){e.save()}),this.render()},eachBars:function(e){n.each(this.datasets,function(t,i){n.each(t.bars,e,this,i)},this)},getBarsAtEvent:function(e){for(var t,i=[],a=n.getRelativePosition(e),s=function(e){i.push(e.bars[t])},r=0;r<this.datasets.length;r++)for(t=0;t<this.datasets[r].bars.length;t++)if(this.datasets[r].bars[t].inRange(a.x,a.y))return n.each(this.datasets,s),i;return i},buildScale:function(e){var t=this,i=function(){var e=[];return t.eachBars(function(t){e.push(t.value)}),e},a={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:e.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(e){var t=n.calculateScaleRange(i(),e,this.fontSize,this.beginAtZero,this.integersOnly);n.extend(this,t)},xLabels:this.options.showXLabels?e:[],font:n.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.barShowStroke?this.options.barStrokeWidth:0,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&n.extend(a,{calculateYRange:n.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new this.ScaleClass(a)},addData:function(e,t){n.each(e,function(e,n){this.datasets[n].bars.push(new this.BarClass({value:e,label:t,datasetLabel:this.datasets[n].label,x:this.scale.calculateBarX(this.datasets.length,n,this.scale.valuesCount+1),y:this.scale.endPoint,width:this.scale.calculateBarWidth(this.datasets.length),base:this.scale.endPoint,strokeColor:this.datasets[n].strokeColor,fillColor:this.datasets[n].fillColor}))},this),this.scale.addXLabel(t),this.update()},removeData:function(){this.scale.removeXLabel(),n.each(this.datasets,function(e){e.bars.shift()},this),this.update()},reflow:function(){n.extend(this.BarClass.prototype,{y:this.scale.endPoint,base:this.scale.endPoint});var e=n.extend({height:this.chart.height,width:this.chart.width});this.scale.update(e)},draw:function(e){var t=e||1;this.clear(),this.chart.ctx,this.scale.draw(t),n.each(this.datasets,function(e,i){n.each(e.bars,function(e,n){e.hasValue()&&(e.base=this.scale.endPoint,e.transition({x:this.scale.calculateBarX(this.datasets.length,i,n),y:this.scale.calculateY(e.value),width:this.scale.calculateBarWidth(this.datasets.length)},t).draw())},this)},this)}})}.call(this),function(){"use strict";var e=this,t=e.Chart,n=t.helpers,i={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,percentageInnerCutout:50,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"><%if(segments[i].label){%><%=segments[i].label%><%}%></span></li><%}%></ul>'};t.Type.extend({name:"Doughnut",defaults:i,initialize:function(e){this.segments=[],this.outerRadius=(n.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2,this.SegmentArc=t.Arc.extend({ctx:this.chart.ctx,x:this.chart.width/2,y:this.chart.height/2}),this.options.showTooltips&&n.bindEvents(this,this.options.tooltipEvents,function(e){var t="mouseout"!==e.type?this.getSegmentsAtEvent(e):[];n.each(this.segments,function(e){e.restore(["fillColor"])}),n.each(t,function(e){e.fillColor=e.highlightColor}),this.showTooltip(t)}),this.calculateTotal(e),n.each(e,function(t,n){t.color||(t.color="hsl("+360*n/e.length+", 100%, 50%)"),this.addData(t,n,!0)},this),this.render()},getSegmentsAtEvent:function(e){var t=[],i=n.getRelativePosition(e);return n.each(this.segments,function(e){e.inRange(i.x,i.y)&&t.push(e)},this),t},addData:function(e,t,n){var i=void 0!==t?t:this.segments.length;this.segments.splice(i,0,new this.SegmentArc({value:e.value,outerRadius:this.options.animateScale?0:this.outerRadius,innerRadius:this.options.animateScale?0:this.outerRadius/100*this.options.percentageInnerCutout,fillColor:e.color,highlightColor:e.highlight||e.color,showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,startAngle:1.5*Math.PI,circumference:this.options.animateRotate?0:this.calculateCircumference(e.value),label:e.label})),n||(this.reflow(),this.update())
},calculateCircumference:function(e){return this.total>0?2*Math.PI*(e/this.total):0},calculateTotal:function(e){this.total=0,n.each(e,function(e){this.total+=Math.abs(e.value)},this)},update:function(){this.calculateTotal(this.segments),n.each(this.activeElements,function(e){e.restore(["fillColor"])}),n.each(this.segments,function(e){e.save()}),this.render()},removeData:function(e){var t=n.isNumber(e)?e:this.segments.length-1;this.segments.splice(t,1),this.reflow(),this.update()},reflow:function(){n.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2}),this.outerRadius=(n.min([this.chart.width,this.chart.height])-this.options.segmentStrokeWidth/2)/2,n.each(this.segments,function(e){e.update({outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout})},this)},draw:function(e){var t=e?e:1;this.clear(),n.each(this.segments,function(e,n){e.transition({circumference:this.calculateCircumference(e.value),outerRadius:this.outerRadius,innerRadius:this.outerRadius/100*this.options.percentageInnerCutout},t),e.endAngle=e.startAngle+e.circumference,e.draw(),0===n&&(e.startAngle=1.5*Math.PI),n<this.segments.length-1&&(this.segments[n+1].startAngle=e.endAngle)},this)}}),t.types.Doughnut.extend({name:"Pie",defaults:n.merge(i,{percentageInnerCutout:0})})}.call(this),function(){"use strict";var e=this,t=e.Chart,n=t.helpers,i={scaleShowGridLines:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"><%if(datasets[i].label){%><%=datasets[i].label%><%}%></span></li><%}%></ul>',offsetGridLines:!1,showXLabels:!0};t.Type.extend({name:"Line",defaults:i,initialize:function(e){this.PointClass=t.Point.extend({offsetGridLines:this.options.offsetGridLines,strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx,inRange:function(e){return Math.pow(e-this.x,2)<Math.pow(this.radius+this.hitDetectionRadius,2)}}),this.datasets=[],this.options.showTooltips&&n.bindEvents(this,this.options.tooltipEvents,function(e){var t="mouseout"!==e.type?this.getPointsAtEvent(e):[];this.eachPoints(function(e){e.restore(["fillColor","strokeColor"])}),n.each(t,function(e){e.fillColor=e.highlightFill,e.strokeColor=e.highlightStroke}),this.showTooltip(t)}),n.each(e.datasets,function(t){var i={label:t.label||null,fillColor:t.fillColor,strokeColor:t.strokeColor,pointColor:t.pointColor,pointStrokeColor:t.pointStrokeColor,points:[]};this.datasets.push(i),n.each(t.data,function(n,a){i.points.push(new this.PointClass({value:n,label:e.labels[a],datasetLabel:t.label,strokeColor:t.pointStrokeColor,fillColor:t.pointColor,highlightFill:t.pointHighlightFill||t.pointColor,highlightStroke:t.pointHighlightStroke||t.pointStrokeColor}))},this),this.buildScale(e.labels),this.eachPoints(function(e,t){n.extend(e,{x:this.scale.calculateX(t),y:this.scale.endPoint}),e.save()},this)},this),this.render()},update:function(){this.scale.update(),n.each(this.activeElements,function(e){e.restore(["fillColor","strokeColor"])}),this.eachPoints(function(e){e.save()}),this.render()},eachPoints:function(e){n.each(this.datasets,function(t){n.each(t.points,e,this)},this)},getPointsAtEvent:function(e){var t=[],i=n.getRelativePosition(e);return n.each(this.datasets,function(e){n.each(e.points,function(e){e.inRange(i.x,i.y)&&t.push(e)})},this),t},buildScale:function(e){var i=this,a=function(){var e=[];return i.eachPoints(function(t){e.push(t.value)}),e},s={templateString:this.options.scaleLabel,height:this.chart.height,width:this.chart.width,ctx:this.chart.ctx,textColor:this.options.scaleFontColor,offsetGridLines:this.options.offsetGridLines,fontSize:this.options.scaleFontSize,fontStyle:this.options.scaleFontStyle,fontFamily:this.options.scaleFontFamily,valuesCount:e.length,beginAtZero:this.options.scaleBeginAtZero,integersOnly:this.options.scaleIntegersOnly,calculateYRange:function(e){var t=n.calculateScaleRange(a(),e,this.fontSize,this.beginAtZero,this.integersOnly);n.extend(this,t)},xLabels:this.options.showXLabels?e:[],font:n.fontString(this.options.scaleFontSize,this.options.scaleFontStyle,this.options.scaleFontFamily),lineWidth:this.options.scaleLineWidth,lineColor:this.options.scaleLineColor,showHorizontalLines:this.options.scaleShowHorizontalLines,showVerticalLines:this.options.scaleShowVerticalLines,gridLineWidth:this.options.scaleShowGridLines?this.options.scaleGridLineWidth:0,gridLineColor:this.options.scaleShowGridLines?this.options.scaleGridLineColor:"rgba(0,0,0,0)",padding:this.options.showScale?0:this.options.pointDotRadius+this.options.pointDotStrokeWidth,showLabels:this.options.scaleShowLabels,display:this.options.showScale};this.options.scaleOverride&&n.extend(s,{calculateYRange:n.noop,steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}),this.scale=new t.Scale(s)},addData:function(e,t){n.each(e,function(e,n){this.datasets[n].points.push(new this.PointClass({value:e,label:t,datasetLabel:this.datasets[n].label,x:this.scale.calculateX(this.scale.valuesCount+1),y:this.scale.endPoint,strokeColor:this.datasets[n].pointStrokeColor,fillColor:this.datasets[n].pointColor}))},this),this.scale.addXLabel(t),this.update()},removeData:function(){this.scale.removeXLabel(),n.each(this.datasets,function(e){e.points.shift()},this),this.update()},reflow:function(){var e=n.extend({height:this.chart.height,width:this.chart.width});this.scale.update(e)},draw:function(e){var t=e||1;this.clear();var i=this.chart.ctx,a=function(e){return null!==e.value},s=function(e,t,i){return n.findNextWhere(t,a,i)||e},r=function(e,t,i){return n.findPreviousWhere(t,a,i)||e};this.scale&&(this.scale.draw(t),n.each(this.datasets,function(e){var o=n.where(e.points,a);n.each(e.points,function(e,n){e.hasValue()&&e.transition({y:this.scale.calculateY(e.value),x:this.scale.calculateX(n)},t)},this),this.options.bezierCurve&&n.each(o,function(e,t){var i=t>0&&t<o.length-1?this.options.bezierCurveTension:0;e.controlPoints=n.splineCurve(r(e,o,t),e,s(e,o,t),i),e.controlPoints.outer.y>this.scale.endPoint?e.controlPoints.outer.y=this.scale.endPoint:e.controlPoints.outer.y<this.scale.startPoint&&(e.controlPoints.outer.y=this.scale.startPoint),e.controlPoints.inner.y>this.scale.endPoint?e.controlPoints.inner.y=this.scale.endPoint:e.controlPoints.inner.y<this.scale.startPoint&&(e.controlPoints.inner.y=this.scale.startPoint)},this),i.lineWidth=this.options.datasetStrokeWidth,i.strokeStyle=e.strokeColor,i.beginPath(),n.each(o,function(e,t){if(0===t)i.moveTo(e.x,e.y);else if(this.options.bezierCurve){var n=r(e,o,t);i.bezierCurveTo(n.controlPoints.outer.x,n.controlPoints.outer.y,e.controlPoints.inner.x,e.controlPoints.inner.y,e.x,e.y)}else i.lineTo(e.x,e.y)},this),this.options.datasetStroke&&i.stroke(),this.options.datasetFill&&o.length>0&&(i.lineTo(o[o.length-1].x,this.scale.endPoint),i.lineTo(o[0].x,this.scale.endPoint),i.fillStyle=e.fillColor,i.closePath(),i.fill()),n.each(o,function(e){e.draw()})},this))}})}.call(this),function(){"use strict";var e=this,t=e.Chart,n=t.helpers,i={scaleShowLabelBackdrop:!0,scaleBackdropColor:"rgba(255,255,255,0.75)",scaleBeginAtZero:!0,scaleBackdropPaddingY:2,scaleBackdropPaddingX:2,scaleShowLine:!0,segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:2,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:!0,animateScale:!1,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"><%if(segments[i].label){%><%=segments[i].label%><%}%></span></li><%}%></ul>'};t.Type.extend({name:"PolarArea",defaults:i,initialize:function(e){this.segments=[],this.SegmentArc=t.Arc.extend({showStroke:this.options.segmentShowStroke,strokeWidth:this.options.segmentStrokeWidth,strokeColor:this.options.segmentStrokeColor,ctx:this.chart.ctx,innerRadius:0,x:this.chart.width/2,y:this.chart.height/2}),this.scale=new t.RadialScale({display:this.options.showScale,fontStyle:this.options.scaleFontStyle,fontSize:this.options.scaleFontSize,fontFamily:this.options.scaleFontFamily,fontColor:this.options.scaleFontColor,showLabels:this.options.scaleShowLabels,showLabelBackdrop:this.options.scaleShowLabelBackdrop,backdropColor:this.options.scaleBackdropColor,backdropPaddingY:this.options.scaleBackdropPaddingY,backdropPaddingX:this.options.scaleBackdropPaddingX,lineWidth:this.options.scaleShowLine?this.options.scaleLineWidth:0,lineColor:this.options.scaleLineColor,lineArc:!0,width:this.chart.width,height:this.chart.height,xCenter:this.chart.width/2,yCenter:this.chart.height/2,ctx:this.chart.ctx,templateString:this.options.scaleLabel,valuesCount:e.length}),this.updateScaleRange(e),this.scale.update(),n.each(e,function(e,t){this.addData(e,t,!0)},this),this.options.showTooltips&&n.bindEvents(this,this.options.tooltipEvents,function(e){var t="mouseout"!==e.type?this.getSegmentsAtEvent(e):[];n.each(this.segments,function(e){e.restore(["fillColor"])}),n.each(t,function(e){e.fillColor=e.highlightColor}),this.showTooltip(t)}),this.render()},getSegmentsAtEvent:function(e){var t=[],i=n.getRelativePosition(e);return n.each(this.segments,function(e){e.inRange(i.x,i.y)&&t.push(e)},this),t},addData:function(e,t,n){var i=t||this.segments.length;this.segments.splice(i,0,new this.SegmentArc({fillColor:e.color,highlightColor:e.highlight||e.color,label:e.label,value:e.value,outerRadius:this.options.animateScale?0:this.scale.calculateCenterOffset(e.value),circumference:this.options.animateRotate?0:this.scale.getCircumference(),startAngle:1.5*Math.PI})),n||(this.reflow(),this.update())},removeData:function(e){var t=n.isNumber(e)?e:this.segments.length-1;this.segments.splice(t,1),this.reflow(),this.update()},calculateTotal:function(e){this.total=0,n.each(e,function(e){this.total+=e.value},this),this.scale.valuesCount=this.segments.length},updateScaleRange:function(e){var t=[];n.each(e,function(e){t.push(e.value)});var i=this.options.scaleOverride?{steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}:n.calculateScaleRange(t,n.min([this.chart.width,this.chart.height])/2,this.options.scaleFontSize,this.options.scaleBeginAtZero,this.options.scaleIntegersOnly);n.extend(this.scale,i,{size:n.min([this.chart.width,this.chart.height]),xCenter:this.chart.width/2,yCenter:this.chart.height/2})},update:function(){this.calculateTotal(this.segments),n.each(this.segments,function(e){e.save()}),this.reflow(),this.render()},reflow:function(){n.extend(this.SegmentArc.prototype,{x:this.chart.width/2,y:this.chart.height/2}),this.updateScaleRange(this.segments),this.scale.update(),n.extend(this.scale,{xCenter:this.chart.width/2,yCenter:this.chart.height/2}),n.each(this.segments,function(e){e.update({outerRadius:this.scale.calculateCenterOffset(e.value)})},this)},draw:function(e){var t=e||1;this.clear(),n.each(this.segments,function(e,n){e.transition({circumference:this.scale.getCircumference(),outerRadius:this.scale.calculateCenterOffset(e.value)},t),e.endAngle=e.startAngle+e.circumference,0===n&&(e.startAngle=1.5*Math.PI),n<this.segments.length-1&&(this.segments[n+1].startAngle=e.endAngle),e.draw()},this),this.scale.draw()}})}.call(this),function(){"use strict";var e=this,t=e.Chart,n=t.helpers;t.Type.extend({name:"Radar",defaults:{scaleShowLine:!0,angleShowLineOut:!0,scaleShowLabels:!1,scaleBeginAtZero:!0,angleLineColor:"rgba(0,0,0,.1)",angleLineWidth:1,pointLabelFontFamily:"'Arial'",pointLabelFontStyle:"normal",pointLabelFontSize:10,pointLabelFontColor:"#666",pointDot:!0,pointDotRadius:3,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].strokeColor%>"><%if(datasets[i].label){%><%=datasets[i].label%><%}%></span></li><%}%></ul>'},initialize:function(e){this.PointClass=t.Point.extend({strokeWidth:this.options.pointDotStrokeWidth,radius:this.options.pointDotRadius,display:this.options.pointDot,hitDetectionRadius:this.options.pointHitDetectionRadius,ctx:this.chart.ctx}),this.datasets=[],this.buildScale(e),this.options.showTooltips&&n.bindEvents(this,this.options.tooltipEvents,function(e){var t="mouseout"!==e.type?this.getPointsAtEvent(e):[];this.eachPoints(function(e){e.restore(["fillColor","strokeColor"])}),n.each(t,function(e){e.fillColor=e.highlightFill,e.strokeColor=e.highlightStroke}),this.showTooltip(t)}),n.each(e.datasets,function(t){var i={label:t.label||null,fillColor:t.fillColor,strokeColor:t.strokeColor,pointColor:t.pointColor,pointStrokeColor:t.pointStrokeColor,points:[]};this.datasets.push(i),n.each(t.data,function(n,a){var s;this.scale.animation||(s=this.scale.getPointPosition(a,this.scale.calculateCenterOffset(n))),i.points.push(new this.PointClass({value:n,label:e.labels[a],datasetLabel:t.label,x:this.options.animation?this.scale.xCenter:s.x,y:this.options.animation?this.scale.yCenter:s.y,strokeColor:t.pointStrokeColor,fillColor:t.pointColor,highlightFill:t.pointHighlightFill||t.pointColor,highlightStroke:t.pointHighlightStroke||t.pointStrokeColor}))},this)},this),this.render()},eachPoints:function(e){n.each(this.datasets,function(t){n.each(t.points,e,this)},this)},getPointsAtEvent:function(e){var t=n.getRelativePosition(e),i=n.getAngleFromPoint({x:this.scale.xCenter,y:this.scale.yCenter},t),a=2*Math.PI/this.scale.valuesCount,s=Math.round((i.angle-1.5*Math.PI)/a),r=[];return(s>=this.scale.valuesCount||0>s)&&(s=0),i.distance<=this.scale.drawingArea&&n.each(this.datasets,function(e){r.push(e.points[s])}),r},buildScale:function(e){this.scale=new t.RadialScale({display:this.options.showScale,fontStyle:this.options.scaleFontStyle,fontSize:this.options.scaleFontSize,fontFamily:this.options.scaleFontFamily,fontColor:this.options.scaleFontColor,showLabels:this.options.scaleShowLabels,showLabelBackdrop:this.options.scaleShowLabelBackdrop,backdropColor:this.options.scaleBackdropColor,backgroundColors:this.options.scaleBackgroundColors,backdropPaddingY:this.options.scaleBackdropPaddingY,backdropPaddingX:this.options.scaleBackdropPaddingX,lineWidth:this.options.scaleShowLine?this.options.scaleLineWidth:0,lineColor:this.options.scaleLineColor,angleLineColor:this.options.angleLineColor,angleLineWidth:this.options.angleShowLineOut?this.options.angleLineWidth:0,pointLabelFontColor:this.options.pointLabelFontColor,pointLabelFontSize:this.options.pointLabelFontSize,pointLabelFontFamily:this.options.pointLabelFontFamily,pointLabelFontStyle:this.options.pointLabelFontStyle,height:this.chart.height,width:this.chart.width,xCenter:this.chart.width/2,yCenter:this.chart.height/2,ctx:this.chart.ctx,templateString:this.options.scaleLabel,labels:e.labels,valuesCount:e.datasets[0].data.length}),this.scale.setScaleSize(),this.updateScaleRange(e.datasets),this.scale.buildYLabels()},updateScaleRange:function(e){var t=function(){var t=[];return n.each(e,function(e){e.data?t=t.concat(e.data):n.each(e.points,function(e){t.push(e.value)})}),t}(),i=this.options.scaleOverride?{steps:this.options.scaleSteps,stepValue:this.options.scaleStepWidth,min:this.options.scaleStartValue,max:this.options.scaleStartValue+this.options.scaleSteps*this.options.scaleStepWidth}:n.calculateScaleRange(t,n.min([this.chart.width,this.chart.height])/2,this.options.scaleFontSize,this.options.scaleBeginAtZero,this.options.scaleIntegersOnly);n.extend(this.scale,i)},addData:function(e,t){this.scale.valuesCount++,n.each(e,function(e,n){var i=this.scale.getPointPosition(this.scale.valuesCount,this.scale.calculateCenterOffset(e));this.datasets[n].points.push(new this.PointClass({value:e,label:t,datasetLabel:this.datasets[n].label,x:i.x,y:i.y,strokeColor:this.datasets[n].pointStrokeColor,fillColor:this.datasets[n].pointColor}))},this),this.scale.labels.push(t),this.reflow(),this.update()},removeData:function(){this.scale.valuesCount--,this.scale.labels.shift(),n.each(this.datasets,function(e){e.points.shift()},this),this.reflow(),this.update()},update:function(){this.eachPoints(function(e){e.save()}),this.reflow(),this.render()},reflow:function(){n.extend(this.scale,{width:this.chart.width,height:this.chart.height,size:n.min([this.chart.width,this.chart.height]),xCenter:this.chart.width/2,yCenter:this.chart.height/2}),this.updateScaleRange(this.datasets),this.scale.setScaleSize(),this.scale.buildYLabels()},draw:function(e){var t=e||1,i=this.chart.ctx;this.clear(),this.scale.draw(),n.each(this.datasets,function(e){n.each(e.points,function(e,n){e.hasValue()&&e.transition(this.scale.getPointPosition(n,this.scale.calculateCenterOffset(e.value)),t)},this),i.lineWidth=this.options.datasetStrokeWidth,i.strokeStyle=e.strokeColor,i.beginPath(),n.each(e.points,function(e,t){0===t?i.moveTo(e.x,e.y):i.lineTo(e.x,e.y)},this),i.closePath(),i.stroke(),i.fillStyle=e.fillColor,this.options.datasetFill&&i.fill(),n.each(e.points,function(e){e.hasValue()&&e.draw()})},this)}})}.call(this);